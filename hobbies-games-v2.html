<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Premium arcade games: Snake, Block Breaker, System Merge (2048), and Space Invaders.">
    <title>Arcade Games | Estivan Ayramia</title>
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Arcade Games | Estivan Ayramia">
    <meta property="og:description" content="Play Snake, Block Breaker, System Merge, and Space Invaders.">
    <meta property="og:url" content="https://estivanayramia.com/hobbies-games.html">
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" crossorigin>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/theme.css">

    <!-- Main Site Logic (Chat, Theme, etc.) -->
    <script src="/assets/js/site.min.js" defer></script>
    
    <!-- Favicon -->
    <link rel="icon" href="/assets/img/icon-192.png" type="image/png">
    <link rel="apple-touch-icon" href="/assets/img/apple-touch-icon.png">
    
    <style>
        /* ============================================
           CRITICAL FIX: Text Sharpness & Rendering
           ============================================ */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* Prevent sub-pixel blur from transforms */
        .game-container,
        .game-card,
        .score-display,
        button {
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        
        /* ============================================
           Layout & Spacing
           ============================================ */
        body {
            padding-top: 0;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        
        main {
            padding-top: 80px;
            min-height: calc(100vh - 80px);
        }
        
        header {
            z-index: 1000;
        }
        
        /* ============================================
           Dark Mode Support
           ============================================ */
        [data-theme="dark"] body {
            background-color: #212842 !important;
            color: #e1d4c2 !important;
        }
        
        [data-theme="dark"] header {
            background-color: rgba(33, 40, 66, 0.95) !important;
            border-color: rgba(225, 212, 194, 0.1) !important;
        }
        
        [data-theme="dark"] .bg-white\/50 {
            background-color: rgba(255, 255, 255, 0.05) !important;
        }
        
        [data-theme="dark"] .border-chocolate\/10 {
            border-color: rgba(225, 212, 194, 0.1) !important;
        }
        
        [data-theme="dark"] .text-chocolate {
            color: #e1d4c2 !important;
        }
        
        [data-theme="dark"] .bg-chocolate {
            background-color: #e1d4c2 !important;
            color: #212842 !important;
        }
        
        [data-theme="dark"] .btn-skip {
            background-color: #ffffff !important;
            color: #212842 !important;
            border: 2px solid #ffffff;
        }
        
        [data-theme="dark"] .btn-skip:hover {
            background-color: #e1d4c2 !important;
            color: #212842 !important;
        }
        
        /* ============================================
           Game Container
           ============================================ */
        .game-container {
            min-height: 450px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        canvas {
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            max-width: 100%;
            height: auto;
        }

        /* ============================================
           Game Selection Cards
           ============================================ */
        .game-card {
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        
        .game-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: currentColor;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .game-card:hover::before {
            left: 100%;
        }
        
        .game-card:active {
            transform: translateY(-4px) scale(1.01);
        }
        
        /* ============================================
           Score Display
           ============================================ */
        .score-display {
            font-size: 1.5rem;
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 12px;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        /* ============================================
           SNAKE GAME
           ============================================ */
        #snake-canvas {
            border: 3px solid currentColor;
            background: #1a1a2e;
            image-rendering: pixelated;
        }
        
        [data-theme="light"] #snake-canvas {
            background: #f5f5f5;
            border-color: #362017;
        }
        
        /* ============================================
           BLOCK BREAKER
           ============================================ */
        #breaker-canvas {
            border: 3px solid currentColor;
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
        }
        
        [data-theme="light"] #breaker-canvas {
            background: linear-gradient(180deg, #f0f9ff 0%, #e0f2fe 100%);
            border-color: #362017;
        }

        /* ============================================
           SPACE INVADERS
           ============================================ */
        #invaders-canvas {
            border: 3px solid currentColor;
            background: #000000;
        }
        
        [data-theme="light"] #invaders-canvas {
            background: #1a1a1a; /* Keep dark bg for space theme even in light mode */
            border-color: #362017;
        }

        /* ============================================
           SYSTEM MERGE (2048) - Animated
           ============================================ */
        .merge-grid-container {
            position: relative;
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 12px;
            width: 340px;
            height: 340px;
            touch-action: none;
        }
        
        .merge-grid-bg {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 12px;
            width: 100%;
            height: 100%;
        }
        
        .merge-cell-bg {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }
        
        .merge-tile {
            position: absolute;
            width: 69px; /* (340 - 24 - 36) / 4 */
            height: 69px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            transition: transform 0.15s ease-in-out;
            z-index: 10;
            color: #fff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        
        .merge-tile.new {
            animation: pop-in 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .merge-tile.merged {
            animation: pop-merge 0.2s ease-in-out;
            z-index: 20;
        }
        
        @keyframes pop-in {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes pop-merge {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        /* Tile Colors */
        .tile-2 { background: #667eea; }
        .tile-4 { background: #764ba2; }
        .tile-8 { background: #f093fb; }
        .tile-16 { background: #f5576c; }
        .tile-32 { background: #4facfe; }
        .tile-64 { background: #00f2fe; }
        .tile-128 { background: #43e97b; }
        .tile-256 { background: #38f9d7; }
        .tile-512 { background: #fa709a; }
        .tile-1024 { background: #fee140; }
        .tile-2048 { background: #ff00cc; box-shadow: 0 0 20px #ff00cc; }

        /* ============================================
           MODAL
           ============================================ */
        .game-modal {
            position: fixed;
            top: 90px;
            right: 20px;
            z-index: 2000;
            max-width: 350px;
            padding: 20px;
            background: rgba(33, 40, 66, 0.98);
            border: 2px solid rgba(225, 212, 194, 0.3);
            border-radius: 16px;
            box-shadow: 0 12px 48px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            animation: modal-slide-in 0.3s ease-out;
            color: #fff;
        }
        
        @keyframes modal-slide-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .modal-close {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        /* ============================================
           Touch Controls
           ============================================ */
        .touch-controls {
            display: none;
            gap: 8px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .touch-controls {
                display: grid;
                grid-template-areas: 
                    ". up ."
                    "left . right"
                    ". down .";
                grid-template-columns: 60px 60px 60px;
                grid-template-rows: 60px 60px 60px;
            }
            
            .touch-controls.horizontal {
                display: flex;
                justify-content: center;
                gap: 20px;
            }
        }
        
        .touch-btn {
            width: 60px;
            height: 60px;
            font-size: 24px;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .touch-btn:active { background: rgba(255,255,255,0.3); }
        .touch-btn.up { grid-area: up; }
        .touch-btn.down { grid-area: down; }
        .touch-btn.left { grid-area: left; }
        .touch-btn.right { grid-area: right; }

        .hidden { display: none !important; }
        
        .btn-back {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(0,0,0,0.2);
            border: 1px solid currentColor;
            border-radius: 8px;
            color: inherit;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .btn-back:hover { background: rgba(0,0,0,0.3); }
    </style>
</head>
<body class="bg-beige text-chocolate min-h-screen transition-colors duration-300">
    <!-- Fixed Header -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-beige/95 backdrop-blur-sm border-b border-chocolate/10">
        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
            <a href="/index.html" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
                <img src="/assets/img/logo-ea.webp" alt="EA Logo" class="w-8 h-8 object-contain">
                <span class="font-semibold">Estivan Ayramia</span>
            </a>
            <div class="flex items-center gap-4">
                <a href="/contact.html" class="text-sm font-medium hover:underline">Contact</a>
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-chocolate/10 transition-colors" aria-label="Toggle theme">
                    üîÜ
                </button>
            </div>
        </div>
    </header>

    <main class="pb-12 px-4">
        <div class="max-w-6xl mx-auto">
            <!-- ========================================
                 GAME SELECTION SCREEN
                 ======================================== -->
            <section id="game-selection">
                <div class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4">Arcade Zone</h1>
                    <p class="text-lg opacity-80 max-w-2xl mx-auto">
                        Select a game to play. All games are optimized for desktop and mobile.
                    </p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 max-w-4xl mx-auto">
                    <!-- Snake -->
                    <div class="game-card bg-white/50 rounded-2xl p-6 text-center" onclick="startGame('snake')">
                        <div class="text-5xl mb-3">üêç</div>
                        <h3 class="text-2xl font-bold mb-2">Snake</h3>
                        <p class="text-sm opacity-70 mb-4">Classic reflex test. Eat and grow.</p>
                        <div class="inline-block px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium">Play Snake</div>
                    </div>
                    
                    <!-- Block Breaker -->
                    <div class="game-card bg-white/50 rounded-2xl p-6 text-center" onclick="startGame('breaker')">
                        <div class="text-5xl mb-3">üß±</div>
                        <h3 class="text-2xl font-bold mb-2">Block Breaker</h3>
                        <p class="text-sm opacity-70 mb-4">Smash bricks with your paddle and ball.</p>
                        <div class="inline-block px-4 py-2 bg-purple-600 text-white rounded-lg text-sm font-medium">Play Breaker</div>
                    </div>
                    
                    <!-- System Merge -->
                    <div class="game-card bg-white/50 rounded-2xl p-6 text-center" onclick="startGame('merge')">
                        <div class="text-5xl mb-3">üß©</div>
                        <h3 class="text-2xl font-bold mb-2">System Merge</h3>
                        <p class="text-sm opacity-70 mb-4">Join numbers to reach 2048.</p>
                        <div class="inline-block px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium">Play Merge</div>
                    </div>

                    <!-- Space Invaders -->
                    <div class="game-card bg-white/50 rounded-2xl p-6 text-center" onclick="startGame('invaders')">
                        <div class="text-5xl mb-3">üëæ</div>
                        <h3 class="text-2xl font-bold mb-2">Space Invaders</h3>
                        <p class="text-sm opacity-70 mb-4">Defend Earth from alien waves.</p>
                        <div class="inline-block px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium">Play Invaders</div>
                    </div>
                </div>
                
                <div class="text-center">
                    <a href="/hobbies.html" class="btn-skip inline-flex items-center gap-2 px-8 py-3 bg-chocolate text-beige rounded-full font-semibold hover:opacity-90 transition-all">
                        Continue to Hobbies
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                    </a>
                </div>
            </section>

            <!-- ========================================
                 SNAKE GAME SCREEN
                 ======================================== -->
            <section id="snake-game" class="hidden">
                <div class="flex items-center justify-between mb-4 max-w-md mx-auto">
                    <button onclick="backToSelection()" class="btn-back">‚Üê Menu</button>
                    <div class="score-display py-2 px-4 text-lg">Score: <span id="snake-score">0</span></div>
                </div>
                <div class="game-container">
                    <canvas id="snake-canvas" width="400" height="400"></canvas>
                    <div class="touch-controls">
                        <button class="touch-btn up" onclick="setSnakeDirection('up')">‚Üë</button>
                        <button class="touch-btn left" onclick="setSnakeDirection('left')">‚Üê</button>
                        <button class="touch-btn right" onclick="setSnakeDirection('right')">‚Üí</button>
                        <button class="touch-btn down" onclick="setSnakeDirection('down')">‚Üì</button>
                    </div>
                    <button onclick="initSnake()" class="mt-4 px-6 py-2 bg-green-600 text-white rounded-lg font-medium">Restart</button>
                </div>
            </section>

            <!-- ========================================
                 BLOCK BREAKER SCREEN
                 ======================================== -->
            <section id="breaker-game" class="hidden">
                <div class="flex items-center justify-between mb-4 max-w-md mx-auto">
                    <button onclick="backToSelection()" class="btn-back">‚Üê Menu</button>
                    <div class="score-display py-2 px-4 text-lg">Score: <span id="breaker-score">0</span></div>
                </div>
                <div class="game-container">
                    <canvas id="breaker-canvas" width="400" height="500"></canvas>
                    <div class="touch-controls horizontal">
                        <button class="touch-btn" ontouchstart="breakerPaddleDir = -1" ontouchend="breakerPaddleDir = 0" onmousedown="breakerPaddleDir = -1" onmouseup="breakerPaddleDir = 0">‚Üê</button>
                        <button class="touch-btn" ontouchstart="breakerPaddleDir = 1" ontouchend="breakerPaddleDir = 0" onmousedown="breakerPaddleDir = 1" onmouseup="breakerPaddleDir = 0">‚Üí</button>
                    </div>
                    <p class="mt-4 text-sm opacity-70">Use Left/Right arrows to move paddle.</p>
                    <button onclick="initBreaker()" class="mt-2 px-6 py-2 bg-purple-600 text-white rounded-lg font-medium">Restart</button>
                </div>
            </section>

            <!-- ========================================
                 SYSTEM MERGE SCREEN
                 ======================================== -->
            <section id="merge-game" class="hidden">
                <div class="flex items-center justify-between mb-4 max-w-md mx-auto">
                    <button onclick="backToSelection()" class="btn-back">‚Üê Menu</button>
                    <div class="score-display py-2 px-4 text-lg">Score: <span id="merge-score">0</span></div>
                </div>
                <div class="game-container">
                    <div class="merge-grid-container" id="merge-container">
                        <div class="merge-grid-bg">
                            <!-- 16 background cells -->
                            <div class="merge-cell-bg"></div><div class="merge-cell-bg"></div><div class="merge-cell-bg"></div><div class="merge-cell-bg"></div>
                            <div class="merge-cell-bg"></div><div class="merge-cell-bg"></div><div class="merge-cell-bg"></div><div class="merge-cell-bg"></div>
                            <div class="merge-cell-bg"></div><div class="merge-cell-bg"></div><div class="merge-cell-bg"></div><div class="merge-cell-bg"></div>
                            <div class="merge-cell-bg"></div><div class="merge-cell-bg"></div><div class="merge-cell-bg"></div><div class="merge-cell-bg"></div>
                        </div>
                        <div id="merge-tiles-layer"></div>
                    </div>
                    <p class="mt-4 text-sm opacity-70">Arrow keys or Swipe to merge tiles.</p>
                    <button onclick="initMerge()" class="mt-2 px-6 py-2 bg-blue-600 text-white rounded-lg font-medium">Restart</button>
                </div>
            </section>

            <!-- ========================================
                 SPACE INVADERS SCREEN
                 ======================================== -->
            <section id="invaders-game" class="hidden">
                <div class="flex items-center justify-between mb-4 max-w-md mx-auto">
                    <button onclick="backToSelection()" class="btn-back">‚Üê Menu</button>
                    <div class="score-display py-2 px-4 text-lg">Score: <span id="invaders-score">0</span></div>
                </div>
                <div class="game-container">
                    <canvas id="invaders-canvas" width="400" height="500"></canvas>
                    <div class="touch-controls horizontal">
                        <button class="touch-btn" ontouchstart="invaderDir = -1" ontouchend="invaderDir = 0" onmousedown="invaderDir = -1" onmouseup="invaderDir = 0">‚Üê</button>
                        <button class="touch-btn" onclick="invaderShoot()">üî•</button>
                        <button class="touch-btn" ontouchstart="invaderDir = 1" ontouchend="invaderDir = 0" onmousedown="invaderDir = 1" onmouseup="invaderDir = 0">‚Üí</button>
                    </div>
                    <p class="mt-4 text-sm opacity-70">Arrows to move, Space to shoot.</p>
                    <button onclick="initInvaders()" class="mt-2 px-6 py-2 bg-red-600 text-white rounded-lg font-medium">Restart</button>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-chocolate/10 py-6 px-4">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4 text-sm opacity-70">
            <p>¬© 2025 Estivan Ayramia</p>
        </div>
    </footer>

    <script>
        // ====================================================================
        // GLOBAL & UTILS
        // ====================================================================
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        let currentGame = null;
        
        // Theme Logic
        const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        html.setAttribute('data-theme', savedTheme);
        themeToggle.innerHTML = savedTheme === 'dark' ? 'üîÜ' : 'üåô';
        
        themeToggle.addEventListener('click', () => {
            const current = html.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            themeToggle.innerHTML = next === 'dark' ? 'üîÜ' : 'üåô';
        });

        // Prevent Space Scroll
        window.addEventListener('keydown', (e) => {
            if (currentGame && e.code === 'Space') {
                e.preventDefault();
            }
        });

        function startGame(game) {
            currentGame = game;
            document.getElementById('game-selection').classList.add('hidden');
            document.getElementById(`${game}-game`).classList.remove('hidden');
            
            if (game === 'snake') initSnake();
            if (game === 'breaker') initBreaker();
            if (game === 'merge') initMerge();
            if (game === 'invaders') initInvaders();
        }

        function backToSelection() {
            stopAllGames();
            document.querySelectorAll('section[id$="-game"]').forEach(s => s.classList.add('hidden'));
            document.getElementById('game-selection').classList.remove('hidden');
            currentGame = null;
        }

        function stopAllGames() {
            if (snakeInterval) clearInterval(snakeInterval);
            if (breakerAnimId) cancelAnimationFrame(breakerAnimId);
            if (invaderAnimId) cancelAnimationFrame(invaderAnimId);
            snakeRunning = false;
            breakerRunning = false;
            invaderRunning = false;
        }

        function showGameOver(emoji, title, message, restartFn) {
            const modal = document.createElement('div');
            modal.className = 'game-modal';
            modal.innerHTML = `
                <button class="modal-close" onclick="this.parentElement.remove()">√ó</button>
                <div class="text-center">
                    <div class="text-5xl mb-3">${emoji}</div>
                    <h3 class="text-xl font-bold mb-2">${title}</h3>
                    <p class="mb-4 opacity-90">${message}</p>
                    <button id="modal-restart" class="px-6 py-2 bg-white text-black rounded-lg font-bold hover:bg-gray-200">Play Again</button>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('modal-restart').onclick = () => {
                modal.remove();
                restartFn();
            };
            
            setTimeout(() => { if(modal.parentElement) modal.remove(); }, 8000);
        }

        // ====================================================================
        // SNAKE GAME
        // ====================================================================
        const snakeCanvas = document.getElementById('snake-canvas');
        const snakeCtx = snakeCanvas.getContext('2d');
        let snake = [], food = {}, snakeDir = {}, nextSnakeDir = {}, snakeScore = 0, snakeInterval, snakeRunning = false;

        function initSnake() {
            snake = [{x:10,y:10}, {x:9,y:10}, {x:8,y:10}];
            snakeDir = {x:1,y:0}; nextSnakeDir = {x:1,y:0};
            snakeScore = 0;
            document.getElementById('snake-score').textContent = '0';
            placeFood();
            if (snakeInterval) clearInterval(snakeInterval);
            snakeRunning = true;
            snakeInterval = setInterval(snakeLoop, 100);
        }

        function placeFood() {
            food = { x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20) };
        }

        function snakeLoop() {
            if (!snakeRunning) return;
            snakeDir = {...nextSnakeDir};
            const head = {x: snake[0].x + snakeDir.x, y: snake[0].y + snakeDir.y};
            
            if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || snake.some(s => s.x === head.x && s.y === head.y)) {
                snakeRunning = false;
                clearInterval(snakeInterval);
                showGameOver('üêç', 'Game Over', `Score: ${snakeScore}`, initSnake);
                return;
            }
            
            snake.unshift(head);
            if (head.x === food.x && head.y === food.y) {
                snakeScore += 10;
                document.getElementById('snake-score').textContent = snakeScore;
                placeFood();
            } else {
                snake.pop();
            }
            drawSnake();
        }

        function drawSnake() {
            snakeCtx.fillStyle = '#1a1a2e';
            snakeCtx.fillRect(0,0,400,400);
            
            // Food
            snakeCtx.fillStyle = '#ef4444';
            snakeCtx.beginPath();
            snakeCtx.arc(food.x*20+10, food.y*20+10, 8, 0, Math.PI*2);
            snakeCtx.fill();
            
            // Snake
            snake.forEach((s, i) => {
                snakeCtx.fillStyle = i===0 ? '#22c55e' : '#16a34a';
                snakeCtx.fillRect(s.x*20+1, s.y*20+1, 18, 18);
            });
        }

        function setSnakeDirection(d) {
            if (!snakeRunning) return;
            const ops = {up:'down', down:'up', left:'right', right:'left'};
            const cur = snakeDir.y===-1?'up':snakeDir.y===1?'down':snakeDir.x===-1?'left':'right';
            if (d !== ops[cur]) {
                if(d==='up') nextSnakeDir={x:0,y:-1};
                if(d==='down') nextSnakeDir={x:0,y:1};
                if(d==='left') nextSnakeDir={x:-1,y:0};
                if(d==='right') nextSnakeDir={x:1,y:0};
            }
        }

        // ====================================================================
        // BLOCK BREAKER
        // ====================================================================
        const brCanvas = document.getElementById('breaker-canvas');
        const brCtx = brCanvas.getContext('2d');
        let brPaddle = {x: 150, w: 100, h: 10}, brBall = {x: 200, y: 250, dx: 4, dy: -4, r: 6};
        let brBricks = [], brScore = 0, breakerRunning = false, breakerAnimId;
        let breakerPaddleDir = 0;

        function initBreaker() {
            brPaddle = {x: 150, w: 100, h: 10};
            brBall = {x: 200, y: 300, dx: 3 * (Math.random() > 0.5 ? 1 : -1), dy: -3, r: 6};
            brBricks = [];
            for(let c=0; c<5; c++) {
                for(let r=0; r<4; r++) {
                    brBricks.push({x: c*70 + 35, y: r*30 + 40, status: 1});
                }
            }
            brScore = 0;
            document.getElementById('breaker-score').textContent = '0';
            breakerRunning = true;
            if(breakerAnimId) cancelAnimationFrame(breakerAnimId);
            breakerLoop();
        }

        function breakerLoop() {
            if(!breakerRunning) return;
            brCtx.clearRect(0,0,400,500);
            
            // Move Paddle
            brPaddle.x += breakerPaddleDir * 7;
            if(brPaddle.x < 0) brPaddle.x = 0;
            if(brPaddle.x + brPaddle.w > 400) brPaddle.x = 400 - brPaddle.w;
            
            // Move Ball
            brBall.x += brBall.dx;
            brBall.y += brBall.dy;
            
            // Wall Collision
            if(brBall.x + brBall.r > 400 || brBall.x - brBall.r < 0) brBall.dx = -brBall.dx;
            if(brBall.y - brBall.r < 0) brBall.dy = -brBall.dy;
            if(brBall.y + brBall.r > 500) {
                breakerRunning = false;
                showGameOver('üß±', 'Game Over', `Score: ${brScore}`, initBreaker);
                return;
            }
            
            // Paddle Collision
            if(brBall.y + brBall.r > 480 && brBall.y - brBall.r < 490 && brBall.x > brPaddle.x && brBall.x < brPaddle.x + brPaddle.w) {
                brBall.dy = -Math.abs(brBall.dy); // Ensure it goes up
                // Add some angle based on hit position
                let hitPoint = brBall.x - (brPaddle.x + brPaddle.w/2);
                brBall.dx = hitPoint * 0.1; 
            }
            
            // Brick Collision
            brBricks.forEach(b => {
                if(b.status === 1) {
                    if(brBall.x > b.x && brBall.x < b.x+60 && brBall.y > b.y && brBall.y < b.y+20) {
                        brBall.dy = -brBall.dy;
                        b.status = 0;
                        brScore += 10;
                        document.getElementById('breaker-score').textContent = brScore;
                        if(brBricks.every(brick => brick.status === 0)) {
                            breakerRunning = false;
                            showGameOver('üèÜ', 'You Win!', `Score: ${brScore}`, initBreaker);
                        }
                    }
                }
            });
            
            // Draw
            brCtx.fillStyle = '#a855f7';
            brCtx.fillRect(brPaddle.x, 480, brPaddle.w, brPaddle.h);
            
            brCtx.fillStyle = '#fff';
            brCtx.beginPath();
            brCtx.arc(brBall.x, brBall.y, brBall.r, 0, Math.PI*2);
            brCtx.fill();
            
            brBricks.forEach(b => {
                if(b.status === 1) {
                    brCtx.fillStyle = `hsl(${b.y}, 70%, 60%)`;
                    brCtx.fillRect(b.x, b.y, 60, 20);
                }
            });
            
            breakerAnimId = requestAnimationFrame(breakerLoop);
        }

        // ====================================================================
        // SYSTEM MERGE (Animated)
        // ====================================================================
        let mergeTiles = []; // {id, val, r, c}
        let mergeIdCounter = 0;
        let mergeScore = 0;

        function initMerge() {
            mergeTiles = [];
            mergeIdCounter = 0;
            mergeScore = 0;
            document.getElementById('merge-score').textContent = '0';
            spawnMergeTile();
            spawnMergeTile();
            renderMerge();
            
            // Touch handling
            const el = document.getElementById('merge-container');
            let tsx=0, tsy=0;
            el.ontouchstart = e => { tsx=e.touches[0].clientX; tsy=e.touches[0].clientY; };
            el.ontouchend = e => {
                let dx = e.changedTouches[0].clientX - tsx;
                let dy = e.changedTouches[0].clientY - tsy;
                if(Math.abs(dx) > Math.abs(dy)) {
                    if(Math.abs(dx)>30) moveMerge(dx>0?'right':'left');
                } else {
                    if(Math.abs(dy)>30) moveMerge(dy>0?'down':'up');
                }
            };
        }

        function spawnMergeTile() {
            let empty = [];
            for(let r=0;r<4;r++) for(let c=0;c<4;c++) {
                if(!mergeTiles.find(t => t.r===r && t.c===c)) empty.push({r,c});
            }
            if(empty.length) {
                let spot = empty[Math.floor(Math.random()*empty.length)];
                mergeTiles.push({
                    id: mergeIdCounter++,
                    val: Math.random()<0.9?2:4,
                    r: spot.r,
                    c: spot.c,
                    new: true
                });
            }
        }

        function renderMerge() {
            const layer = document.getElementById('merge-tiles-layer');
            layer.innerHTML = '';
            mergeTiles.forEach(t => {
                const el = document.createElement('div');
                el.className = `merge-tile tile-${t.val} ${t.new?'new':''} ${t.merged?'merged':''}`;
                el.textContent = t.val;
                // Grid gap 12px, cell size ~69px. 
                // Pos = gap + (size+gap)*index
                // 12 + (69+12)*i = 12 + 81*i
                el.style.transform = `translate(${12 + t.c * 81}px, ${12 + t.r * 81}px)`;
                layer.appendChild(el);
                
                // Remove animation classes after render
                setTimeout(() => {
                    el.classList.remove('new', 'merged');
                    t.new = false; t.merged = false;
                }, 300);
            });
        }

        function moveMerge(dir) {
            let moved = false;
            // Sort tiles based on direction to process correctly
            // Right: process rightmost first (col desc)
            // Left: process leftmost first (col asc)
            // Down: process bottom first (row desc)
            // Up: process top first (row asc)
            
            let sorted = [...mergeTiles];
            if(dir==='right') sorted.sort((a,b) => b.c - a.c);
            if(dir==='left') sorted.sort((a,b) => a.c - b.c);
            if(dir==='down') sorted.sort((a,b) => b.r - a.r);
            if(dir==='up') sorted.sort((a,b) => a.r - b.r);
            
            let mergedIds = new Set();
            
            sorted.forEach(t => {
                let tr = t.r, tc = t.c;
                let dist = 0;
                
                while(true) {
                    let nr = tr, nc = tc;
                    if(dir==='right') nc++;
                    if(dir==='left') nc--;
                    if(dir==='down') nr++;
                    if(dir==='up') nr--;
                    
                    if(nr<0||nr>3||nc<0||nc>3) break;
                    
                    let obstacle = mergeTiles.find(x => x.r===nr && x.c===nc);
                    if(!obstacle) {
                        tr = nr; tc = nc; moved = true;
                    } else if(!mergedIds.has(obstacle.id) && obstacle.val === t.val) {
                        // Merge
                        mergeTiles = mergeTiles.filter(x => x.id !== t.id); // Remove current
                        obstacle.val *= 2;
                        obstacle.merged = true;
                        mergedIds.add(obstacle.id);
                        mergeScore += obstacle.val;
                        document.getElementById('merge-score').textContent = mergeScore;
                        moved = true;
                        return; // Done with this tile
                    } else {
                        break; // Hit different tile or already merged
                    }
                }
                t.r = tr; t.c = tc;
            });
            
            if(moved) {
                spawnMergeTile();
                renderMerge();
                if(mergeTiles.length === 16 && !canMergeMove()) {
                    showGameOver('üß©', 'Game Over', `Score: ${mergeScore}`, initMerge);
                }
            }
        }
        
        function canMergeMove() {
            // Simple check: if any tile has neighbor with same value
            for(let t of mergeTiles) {
                if(mergeTiles.find(n => n.val===t.val && Math.abs(n.r-t.r)+Math.abs(n.c-t.c)===1)) return true;
            }
            return false;
        }

        // ====================================================================
        // SPACE INVADERS
        // ====================================================================
        const invCanvas = document.getElementById('invaders-canvas');
        const invCtx = invCanvas.getContext('2d');
        let player = {x: 180, y: 450, w: 30, h: 20};
        let bullets = [], aliens = [], invaderDir = 0, invaderScore = 0;
        let invaderRunning = false, invaderAnimId, alienDir = 1, alienSpeed = 1;
        let lastShot = 0;

        function initInvaders() {
            player = {x: 180, y: 450, w: 30, h: 20};
            bullets = [];
            aliens = [];
            // Create aliens
            for(let r=0; r<4; r++) {
                for(let c=0; c<8; c++) {
                    aliens.push({x: c*40 + 20, y: r*30 + 20, w: 20, h: 20, active: true});
                }
            }
            invaderScore = 0;
            document.getElementById('invaders-score').textContent = '0';
            invaderRunning = true;
            alienDir = 1;
            if(invaderAnimId) cancelAnimationFrame(invaderAnimId);
            invaderLoop();
        }

        function invaderShoot() {
            if(Date.now() - lastShot > 300) {
                bullets.push({x: player.x + 13, y: player.y, active: true});
                lastShot = Date.now();
            }
        }

        function invaderLoop() {
            if(!invaderRunning) return;
            invCtx.clearRect(0,0,400,500);
            
            // Player
            player.x += invaderDir * 5;
            if(player.x < 0) player.x = 0;
            if(player.x > 370) player.x = 370;
            
            invCtx.fillStyle = '#00ff00';
            // Draw ship shape
            invCtx.beginPath();
            invCtx.moveTo(player.x + 15, player.y);
            invCtx.lineTo(player.x + 30, player.y + 20);
            invCtx.lineTo(player.x, player.y + 20);
            invCtx.fill();
            
            // Bullets
            invCtx.fillStyle = '#ffff00';
            bullets.forEach(b => {
                if(b.active) {
                    b.y -= 7;
                    invCtx.fillRect(b.x, b.y, 4, 10);
                    if(b.y < 0) b.active = false;
                    
                    // Collision
                    aliens.forEach(a => {
                        if(a.active && b.x > a.x && b.x < a.x+a.w && b.y < a.y+a.h && b.y > a.y) {
                            a.active = false;
                            b.active = false;
                            invaderScore += 10;
                            document.getElementById('invaders-score').textContent = invaderScore;
                        }
                    });
                }
            });
            
            // Aliens
            let hitEdge = false;
            aliens.forEach(a => {
                if(a.active) {
                    a.x += alienDir * alienSpeed;
                    if(a.x > 380 || a.x < 0) hitEdge = true;
                }
            });
            
            if(hitEdge) {
                alienDir *= -1;
                aliens.forEach(a => a.y += 10);
            }
            
            invCtx.fillStyle = '#ff0000';
            let activeAliens = 0;
            aliens.forEach(a => {
                if(a.active) {
                    activeAliens++;
                    invCtx.fillRect(a.x, a.y, a.w, a.h);
                    // Game Over check
                    if(a.y > 420) {
                        invaderRunning = false;
                        showGameOver('üëæ', 'Invasion Successful', `Score: ${invaderScore}`, initInvaders);
                    }
                }
            });
            
            if(activeAliens === 0) {
                invaderRunning = false;
                showGameOver('üèÜ', 'Earth Saved!', `Score: ${invaderScore}`, initInvaders);
            }
            
            invaderAnimId = requestAnimationFrame(invaderLoop);
        }

        // Keyboard Input
        document.addEventListener('keydown', e => {
            if(currentGame === 'snake') {
                if(e.key==='ArrowUp') setSnakeDirection('up');
                if(e.key==='ArrowDown') setSnakeDirection('down');
                if(e.key==='ArrowLeft') setSnakeDirection('left');
                if(e.key==='ArrowRight') setSnakeDirection('right');
            }
            if(currentGame === 'breaker') {
                if(e.key==='ArrowLeft') breakerPaddleDir = -1;
                if(e.key==='ArrowRight') breakerPaddleDir = 1;
            }
            if(currentGame === 'merge') {
                if(e.key==='ArrowUp') moveMerge('up');
                if(e.key==='ArrowDown') moveMerge('down');
                if(e.key==='ArrowLeft') moveMerge('left');
                if(e.key==='ArrowRight') moveMerge('right');
            }
            if(currentGame === 'invaders') {
                if(e.key==='ArrowLeft') invaderDir = -1;
                if(e.key==='ArrowRight') invaderDir = 1;
                if(e.code==='Space') invaderShoot();
            }
        });
        
        document.addEventListener('keyup', e => {
            if(currentGame === 'breaker') {
                if(e.key==='ArrowLeft' && breakerPaddleDir===-1) breakerPaddleDir = 0;
                if(e.key==='ArrowRight' && breakerPaddleDir===1) breakerPaddleDir = 0;
            }
            if(currentGame === 'invaders') {
                if(e.key==='ArrowLeft' && invaderDir===-1) invaderDir = 0;
                if(e.key==='ArrowRight' && invaderDir===1) invaderDir = 0;
            }
        });

    </script>
<!-- Savonie AI Chat Widget -->
    <div id="chat-widget" class="fixed bottom-6 z-50 font-sans" style="z-index: 9999;" role="region" aria-label="AI Chat Assistant">
        <!-- Chat Window (independently positioned when dragging) -->
        <div id="chat-window" class="hidden fixed w-80 h-[500px] bg-[#e1d4c2]/95 backdrop-blur-md rounded-2xl shadow-2xl border border-[#362017]/10 overflow-hidden flex-col" style="max-width: calc(100vw - 48px); max-height: calc(100vh - 120px);" role="dialog" aria-modal="true" aria-labelledby="chat-title">
            <div id="chat-header" class="bg-[#212842] p-4 flex justify-between items-center shrink-0 cursor-move select-none">
                <h3 id="chat-title" class="text-white font-medium text-sm flex items-center gap-2 pointer-events-none">
                    <img src="/assets/img/savonie-thumb.webp" alt="Savonie chatbot avatar" class="w-6 h-6 rounded-full border border-white/20 object-cover" width="64" height="64" loading="lazy" decoding="async">
                    Savonie AI
                </h3>
                <button type="button" id="close-chat" class="text-white/80 hover:text-white text-xl leading-none cursor-pointer" aria-label="Close chat">&times;</button>
            </div>
            
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-3 bg-white/50" role="log" aria-live="polite" aria-label="Chat messages"></div>

            <!-- Dynamic Suggestion Chips Container -->
            <div id="chat-chips" data-chat-suggestions="container" class="p-2 bg-white/80 border-t border-[#362017]/5 flex gap-2 overflow-x-auto whitespace-nowrap" role="group" aria-label="Suggested questions"></div>

            <div id="chat-input-area" class="pl-2 pr-4 py-4 bg-white dark:bg-[#362017] border-t border-[#362017]/10 shrink-0 flex gap-1 sm:gap-2 items-center">
                <button type="button" id="suggestions-btn" data-chat-suggestions-toggle="button" aria-label="Toggle suggestions" title="Toggle suggestions" class="shrink-0 px-1 sm:px-2 py-1 flex justify-center items-center text-[#362017]/60 hover:text-[#362017] dark:text-[#e1d4c2]/60 dark:hover:text-[#e1d4c2] transition-colors">
                    üí°
                </button>
                <input type="text" id="chat-input" placeholder="Ask a question..." class="flex-1 bg-[#e1d4c2]/30 border-none rounded-lg px-2 sm:px-3 py-1 text-xs sm:text-sm text-[#362017] dark:text-[#e1d4c2] dark:placeholder-[#e1d4c2]/60 focus:ring-2 focus:ring-[#212842]/20 outline-none min-w-0">
                <button type="button" id="send-btn" class="bg-[#212842] text-white px-1 sm:px-2 py-1 rounded-lg hover:bg-[#362017] transition-colors shrink-0 flex justify-center items-center" aria-label="Send Message">
                    <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                </button>
            </div>
        </div>

        <!-- Welcome Bubble (anchored above toggle button) -->
        <div id="welcome-bubble" class="fixed bg-white px-4 py-2 rounded-xl rounded-br-none shadow-lg border border-[#362017]/5 transform transition-all duration-500 opacity-0 translate-y-4 pointer-events-none" style="bottom: 5.625rem;">
            <p class="text-sm font-medium text-[#362017]">Hi, maybe I can help? üëã</p>
        </div>

        <!-- Toggle Button (always stays in bottom-right corner) -->
        <button type="button" id="chat-toggle" class="absolute bottom-0 right-0 bg-[#212842] w-16 h-16 rounded-full shadow-xl flex items-center justify-center hover:scale-105 hover:rotate-3 transition-all duration-300 group border-2 border-white/10 overflow-hidden" aria-label="Open Chat">
            <img src="/assets/img/savonie-thumb.webp" alt="Savonie chat UI" class="w-full h-full object-cover" width="64" height="64" loading="lazy" decoding="async">
        </button>
    </div>
    
    <script src="/assets/js/lazy-loader.min.js" defer></script>
        <!-- Scroll to Top Button -->
        <button id="scroll-to-top" class="scroll-to-top-btn" type="button" title="Back to top" aria-label="Back to top" aria-describedby="scroll-to-top-tooltip">
            <svg class="scroll-progress-ring" viewBox="0 0 47 47" width="47" height="47" aria-hidden="true" focusable="false">
                <circle class="scroll-progress-track" cx="23.5" cy="23.5" r="22" fill="none" stroke="currentColor" stroke-width="3"></circle>
                <circle class="scroll-progress-circle" cx="23.5" cy="23.5" r="22" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"></circle>
            </svg>
            <svg class="scroll-to-top-icon" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                <path d="M18 15l-6-6-6 6"></path>
            </svg>
            <div id="scroll-to-top-tooltip" class="scroll-to-top-btn-tooltip" role="tooltip">Back to top</div>
        </button>
</body>
</html>


