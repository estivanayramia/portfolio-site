(()=>{var q=(p,d)=>()=>(d||p((d={exports:{}}).exports,d),d.exports);var J=q(()=>{(function(){if(window.__SavonieHUD&&window.__SavonieHUD.open){window.__SavonieHUD.open();return}let p=window.__SavonieTelemetry;if(!p){try{console.error("[Diagnostics] Telemetry core missing.")}catch(t){}return}let d=window.__SavonieDiagnosticsConsent,N=document.createElement("style");N.textContent=`
  .savonie-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.28);z-index:999990}
  .savonie-panel{position:fixed;z-index:999991;background:rgba(225,212,194,.98);border:1px solid rgba(54,32,23,.15);
    box-shadow:0 18px 60px rgba(0,0,0,.25);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#212842}
  .savonie-header{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border-bottom:1px solid rgba(54,32,23,.12)}
  .savonie-title{font-weight:800}
  .savonie-btn{min-height:44px;border-radius:10px;border:1px solid rgba(33,40,66,.25);background:#212842;color:#fff;font-weight:700;
    padding:8px 10px;cursor:pointer}
  .savonie-btn.secondary{background:transparent;color:#362017;border:1px solid rgba(54,32,23,.22);font-weight:700}
  .savonie-tabs{display:flex;gap:8px;flex-wrap:wrap;padding:10px 12px;border-bottom:1px solid rgba(54,32,23,.12)}
  .savonie-tab{padding:8px 10px;border-radius:999px;border:1px solid rgba(33,40,66,.18);background:transparent;cursor:pointer;font-weight:700}
  .savonie-tab[aria-selected="true"]{background:#212842;color:#fff;border-color:rgba(33,40,66,.35)}
  .savonie-body{padding:12px;max-height:calc(100vh - 170px);overflow:auto}
  .savonie-kv{display:grid;grid-template-columns:160px 1fr;gap:8px 10px;font-size:13px}
  .savonie-k{opacity:.85}
  .savonie-v{word-break:break-word}
  .savonie-list{display:flex;flex-direction:column;gap:10px}
  .savonie-card{background:rgba(255,255,255,.65);border:1px solid rgba(54,32,23,.12);border-radius:12px;padding:10px}
  .savonie-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;white-space:pre-wrap;word-break:break-word}
  .savonie-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .savonie-pill{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid rgba(33,40,66,.18);background:rgba(33,40,66,.06)}
  .savonie-handle{display:none}
  @media (max-width: 767px){
    .savonie-panel{left:10px;right:10px;bottom:10px;border-radius:16px}
    .savonie-handle{display:block;margin:8px auto 0 auto;width:56px;height:5px;border-radius:999px;background:rgba(33,40,66,.25)}
  }
  @media (min-width: 768px){
    .savonie-panel{right:12px;top:12px;bottom:12px;width:440px;border-radius:16px}
  }
  `,document.head.appendChild(N);let v=document.createElement("div");v.className="savonie-backdrop";let c=document.createElement("div");c.className="savonie-panel",c.setAttribute("role","dialog"),c.setAttribute("aria-label","Diagnostics HUD"),c.tabIndex=-1;let L=document.createElement("div");L.className="savonie-handle",c.appendChild(L);let m=document.createElement("div");m.className="savonie-header";let k=document.createElement("div");k.className="savonie-title",k.textContent="Diagnostics";let S=document.createElement("div");S.className="savonie-row";let h=document.createElement("button");h.className="savonie-btn secondary",h.type="button",h.textContent="Close",h.dataset.action="close",S.appendChild(h),m.appendChild(k),m.appendChild(S);let w=document.createElement("div");w.className="savonie-tabs";let g=document.createElement("div");g.className="savonie-body",c.appendChild(m),c.appendChild(w),c.appendChild(g);let T=["Summary","Issues","Network","Errors","Performance","Layout","Storage"],u="Summary",C=null;c.addEventListener("click",t=>{let e=t.target.closest("button");if(!e)return;if(t.preventDefault(),t.stopPropagation(),e.dataset.action==="close"){y();return}if(e.classList.contains("savonie-tab")){let i=e.textContent.trim();T.includes(i)&&(u=i,f());return}let o=e.dataset.action;if(!o)return;let a=p.getState(),s=d?d.get():{consent:null,upload:!1};switch(o){case"export":try{let r=p.export({includeAll:!1});navigator.clipboard.writeText(JSON.stringify(r,null,2)),$("Copied to clipboard")}catch(r){console.error("Export failed:",r)}break;case"toggle-upload":if(d){d.set({upload:!s.upload});let r=d.get();r.consent==="granted"&&p.enable({upload:r.upload,mode:"dev"}),f()}break;case"disable":d&&d.revoke(),f();break;case"clear":d&&d.clearData(),f();break;case"copy-issue":try{let r=parseInt(e.dataset.issueIndex,10),l=a.issues||[];if(r>=0&&r<l.length){let b={schema:"savonie.issue.v1",issue:l[r],ctx:p.export({includeAll:!1}).ctx};navigator.clipboard.writeText(JSON.stringify(b,null,2)),$("Issue copied")}}catch(r){console.error("Copy issue failed:",r)}break;case"run-layout-scan":let i=P();W(i);break}}),v.addEventListener("click",t=>{t.target===v&&y()});function $(t){let e=document.createElement("div");e.style.cssText=`
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      background: rgba(33,40,66,0.95);
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      z-index: 999999;
      font-size: 13px;
      pointer-events: none;
    `,e.textContent=t,document.body.appendChild(e),setTimeout(()=>e.remove(),2e3)}function n(t,e={}){let o=document.createElement(t);t==="button"&&!("type"in e)&&(o.type="button");for(let[a,s]of Object.entries(e))a==="text"?o.textContent=s:a==="class"?o.className=s:(a.startsWith("data-"),o.setAttribute(a,s));return o}function M(){w.innerHTML="";for(let t of T){let e=n("button",{class:"savonie-tab",type:"button",role:"tab","aria-selected":t===u?"true":"false",text:t});w.appendChild(e)}}function _(t){let e=d?d.get():{consent:null,upload:!1,storage:"unknown"},o=n("div",{class:"savonie-list"}),a=n("div",{class:"savonie-card"}),s=n("div",{class:"savonie-kv"}),i=[["URL",location.href],["Referrer",document.referrer||""],["Build",t.buildVersion],["Viewport",`${window.innerWidth}x${window.innerHeight} @${window.devicePixelRatio}`],["Consent",String(e.consent||"unset")],["Upload",e.upload?"on":"off"],["Storage",e.storage],["Enabled",t.enabled?"true":"false"],["Last upload",t.lastUploadAt?new Date(t.lastUploadAt).toLocaleString():"never"],["Issues",String((t.issues||[]).length)]];for(let[x,b]of i)s.appendChild(n("div",{class:"savonie-k",text:x})),s.appendChild(n("div",{class:"savonie-v",text:String(b)}));a.appendChild(s);let r=n("div",{class:"savonie-card"}),l=n("div",{class:"savonie-row"});return l.appendChild(n("button",{class:"savonie-btn",type:"button","data-action":"export",text:"Copy export JSON"})),l.appendChild(n("button",{class:"savonie-btn secondary",type:"button","data-action":"toggle-upload",text:e.upload?"Turn upload off":"Turn upload on"})),l.appendChild(n("button",{class:"savonie-btn secondary",type:"button","data-action":"disable",text:"Disable diagnostics"})),l.appendChild(n("button",{class:"savonie-btn secondary",type:"button","data-action":"clear",text:"Delete diagnostics data"})),r.appendChild(l),o.appendChild(a),o.appendChild(r),o}function R(t){let e=n("div",{class:"savonie-list"}),o=(t.issues||[]).slice().reverse();return o.length?(o.forEach((a,s)=>{let i=n("div",{class:"savonie-card"}),r=n("div",{class:"savonie-row"});r.appendChild(n("div",{class:"savonie-pill",text:a.kind})),r.appendChild(n("div",{class:"savonie-pill",text:`count ${a.count}`})),r.appendChild(n("div",{class:"savonie-pill",text:new Date(a.lastSeen).toLocaleTimeString()}));let l=n("div",{class:"savonie-mono"});l.textContent=`${a.msg}
${a.url}
${a.signature}`;let x=n("div",{class:"savonie-row"});if(x.appendChild(n("button",{class:"savonie-btn",type:"button","data-action":"copy-issue","data-issue-index":String(s),text:"Copy issue report"})),i.appendChild(r),i.appendChild(l),a.stack){let b=n("div",{class:"savonie-mono"});b.textContent=a.stack,i.appendChild(b)}i.appendChild(x),e.appendChild(i)}),e):(e.appendChild(n("div",{class:"savonie-card",text:"No issues recorded."})),e)}function U(t){let e=n("div",{class:"savonie-list"}),o=(t.events||[]).filter(a=>a.kind==="network").slice(-80).reverse();if(!o.length)return e.appendChild(n("div",{class:"savonie-card",text:"No network events captured."})),e;for(let a of o){let s=n("div",{class:"savonie-card"}),i=a.data||{};s.appendChild(n("div",{class:"savonie-mono",text:`${i.method||""} ${i.url||""}
status ${i.status}  dur ${i.dur}ms`})),e.appendChild(s)}return e}function H(t){let e=n("div",{class:"savonie-list"}),o=(t.events||[]).filter(a=>a.kind==="error"||a.kind==="resource").slice(-80).reverse();if(!o.length)return e.appendChild(n("div",{class:"savonie-card",text:"No errors captured."})),e;for(let a of o){let s=n("div",{class:"savonie-card"}),i=a.data||{},r=n("div",{class:"savonie-mono"});r.textContent=`${a.msg}
${i.message||""}
${i.filename||""}:${i.line||""}:${i.col||""}
${i.url||""}
${i.stack||""}`,s.appendChild(r),e.appendChild(s)}return e}function z(t){let e=n("div",{class:"savonie-list"}),o=t.perf||{},a=n("div",{class:"savonie-card"}),s=n("div",{class:"savonie-kv"}),i=[["CLS",o.cls==null?"n/a":String(o.cls)],["LCP",o.lcp==null?"n/a":`${Math.round(o.lcp)}ms`],["INP",o.inp==null?"n/a":`${Math.round(o.inp)}ms`],["Long tasks",String(o.longTasks||0)]];for(let[r,l]of i)s.appendChild(n("div",{class:"savonie-k",text:r})),s.appendChild(n("div",{class:"savonie-v",text:l}));return a.appendChild(s),e.appendChild(a),e}function O(){let t=n("div",{class:"savonie-list"}),e=n("div",{class:"savonie-card"});e.appendChild(n("div",{text:"On-demand scan only. No continuous DOM scanning."}));let o=n("div",{class:"savonie-row"});return o.appendChild(n("button",{class:"savonie-btn",type:"button","data-action":"run-layout-scan",text:"Run scan"})),e.appendChild(o),t.appendChild(e),t}function P(){let t={scannedAt:Date.now(),tinyTargets:[],overflows:[]},e=document.querySelectorAll("a,button,[role='button'],input,select,textarea");for(let a of e){let s=a.getBoundingClientRect();if(s.width>0&&s.height>0&&(s.width<44||s.height<44)&&(t.tinyTargets.push({tag:a.tagName,w:Math.round(s.width),h:Math.round(s.height)}),t.tinyTargets.length>=20))break}let o=document.querySelectorAll("body *");for(let a=0;a<Math.min(o.length,1500);a++){let s=o[a],i=s.getBoundingClientRect();if(i.right>window.innerWidth+1&&(t.overflows.push({tag:s.tagName,right:Math.round(i.right),vw:window.innerWidth}),t.overflows.length>=20))break}return t}function W(t){let e=n("div",{class:"savonie-card"}),o=n("div",{class:"savonie-mono"});o.textContent=JSON.stringify(t,null,2),e.appendChild(o),g.appendChild(e)}function B(){let t=n("div",{class:"savonie-list"}),e=n("div",{class:"savonie-card"}),o=n("div",{class:"savonie-kv"}),a="n/a",s="n/a";try{a=String(localStorage.length)}catch(l){}try{s=String(sessionStorage.length)}catch(l){}let i=navigator.serviceWorker,r={controller:!!(i&&i.controller),scope:"n/a"};return o.appendChild(n("div",{class:"savonie-k",text:"localStorage keys"})),o.appendChild(n("div",{class:"savonie-v",text:a})),o.appendChild(n("div",{class:"savonie-k",text:"sessionStorage keys"})),o.appendChild(n("div",{class:"savonie-v",text:s})),o.appendChild(n("div",{class:"savonie-k",text:"SW controller"})),o.appendChild(n("div",{class:"savonie-v",text:r.controller?"true":"false"})),e.appendChild(o),t.appendChild(e),t}function f(){let t=p.getState();M(),g.innerHTML="";let e=null;u==="Summary"&&(e=_(t)),u==="Issues"&&(e=R(t)),u==="Network"&&(e=U(t)),u==="Errors"&&(e=H(t)),u==="Performance"&&(e=z(t)),u==="Layout"&&(e=O()),u==="Storage"&&(e=B()),g.appendChild(e||n("div",{class:"savonie-card",text:"Not implemented."}))}function D(t){if(t.key!=="Tab")return;let e=c.querySelectorAll("button,[href],input,select,textarea,[tabindex]:not([tabindex='-1'])");if(!e.length)return;let o=e[0],a=e[e.length-1];t.shiftKey&&document.activeElement===o?(t.preventDefault(),a.focus()):!t.shiftKey&&document.activeElement===a&&(t.preventDefault(),o.focus())}function A(){c.isConnected||(C=document.activeElement,document.body.appendChild(v),document.body.appendChild(c),f(),c.focus(),document.addEventListener("keydown",I,!0),document.addEventListener("keydown",D,!0))}function y(){if(document.removeEventListener("keydown",I,!0),document.removeEventListener("keydown",D,!0),v.isConnected&&v.remove(),c.isConnected&&c.remove(),C&&C.focus)try{C.focus()}catch(t){}}function I(t){t.key==="Escape"&&y()}let E=0;p.subscribe(()=>{c.isConnected&&(E||(E=requestAnimationFrame(()=>{E=0,f()})))}),window.__SavonieHUD={open:A,close:y},A()})()});J();})();
