(()=>{var K=(u,d)=>()=>(d||u((d={exports:{}}).exports,d),d.exports);var V=K(()=>{(function(){if(window.__SavonieHUD&&window.__SavonieHUD.open){window.__SavonieHUD.open();return}let u=window.__SavonieTelemetry;if(!u){try{console.error("[Diagnostics] Telemetry core missing.")}catch(t){}return}let d=window.__SavonieDiagnosticsConsent,L=document.createElement("style");L.textContent=`
  .savonie-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.28);z-index:999990}
  .savonie-panel{position:fixed;z-index:999991;background:rgba(225,212,194,.98);border:1px solid rgba(54,32,23,.15);
    box-shadow:0 18px 60px rgba(0,0,0,.25);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#212842}
  .savonie-header{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border-bottom:1px solid rgba(54,32,23,.12)}
  .savonie-title{font-weight:800}
  .savonie-btn{min-height:44px;border-radius:10px;border:1px solid rgba(33,40,66,.25);background:#212842;color:#fff;font-weight:700;
    padding:8px 10px;cursor:pointer}
  .savonie-btn.secondary{background:transparent;color:#362017;border:1px solid rgba(54,32,23,.22);font-weight:700}
  .savonie-tabs{display:flex;gap:8px;flex-wrap:wrap;padding:10px 12px;border-bottom:1px solid rgba(54,32,23,.12)}
  .savonie-tab{padding:8px 10px;border-radius:999px;border:1px solid rgba(33,40,66,.18);background:transparent;cursor:pointer;font-weight:700}
  .savonie-tab[aria-selected="true"]{background:#212842;color:#fff;border-color:rgba(33,40,66,.35)}
  .savonie-body{padding:12px;max-height:calc(100vh - 170px);overflow:auto}
  .savonie-kv{display:grid;grid-template-columns:160px 1fr;gap:8px 10px;font-size:13px}
  .savonie-k{opacity:.85}
  .savonie-v{word-break:break-word}
  .savonie-list{display:flex;flex-direction:column;gap:10px}
  .savonie-card{background:rgba(255,255,255,.65);border:1px solid rgba(54,32,23,.12);border-radius:12px;padding:10px}
  .savonie-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;white-space:pre-wrap;word-break:break-word}
  .savonie-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .savonie-pill{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid rgba(33,40,66,.18);background:rgba(33,40,66,.06)}
  .savonie-handle{display:none}
  @media (max-width: 767px){
    .savonie-panel{left:10px;right:10px;bottom:10px;border-radius:16px}
    .savonie-handle{display:block;margin:8px auto 0 auto;width:56px;height:5px;border-radius:999px;background:rgba(33,40,66,.25)}
  }
  @media (min-width: 768px){
    .savonie-panel{right:12px;top:12px;bottom:12px;width:440px;border-radius:16px}
  }
  `,document.head.appendChild(L);let g=document.createElement("div");g.className="savonie-backdrop",g.addEventListener("click",y);let r=document.createElement("div");r.className="savonie-panel",r.setAttribute("role","dialog"),r.setAttribute("aria-label","Diagnostics HUD"),r.tabIndex=-1;let $=document.createElement("div");$.className="savonie-handle",r.appendChild($);let x=document.createElement("div");x.className="savonie-header";let k=document.createElement("div");k.className="savonie-title",k.textContent="Diagnostics";let S=document.createElement("div");S.className="savonie-row";let b=document.createElement("button");b.className="savonie-btn secondary",b.type="button",b.textContent="Close",b.addEventListener("click",y),S.appendChild(b),x.appendChild(k),x.appendChild(S);let m=document.createElement("div");m.className="savonie-tabs";let C=document.createElement("div");C.className="savonie-body",r.appendChild(x),r.appendChild(m),r.appendChild(C);let T=["Summary","Issues","Network","Errors","Performance","Layout","Storage"],p="Summary",w=null;function n(t,e={}){let a=document.createElement(t);if(t==="button"&&!(e&&Object.prototype.hasOwnProperty.call(e,"type")))try{a.type="button"}catch(o){}for(let[o,s]of Object.entries(e))o==="text"?a.textContent=s:o==="class"?a.className=s:o.startsWith("on")&&typeof s=="function"?a.addEventListener(o.slice(2).toLowerCase(),s):a.setAttribute(o,s);return a}function R(){m.innerHTML="";for(let t of T){let e=n("button",{class:"savonie-tab",role:"tab","aria-selected":t===p?"true":"false",text:t,onclick:()=>{p=t,v()}});m.appendChild(e)}}function D(t){try{return navigator.clipboard.writeText(t),!0}catch(e){return!1}}function U(t){let e=d?d.get():{consent:null,upload:!1,storage:"unknown"},a=n("div",{class:"savonie-list"}),o=n("div",{class:"savonie-card"}),s=n("div",{class:"savonie-kv"}),i=[["URL",location.href],["Referrer",document.referrer||""],["Build",t.buildVersion],["Viewport",`${window.innerWidth}x${window.innerHeight} @${window.devicePixelRatio}`],["Consent",String(e.consent||"unset")],["Upload",e.upload?"on":"off"],["Storage",e.storage],["Enabled",t.enabled?"true":"false"],["Last upload",t.lastUploadAt?new Date(t.lastUploadAt).toLocaleString():"never"],["Issues",String((t.issues||[]).length)]];for(let[h,F]of i)s.appendChild(n("div",{class:"savonie-k",text:h})),s.appendChild(n("div",{class:"savonie-v",text:String(F)}));o.appendChild(s);let c=n("div",{class:"savonie-card"}),l=n("div",{class:"savonie-row"}),N=n("button",{class:"savonie-btn secondary",text:e.upload?"Turn upload off":"Turn upload on",onclick:()=>{if(!d)return;d.set({upload:!e.upload});let h=d.get();h.consent==="granted"&&u.enable({upload:h.upload,mode:"dev"}),v()}}),f=n("button",{class:"savonie-btn secondary",text:"Disable diagnostics",onclick:()=>{d&&d.revoke(),v()}}),J=n("button",{class:"savonie-btn secondary",text:"Delete diagnostics data",onclick:()=>{d&&d.clearData(),v()}}),j=n("button",{class:"savonie-btn",text:"Copy export JSON",onclick:()=>{let h=u.export({includeAll:!1});D(JSON.stringify(h,null,2))}});return l.appendChild(j),l.appendChild(N),l.appendChild(f),l.appendChild(J),c.appendChild(l),a.appendChild(o),a.appendChild(c),a}function I(t){let e=n("div",{class:"savonie-list"}),a=(t.issues||[]).slice().reverse();if(!a.length)return e.appendChild(n("div",{class:"savonie-card",text:"No issues recorded."})),e;for(let o of a){let s=n("div",{class:"savonie-card"}),i=n("div",{class:"savonie-row"});i.appendChild(n("div",{class:"savonie-pill",text:o.kind})),i.appendChild(n("div",{class:"savonie-pill",text:`count ${o.count}`})),i.appendChild(n("div",{class:"savonie-pill",text:new Date(o.lastSeen).toLocaleTimeString()}));let c=n("div",{class:"savonie-mono"});c.textContent=`${o.msg}
${o.url}
${o.signature}`;let l=n("div",{class:"savonie-row"}),N=n("button",{class:"savonie-btn",text:"Copy issue report",onclick:()=>{let f={issue:o,ctx:u.export({includeAll:!1}).ctx};D(JSON.stringify(f,null,2))}});if(l.appendChild(N),s.appendChild(i),s.appendChild(c),o.stack){let f=n("div",{class:"savonie-mono"});f.textContent=o.stack,s.appendChild(f)}s.appendChild(l),e.appendChild(s)}return e}function O(t){let e=n("div",{class:"savonie-list"}),a=(t.events||[]).filter(o=>o.kind==="network").slice(-80).reverse();if(!a.length)return e.appendChild(n("div",{class:"savonie-card",text:"No network events captured."})),e;for(let o of a){let s=n("div",{class:"savonie-card"}),i=o.data||{};s.appendChild(n("div",{class:"savonie-row"})),s.appendChild(n("div",{class:"savonie-mono",text:`${i.method||""} ${i.url||""}
status ${i.status}  dur ${i.dur}ms`})),e.appendChild(s)}return e}function H(t){let e=n("div",{class:"savonie-list"}),a=(t.events||[]).filter(o=>o.kind==="error"||o.kind==="resource").slice(-80).reverse();if(!a.length)return e.appendChild(n("div",{class:"savonie-card",text:"No errors captured."})),e;for(let o of a){let s=n("div",{class:"savonie-card"}),i=o.data||{},c=n("div",{class:"savonie-mono"});c.textContent=`${o.msg}
${i.message||""}
${i.filename||""}:${i.line||""}:${i.col||""}
${i.url||""}
${i.stack||""}`,s.appendChild(c),e.appendChild(s)}return e}function P(t){let e=n("div",{class:"savonie-list"}),a=t.perf||{},o=n("div",{class:"savonie-card"}),s=n("div",{class:"savonie-kv"}),i=[["CLS",a.cls==null?"n/a":String(a.cls)],["LCP",a.lcp==null?"n/a":`${Math.round(a.lcp)}ms`],["INP",a.inp==null?"n/a":`${Math.round(a.inp)}ms`],["Long tasks",String(a.longTasks||0)]];for(let[c,l]of i)s.appendChild(n("div",{class:"savonie-k",text:c})),s.appendChild(n("div",{class:"savonie-v",text:l}));return o.appendChild(s),e.appendChild(o),e}function B(){let t=n("div",{class:"savonie-list"}),e=n("div",{class:"savonie-card"}),a=n("button",{class:"savonie-btn",text:"Run scan",onclick:()=>{let o=W();z(t,o)}});return e.appendChild(n("div",{text:"On-demand scan only. No continuous DOM scanning."})),e.appendChild(n("div",{class:"savonie-row"})),e.appendChild(a),t.appendChild(e),t}function W(){let t=[],e=document.querySelectorAll("a,button,[role='button'],input,select,textarea");for(let o of e){let s=o.getBoundingClientRect();s.width>0&&s.height>0&&(s.width<44||s.height<44)&&t.push({type:"tiny_tap_target",tag:o.tagName,w:Math.round(s.width),h:Math.round(s.height)})}let a=document.querySelectorAll("body *");for(let o=0;o<Math.min(a.length,1500);o++){let s=a[o],i=s.getBoundingClientRect();i.right>window.innerWidth+1&&t.push({type:"overflow_x",tag:s.tagName,right:Math.round(i.right),vw:window.innerWidth})}return t.slice(0,100)}function z(t,e){let a=n("div",{class:"savonie-card"});a.appendChild(n("div",{class:"savonie-title",text:`Results (${e.length})`}));let o=n("div",{class:"savonie-mono"});o.textContent=JSON.stringify(e,null,2),a.appendChild(o),t.appendChild(a)}function q(){let t=n("div",{class:"savonie-list"}),e=n("div",{class:"savonie-card"}),a=n("div",{class:"savonie-kv"}),o="n/a",s="n/a";try{o=String(localStorage.length)}catch(l){}try{s=String(sessionStorage.length)}catch(l){}let i=navigator.serviceWorker,c={controller:!!(i&&i.controller),scope:"n/a"};return a.appendChild(n("div",{class:"savonie-k",text:"localStorage keys"})),a.appendChild(n("div",{class:"savonie-v",text:o})),a.appendChild(n("div",{class:"savonie-k",text:"sessionStorage keys"})),a.appendChild(n("div",{class:"savonie-v",text:s})),a.appendChild(n("div",{class:"savonie-k",text:"SW controller"})),a.appendChild(n("div",{class:"savonie-v",text:c.controller?"true":"false"})),e.appendChild(a),t.appendChild(e),t}function v(){let t=u.getState();R(),C.innerHTML="";let e=null;p==="Summary"&&(e=U(t)),p==="Issues"&&(e=I(t)),p==="Network"&&(e=O(t)),p==="Errors"&&(e=H(t)),p==="Performance"&&(e=P(t)),p==="Layout"&&(e=B()),p==="Storage"&&(e=q()),C.appendChild(e||n("div",{class:"savonie-card",text:"Not implemented."}))}function _(t){if(t.key!=="Tab")return;let e=r.querySelectorAll("button,[href],input,select,textarea,[tabindex]:not([tabindex='-1'])");if(!e.length)return;let a=e[0],o=e[e.length-1];t.shiftKey&&document.activeElement===a?(t.preventDefault(),o.focus()):!t.shiftKey&&document.activeElement===o&&(t.preventDefault(),a.focus())}function A(){r.isConnected||(w=document.activeElement,document.body.appendChild(g),document.body.appendChild(r),v(),r.focus(),document.addEventListener("keydown",M,!0),document.addEventListener("keydown",_,!0))}function y(){if(document.removeEventListener("keydown",M,!0),document.removeEventListener("keydown",_,!0),g.isConnected&&g.remove(),r.isConnected&&r.remove(),w&&w.focus)try{w.focus()}catch(t){}}function M(t){t.key==="Escape"&&y()}let E=0;u.subscribe(()=>{r.isConnected&&(E||(E=requestAnimationFrame(()=>{E=0,v()})))}),window.__SavonieHUD={open:A,close:y},A()})()});V();})();
