(()=>{var K=(b,c)=>()=>(c||b((c={exports:{}}).exports,c),c.exports);var j=K(()=>{(function(){if(document.querySelectorAll(".savonie-panel").forEach(e=>e.remove()),document.querySelectorAll(".savonie-backdrop").forEach(e=>e.remove()),window.__SavonieHUD&&window.__SavonieHUD.close)try{window.__SavonieHUD.close()}catch(e){}window.__SavonieHUD&&window.__SavonieHUD.open;let b=window.__SavonieTelemetry;if(!b){window.Savonie||(window.Savonie=window.__SavonieHUD);try{console.error("[Diagnostics] Telemetry core missing.")}catch(e){}return}let c=window.__SavonieDiagnosticsConsent,L=document.createElement("style");L.textContent=`
  .savonie-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.28);z-index:999990}
  .savonie-panel{position:fixed;z-index:999991;background:rgba(225,212,194,.98);border:1px solid rgba(54,32,23,.15);
    box-shadow:0 18px 60px rgba(0,0,0,.25);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#212842}
  .savonie-header{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border-bottom:1px solid rgba(54,32,23,.12)}
  .savonie-title{font-weight:800}
  .savonie-btn{min-height:44px;border-radius:10px;border:1px solid rgba(33,40,66,.25);background:#212842;color:#fff;font-weight:700;
    padding:8px 10px;cursor:pointer}
  .savonie-btn.secondary{background:transparent;color:#362017;border:1px solid rgba(54,32,23,.22);font-weight:700}
  .savonie-tabs{display:flex;gap:8px;flex-wrap:wrap;padding:10px 12px;border-bottom:1px solid rgba(54,32,23,.12)}
  .savonie-tab{padding:8px 10px;border-radius:999px;border:1px solid rgba(33,40,66,.18);background:transparent;cursor:pointer;font-weight:700}
  .savonie-tab[aria-selected="true"]{background:#212842;color:#fff;border-color:rgba(33,40,66,.35)}
  .savonie-body{padding:12px;max-height:calc(100vh - 170px);overflow:auto}
  .savonie-kv{display:grid;grid-template-columns:160px 1fr;gap:8px 10px;font-size:13px}
  .savonie-k{opacity:.85}
  .savonie-v{word-break:break-word}
  .savonie-list{display:flex;flex-direction:column;gap:10px}
  .savonie-card{background:rgba(255,255,255,.65);border:1px solid rgba(54,32,23,.12);border-radius:12px;padding:10px}
  .savonie-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;white-space:pre-wrap;word-break:break-word}
  .savonie-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .savonie-pill{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid rgba(33,40,66,.18);background:rgba(33,40,66,.06)}
  .savonie-handle{display:none}
  @media (max-width: 767px){
    .savonie-panel{left:10px;right:10px;bottom:10px;border-radius:16px}
    .savonie-handle{display:block;margin:8px auto 0 auto;width:56px;height:5px;border-radius:999px;background:rgba(33,40,66,.25)}
  }
  @media (min-width: 768px){
    .savonie-panel{right:12px;top:12px;bottom:12px;width:440px;border-radius:16px}
  }
  .savonie-panel.savonie-embedded{position:relative;inset:auto;right:auto;top:auto;bottom:auto;width:100%;max-width:none;
    background:#1a1f2e;color:#e1d4c2;border:1px solid #2a2f3e;box-shadow:none;z-index:2147483647 !important}
  .savonie-panel.savonie-embedded .savonie-header{border-bottom:1px solid #2a2f3e}
  .savonie-panel.savonie-embedded .savonie-tab{border-color:#2a2f3e;color:#e1d4c2}
  .savonie-panel.savonie-embedded .savonie-tab[aria-selected="true"]{background:#4a90e2 !important;color:#fff !important;border-color:#357abd !important}
  .savonie-panel.savonie-embedded .savonie-card{background:#111722;border-color:#2a2f3e}
  .savonie-panel.savonie-embedded .savonie-btn{background:#4a90e2;border-color:#357abd}
  .savonie-panel.savonie-embedded .savonie-btn.secondary{background:transparent;color:#e1d4c2;border-color:#2a2f3e}
  `,L.textContent+=`
  body.savonie-open #chatbase-bubble-button,
  body.savonie-open #chatbase-bubble-window,
  body.savonie-open iframe[id*="chat"],
  body.savonie-open .chatbase-bubble {
    display: none !important;
    pointer-events: none !important;
  }
  
  /* Force Interactivity */
  .savonie-panel, .savonie-panel * {
    pointer-events: auto !important;
  }
  `,document.head.appendChild(L),window.addEventListener("click",e=>{var t;((t=e.target.classList)!=null&&t.contains("savonie-tab")||e.target.closest(".savonie-tab"))&&console.log("[GLOBAL SNIFFER] Click detected on Tab!",{target:e.target,path:e.composedPath(),event:e})},!0);let u=document.createElement("div");u.className="savonie-backdrop";let r=document.createElement("div");r.className="savonie-panel",r.setAttribute("role","dialog"),r.setAttribute("aria-label","Diagnostics HUD"),r.tabIndex=-1;let I=document.createElement("div");I.className="savonie-handle",r.appendChild(I);let h=document.createElement("div");h.className="savonie-header";let N=document.createElement("div");N.className="savonie-title",N.textContent="Diagnostics";let D=document.createElement("div");D.className="savonie-row";let g=document.createElement("button");g.className="savonie-btn secondary",g.type="button",g.textContent="Close",g.dataset.action="close",D.appendChild(g),h.appendChild(N),h.appendChild(D);let f=document.createElement("div");f.className="savonie-tabs";let x=document.createElement("div");x.className="savonie-body",r.appendChild(h),r.appendChild(f),r.appendChild(x);let A=["Summary","Issues","Network","Errors","Performance","Layout","Storage"],l="Summary",w=null,y=null,C=document.body,k=!0,T=!1;r.addEventListener("click",e=>{let t=e.target.closest("button");if(!t)return;if(e.preventDefault(),e.stopPropagation(),t.dataset.action==="close"){S();return}if(t.classList.contains("savonie-tab")){let s=t.textContent.trim();console.log(`[HUD] Tab clicked: "${s}"`,{matches:A.includes(s),current:l}),A.includes(s)?(l=s,console.log("[HUD] Setting active tab to:",l),v()):console.warn("[HUD] Tab name not in whitelist:",s);return}let a=t.dataset.action;if(!a)return;let o=b.getState(),i=c?c.get():{consent:null,upload:!1};switch(a){case"export":try{let s=b.export({includeAll:!1});navigator.clipboard.writeText(JSON.stringify(s,null,2)),_("Copied to clipboard")}catch(s){console.error("Export failed:",s)}break;case"toggle-upload":if(c){c.set({upload:!i.upload});let s=c.get();s.consent==="granted"&&b.enable({upload:s.upload,mode:"dev"}),_(s.upload?"Automatic reporting enabled":"Automatic reporting disabled"),v()}break;case"disable":c&&c.revoke(),v();break;case"clear":c&&c.clearData(),v();break;case"copy-issue":try{let s=parseInt(t.dataset.issueIndex,10),d=o.issues||[];if(s>=0&&s<d.length){let m={schema:"savonie.issue.v1",issue:d[s],ctx:b.export({includeAll:!1}).ctx};navigator.clipboard.writeText(JSON.stringify(m,null,2)),_("Issue copied")}}catch(s){console.error("Copy issue failed:",s)}break;case"run-layout-scan":y=W(),v();break}},{capture:!0}),u.addEventListener("click",e=>{e.target===u&&S()});function _(e){let t=document.createElement("div");t.style.cssText=`
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      background: rgba(33,40,66,0.95);
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      z-index: 999999;
      font-size: 13px;
      pointer-events: none;
    `,t.textContent=e,document.body.appendChild(t),setTimeout(()=>t.remove(),2e3)}function n(e,t={}){let a=document.createElement(e);e==="button"&&!("type"in t)&&(a.type="button");for(let[o,i]of Object.entries(t))o==="text"?a.textContent=i:o==="class"?a.className=i:(o.startsWith("data-"),a.setAttribute(o,i));return a}function R(){f.innerHTML="",f.style.pointerEvents="auto",f.style.position="relative",f.style.zIndex="2147483647";for(let e of A){let t=n("button",{class:"savonie-tab",type:"button",role:"tab","aria-selected":e===l?"true":"false",text:e});t.style.pointerEvents="auto",t.style.cursor="pointer",t.addEventListener("click",function(o){o.preventDefault(),o.stopPropagation(),l!==e&&(l=e,v())},{capture:!0}),f.appendChild(t)}}function z(e){let t=c?c.get():{consent:null,upload:!1,storage:"unknown"},a=n("div",{class:"savonie-list"}),o=n("div",{class:"savonie-card"}),i=n("div",{class:"savonie-kv"}),s=[["URL",location.href],["Referrer",document.referrer||""],["Build",e.buildVersion],["Viewport",`${window.innerWidth}x${window.innerHeight} @${window.devicePixelRatio}`],["Consent",String(t.consent||"unset")],["Automatic reporting",t.upload?"on":"off"],["Storage",t.storage],["Enabled",e.enabled?"true":"false"],["Last upload",e.lastUploadAt?new Date(e.lastUploadAt).toLocaleString():"never"],["Issues",String((e.issues||[]).length)]];for(let[m,E]of s)i.appendChild(n("div",{class:"savonie-k",text:m})),i.appendChild(n("div",{class:"savonie-v",text:String(E)}));o.appendChild(i);let d=n("div",{class:"savonie-card"}),p=n("div",{class:"savonie-row"});return p.appendChild(n("button",{class:"savonie-btn",type:"button","data-action":"export",text:"Copy export JSON"})),p.appendChild(n("button",{class:"savonie-btn secondary",type:"button","data-action":"toggle-upload",text:t.upload?"Disable automatic reporting":"Enable automatic reporting"})),p.appendChild(n("button",{class:"savonie-btn secondary",type:"button","data-action":"disable",text:"Disable diagnostics"})),p.appendChild(n("button",{class:"savonie-btn secondary",type:"button","data-action":"clear",text:"Delete diagnostics data"})),d.appendChild(p),a.appendChild(o),a.appendChild(d),a}function O(e){let t=n("div",{class:"savonie-list"}),a=(e.issues||[]).slice().reverse();return a.length?(a.forEach((o,i)=>{let s=n("div",{class:"savonie-card"}),d=n("div",{class:"savonie-row"});d.appendChild(n("div",{class:"savonie-pill",text:o.kind})),d.appendChild(n("div",{class:"savonie-pill",text:`count ${o.count}`})),d.appendChild(n("div",{class:"savonie-pill",text:new Date(o.lastSeen).toLocaleTimeString()}));let p=n("div",{class:"savonie-mono"});p.textContent=`${o.msg}
${o.url}
${o.signature}`;let m=n("div",{class:"savonie-row"});if(m.appendChild(n("button",{class:"savonie-btn",type:"button","data-action":"copy-issue","data-issue-index":String(i),text:"Copy issue report"})),s.appendChild(d),s.appendChild(p),o.stack){let E=n("div",{class:"savonie-mono"});E.textContent=o.stack,s.appendChild(E)}s.appendChild(m),t.appendChild(s)}),t):(t.appendChild(n("div",{class:"savonie-card",text:"No issues recorded."})),t)}function P(e){let t=n("div",{class:"savonie-list"}),a=(e.events||[]).filter(o=>o.kind==="network").slice(-80).reverse();if(!a.length)return t.appendChild(n("div",{class:"savonie-card",text:"No network events captured."})),t;for(let o of a){let i=n("div",{class:"savonie-card"}),s=o.data||{};i.appendChild(n("div",{class:"savonie-mono",text:`${s.method||""} ${s.url||""}
status ${s.status}  dur ${s.dur}ms`})),t.appendChild(i)}return t}function B(e){let t=n("div",{class:"savonie-list"}),a=(e.events||[]).filter(o=>o.kind==="error"||o.kind==="resource").slice(-80).reverse();if(!a.length)return t.appendChild(n("div",{class:"savonie-card",text:"No errors captured."})),t;for(let o of a){let i=n("div",{class:"savonie-card"}),s=o.data||{},d=n("div",{class:"savonie-mono"});d.textContent=`${o.msg}
${s.message||""}
${s.filename||""}:${s.line||""}:${s.col||""}
${s.url||""}
${s.stack||""}`,i.appendChild(d),t.appendChild(i)}return t}function q(e){let t=n("div",{class:"savonie-list"}),a=e.perf||{},o=n("div",{class:"savonie-card"}),i=n("div",{class:"savonie-kv"}),s=[["CLS",a.cls==null?"n/a":String(a.cls)],["LCP",a.lcp==null?"n/a":`${Math.round(a.lcp)}ms`],["INP",a.inp==null?"n/a":`${Math.round(a.inp)}ms`],["Long tasks",String(a.longTasks||0)]];for(let[d,p]of s)i.appendChild(n("div",{class:"savonie-k",text:d})),i.appendChild(n("div",{class:"savonie-v",text:p}));return o.appendChild(i),t.appendChild(o),t}function F(){let e=n("div",{class:"savonie-list"}),t=n("div",{class:"savonie-card"});t.appendChild(n("div",{text:"On-demand scan only. No continuous DOM scanning."}));let a=n("div",{class:"savonie-row"});if(a.appendChild(n("button",{class:"savonie-btn",type:"button","data-action":"run-layout-scan",text:"Run scan"})),t.appendChild(a),e.appendChild(t),y){let o=n("div",{class:"savonie-card"}),i=n("div",{class:"savonie-mono"});i.textContent=JSON.stringify(y,null,2),o.appendChild(i),e.appendChild(o)}return e}function W(){let e={scannedAt:Date.now(),tinyTargets:[],overflows:[]},t=document.querySelectorAll("a,button,[role='button'],input,select,textarea");for(let o of t){let i=o.getBoundingClientRect();if(i.width>0&&i.height>0&&(i.width<44||i.height<44)&&(e.tinyTargets.push({tag:o.tagName,w:Math.round(i.width),h:Math.round(i.height)}),e.tinyTargets.length>=20))break}let a=document.querySelectorAll("body *");for(let o=0;o<Math.min(a.length,1500);o++){let i=a[o],s=i.getBoundingClientRect();if(s.right>window.innerWidth+1&&(e.overflows.push({tag:i.tagName,right:Math.round(s.right),vw:window.innerWidth}),e.overflows.length>=20))break}return e}function V(e){y=e,v()}function J(){let e=n("div",{class:"savonie-list"}),t=n("div",{class:"savonie-card"}),a=n("div",{class:"savonie-kv"}),o="n/a",i="n/a";try{o=String(localStorage.length)}catch(p){}try{i=String(sessionStorage.length)}catch(p){}let s=navigator.serviceWorker,d={controller:!!(s&&s.controller),scope:"n/a"};return a.appendChild(n("div",{class:"savonie-k",text:"localStorage keys"})),a.appendChild(n("div",{class:"savonie-v",text:o})),a.appendChild(n("div",{class:"savonie-k",text:"sessionStorage keys"})),a.appendChild(n("div",{class:"savonie-v",text:i})),a.appendChild(n("div",{class:"savonie-k",text:"SW controller"})),a.appendChild(n("div",{class:"savonie-v",text:d.controller?"true":"false"})),t.appendChild(a),e.appendChild(t),e}function v(){let e=b.getState();R(),x.innerHTML="";let t=null;l==="Summary"&&(t=z(e)),l==="Issues"&&(t=O(e)),l==="Network"&&(t=P(e)),l==="Errors"&&(t=B(e)),l==="Performance"&&(t=q(e)),l==="Layout"&&(t=F()),l==="Storage"&&(t=J()),x.appendChild(t||n("div",{class:"savonie-card",text:"Not implemented."}))}function U(e){if(e.key!=="Tab")return;let t=r.querySelectorAll("button,[href],input,select,textarea,[tabindex]:not([tabindex='-1'])");if(!t.length)return;let a=t[0],o=t[t.length-1];e.shiftKey&&document.activeElement===a?(e.preventDefault(),o.focus()):!e.shiftKey&&document.activeElement===o&&(e.preventDefault(),a.focus())}function H(e={}){let t=e||{};if(T=!!t.embedded,k=T?!1:t.backdrop!==!1,C=t.mount||document.body,r.style.pointerEvents="auto",r.style.zIndex="2147483647",T?r.classList.add("savonie-embedded"):r.classList.remove("savonie-embedded"),r.isConnected){r.parentElement!==C&&C.appendChild(r),k&&!u.isConnected&&document.body.appendChild(u),!k&&u.isConnected&&u.remove(),v(),r.focus();return}w=document.activeElement,k&&document.body.appendChild(u),C.appendChild(r),document.body.classList.add("savonie-open"),v(),r.focus(),document.addEventListener("keydown",M,!0),document.addEventListener("keydown",U,!0)}function S(){if(document.removeEventListener("keydown",M,!0),document.removeEventListener("keydown",U,!0),document.body.classList.remove("savonie-open"),u.isConnected&&u.remove(),r.isConnected&&r.remove(),w&&w.focus)try{w.focus()}catch(e){}}function M(e){e.key==="Escape"&&S()}let $=0;b.subscribe(()=>{r.isConnected&&($||($=requestAnimationFrame(()=>{$=0,v()})))}),window.__SavonieHUD={open:H,close:S},window.__SavonieHUD_AUTOOPEN===!0&&H()})()});j();})();
