console.log("[Savonie DEBUG] site.js loaded");/**
 * ============================================================================
 * PORTFOLIO SITE - MAIN JAVASCRIPT
 * ============================================================================
 * 
 * Purpose: Core functionality for the portfolio website including:
 * - Mobile-optimized navigation and scroll handling
 * - Dark/light theme management with system preference detection
 * - GSAP animations with ScrollTrigger
 * - Progressive PDF preview loading with graceful fallbacks
 * - Savonie AI chatbot integration
 * - Client-side diagnostics (opt-in with ?collect-logs=1)
 * - PWA support with service worker
 * - Achievement system
 * - Custom analytics event tracking (theme changes, scroll depth, interactions)
 * 
 * Architecture Overview:
 * 1. Core Utilities (user interaction tracking, guarded reload)
 * 2. Instrumentation Module (diagnostic logging, gated by URL param)
 * 3. Feature Modules (theme, animations, PDFs, chat, etc.)
 * 4. Analytics Integration (custom events sent to GA4 & Clarity)
 * 5. Initialization & Startup
 * 
 * Analytics Integration:
 * ----------------------
 * Analytics initialization is handled by lazy-loader.js (loaded via defer).
 * This file sends CUSTOM EVENTS to the analytics services after they're loaded.
 * 
 * Services used:
 * - Google Analytics 4 (GA4): G-MCN4RXCY6Q
 * - Microsoft Clarity: uawk2g8xee
 * 
 * How it works:
 * 1. lazy-loader.js loads analytics on first user interaction (scroll, click, etc.)
 * 2. This file checks if analytics are loaded before sending events
 * 3. Custom events: theme toggle, scroll depth, navigation clicks, form submissions
 * 4. All analytics code is defensive (checks typeof before calling)
 * 
 * To verify analytics:
 * - GA4: https://analytics.google.com → Realtime → Events
 * - Clarity: https://clarity.microsoft.com → Dashboard → Recordings
 * 
 * @version 2.1.0
 * @author Estivan Ayramia
 * @license MIT
 */let __userInteracting=!1,__userInteractingTimer=null;const __markUserInteraction=()=>{__userInteracting=!0,__userInteractingTimer&&clearTimeout(__userInteractingTimer),__userInteractingTimer=setTimeout(()=>{__userInteracting=!1},1e3)};["touchstart","touchmove","wheel","scroll"].forEach(s=>{try{window.addEventListener(s,__markUserInteraction,{passive:!0})}catch{window.addEventListener(s,__markUserInteraction)}});const __collectLogsEnabled=typeof window<"u"&&new URLSearchParams(window.location.search).has("collect-logs"),__collectedLogs=[],__saveCollected=()=>{try{localStorage.setItem("site_collect_logs",JSON.stringify(__collectedLogs.slice(-1e3)))}catch{}},__logCollect=(s,c)=>{if(__collectLogsEnabled)try{const o={t:Date.now(),msg:String(s),data:c||null,scrollY:window.scrollY||0};__collectedLogs.push(o),__saveCollected()}catch{}},__collectLogsParam=typeof window<"u"?new URLSearchParams(window.location.search).get("collect-logs"):null,__collectSnapshots=!!(__collectLogsParam&&/snapshot/i.test(__collectLogsParam)),__maybeTakeSnapshot=(s,c)=>{if(__collectSnapshots)try{const o=document.activeElement,e=t=>{if(!t||!t.getBoundingClientRect)return null;const r=t.getBoundingClientRect();return{tag:t.tagName||null,id:t.id||null,classes:t.className||null,rect:{x:Math.round(r.x),y:Math.round(r.y),w:Math.round(r.width),h:Math.round(r.height),top:Math.round(r.top),left:Math.round(r.left)},focusable:typeof t.tabIndex=="number"?t.tabIndex:null,ariaRole:t.getAttribute&&(t.getAttribute("role")||null)}},n={reason:s||null,ts:Date.now(),scrollY:window.scrollY||0,innerWidth:window.innerWidth||0,innerHeight:window.innerHeight||0,docHeight:document.documentElement.scrollHeight||document.body.scrollHeight||0,target:e(c||document.activeElement)||null,activeElement:e(o)||null};__logCollect("snapshot",n)}catch{}};if(__collectLogsEnabled){let s=null;window.addEventListener("scroll",()=>{s||(s=setTimeout(()=>{__logCollect("scroll",{y:window.scrollY,innerHeight:window.innerHeight,docHeight:document.documentElement.scrollHeight}),s=null},200))},{passive:!0});try{"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{__logCollect("controllerchange",{controller:!!navigator.serviceWorker.controller})})}catch{}try{const o=window.location.reload.bind(window.location);window.location.reload=function(){return __logCollect("location.reload called"),o()}}catch{}(()=>{const o=document.createElement("button");o.id="collect-logs-btn",o.textContent="Logs",Object.assign(o.style,{position:"fixed",left:"8px",bottom:"12px",zIndex:99999,padding:"6px 8px",fontSize:"12px",background:"rgba(33,40,66,0.85)",color:"#e1d4c2",border:"1px solid rgba(225,212,194,0.08)",borderRadius:"6px"}),o.addEventListener("click",()=>{try{const e=JSON.stringify(__collectedLogs,null,2),n=new Blob([e],{type:"application/json"}),t=URL.createObjectURL(n),r=document.createElement("a");r.href=t,r.download=`site-logs-${Date.now()}.json`,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(t)}catch{const n=window.open();n&&n.document.write("<pre>"+JSON.stringify(__collectedLogs,null,2)+"</pre>")}}),document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(o)})})();try{document.addEventListener("visibilitychange",()=>__logCollect("visibilitychange",{hidden:document.hidden})),window.addEventListener("hashchange",o=>__logCollect("hashchange",{oldURL:o.oldURL,newURL:o.newURL})),window.addEventListener("popstate",o=>__logCollect("popstate",{state:o.state})),window.addEventListener("beforeunload",o=>__logCollect("beforeunload",{})),window.addEventListener("focusin",o=>{try{__logCollect("focusin",{tag:o.target&&o.target.tagName,id:o.target&&o.target.id||null,class:o.target&&o.target.className||null})}catch{}}),(function(){const o=HTMLElement.prototype.focus;o.__wrappedByCollectLogs||(HTMLElement.prototype.focus=function(){try{__logCollect("element.focus.called",{tag:this.tagName,id:this.id||null,options:arguments[0]||null})}catch{}try{__maybeTakeSnapshot&&__maybeTakeSnapshot("focus",this)}catch{}try{return o.apply(this,arguments)}catch{try{return o.call(this)}catch{}}},HTMLElement.prototype.focus.__wrappedByCollectLogs=!0)})(),(function(){const o=Element.prototype;if(!o.__scrollIntoViewLogged){const e=o.scrollIntoView;o.scrollIntoView=function(){try{__logCollect("element.scrollIntoView",{tag:this.tagName,id:this.id||null,args:Array.from(arguments)})}catch{}try{__maybeTakeSnapshot&&__maybeTakeSnapshot("scrollIntoView",this)}catch{}return e.apply(this,arguments)},o.__scrollIntoViewLogged=!0}})();try{const o=window.scrollTo;window.scrollTo=function(){try{__logCollect("window.scrollTo",{args:Array.from(arguments)})}catch{}try{__maybeTakeSnapshot&&__maybeTakeSnapshot("window.scrollTo",null)}catch{}return o.apply(window,arguments)}}catch{}try{const o=window.scrollBy;window.scrollBy=function(){try{__logCollect("window.scrollBy",{args:Array.from(arguments)})}catch{}try{__maybeTakeSnapshot&&__maybeTakeSnapshot("window.scrollBy",null)}catch{}return o.apply(window,arguments)}}catch{}try{const o=window.fetch;window.fetch=function(e,n){try{__logCollect("fetch.start",{url:e&&e.url||e,method:n&&n.method||"GET"})}catch{}return o.apply(this,arguments).then(t=>{try{__logCollect("fetch.end",{url:t&&t.url||e,status:t.status})}catch{}return t}).catch(t=>{try{__logCollect("fetch.error",{url:e,message:t&&t.message})}catch{}throw t})}}catch{}try{let e=function(){const n=new o;let t=null;const r=n.open;n.open=function(x,g){t=g;try{__logCollect("xhr.open",{method:x,url:g})}catch{}return r.apply(n,arguments)};const d=n.send;return n.send=function(){try{__logCollect("xhr.send",{url:t})}catch{}return n.addEventListener("loadend",function(){try{__logCollect("xhr.loadend",{url:t,status:n.status})}catch{}}),d.apply(n,arguments)},n};var WrappedXHR=e;const o=window.XMLHttpRequest;e.prototype=o.prototype,window.XMLHttpRequest=e}catch{}window.addEventListener("resize",()=>__logCollect("resize",{innerWidth:window.innerWidth,innerHeight:window.innerHeight})),window.addEventListener("orientationchange",()=>__logCollect("orientationchange",{orientation:window.orientation}));try{if(navigator.serviceWorker&&navigator.serviceWorker.register){const o=navigator.serviceWorker.register.bind(navigator.serviceWorker);navigator.serviceWorker.register=function(){const e=arguments;try{__logCollect("sw.register.start",{scope:e&&e[1]&&e[1].scope||null,script:e&&e[0]})}catch{}return o.apply(navigator.serviceWorker,arguments).then(n=>{try{__logCollect("sw.register.done",{scope:n.scope})}catch{}try{n.addEventListener("updatefound",()=>__logCollect("sw.updatefound",{})),n.waiting&&__logCollect("sw.waiting",{})}catch{}return n}).catch(n=>{try{__logCollect("sw.register.error",{message:n&&n.message})}catch{}throw n})}}}catch{}try{if(typeof ScrollTrigger<"u"&&ScrollTrigger&&ScrollTrigger.refresh){const o=ScrollTrigger.refresh.bind(ScrollTrigger);ScrollTrigger.refresh=function(){try{__logCollect("ScrollTrigger.refresh",{args:Array.from(arguments)})}catch{}return o.apply(this,arguments)}}}catch{}["touchend","pointerup","mouseup"].forEach(o=>{window.addEventListener(o,e=>{try{__logCollect("gesture."+o,{x:e.changedTouches&&e.changedTouches[0]&&e.changedTouches[0].clientX||e.clientX||null,y:e.changedTouches&&e.changedTouches[0]&&e.changedTouches[0].clientY||e.clientY||null})}catch{}},{passive:!0})});try{let o=document.documentElement.scrollHeight||document.body.scrollHeight||0;new MutationObserver(()=>{try{const n=document.documentElement.scrollHeight||document.body.scrollHeight||0;if(n!==o){__logCollect("docHeight.change",{from:o,to:n});try{__maybeTakeSnapshot&&__maybeTakeSnapshot("docHeight.change",document.documentElement)}catch{}o=n}}catch{}}).observe(document.documentElement||document.body,{childList:!0,subtree:!0,attributes:!0})}catch{}try{const e=n=>{try{const t=JSON.stringify(n,(r,d)=>typeof r=="string"&&/pass(word)?|token|secret|auth|credit|cc-number|card|ssn|cvv/i.test(r)?"[REDACTED]":typeof d=="string"&&d.length>200?d.slice(0,200)+"\u2026[truncated]":d);return t.length>8192?t.slice(0,8192)+"...[truncated]":t}catch{return String(n)}};try{["log","info","warn","error","debug"].forEach(n=>{const t=console[n]&&console[n].bind(console);t&&(console[n]=function(){try{__logCollect("console."+n,{args:Array.from(arguments).map(r=>typeof r=="object"?e(r):String(r))})}catch{}try{(n==="error"||n==="warn")&&__maybeTakeSnapshot&&__maybeTakeSnapshot("console."+n,document.activeElement)}catch{}return t.apply(console,arguments)})})}catch{}window.addEventListener("error",n=>{try{__logCollect("window.error",{message:n.message,filename:n.filename,lineno:n.lineno,colno:n.colno,stack:n.error&&n.error.stack?String(n.error.stack).slice(0,1e3):null});try{__maybeTakeSnapshot&&__maybeTakeSnapshot("error",n&&n.target?n.target:document.activeElement)}catch{}}catch{}}),window.addEventListener("unhandledrejection",n=>{try{__logCollect("unhandledrejection",{reason:n.reason&&(n.reason.stack?String(n.reason.stack).slice(0,1e3):String(n.reason))})}catch{}});try{const n=localStorage.setItem.bind(localStorage);localStorage.setItem=function(t,r){try{__logCollect("localStorage.setItem",{key:String(t),size:r&&r.length||0})}catch{}return n(t,r)}}catch{}try{const n=sessionStorage.setItem.bind(sessionStorage);sessionStorage.setItem=function(t,r){try{__logCollect("sessionStorage.setItem",{key:String(t),size:r&&r.length||0})}catch{}return n(t,r)}}catch{}try{if(navigator&&navigator.sendBeacon){const n=navigator.sendBeacon.bind(navigator);navigator.sendBeacon=function(t,r){try{__logCollect("navigator.sendBeacon",{url:String(t),dataSize:r&&r.size||null})}catch{}return n(t,r)}}}catch{}try{document.addEventListener("click",n=>{try{const t=n.target&&(n.target.closest?n.target.closest("a,button,input,select,textarea,summary"):n.target);if(!t)return;const r=(t.tagName||"").toLowerCase(),d={tag:r,id:t.id||null,classes:t.className||null};r==="a"&&t.href&&(d.href=t.href.length>200?t.href.slice(0,200)+"\u2026":t.href),__logCollect("dom.click",d);try{["a","button","input","textarea","select"].includes(r)&&__maybeTakeSnapshot&&__maybeTakeSnapshot("click",t)}catch{}}catch{}},{passive:!0}),document.addEventListener("submit",n=>{try{const t=n.target;if(!t||!t.tagName||t.tagName.toLowerCase()!=="form")return;const r=Array.from(t.elements||[]).filter(d=>d.name).map(d=>({name:d.name,type:d.type||d.tagName}));__logCollect("form.submit",{action:t.action||null,method:t.method||"GET",fields:r})}catch{}},!0)}catch{}try{document.addEventListener("input",n=>{try{const t=n.target;if(!t)return;const r=t.tagName&&t.tagName.toLowerCase();if(r==="input"||r==="textarea"||r==="select"){const d={tag:r,type:t.type||null,name:t.name||null,valueLength:t.value&&t.value.length||0};__logCollect("input",d)}}catch{}},{passive:!0})}catch{}try{document.addEventListener("selectionchange",()=>{try{const n=document.getSelection&&document.getSelection();if(!n)return;const t=n.toString(),r=n.anchorNode&&n.anchorNode.parentElement&&n.anchorNode.parentElement.tagName;__logCollect("selectionchange",{length:t.length,container:r||null})}catch{}})}catch{}try{["copy","cut","paste"].forEach(n=>{document.addEventListener(n,t=>{try{__logCollect("clipboard."+n,{})}catch{}})})}catch{}try{if("PerformanceObserver"in window)try{new PerformanceObserver(t=>{t.getEntries().forEach(r=>{try{r.entryType==="longtask"?__logCollect("perf.longtask",{duration:Math.round(r.duration)}):r.entryType==="resource"&&__logCollect("perf.resource",{name:r.name,initiatorType:r.initiatorType,duration:Math.round(r.duration)})}catch{}})}).observe({entryTypes:["longtask","resource"]})}catch{}}catch{}try{const n=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(t,r,d){try{__logCollect("addEventListener",{target:this&&this.tagName?this.tagName:this&&this.constructor&&this.constructor.name||"unknown",type:t})}catch{}return n.apply(this,arguments)}}catch{}}catch{}}catch{}window.tryGuardedReload=function(o){o=o||{};const e=typeof o.MAX=="number"?o.MAX:3e4,n=typeof o.RETRY=="number"?o.RETRY:500,t=o&&typeof o.fallback=="function"?o.fallback:null,r=Date.now();(function d(){try{if(!(typeof window.__userInteracting<"u"?window.__userInteracting:!1)){try{window.location.reload()}catch{try{window.location.href=window.location.href}catch{}}return}if(Date.now()-r<e){setTimeout(d,n);return}if(t)try{t()}catch{try{window.location.reload()}catch{}}else try{window.location.reload()}catch{try{window.location.href=window.location.href}catch{}}}catch{if(t)try{t()}catch{try{window.location.reload()}catch{}}else try{window.location.reload()}catch{}}})()}}const initDarkMode=()=>{const s=document.getElementById("theme-toggle");if(!s)return;const c=window.matchMedia("(prefers-color-scheme: dark)").matches,o=localStorage.getItem("theme"),e=o||(c?"dark":"light");document.documentElement.setAttribute("data-theme",e),o||localStorage.setItem("theme",e),s.innerHTML=e==="dark"?'<span style="color: #e1d4c2">\u{1F506}</span>':'<span style="color: #212842">\u{1F319}</span>';const n=()=>{const t=document.documentElement.getAttribute("data-theme"),r=t==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",r),localStorage.setItem("theme",r),s.innerHTML=r==="dark"?'<span style="color: #e1d4c2">\u{1F506}</span>':'<span style="color: #212842">\u{1F319}</span>',typeof clarity=="function"&&clarity("event","theme_toggle",{theme:r}),typeof gtag=="function"&&gtag("event","theme_toggle",{event_category:"user_preference",event_label:r}),s.setAttribute("aria-label",`Switch to ${t} mode`)};window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{if(!localStorage.getItem("theme_manual")){const r=t.matches?"dark":"light";document.documentElement.setAttribute("data-theme",r),localStorage.setItem("theme",r),s.innerHTML=r==="dark"?'<span style="color: #e1d4c2">\u{1F506}</span>':'<span style="color: #212842">\u{1F319}</span>'}}),s.addEventListener("click",()=>{n(),localStorage.setItem("theme_manual","true")})},initMobileMenu=()=>{const s=document.getElementById("mobile-menu-toggle"),c=document.getElementById("mobile-menu");if(!s||!c)return;const o=()=>{const e=s.getAttribute("aria-expanded")==="true";c.classList.toggle("hidden"),s.setAttribute("aria-expanded",!e);const n=s.querySelector("svg");n&&(n.style.transform=e?"rotate(0deg)":"rotate(90deg)")};s.addEventListener("click",e=>{e.preventDefault(),o()}),document.addEventListener("click",e=>{!s.contains(e.target)&&!c.contains(e.target)&&(c.classList.add("hidden"),s.setAttribute("aria-expanded","false"))}),c.querySelectorAll("a").forEach(e=>{e.addEventListener("click",()=>{c.classList.add("hidden"),s.setAttribute("aria-expanded","false");const n=s.querySelector("svg");n&&(n.style.transform="rotate(0deg)")})})},initAnimations=()=>{const s=typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(max-width: 768px)").matches,c=typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;if(document.querySelectorAll("[data-gsap]").forEach(r=>{r.classList.remove("opacity-0","translate-y-8"),r.style.opacity="1",r.style.transform="none"}),typeof gsap>"u"||typeof ScrollTrigger>"u"){console.warn("GSAP or ScrollTrigger not loaded; revealing content without animations.");return}if(c)return;gsap.registerPlugin(ScrollTrigger),document.querySelectorAll('[data-gsap="fade-up"]').forEach(r=>{const d=r.getAttribute("data-gsap-delay")||0;gsap.from(r,{opacity:0,y:20,duration:.4,delay:parseFloat(d)*.5,ease:"power2.out",scrollTrigger:{trigger:r,start:"top 92%",toggleActions:"play none none none"}})});const n=document.querySelector("section:first-of-type");n&&!s&&gsap.to(n,{yPercent:20,ease:"none",scrollTrigger:{trigger:n,start:"top top",end:"bottom top",scrub:!0}}),document.querySelectorAll(".card-hover").forEach(r=>{r.addEventListener("mouseenter",()=>{gsap.to(r,{y:-8,duration:.3,ease:"power2.out"})}),r.addEventListener("mouseleave",()=>{gsap.to(r,{y:0,duration:.3,ease:"power2.out"})})})},loadGSAPAndInit=()=>{const s=typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(max-width: 768px)").matches,c=()=>{if(window.gsap&&window.ScrollTrigger){initAnimations();return}const o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js",o.onload=()=>{const e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js",e.onload=()=>{initAnimations()},document.body.appendChild(e)},document.body.appendChild(o)};if(s){initAnimations();const o=()=>{["scroll","touchstart","mousemove"].forEach(e=>window.removeEventListener(e,o)),c()};["scroll","touchstart","mousemove"].forEach(e=>window.addEventListener(e,o,{once:!0,passive:!0}))}else c()},initSmoothScroll=()=>{document.querySelectorAll('a[href^="#"]').forEach(s=>{s.addEventListener("click",function(c){const o=this.getAttribute("href");if(o==="#"){c.preventDefault();return}const e=document.querySelector(o);if(e){c.preventDefault();const r=e.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:r,behavior:"smooth"})}})})},initFormValidation=()=>{const s=document.querySelector('form[action*="formspree.io"]');if(!s)return;const c=s.querySelectorAll("input, textarea, select"),o=s.querySelector('input[type="file"][name="file"]'),e=5*1024*1024,n=["csv","doc","docx","pdf","txt","xls","xlsx","jpg","jpeg","png","gif","svg","webp"],t=s.querySelector('input[name="link"]'),r=h=>{if(!h)return!0;let k=h.trim();/^https?:\/\//i.test(k)||(k=`https://${k}`);let f;try{f=new URL(k)}catch{return!1}return!["javascript:","data:","file:","blob:","chrome:","chrome-extension:"].includes(f.protocol)};t&&t.addEventListener("blur",()=>{t.value&&!/^https?:\/\//i.test(t.value)&&(t.value=`https://${t.value.trim()}`)});const d=(h,k)=>{h.classList.add("border-red-500");let f=h.parentElement.querySelector(".inline-error");f||(f=document.createElement("p"),f.className="inline-error text-xs text-red-600 mt-1",h.parentElement.appendChild(f)),f.textContent=k},x=h=>{h.classList.remove("border-red-500");const k=h.parentElement.querySelector(".inline-error");k&&k.remove()};c.forEach(h=>{h.addEventListener("blur",()=>{h.hasAttribute("required")&&!h.value.trim()?d(h,"This field is required"):h.type==="email"&&h.value&&!h.checkValidity()?d(h,"Please enter a valid email address"):h.type==="url"&&h.value&&!r(h.value)?d(h,"Please enter a valid URL"):h.checkValidity()?x(h):d(h,h.validationMessage||"Invalid input")}),h.addEventListener("input",()=>{h.classList.contains("border-red-500")&&h.checkValidity()&&h.value.trim()&&x(h)})});let g=s.querySelector("#form-status");g||(g=document.createElement("div"),g.id="form-status",g.className="text-sm mt-3",s.appendChild(g));const E=h=>{const k=s.querySelector('button[type="submit"]');k&&(k.disabled=h,k.classList.toggle("loading",h))},_=async()=>{E(!0),g.textContent="";try{const h=new FormData(s);if(o&&o.files&&o.files[0]){const f=o.files[0],S=(f.name.split(".").pop()||"").toLowerCase();if(!n.includes(S)){g.className="text-sm mt-3 text-red-700",g.textContent="Unsupported file type. Please upload one of: CSV, DOC, DOCX, PDF, TXT, XLS, XLSX, JPG, JPEG, PNG, GIF, SVG, WEBP.",E(!1);return}if(f.size>e){g.className="text-sm mt-3 text-red-700",g.textContent="File too large (max 5MB). Please upload a smaller file.",E(!1);return}}if(t&&t.value&&!r(t.value)){g.className="text-sm mt-3 text-red-700",g.textContent="Please enter a valid link starting with https:// or http://",E(!1);return}if((await fetch(s.action,{method:"POST",body:h,headers:{Accept:"application/json"},mode:"cors",credentials:"omit"})).ok){s.reset();const f=s.parentElement;f&&(f.innerHTML=`
                        <h2 class="text-2xl font-bold text-indigodeep mb-2">Thanks - message sent!</h2>
                        <p class="text-sm text-chocolate mb-4">Enjoy a quick game while you're here.</p>
                        <div id="mini-game-root" class="w-full bg-white border border-chocolate/10 rounded-xl p-4"></div>
                    `,initMiniGame("mini-game-root"))}else{g.className="text-sm mt-3 text-red-700",g.textContent="Sorry, something went wrong. Trying fallback...";try{s.setAttribute("target","_blank"),s.submit()}catch{g.textContent="Sorry, something went wrong. Please try again or email hello@estivanayramia.com."}}}catch{g.className="text-sm mt-3 text-red-700",g.textContent="Network error detected. Opening fallback submit...";try{s.setAttribute("target","_blank"),s.submit()}catch{g.textContent="Network error. Please check your connection or email hello@estivanayramia.com."}}finally{E(!1)}};s.addEventListener("submit",h=>{let k=!0;if(c.forEach(f=>{f.checkValidity()||(k=!1,f.classList.add("border-red-500"))}),h.preventDefault(),!k){const f=s.querySelector(".border-red-500");if(f)try{f.focus({preventScroll:!0})}catch{try{__logCollect&&__logCollect("focus-fallback",{selector:f.tagName+(f.id?"#"+f.id:"")})}catch{}f.focus()}g.className="text-sm mt-3 text-red-700",g.textContent="Please complete required fields highlighted in red.";return}_()})},initMiniGame=s=>{const c=document.getElementById(s);if(!c)return;const o="mgHighScore",e="mgLeaderboard",n=parseInt(localStorage.getItem(o)||"0",10),t=()=>{try{const l=localStorage.getItem(e);if(!l)return[];const w=JSON.parse(l);return Array.isArray(w)?w.filter(L=>typeof L.name=="string"&&typeof L.score=="number").slice(0,25):[]}catch{return[]}},r=l=>{try{localStorage.setItem(e,JSON.stringify(l.slice(0,25)))}catch{}};let d=t();c.innerHTML=`
        <div class="flex items-center justify-between mb-2">
            <div class="text-sm font-medium text-indigodeep">Score: <span id="mg-score">0</span> <span id="mg-mult" class="ml-2 text-ink/60">x1</span></div>
            <div class="text-xs text-ink/60">Best: <span id="mg-best">${n}</span></div>
        </div>
        <div class="flex items-center justify-between mb-2">
            <div class="text-xs text-ink/60">Lives: <span id="mg-lives">\u2764\u2764\u2764</span></div>
            <button id="mg-start" class="text-xs bg-indigodeep text-white px-3 py-1 rounded-full">Start</button>
        </div>
        <canvas id="mg-canvas" class="w-full rounded border border-chocolate/10" style="touch-action: none; height: 320px;"></canvas>
        <p class="text-xs text-ink/60 mt-2">Catch the orbs. Golden orbs are bonus. Tap/drag on mobile, or use \u25C0 \u25B6.</p>
    `;const x=c.querySelector("#mg-canvas"),g=c.querySelector("#mg-score"),E=c.querySelector("#mg-mult"),_=c.querySelector("#mg-best"),h=c.querySelector("#mg-lives"),k=c.querySelector("#mg-start"),f=x.getContext("2d"),S=window.devicePixelRatio||1,i={running:!1,score:0,best:n,w:0,h:0,paddle:{x:0,y:0,w:90,h:12},orbs:[],particles:[],lastSpawn:0,orbInterval:900,baseSpeed:2.2,lives:3,combo:0,comboTimer:0,shake:0,t:0},j=()=>{const l=x.getBoundingClientRect();x.width=Math.floor(l.width*S),x.height=Math.floor(320*S),i.w=x.width,i.h=x.height,i.paddle.y=i.h-30*S,i.paddle.x===0&&(i.paddle.x=i.w/2-i.paddle.w*S/2),m()},P=l=>"\u2764\u2764\u2764".slice(0,l),H=l=>{navigator.vibrate&&navigator.vibrate(l)},W=(l,w,L="#212842",v=10)=>{for(let b=0;b<v;b++)i.particles.push({x:l,y:w,vx:(Math.random()-.5)*3*S,vy:-Math.random()*3*S,life:600,color:L,r:2*S})},O=()=>{const l=(8+Math.random()*2)*S,w=l+Math.random()*(i.w-2*l),L=Math.random()<.15,v=L?"#eab308":"#362017",b=(i.baseSpeed+Math.random()*1.5+i.score*.01)*S;i.orbs.push({x:w,y:l+2,r:l,vy:b,color:v,type:L?"gold":"normal"})},u=()=>{const l=f.createLinearGradient(0,0,i.w,i.h),w=(Math.sin(i.t*.001)+1)/2;l.addColorStop(0,`rgba(${210+20*w|0}, ${200+10*w|0}, 180, 0.6)`),l.addColorStop(1,"rgba(200, 190, 170, 0.6)"),f.fillStyle=l,f.fillRect(0,0,i.w,i.h)},m=()=>{const l=i.shake?Math.random()*i.shake-i.shake/2:0,w=i.shake?Math.random()*i.shake-i.shake/2:0;f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,i.w,i.h),f.translate(l,w),u();const L=Math.min(i.combo,6);f.shadowColor="rgba(33,40,66,0.6)",f.shadowBlur=L*2*S,f.fillStyle="#212842",f.fillRect(i.paddle.x,i.paddle.y,i.paddle.w*S,i.paddle.h*S),f.shadowBlur=0,i.particles.forEach(v=>{f.globalAlpha=Math.max(0,v.life/600),f.fillStyle=v.color,f.beginPath(),f.arc(v.x,v.y,v.r,0,Math.PI*2),f.fill(),f.globalAlpha=1}),i.orbs.forEach(v=>{f.beginPath(),f.fillStyle=v.color,f.shadowColor=v.type==="gold"?"rgba(234,179,8,0.6)":"rgba(54,32,23,0.3)",f.shadowBlur=v.type==="gold"?8*S:4*S,f.arc(v.x,v.y,v.r,0,Math.PI*2),f.fill(),f.shadowBlur=0})},a=l=>{if(!i.running)return;i.last||(i.last=l);const w=l-i.last;i.t+=w,i.last=l,i.comboTimer+=w,i.comboTimer>1600&&i.combo>0&&(i.combo=0,E.textContent="x1"),i.shake>0&&(i.shake=Math.max(0,i.shake-.5*S)),l-i.lastSpawn>i.orbInterval&&(O(),i.lastSpawn=l,i.orbInterval>420&&(i.orbInterval-=8));const L=i.paddle.w*S,v=i.paddle.h*S,b=i.paddle.x,M=i.paddle.y;i.orbs.forEach(A=>{A.y+=A.vy});for(let A=i.particles.length-1;A>=0;A--){const y=i.particles[A];y.x+=y.vx,y.y+=y.vy,y.vy+=.04*S,y.life-=w,y.life<=0&&i.particles.splice(A,1)}for(let A=i.orbs.length-1;A>=0;A--){const y=i.orbs[A];if(y.y+y.r>=M&&y.x>=b&&y.x<=b+L){const B=y.type==="gold"?5:1;i.combo=Math.min(i.combo+1,9),i.comboTimer=0;const Y=1+Math.floor(i.combo/3);i.score+=B*Y,g.textContent=i.score,E.textContent="x"+Y,W(y.x,M,y.color,y.type==="gold"?18:10),i.shake=Math.min(6*S,i.shake+(y.type==="gold"?4:2)),H(y.type==="gold"?25:12),i.orbs.splice(A,1),i.score%10===0&&W(y.x,y.y,"#e1d4c2",24)}else if(y.y-y.r>i.h&&(i.orbs.splice(A,1),i.lives-=1,h.textContent=P(i.lives),i.combo=0,E.textContent="x1",i.shake=10*S,H(60),i.lives<=0)){p();return}}m(),requestAnimationFrame(a)},p=()=>{i.running=!1,i.score>i.best&&(i.best=i.score,localStorage.setItem(o,String(i.best)),_.textContent=i.best),k.textContent="Restart";const l=document.createElement("div");l.className="mt-3 text-sm text-indigodeep mg-end",l.innerHTML=`
            <div class="mb-1 font-medium">Game over! Final score: ${i.score}</div>
            <p class="text-ink/80 mb-2">Hope you enjoyed this little easter egg - I'll be in touch soon.</p>
            <p class="text-ink/60">Want more surprises? Explore a few corners of the site:</p>
            <div class="mt-2 flex flex-wrap gap-2">
                <a href="overview.html" class="text-xs px-3 py-1 rounded-full border border-chocolate/20 text-indigodeep hover:bg-beige transition-colors">Overview</a>
                <a href="deep-dive.html" class="text-xs px-3 py-1 rounded-full border border-chocolate/20 text-indigodeep hover:bg-beige transition-colors">Deep Dive</a>
                <a href="projects.html" class="text-xs px-3 py-1 rounded-full border border-chocolate/20 text-indigodeep hover:bg-beige transition-colors">Projects</a>
            </div>
            ${i.score>0?`<div class='mt-4 border-t border-chocolate/10 pt-3'>
                <p class='text-ink/70 mb-2'>Submit your score to the local leaderboard (device-only) or view current rankings.</p>
                <div class='flex flex-col sm:flex-row gap-2 sm:items-center'>
                    <input id='mg-name' maxlength='16' placeholder='Username (3-16 chars)' class='flex-1 px-3 py-2 text-sm border border-chocolate/20 rounded focus:outline-none focus:ring-2 focus:ring-indigodeep'/>
                    <button id='mg-save' class='text-xs bg-indigodeep text-white px-4 py-2 rounded-full'>Save Score</button>
                    <button id='mg-view' class='text-xs bg-chocolate text-white px-4 py-2 rounded-full'>View Leaderboard</button>
                </div>
                <div id='mg-name-error' class='mt-2 text-xs text-red-600 hidden'></div>
                <div id='mg-leaderboard' class='mt-3 hidden'></div>
            </div>`:""}
        `,c.appendChild(l);const w=l.querySelector("#mg-name"),L=l.querySelector("#mg-save"),v=l.querySelector("#mg-view"),b=l.querySelector("#mg-name-error"),M=l.querySelector("#mg-leaderboard");if(!L||!v)return;const A=["fuck","shit","bitch","cunt","dick","piss","cock","asshole","retard","fag","faggot","nigger","nigga","spic","chink","whore","slut","bastard","twat","rape","cum","penis","vagina"],y=I=>I.toLowerCase().replace(/[@]/g,"a").replace(/[$]/g,"s").replace(/0/g,"o").replace(/1/g,"i").replace(/3/g,"e").replace(/4/g,"a").replace(/5/g,"s").replace(/7/g,"t"),B=I=>{const D=y(I).replace(/[_-]/g,"");return!A.some(q=>D.includes(q))},Y=/^[A-Za-z0-9_-]{3,16}$/,$=()=>{if(!M)return;let I="<table class='w-full text-xs'><thead><tr class='text-indigodeep'><th class='text-left pb-1'>#</th><th class='text-left pb-1'>User</th><th class='text-right pb-1'>Score</th></tr></thead><tbody>";d.slice(0,10).forEach((D,q)=>{I+=`<tr class='border-t border-chocolate/10'><td class='py-1 pr-2'>${q+1}</td><td class='py-1 pr-2'>${D.name}</td><td class='py-1 text-right'>${D.score}</td></tr>`}),d.length===0&&(I+="<tr><td colspan='3' class='py-2 text-ink/60'>No scores yet.</td></tr>"),I+="</tbody></table>",M.innerHTML=I};v.addEventListener("click",()=>{M.classList.toggle("hidden"),M.classList.contains("hidden")?v.textContent="View Leaderboard":($(),v.textContent="Hide Leaderboard")}),L.addEventListener("click",()=>{const I=(w.value||"").trim();if(!Y.test(I)){b.textContent="Username must be 3-16 chars: letters, numbers, _ or - only.",b.classList.remove("hidden");return}if(!B(I)){b.textContent="Please choose a different name (profanity not allowed).",b.classList.remove("hidden");return}b.classList.add("hidden"),d.push({name:I,score:i.score,ts:Date.now()}),d.sort((D,q)=>q.score-D.score||D.ts-q.ts),d=d.slice(0,25),r(d),$(),M.classList.remove("hidden"),v.textContent="Hide Leaderboard",L.disabled=!0,L.textContent="Saved"})},T=()=>{i.running=!0,i.score=0,g.textContent="0",i.orbs=[],i.particles=[],i.lastSpawn=0,i.orbInterval=900,i.baseSpeed=2.2,i.lives=3,h.textContent=P(3),i.combo=0,E.textContent="x1",i.t=0,i.shake=0,[...c.querySelectorAll(".mg-end")].forEach(l=>l.remove()),requestAnimationFrame(a)},C=l=>{const w=x.getBoundingClientRect();let L=(l-w.left)*S-i.paddle.w*S/2;L=Math.max(0,Math.min(L,i.w-i.paddle.w*S)),i.paddle.x=L};x.addEventListener("mousemove",l=>C(l.clientX)),x.addEventListener("touchstart",l=>{l.touches[0]&&C(l.touches[0].clientX)},{passive:!0}),x.addEventListener("touchmove",l=>{l.touches[0]&&C(l.touches[0].clientX)},{passive:!0}),window.addEventListener("keydown",l=>{l.key==="ArrowLeft"&&C(x.getBoundingClientRect().left+i.paddle.x/S-24),l.key==="ArrowRight"&&C(x.getBoundingClientRect().left+i.paddle.x/S+24)}),k.addEventListener("click",()=>{k.textContent="Playing...",T()}),window.addEventListener("resize",j),j(),m()},initLazyLoading=()=>{const s=document.querySelectorAll("img[data-src]");if("IntersectionObserver"in window){const c=new IntersectionObserver((o,e)=>{o.forEach(n=>{if(n.isIntersecting){const t=n.target;t.src=t.dataset.src,t.removeAttribute("data-src"),c.unobserve(t)}})});s.forEach(o=>c.observe(o))}else s.forEach(c=>{c.src=c.dataset.src,c.removeAttribute("data-src")})},initPdfPreviews=()=>{try{document.querySelectorAll(".preview-panel").forEach(s=>{try{const c=s.closest("section")||s.parentElement;if(!c)return;const o=c.querySelector('a[href$=".pdf"]');if(!o)return;const e=o.href;s.dataset.pdfLoaded="true";const n=g=>{try{s.innerHTML='<div class="rounded-xl border border-chocolate/20 bg-white/40 overflow-hidden p-8 text-center"><p class="text-sm text-chocolate/70">Inline PDF preview may be blocked by hosting or browser settings. Use the buttons below to open or download the deck.</p></div>',__logCollect&&__logCollect("pdf.preview.fallback",{url:e,reason:g})}catch{}};s.innerHTML=`<div class="py-12 bg-white/30 rounded-xl border border-chocolate/10 flex items-center justify-center min-h-[480px]">
  <div class="text-sm text-chocolate/60 flex items-center gap-2"><svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Loading preview\u2026</div>
</div>`;const t=document.createElement("iframe");t.setAttribute("aria-label","PDF preview"),t.style.cssText="width:100%;height:480px;border:0;border-radius:12px;background:#fff;opacity:0;position:absolute;top:0;left:0;",t.referrerPolicy="strict-origin-when-cross-origin",s.style.position="relative",s.style.minHeight="480px";let r=!1,d=!1;const x=g=>{if(!d)if(d=!0,g){t.style.position="relative",t.style.opacity="1",t.style.transition="opacity 0.3s ease";const E=s.querySelector("div");E&&E.remove(),__logCollect&&__logCollect("pdf.preview.loaded",{url:e})}else{try{t.remove()}catch{}n("load_failed")}};t.addEventListener("load",()=>{r=!0,setTimeout(()=>x(!0),100)}),t.addEventListener("error",()=>x(!1));try{t.src=e,s.appendChild(t),__logCollect&&__logCollect("pdf.preview.attempt",{url:e})}catch{x(!1);return}setTimeout(()=>{r||x(!0)},5e3)}catch{}})}catch{}},initScrollToTop=()=>{const s=document.getElementById("scroll-to-top");if(!s)return;const c=()=>{const n=(document.documentElement.scrollHeight-window.innerHeight)*.25;window.scrollY>n?s.classList.add("show"):s.classList.remove("show")},o=()=>{typeof clarity=="function"&&clarity("event","scroll_to_top_clicked"),typeof gtag=="function"&&gtag("event","scroll_to_top",{event_category:"navigation",event_label:"button_click"}),window.scrollTo({top:0,behavior:"smooth"})};window.addEventListener("scroll",c),s.addEventListener("click",o),c()},getCurrentLanguage=()=>document.documentElement.lang||"en",translations={achievement:{en:{unlocked:"Achievement Unlocked!",explorer:{name:"Explorer",description:"Visited all main pages"},reader:{name:"Deep Diver",description:"Read the full Deep Dive"},gamer:{name:"Game Master",description:"Played the contact form game"},chatter:{name:"Conversationalist",description:"Opened the chat"},nightOwl:{name:"Night Owl",description:"Toggled dark mode"},konami:{name:"Secret Discoverer",description:"Found the Konami code"},networker:{name:"Networker",description:"Visited social profiles"},formFiller:{name:"Messenger",description:"Submitted the contact form"}},es:{unlocked:"\xA1Logro Desbloqueado!",explorer:{name:"Explorador",description:"Visit\xF3 todas las p\xE1ginas principales"},reader:{name:"Buzo Profundo",description:"Ley\xF3 la inmersi\xF3n completa"},gamer:{name:"Maestro del Juego",description:"Jug\xF3 el juego del formulario de contacto"},chatter:{name:"Conversador",description:"Abri\xF3 el chat"},nightOwl:{name:"Noct\xE1mbulo",description:"Altern\xF3 el modo oscuro"},konami:{name:"Descubridor Secreto",description:"Encontr\xF3 el c\xF3digo Konami"},networker:{name:"Redactor",description:"Visit\xF3 perfiles sociales"},formFiller:{name:"Mensajero",description:"Envi\xF3 el formulario de contacto"}},ar:{unlocked:"\u062A\u0645 \u0625\u0644\u063A\u0627\u0621 \u0642\u0641\u0644 \u0627\u0644\u0625\u0646\u062C\u0627\u0632!",explorer:{name:"\u0627\u0644\u0645\u0633\u062A\u0643\u0634\u0641",description:"\u0632\u0627\u0631 \u062C\u0645\u064A\u0639 \u0627\u0644\u0635\u0641\u062D\u0627\u062A \u0627\u0644\u0631\u0626\u064A\u0633\u064A\u0629"},reader:{name:"\u0627\u0644\u063A\u0648\u0627\u0635 \u0627\u0644\u0639\u0645\u064A\u0642",description:"\u0642\u0631\u0623 \u0627\u0644\u063A\u0648\u0635 \u0627\u0644\u0643\u0627\u0645\u0644"},gamer:{name:"\u0633\u064A\u062F \u0627\u0644\u0644\u0639\u0628\u0629",description:"\u0644\u0639\u0628 \u0644\u0639\u0628\u0629 \u0646\u0645\u0648\u0630\u062C \u0627\u0644\u0627\u062A\u0635\u0627\u0644"},chatter:{name:"\u0627\u0644\u0645\u062D\u0627\u062F\u062B",description:"\u0641\u062A\u062D \u0627\u0644\u062F\u0631\u062F\u0634\u0629"},nightOwl:{name:"\u0628\u0648\u0645\u0629 \u0627\u0644\u0644\u064A\u0644",description:"\u0628\u062F\u0651\u0644 \u0627\u0644\u0648\u0636\u0639 \u0627\u0644\u0645\u0638\u0644\u0645"},konami:{name:"\u0627\u0644\u0645\u0643\u062A\u0634\u0641 \u0627\u0644\u0633\u0631\u064A",description:"\u0648\u062C\u062F \u0631\u0645\u0632 \u0643\u0648\u0646\u0627\u0645\u064A"},networker:{name:"\u0627\u0644\u0634\u0628\u0643\u064A",description:"\u0632\u0627\u0631 \u0627\u0644\u0645\u0644\u0641\u0627\u062A \u0627\u0644\u0634\u062E\u0635\u064A\u0629 \u0627\u0644\u0627\u062C\u062A\u0645\u0627\u0639\u064A\u0629"},formFiller:{name:"\u0627\u0644\u0631\u0633\u0648\u0644",description:"\u0623\u0631\u0633\u0644 \u0646\u0645\u0648\u0630\u062C \u0627\u0644\u0627\u062A\u0635\u0627\u0644"}}},konami:{en:{title:"\u{1F3AE} You found the secret!",message:"Congratulations! You've unlocked the Konami code.",giftText:"Click the gift for a surprise!",stats:"You're one of the {percent}% who found this!",compliments:["You're absolutely amazing! \u{1F31F}","You're a coding wizard! \u{1F9D9}\u200D\u2642\uFE0F","You're incredibly talented! \u{1F3A8}","You're a problem-solving genius! \u{1F9E0}","You're making the world better! \u{1F30D}","You're a creative powerhouse! \u26A1","You're inspiring others! \u{1F4AB}","You're a true innovator! \u{1F680}","You're exceptionally skilled! \u{1F3C6}","You're a digital artist! \u{1F3AD}","You're building something incredible! \u{1F3D7}\uFE0F","You're a technology trailblazer! \u{1F5FA}\uFE0F","You're exceptionally creative! \u{1F3A8}","You're a user experience master! \u{1F3AF}","You're a design virtuoso! \u{1F3A8}"]},es:{title:"\u{1F3AE} \xA1Encontraste el secreto!",message:"\xA1Felicitaciones! Has desbloqueado el c\xF3digo Konami.",giftText:"\xA1Haz clic en el regalo para una sorpresa!",stats:"\xA1Eres uno del {percent}% que encontr\xF3 esto!",compliments:["\xA1Eres absolutamente incre\xEDble! \u{1F31F}","\xA1Eres un mago de la programaci\xF3n! \u{1F9D9}\u200D\u2642\uFE0F","\xA1Eres incre\xEDblemente talentoso! \u{1F3A8}","\xA1Eres un genio para resolver problemas! \u{1F9E0}","\xA1Est\xE1s haciendo el mundo mejor! \u{1F30D}","\xA1Eres una potencia creativa! \u26A1","\xA1Est\xE1s inspirando a otros! \u{1F4AB}","\xA1Eres un verdadero innovador! \u{1F680}","\xA1Eres excepcionalmente h\xE1bil! \u{1F3C6}","\xA1Eres un artista digital! \u{1F3AD}","\xA1Est\xE1s construyendo algo incre\xEDble! \u{1F3D7}\uFE0F","\xA1Eres un pionero de la tecnolog\xEDa! \u{1F5FA}\uFE0F","\xA1Eres excepcionalmente creativo! \u{1F3A8}","\xA1Eres un maestro de la experiencia del usuario! \u{1F3AF}","\xA1Eres un virtuoso del dise\xF1o! \u{1F3A8}"]},ar:{title:"\u{1F3AE} \u0644\u0642\u062F \u0648\u062C\u062F\u062A \u0627\u0644\u0633\u0631!",message:"\u062A\u0647\u0627\u0646\u064A\u0646\u0627! \u0644\u0642\u062F \u0642\u0645\u062A \u0628\u0641\u062A\u062D \u0631\u0645\u0632 \u0643\u0648\u0646\u0627\u0645\u064A.",giftText:"\u0627\u0646\u0642\u0631 \u0639\u0644\u0649 \u0627\u0644\u0647\u062F\u064A\u0629 \u0644\u0644\u062D\u0635\u0648\u0644 \u0639\u0644\u0649 \u0645\u0641\u0627\u062C\u0623\u0629!",stats:"\u0623\u0646\u062A \u0648\u0627\u062D\u062F \u0645\u0646 {percent}% \u0627\u0644\u0630\u064A\u0646 \u0648\u062C\u062F\u0648\u0627 \u0647\u0630\u0627!",compliments:["\u0623\u0646\u062A \u0631\u0627\u0626\u0639 \u062A\u0645\u0627\u0645\u0627\u064B! \u{1F31F}","\u0623\u0646\u062A \u0633\u0627\u062D\u0631 \u0628\u0631\u0645\u062C\u0629! \u{1F9D9}\u200D\u2642\uFE0F","\u0623\u0646\u062A \u0645\u0648\u0647\u0648\u0628 \u0628\u0634\u0643\u0644 \u0644\u0627 \u064A\u0635\u062F\u0642! \u{1F3A8}","\u0623\u0646\u062A \u0639\u0628\u0642\u0631\u064A \u0641\u064A \u062D\u0644 \u0627\u0644\u0645\u0634\u0643\u0644\u0627\u062A! \u{1F9E0}","\u0623\u0646\u062A \u062A\u062C\u0639\u0644 \u0627\u0644\u0639\u0627\u0644\u0645 \u0623\u0641\u0636\u0644! \u{1F30D}","\u0623\u0646\u062A \u0642\u0648\u0629 \u0625\u0628\u062F\u0627\u0639\u064A\u0629! \u26A1","\u0623\u0646\u062A \u062A\u0644\u0647\u0645 \u0627\u0644\u0622\u062E\u0631\u064A\u0646! \u{1F4AB}","\u0623\u0646\u062A \u0645\u0628\u062A\u0643\u0631 \u062D\u0642\u064A\u0642\u064A! \u{1F680}","\u0623\u0646\u062A \u0645\u0627\u0647\u0631 \u0628\u0634\u0643\u0644 \u0627\u0633\u062A\u062B\u0646\u0627\u0626\u064A! \u{1F3C6}","\u0623\u0646\u062A \u0641\u0646\u0627\u0646 \u0631\u0642\u0645\u064A! \u{1F3AD}","\u0623\u0646\u062A \u062A\u0628\u0646\u064A \u0634\u064A\u0626\u0627\u064B \u0645\u0630\u0647\u0644\u0627\u064B! \u{1F3D7}\uFE0F","\u0623\u0646\u062A \u0631\u0627\u0626\u062F \u062A\u0643\u0646\u0648\u0644\u0648\u062C\u064A\u0627! \u{1F5FA}\uFE0F","\u0623\u0646\u062A \u0645\u0628\u062F\u0639 \u0628\u0634\u0643\u0644 \u0627\u0633\u062A\u062B\u0646\u0627\u0626\u064A! \u{1F3A8}","\u0623\u0646\u062A \u062E\u0628\u064A\u0631 \u0641\u064A \u062A\u062C\u0631\u0628\u0629 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645! \u{1F3AF}","\u0623\u0646\u062A \u0641\u0646\u0627\u0646 \u062A\u0635\u0645\u064A\u0645! \u{1F3A8}"]}},chat:{welcome:{en:"Hello! I am Savonie. Ask me anything about Estivan.",es:"\xA1Hola! Soy Savonie. Preg\xFAntame cualquier cosa sobre Estivan.",ar:"\u0645\u0631\u062D\u0628\u0627\u064B! \u0623\u0646\u0627 \u0633\u0627\u0641\u0648\u0646\u064A. \u0627\u0633\u0623\u0644\u0646\u064A \u0623\u064A \u0634\u064A\u0621 \u0639\u0646 \u0627\u0633\u062A\u064A\u0641\u0627\u0646."},defaultChips:{en:["What does Estivan do?","Tell me about his background","What are his skills?","How can I contact him?"],es:["\xBFQu\xE9 hace Estivan?","H\xE1blame de su experiencia","\xBFCu\xE1les son sus habilidades?","\xBFC\xF3mo puedo contactarlo?"],ar:["\u0645\u0627\u0630\u0627 \u064A\u0641\u0639\u0644 \u0627\u0633\u062A\u064A\u0641\u0627\u0646\u061F","\u0623\u062E\u0628\u0631\u0646\u064A \u0639\u0646 \u062E\u0644\u0641\u064A\u062A\u0647","\u0645\u0627 \u0647\u064A \u0645\u0647\u0627\u0631\u0627\u062A\u0647\u061F","\u0643\u064A\u0641 \u064A\u0645\u0643\u0646\u0646\u064A \u0627\u0644\u0627\u062A\u0635\u0627\u0644 \u0628\u0647\u061F"]},contextualSuggestions:{en:{skills:["What projects have you worked on?","Tell me about your experience","What are you learning currently?"],background:["What are your main skills?","Tell me about your education","What industries have you worked in?"],projects:["Can you show me your code?","What technologies did you use?","How long did it take to build?"],contact:["Are you available for freelance work?","What's your typical response time?","Do you work remotely?"],education:["What certifications do you have?","What's your favorite programming language?","How do you stay updated with technology?"],projectResponse:["Can you tell me more about that project?","What challenges did you face?","What did you learn from it?"],skillResponse:["How did you learn that?","Have you used it in projects?","What's your proficiency level?"],early:["What are your main skills?","Tell me about your background","What projects are you proud of?"]},es:{skills:["\xBFEn qu\xE9 proyectos has trabajado?","H\xE1blame de tu experiencia","\xBFQu\xE9 est\xE1s aprendiendo actualmente?"],background:["\xBFCu\xE1les son tus principales habilidades?","H\xE1blame de tu educaci\xF3n","\xBFEn qu\xE9 industrias has trabajado?"],projects:["\xBFPuedes mostrarme tu c\xF3digo?","\xBFQu\xE9 tecnolog\xEDas usaste?","\xBFCu\xE1nto tiempo tom\xF3 construirlo?"],contact:["\xBFEst\xE1s disponible para trabajo freelance?","\xBFCu\xE1l es tu tiempo t\xEDpico de respuesta?","\xBFTrabajas de forma remota?"],education:["\xBFQu\xE9 certificaciones tienes?","\xBFCu\xE1l es tu lenguaje de programaci\xF3n favorito?","\xBFC\xF3mo te mantienes actualizado con la tecnolog\xEDa?"],projectResponse:["\xBFPuedes contarme m\xE1s sobre ese proyecto?","\xBFQu\xE9 desaf\xEDos enfrentaste?","\xBFQu\xE9 aprendiste de ello?"],skillResponse:["\xBFC\xF3mo aprendiste eso?","\xBFLo has usado en proyectos?","\xBFCu\xE1l es tu nivel de competencia?"],early:["\xBFCu\xE1les son tus principales habilidades?","H\xE1blame de tu experiencia","\xBFDe qu\xE9 proyectos est\xE1s orgulloso?"]},ar:{skills:["\u0645\u0627 \u0647\u064A \u0627\u0644\u0645\u0634\u0627\u0631\u064A\u0639 \u0627\u0644\u062A\u064A \u0639\u0645\u0644\u062A \u0639\u0644\u064A\u0647\u0627\u061F","\u0623\u062E\u0628\u0631\u0646\u064A \u0639\u0646 \u062A\u062C\u0631\u0628\u062A\u0643","\u0645\u0627\u0630\u0627 \u062A\u062A\u0639\u0644\u0645 \u062D\u0627\u0644\u064A\u0627\u064B\u061F"],background:["\u0645\u0627 \u0647\u064A \u0645\u0647\u0627\u0631\u0627\u062A\u0643 \u0627\u0644\u0631\u0626\u064A\u0633\u064A\u0629\u061F","\u0623\u062E\u0628\u0631\u0646\u064A \u0639\u0646 \u062A\u0639\u0644\u064A\u0645\u0643","\u0641\u064A \u0623\u064A \u0635\u0646\u0627\u0639\u0627\u062A \u0639\u0645\u0644\u062A\u061F"],projects:["\u0647\u0644 \u064A\u0645\u0643\u0646\u0643 \u0625\u0638\u0647\u0627\u0631 \u0643\u0648\u062F\u0643\u061F","\u0645\u0627 \u0647\u064A \u0627\u0644\u062A\u0642\u0646\u064A\u0627\u062A \u0627\u0644\u062A\u064A \u0627\u0633\u062A\u062E\u062F\u0645\u062A\u0647\u0627\u061F","\u0643\u0645 \u0645\u0646 \u0627\u0644\u0648\u0642\u062A \u0627\u0633\u062A\u063A\u0631\u0642 \u0628\u0646\u0627\u0624\u0647\u061F"],contact:["\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0627\u062D \u0644\u0644\u0639\u0645\u0644 \u0627\u0644\u062D\u0631\u061F","\u0645\u0627 \u0647\u0648 \u0648\u0642\u062A \u0631\u062F\u0643 \u0627\u0644\u0645\u0639\u062A\u0627\u062F\u061F","\u0647\u0644 \u062A\u0639\u0645\u0644 \u0639\u0646 \u0628\u0639\u062F\u061F"],education:["\u0645\u0627 \u0647\u064A \u0627\u0644\u0634\u0647\u0627\u062F\u0627\u062A \u0627\u0644\u062A\u064A \u0644\u062F\u064A\u0643\u061F","\u0645\u0627 \u0647\u0648 \u0644\u063A\u0629 \u0627\u0644\u0628\u0631\u0645\u062C\u0629 \u0627\u0644\u0645\u0641\u0636\u0644\u0629 \u0644\u062F\u064A\u0643\u061F","\u0643\u064A\u0641 \u062A\u062D\u0627\u0641\u0638 \u0639\u0644\u0649 \u062A\u062D\u062F\u064A\u062B \u0646\u0641\u0633\u0643 \u0628\u0627\u0644\u062A\u0643\u0646\u0648\u0644\u0648\u062C\u064A\u0627\u061F"],projectResponse:["\u0647\u0644 \u064A\u0645\u0643\u0646\u0643 \u0625\u062E\u0628\u0627\u0631\u064A \u0627\u0644\u0645\u0632\u064A\u062F \u0639\u0646 \u0647\u0630\u0627 \u0627\u0644\u0645\u0634\u0631\u0648\u0639\u061F","\u0645\u0627 \u0647\u064A \u0627\u0644\u062A\u062D\u062F\u064A\u0627\u062A \u0627\u0644\u062A\u064A \u0648\u0627\u062C\u0647\u062A\u0647\u0627\u061F","\u0645\u0627\u0630\u0627 \u062A\u0639\u0644\u0645\u062A \u0645\u0646\u0647\u061F"],skillResponse:["\u0643\u064A\u0641 \u062A\u0639\u0644\u0645\u062A \u0630\u0644\u0643\u061F","\u0647\u0644 \u0627\u0633\u062A\u062E\u062F\u0645\u062A\u0647 \u0641\u064A \u0645\u0634\u0627\u0631\u064A\u0639\u061F","\u0645\u0627 \u0647\u0648 \u0645\u0633\u062A\u0648\u0649 \u0645\u0647\u0627\u0631\u062A\u0643\u061F"],early:["\u0645\u0627 \u0647\u064A \u0645\u0647\u0627\u0631\u0627\u062A\u0643 \u0627\u0644\u0631\u0626\u064A\u0633\u064A\u0629\u061F","\u0623\u062E\u0628\u0631\u0646\u064A \u0639\u0646 \u062E\u0644\u0641\u064A\u062A\u0643","\u0645\u0627 \u0647\u064A \u0627\u0644\u0645\u0634\u0627\u0631\u064A\u0639 \u0627\u0644\u062A\u064A \u062A\u0641\u062E\u0631 \u0628\u0647\u0627\u061F"]}}}},initAchievements=()=>{const s="portfolio_achievements",c={explorer:{id:"explorer",icon:"\u{1F5FA}\uFE0F"},reader:{id:"reader",icon:"\u{1F4D6}"},gamer:{id:"gamer",icon:"\u{1F3AE}"},chatter:{id:"chatter",icon:"\u{1F4AC}"},nightOwl:{id:"nightOwl",icon:"\u{1F319}"},konami:{id:"konami",icon:"\u{1F3AF}"},networker:{id:"networker",icon:"\u{1F517}"},formFiller:{id:"formFiller",icon:"\u2709\uFE0F"}},o=()=>{try{const g=localStorage.getItem(s);return g?JSON.parse(g):{}}catch{return{}}},e=g=>{try{localStorage.setItem(s,JSON.stringify(g))}catch{}},n=g=>{const E=o();if(E[g])return;const _=getCurrentLanguage(),h={...c[g],...translations.achievement[_][g]};E[g]={unlockedAt:new Date().toISOString(),...h},e(E),t(h)},t=g=>{const E=getCurrentLanguage(),_=document.createElement("div");_.className="achievement-notification",_.innerHTML=`
            <div class="achievement-icon">${g.icon}</div>
            <div class="achievement-content">
                <div class="achievement-title">${translations.achievement[E].unlocked}</div>
                <div class="achievement-name">${g.name}</div>
                <div class="achievement-desc">${g.description}</div>
            </div>
            <button class="achievement-close" aria-label="Close achievement notification">\xD7</button>
        `,document.body.appendChild(_);const h=_.querySelector(".achievement-close"),k=()=>{_.classList.remove("show"),setTimeout(()=>_.remove(),300)};h.addEventListener("click",k),setTimeout(()=>_.classList.add("show"),100);const f=setTimeout(()=>{document.body.contains(_)&&k()},4e3);h.addEventListener("click",()=>clearTimeout(f))},r=()=>{const g="portfolio_visited_pages";try{const E=JSON.parse(localStorage.getItem(g)||"[]"),_=window.location.pathname.split("/").pop()||"index.html";E.includes(_)||(E.push(_),localStorage.setItem(g,JSON.stringify(E))),["index.html","overview.html","deep-dive.html","about.html","projects.html","contact.html"].every(f=>E.includes(f))&&n("explorer"),_==="deep-dive.html"&&n("reader")}catch{}},d=()=>{const g=document.getElementById("theme-toggle");g&&g.addEventListener("click",()=>n("nightOwl"))},x=()=>{document.querySelectorAll('a[href*="linkedin.com"], a[href*="github.com"]').forEach(g=>{g.addEventListener("click",()=>n("networker"))})};r(),d(),x(),window.unlockAchievement=n},initKonamiCode=()=>{const s=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"];let c=0;const o=()=>{window.dispatchEvent(new Event("konami-activated")),window.unlockAchievement&&window.unlockAchievement("konami");const n=getCurrentLanguage(),t=translations.konami[n],r=document.createElement("div");r.className="konami-modal",r.innerHTML=`
            <div class="konami-content">
                <div class="konami-header">
                    <h2>${t.title}</h2>
                    <button class="konami-close" aria-label="Close">&times;</button>
                </div>
                <div class="konami-body">
                    <p class="konami-message">${t.message}</p>
                    <div class="konami-gift">
                        <div class="gift-emoji">\u{1F381}</div>
                        <p class="gift-text">${t.giftText}</p>
                        <div class="compliment-container" style="display: none;">
                            <p class="compliment-text"></p>
                        </div>
                    </div>
                    <div class="konami-stats">
                        <p>${t.stats.replace("{percent}",Math.floor(Math.random()*10)+1)}</p>
                    </div>
                </div>
            </div>
        `,document.body.appendChild(r),setTimeout(()=>r.classList.add("show"),100);const d=r.querySelector(".gift-emoji"),x=r.querySelector(".compliment-container"),g=r.querySelector(".compliment-text"),E=r.querySelector(".gift-text"),_=t.compliments;d.addEventListener("click",()=>{d.style.display="none",E.style.display="none";const k=_[Math.floor(Math.random()*_.length)];g.textContent=k,x.style.display="block",d.classList.add("gift-opened"),e(),setTimeout(()=>{x.classList.add("sparkle")},500)});const h=()=>{r.classList.remove("show"),setTimeout(()=>r.remove(),300)};r.querySelector(".konami-close").addEventListener("click",h),r.addEventListener("click",k=>{k.target===r&&h()})},e=()=>{const n=["#ff6b6b","#4ecdc4","#45b7d1","#f9ca24","#f0932b","#eb4d4b","#6c5ce7","#a29bfe","#fd79a8","#e17055"];for(let r=0;r<50;r++){const d=document.createElement("div");d.className="confetti",d.style.left=Math.random()*100+"vw",d.style.backgroundColor=n[Math.floor(Math.random()*n.length)],d.style.animationDelay=Math.random()*3+"s",d.style.animationDuration=Math.random()*3+2+"s",document.body.appendChild(d),setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},5e3)}};document.addEventListener("keydown",n=>{n.key===s[c]?(c++,c===s.length&&(c=0,o())):c=0})},initPWA=()=>{if("serviceWorker"in navigator){let c=!!navigator.serviceWorker.controller,o=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{if(!c){c=!0;return}if(!o)if(o=!0,typeof window.tryGuardedReload=="function")window.tryGuardedReload({MAX:3e4,RETRY:500,fallback:()=>{try{window.location.reload()}catch{try{window.location.href=window.location.href}catch{}}}});else{const e=()=>{__userInteracting?setTimeout(e,500):window.location.reload()};e()}}),window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{setInterval(()=>{e.update()},6e4),e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"}),e.addEventListener("updatefound",()=>{const n=e.installing;n&&n.addEventListener("statechange",()=>{n.state==="installed"&&navigator.serviceWorker.controller&&n.postMessage({type:"SKIP_WAITING"})})})}).catch(e=>{})})}let s;window.addEventListener("beforeinstallprompt",c=>{c.preventDefault(),s=c})},trackEventDebug=(s,c)=>{try{window.location.search.includes("debug-analytics=1")&&console.log("[Analytics Event]",s,c||null)}catch{}},initAnalytics=()=>{const s=(t,r)=>{const d=`button_click_${r}`;trackEventDebug(d),typeof clarity=="function"&&clarity("event",d),typeof gtag=="function"&&gtag("event","button_click",{event_category:"engagement",event_label:r})};document.querySelectorAll('a[href*="contact"], button[type="submit"]').forEach(t=>{t.addEventListener("click",()=>{const r=t.textContent.trim().replace(/\s+/g,"_").toLowerCase();s(t,r)})}),document.querySelectorAll("nav a").forEach(t=>{t.addEventListener("click",()=>{const r=t.getAttribute("href")||"unknown";trackEventDebug("navigation_click",{page:r}),typeof clarity=="function"&&clarity("event","navigation_click",{page:r}),typeof gtag=="function"&&gtag("event","navigation_click",{event_category:"navigation",event_label:r})})}),document.querySelectorAll('a[href*="linkedin.com"], a[href*="github.com"]').forEach(t=>{t.addEventListener("click",()=>{const r=t.href.includes("linkedin")?"linkedin":"github";trackEventDebug("social_click",{platform:r}),typeof clarity=="function"&&clarity("event","social_click",{platform:r}),typeof gtag=="function"&&gtag("event","social_click",{event_category:"social",event_label:r})})});const c=document.querySelector('form[action*="formspree.io"]');c&&c.addEventListener("submit",()=>{trackEventDebug("form_submission"),typeof clarity=="function"&&clarity("event","form_submission"),typeof gtag=="function"&&gtag("event","form_submission",{event_category:"engagement",event_label:"contact_form"})});let o=0,e={25:!1,50:!1,75:!1,100:!1};window.addEventListener("scroll",()=>{const t=Math.round((window.scrollY+window.innerHeight)/document.documentElement.scrollHeight*100);t>o&&(o=t,o>=25&&!e[25]&&(e[25]=!0,trackEventDebug("scroll_25_percent"),typeof clarity=="function"&&clarity("event","scroll_25_percent"),typeof gtag=="function"&&gtag("event","scroll",{event_category:"engagement",event_label:"25_percent"})),o>=50&&!e[50]&&(e[50]=!0,trackEventDebug("scroll_50_percent"),typeof clarity=="function"&&clarity("event","scroll_50_percent"),typeof gtag=="function"&&gtag("event","scroll",{event_category:"engagement",event_label:"50_percent"})),o>=75&&!e[75]&&(e[75]=!0,trackEventDebug("scroll_75_percent"),typeof clarity=="function"&&clarity("event","scroll_75_percent"),typeof gtag=="function"&&gtag("event","scroll",{event_category:"engagement",event_label:"75_percent"})),o>=100&&!e[100]&&(e[100]=!0,trackEventDebug("scroll_100_percent"),typeof clarity=="function"&&clarity("event","scroll_100_percent"),typeof gtag=="function"&&gtag("event","scroll",{event_category:"engagement",event_label:"100_percent"})))}),window.addEventListener("konami-activated",()=>{trackEventDebug("konami_code_activated"),typeof clarity=="function"&&clarity("event","konami_code_activated"),typeof gtag=="function"&&gtag("event","easter_egg",{event_category:"engagement",event_label:"konami_code"})});const n=window.unlockAchievement;n&&(window.unlockAchievement=t=>{trackEventDebug("achievement_unlocked",{achievement:t}),typeof clarity=="function"&&clarity("event","achievement_unlocked",{achievement:t}),typeof gtag=="function"&&gtag("event","achievement_unlock",{event_category:"gamification",event_label:t}),n(t)})},initPerformanceMonitoring=()=>{if("PerformanceObserver"in window)try{new PerformanceObserver(c=>{const o=c.getEntries(),e=o[o.length-1];typeof clarity=="function"&&clarity("set","lcp",Math.round(e.renderTime||e.loadTime));const n=e.renderTime||e.loadTime;n>2500&&console.warn("Poor LCP detected:",n,"ms")}).observe({type:"largest-contentful-paint",buffered:!0})}catch{}if("web-vital"in window){try{new PerformanceObserver(c=>{c.getEntries().forEach(e=>{const n=e.processingStart-e.startTime;typeof clarity=="function"&&clarity("set","fid",Math.round(n))})}).observe({type:"first-input",buffered:!0})}catch{}try{let s=0;new PerformanceObserver(o=>{for(const e of o.getEntries())e.hadRecentInput||(s+=e.value);typeof clarity=="function"&&clarity("set","cls",s.toFixed(4))}).observe({type:"layout-shift",buffered:!0})}catch{}}},initPhase2=()=>{document.body.addEventListener("click",o=>{const e=o.target.closest('a[href^="mailto:"]');if(!e)return;o.preventDefault();const n=e.href.replace("mailto:","").split("?")[0];navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(n).then(()=>{if(e.innerText||e.textContent){const t=e.innerText||e.textContent;e.innerText="Copied! \u2705",setTimeout(()=>{e.innerText=t},2e3)}}).catch(()=>{window.location.href=e.href}):window.location.href=e.href});const s=document.querySelector("footer p.text-xs");if(s){const o=new Date().getFullYear();s.innerHTML=s.innerHTML.replace(/&copy;\s*\d{4}/,`&copy; ${o}`)}const c=document.querySelector('form[action*="formspree"]');c&&c.addEventListener("submit",o=>{const e=c.querySelector('input[name="website_url"]');if(e&&e.value)return o.preventDefault(),!1})},init=()=>{console.log("%c Designed by Estivan Ayramia ","background: #212842; color: #e1d4c2; padding: 4px; border-radius: 4px;"),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{initDarkMode(),initMobileMenu(),loadGSAPAndInit(),initSmoothScroll(),initFormValidation(),initLazyLoading(),initScrollToTop(),initPdfPreviews(),initAchievements(),initKonamiCode(),initPWA(),initAnalytics(),initPerformanceMonitoring(),initPhase2()}):(initDarkMode(),initMobileMenu(),loadGSAPAndInit(),initSmoothScroll(),initFormValidation(),initLazyLoading(),initScrollToTop(),initPdfPreviews(),initAchievements(),initKonamiCode(),initPWA(),initAnalytics(),initPerformanceMonitoring(),initPhase2())};init(),document.addEventListener("DOMContentLoaded",()=>{const s="https://portfolio-chat.eayramia.workers.dev",o={logistics:{title:"Logistics System",img:"assets/img/project-logistics.jpg",link:"/deep-dive.html#logistics"},conflict:{title:"Conflict Playbook",img:"assets/img/project-conflict.jpg",link:"/deep-dive.html#conflict"},discipline:{title:"Discipline Routine",img:"assets/img/project-discipline.jpg",link:"/deep-dive.html#discipline"},website:{title:"Portfolio Website",img:"assets/img/og-image.png",link:"/"}},e={widget:document.getElementById("chat-widget"),window:document.getElementById("chat-window"),header:document.getElementById("chat-header"),messages:document.getElementById("chat-messages"),input:document.getElementById("chat-input"),sendBtn:document.getElementById("send-btn"),toggleBtn:document.getElementById("chat-toggle"),closeBtn:document.getElementById("close-chat"),bubble:document.getElementById("welcome-bubble"),chipsContainer:document.getElementById("chat-chips"),suggestionsBtn:document.getElementById("suggestions-btn"),suggestionsContainer:document.querySelector('[data-chat-suggestions="container"]'),suggestionsToggle:document.querySelector('[data-chat-suggestions-toggle="button"]'),suggestionsClose:null};(function(){try{if(window.CSS&&CSS.supports&&CSS.supports("animation-timeline","scroll()"))return}catch{}const m=document.querySelector(".scroll-progress");if(!m)return;let a=!1;function p(){const C=document.documentElement,l=window.scrollY||C.scrollTop||0,w=Math.max((C.scrollHeight||document.body.scrollHeight||0)-window.innerHeight,0),L=w>0?Math.min(1,Math.max(0,l/w)):0;m.style.setProperty("--scroll-scale",L),a=!1}const T=function(){a||(a=!0,requestAnimationFrame(p))};window.addEventListener("scroll",T,{passive:!0}),window.addEventListener("resize",T,{passive:!0}),requestAnimationFrame(p)})(),document.documentElement.lang==="ar"&&e.widget?(e.widget.style.left="1rem",e.widget.style.right="auto",e.bubble&&(e.bubble.style.left="1rem",e.bubble.style.right="auto")):e.widget&&(e.widget.style.right="1rem",e.widget.style.left="auto",e.bubble&&(e.bubble.style.right="1rem",e.bubble.style.left="auto"));let t=[],r=!1,d=!1;try{const u=sessionStorage.getItem("savonie_history");u&&(t=JSON.parse(u),t.forEach(m=>{const a=document.createElement("div"),p="bg-[#212842] text-white rounded-tr-none self-end ml-auto",T="bg-white text-[#362017] rounded-tl-none border border-[#362017]/5 self-start";a.className=`p-3 rounded-lg shadow-sm max-w-[85%] mb-3 text-sm leading-relaxed ${m.sender==="user"?p:T}`,m.sender==="bot"?a.innerHTML=R(m.text):a.textContent=m.text,e.messages?.appendChild(a)}),setTimeout(()=>{e.messages&&(e.messages.scrollTop=e.messages.scrollHeight)},100))}catch{}if(t.length===0){const u=document.documentElement.lang||"en",m=translations.chat.welcome[u]||"Hello! I am Savonie. Ask me anything about Estivan.";H(m,"bot",!1)}if(e.chipsContainer){const u=document.documentElement.lang||"en",m=translations.chat.defaultChips[u]||translations.chat.defaultChips.en;N(m)}d=!0;const x=parseInt(sessionStorage.getItem("savonie_bubble_count")||"0");x<2&&setTimeout(()=>{e.window?.classList.contains("hidden")&&t.length===0&&(e.bubble?.classList.remove("opacity-0","translate-y-4"),e.bubble?.classList.add("opacity-100","translate-y-0"),sessionStorage.setItem("savonie_bubble_count",(x+1).toString()))},2500),e.toggleBtn?.addEventListener("click",i),e.closeBtn?.addEventListener("click",i),e.sendBtn?.addEventListener("click",P),e.input?.addEventListener("keypress",u=>u.key==="Enter"&&P());function g(u){if(!e.suggestionsContainer){console.log("[Savonie DEBUG] setSuggestionsVisible called but no suggestions container");return}u?(e.suggestionsContainer.classList.remove("savonie-suggestions-hidden"),e.suggestionsContainer.removeAttribute("hidden"),e.suggestionsContainer.style.display="flex"):(e.suggestionsContainer.classList.add("savonie-suggestions-hidden"),e.suggestionsContainer.setAttribute("hidden","true"),e.suggestionsContainer.style.display="none"),console.log("[Savonie DEBUG] setSuggestionsVisible ->",u,"classes:",e.suggestionsContainer.className)}function E(){if(!e.suggestionsContainer){console.log("[Savonie DEBUG] No suggestions container found on this page");return}e.suggestionsToggle?e.suggestionsToggle.addEventListener("click",()=>{const m=e.suggestionsContainer.classList.contains("savonie-suggestions-hidden")||e.suggestionsContainer.hasAttribute("hidden")||e.suggestionsContainer.style.display==="none";console.log("[Savonie DEBUG] Lightbulb clicked, nextVisible =",m),g(m)}):console.log("[Savonie DEBUG] No suggestions toggle (lightbulb) found"),console.log("[Savonie DEBUG] attachSuggestionHandlers complete")}E(),e.chipsContainer&&e.chipsContainer.querySelectorAll(".chip-btn").forEach(u=>{u.addEventListener("click",()=>{e.input&&(e.input.value=u.textContent,P())})});const _=document.getElementById("mic-btn");let h=null,k=!1;if(_&&("webkitSpeechRecognition"in window||"SpeechRecognition"in window)){const u=window.SpeechRecognition||window.webkitSpeechRecognition;h=new u,h.continuous=!1,h.interimResults=!1,h.lang=document.documentElement.lang||"en-US",h.onstart=()=>{k=!0,_.classList.add("listening"),_.setAttribute("aria-label","Listening...")},h.onend=()=>{k=!1,_.classList.remove("listening"),_.setAttribute("aria-label","Voice input")},h.onresult=m=>{const a=m.results[0][0].transcript;if(e.input&&a){e.input.value=a;try{e.input.focus({preventScroll:!0})}catch{e.input.focus()}}},h.onerror=m=>{console.warn("Speech recognition error:",m.error),k=!1,_.classList.remove("listening")},_.addEventListener("click",()=>{k?h.stop():h.start()})}else _&&(_.style.display="none");function f(u){const m=[],a=[...u].reverse().find(l=>l.sender==="user")?.text?.toLowerCase()||"",p=[...u].reverse().find(l=>l.sender==="bot")?.text?.toLowerCase()||"",T=S(a),C=translations.chat.contextualSuggestions;return a.includes("skill")||a.includes("technology")||a.includes("expertise")||a.includes("habilidad")||a.includes("tecnolog\xEDa")||a.includes("experiencia")||a.includes("\u0645\u0647\u0627\u0631\u0629")||a.includes("\u062A\u0643\u0646\u0648\u0644\u0648\u062C\u064A\u0627")||a.includes("\u062E\u0628\u0631\u0629")?m.push(...C[T]?.skills||["What projects have you worked on?","Tell me about your experience","What are you learning currently?"]):a.includes("background")||a.includes("experience")||a.includes("career")||a.includes("fondo")||a.includes("experiencia")||a.includes("carrera")||a.includes("\u062E\u0644\u0641\u064A\u0629")||a.includes("\u062E\u0628\u0631\u0629")||a.includes("\u0645\u0633\u064A\u0631\u0629")?m.push(...C[T]?.background||["What are your main skills?","Tell me about your education","What industries have you worked in?"]):a.includes("project")||a.includes("work")||a.includes("portfolio")||a.includes("proyecto")||a.includes("trabajo")||a.includes("portafolio")||a.includes("\u0645\u0634\u0631\u0648\u0639")||a.includes("\u0639\u0645\u0644")||a.includes("\u0645\u062D\u0641\u0638\u0629")?m.push(...C[T]?.projects||["Can you show me your code?","What technologies did you use?","How long did it take to build?"]):a.includes("contact")||a.includes("reach")||a.includes("email")||a.includes("contacto")||a.includes("alcanzar")||a.includes("correo")||a.includes("\u0627\u062A\u0635\u0627\u0644")||a.includes("\u0627\u0644\u0648\u0635\u0648\u0644")||a.includes("\u0628\u0631\u064A\u062F")?m.push(...C[T]?.contact||["Are you available for freelance work?","What's your typical response time?","Do you work remotely?"]):a.includes("education")||a.includes("study")||a.includes("learn")||a.includes("educaci\xF3n")||a.includes("estudio")||a.includes("aprender")||a.includes("\u062A\u0639\u0644\u064A\u0645")||a.includes("\u062F\u0631\u0627\u0633\u0629")||a.includes("\u062A\u0639\u0644\u0645")?m.push(...C[T]?.education||["What certifications do you have?","What's your favorite programming language?","How do you stay updated with technology?"]):p.includes("project")||p.includes("work")||p.includes("proyecto")||p.includes("trabajo")||p.includes("\u0645\u0634\u0631\u0648\u0639")||p.includes("\u0639\u0645\u0644")?m.push(...C[T]?.projectResponse||["Can you tell me more about that project?","What challenges did you face?","What did you learn from it?"]):p.includes("skill")||p.includes("technology")||p.includes("habilidad")||p.includes("tecnolog\xEDa")||p.includes("\u0645\u0647\u0627\u0631\u0629")||p.includes("\u062A\u0643\u0646\u0648\u0644\u0648\u062C\u064A\u0627")?m.push(...C[T]?.skillResponse||["How did you learn that?","Have you used it in projects?","What's your proficiency level?"]):u.length<4&&m.push(...C[T]?.early||["What are your main skills?","Tell me about your background","What projects are you proud of?"]),m.slice(0,3)}function S(u){return u?/[\u0600-\u06FF]/.test(u)?"ar":/\b(qué|como|dónde|cuándo|por qué|está|son|tiene|trabajo|habilidades?|experiencia|proyecto|contacto)\b/i.test(u)?"es":"en":"en"}function R(u){if(!u)return"";if(typeof window<"u"&&typeof window.marked<"u")try{return window.marked.parse(u)}catch(a){console.warn("[Savonie DEBUG] marked.parse failed:",a)}let m=u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return m=m.replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g,(a,p,T)=>'<a href="'+T+'" target="_blank" rel="noopener noreferrer" class="text-[#212842] underline hover:text-[#362017] font-medium">'+p+"</a>"),m=m.replace(/\n/g,"<br>"),m}function N(u){if(!e.chipsContainer)return;if(e.chipsContainer.innerHTML="",!u||u.length===0){g(!1);return}u.forEach(a=>{const p=document.createElement("button");p.className="chip-btn text-xs bg-white border border-[#212842]/20 text-[#212842] px-3 py-1 rounded-full hover:bg-[#212842] hover:text-white transition-colors",p.textContent=a,p.addEventListener("click",()=>{e.input&&(e.input.value=a,P())}),e.chipsContainer.appendChild(p)});const m=document.createElement("button");m.className="chip-close-btn text-xs text-[#362017]/60 hover:text-[#362017] px-2 py-1 ml-2 transition-colors",m.setAttribute("data-chat-suggestions-close","button"),m.innerHTML="\xD7",m.title="Hide suggestions",m.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),console.log("[Savonie DEBUG] Suggestions close X clicked, hiding suggestions"),g(!1)}),e.chipsContainer.appendChild(m),e.suggestionsClose=m,g(!0)}function i(){const u=e.window?.classList.contains("hidden"),m=document.documentElement.dir==="rtl";if(u?(e.window?.classList.remove("hidden"),e.window?.classList.add("flex"),typeof clarity=="function"&&clarity("event","chat_open"),typeof gtag=="function"&&gtag("event","chat_open",{event_category:"Chatbot"})):(e.window?.classList.remove("flex"),e.window?.classList.add("hidden"),typeof clarity=="function"&&clarity("event","chat_close"),typeof gtag=="function"&&gtag("event","chat_close",{event_category:"Chatbot"})),!e.window?.classList.contains("hidden")){if(u){const a=e.widget?.getBoundingClientRect();if(a){let l=a.left/16,w=a.top/16-31.25-1;l+20>window.innerWidth/16&&(l=window.innerWidth/16-20-1),l<1&&(l=1),w<1&&(w=1),e.window.style.position="fixed",e.window.style.left=`${l}rem`,e.window.style.top=`${w}rem`,e.window.style.right="auto",e.window.style.zIndex="10000"}else e.window.style.position="",e.window.style.left="",e.window.style.top="",e.window.style.right="",e.window.style.zIndex=""}e.bubble&&(e.bubble.style.display="none"),setTimeout(()=>{try{e.input?.focus({preventScroll:!0})}catch{e.input?.focus&&e.input.focus()}e.messages&&(e.messages.scrollTop=e.messages.scrollHeight)},100)}}async function j(){if(navigator.onLine)return!0;try{const u=new AbortController,m=setTimeout(()=>u.abort(),3e3),a=await fetch("/favicon.ico",{method:"HEAD",cache:"no-cache",signal:u.signal});return clearTimeout(m),a.ok}catch{return!1}}async function P(){if(!e.input)return;const u=e.input.value.trim();if(!u||r)return;if(r=!0,typeof gtag=="function"&&gtag("event","chat_question",{event_category:"Chatbot",event_label:"User Asked Question"}),typeof clarity=="function"&&clarity("event","chat_question"),!await j()){H(u,"user"),e.input.value="",H("You appear to be offline. Please check your connection and try again.","bot"),r=!1;return}const a=S(u),p=document.documentElement.lang||"en",T=a!=="en"?a:p;H(u,"user"),e.input.value="";const C=H("Thinking...","bot",!0),l=3e4,w=2;let L=null,v=null;for(let b=0;b<=w;b++){const M=new AbortController,A=setTimeout(()=>M.abort(),l);try{const y=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:u,language:T,pageContent:document.body.innerText.substring(0,2e3)}),signal:M.signal});if(clearTimeout(A),!y.ok)if(y.status>=500){if(L={type:"server",status:y.status},b<w){await new Promise(B=>setTimeout(B,1e3*(b+1)));continue}}else if(y.status===429){L={type:"rate_limit"};break}else{L={type:"client",status:y.status};break}v=await y.json(),L=null;break}catch(y){if(clearTimeout(A),y.name==="AbortError"){if(L={type:"timeout"},b<w)continue}else if(L={type:"network",message:y.message},b<w){await new Promise(B=>setTimeout(B,1e3*(b+1)));continue}}}if(L){O(C);let b;switch(L.type){case"timeout":b="The request took too long. The AI service might be busy. Please try again in a moment.";break;case"rate_limit":b="Too many requests. Please wait a moment before sending another message.";break;case"server":b="The AI service is temporarily unavailable. Please try again in a few seconds.";break;case"network":b="Connection lost. Please check your internet connection and try again.";break;default:b="Something went wrong. Please try again."}H(b,"bot"),r=!1;return}if(O(C),v.reply&&H(v.reply,"bot"),v.chips&&Array.isArray(v.chips)&&e.chipsContainer&&N(v.chips),v.action)if(v.action==="download_resume"){const b=document.createElement("a");b.href="/assets/resume.pdf",b.download="Estivan_Ayramia_Resume.pdf",b.style.display="none",document.body.appendChild(b),b.click(),document.body.removeChild(b)}else v.action==="email_link"&&(window.location.href="mailto:hello@estivanayramia.com");if(v.card&&W(v.card),!v.chips&&t.length>0){const b=f(t);b.length>0&&e.chipsContainer&&N(b)}r=!1}function H(u,m,a=!1){if(!e.messages)return;const p=document.createElement("div");p.id=a?"loading-msg":"";const T="bg-[#212842] text-white rounded-tr-none self-end ml-auto",C="bg-white text-[#362017] rounded-tl-none border border-[#362017]/5 self-start";if(p.className=`p-3 rounded-lg shadow-sm max-w-[70%] mb-3 text-sm leading-relaxed ${m==="user"?T:C}`,e.messages.appendChild(p),m==="bot"&&!a){let l=0;p.textContent="";const w=setInterval(()=>{l<u.length?(p.textContent+=u[l],l++,e.messages.scrollTop=e.messages.scrollHeight):(clearInterval(w),p.innerHTML=R(u),e.messages.scrollTop=e.messages.scrollHeight)},12)}else p.innerHTML=R(u);return!a&&d&&(t.push({text:u,sender:m}),sessionStorage.setItem("savonie_history",JSON.stringify(t))),e.messages.scrollTop=e.messages.scrollHeight,p.id}function W(u){if(!e.messages||!o[u])return;const m=o[u],a=document.createElement("div");a.className="bg-white rounded-lg shadow-md overflow-hidden border border-[#362017]/10 mb-3 max-w-[85%] self-start",a.innerHTML=`
            <img src="${m.img}" alt="${m.title}" class="w-full h-32 object-cover" onerror="this.src='assets/img/og-image.png'">
            <div class="p-3">
                <h4 class="font-semibold text-[#212842] mb-2">${m.title}</h4>
                <a href="${m.link}" class="inline-block bg-[#212842] text-white px-4 py-2 rounded-lg text-sm hover:bg-[#362017] transition-colors">
                    View Project
                </a>
            </div>
        `,e.messages.appendChild(a),e.messages.scrollTop=e.messages.scrollHeight}function O(u){const m=document.getElementById(u);m&&m.remove()}if(e.header&&e.window){let u=!1,m,a,p,T;const C=document.documentElement.dir==="rtl";e.header.style.cursor="move",e.header.addEventListener("mousedown",l=>{if(l.target.closest("#close-chat"))return;u=!0,m=l.clientX,a=l.clientY;const w=e.window.getBoundingClientRect();if(p=w.left,T=w.top,e.header.style.cursor="grabbing",document.body.style.userSelect="none",e.window.style.position!=="fixed"){if(e.window.style.position="fixed",C){const L=window.innerWidth-w.right;e.window.style.right=`${L}px`,e.window.style.left="auto"}else e.window.style.left=`${p}px`;e.window.style.top=`${T}px`,e.window.style.zIndex="10000"}}),document.addEventListener("mousemove",l=>{if(!u)return;l.preventDefault();const w=l.clientX-m,L=l.clientY-a,v=e.window.offsetWidth,b=e.window.offsetHeight,M=10;if(C){let y=window.innerWidth-p-v-w;y=Math.max(M,Math.min(y,window.innerWidth-v-M)),e.window.style.right=`${y}px`,e.window.style.left="auto"}else{let y=p+w;y=Math.max(M,Math.min(y,window.innerWidth-v-M)),e.window.style.left=`${y}px`,e.window.style.right="auto"}let A=T+L;A=Math.max(M,Math.min(A,window.innerHeight-b-M)),e.window.style.top=`${A}px`}),document.addEventListener("mouseup",()=>{u&&(u=!1,e.header.style.cursor="move",document.body.style.userSelect="")})}document.addEventListener("keydown",u=>{u.key==="Escape"&&!e.window?.classList.contains("hidden")&&i(),(u.ctrlKey||u.metaKey)&&u.key==="k"&&(u.preventDefault(),i())})}),document.addEventListener("DOMContentLoaded",()=>{const s=()=>{const o=document.createElement("div");o.className="rounded-xl border border-chocolate/20 bg-white/40 overflow-hidden p-8 text-center";const e=document.createElement("p");return e.className="text-sm text-chocolate/70",e.textContent="Inline PDF preview may be blocked by hosting or browser settings. Use the buttons below to open or download the deck.",o.appendChild(e),o},c=(o,e)=>{if(!o||!e||o.dataset.pdfLoaded)return;o.innerHTML="";const n=document.createElement("div");n.className="py-12 text-sm text-chocolate/60",n.textContent="Attempting to load inline preview\u2026",o.appendChild(n);const t=document.createElement("iframe");t.src=e,t.title="PDF preview",t.style.width="100%",t.style.height="480px",t.style.border="0",t.loading="lazy";let r=!1;const d=setTimeout(()=>{r=!0,console.log("PDF load timeout - assuming success");try{n.remove()}catch{}o.contains(t)||o.appendChild(t),o.dataset.pdfLoaded="true"},5e3),x=()=>{clearTimeout(d);try{t.remove()}catch{}o.innerHTML="",o.appendChild(s()),o.dataset.pdfLoaded="false"};t.addEventListener("load",()=>{clearTimeout(d);try{try{n.remove()}catch{}o.contains(t)||o.appendChild(t),o.dataset.pdfLoaded="true"}catch{x()}}),t.addEventListener("error",x),o.appendChild(t)};document.querySelectorAll(".preview-toggle").forEach(o=>{const e=o.closest("section"),n=e&&e.querySelector(".preview-panel");let t=null;e&&(t=e.querySelector('a[href$=".pdf"]')||e.querySelector('a[href*=".pdf?"]'));const r=t?t.getAttribute("href"):null;n&&r&&c(n,r),o.addEventListener("click",()=>{if(!n)return;n.classList.toggle("hidden");const d=!n.classList.contains("hidden");o.textContent=d?"Hide preview":"Show preview",typeof clarity=="function"&&clarity("event",d?"pdf_preview_show":"pdf_preview_hide"),typeof gtag=="function"&&gtag("event",d?"pdf_preview_show":"pdf_preview_hide",{event_category:"PDF"}),d&&!n.dataset.pdfLoaded&&r&&c(n,r)})})});
