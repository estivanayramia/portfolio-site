console.log("[Savonie DEBUG] site.js loaded");/**
 * ============================================================================
 * PORTFOLIO SITE - MAIN JAVASCRIPT
 * ============================================================================
 * 
 * Purpose: Core functionality for the portfolio website including:
 * - Mobile-optimized navigation and scroll handling
 * - Dark/light theme management with system preference detection
 * - GSAP animations with ScrollTrigger
 * - Progressive PDF preview loading with graceful fallbacks
 * - Savonie AI chatbot integration
 * - Client-side diagnostics (opt-in with ?collect-logs=1)
 * - PWA support with service worker
 * - Achievement system
 * - Custom analytics event tracking (theme changes, scroll depth, interactions)
 * 
 * Architecture Overview:
 * 1. Core Utilities (user interaction tracking, guarded reload)
 * 2. Instrumentation Module (diagnostic logging, gated by URL param)
 * 3. Feature Modules (theme, animations, PDFs, chat, etc.)
 * 4. Analytics Integration (custom events sent to GA4 & Clarity)
 * 5. Initialization & Startup
 * 
 * Analytics Integration:
 * ----------------------
 * Analytics initialization is handled by lazy-loader.js (loaded via defer).
 * This file sends CUSTOM EVENTS to the analytics services after they're loaded.
 * 
 * Services used:
 * - Google Analytics 4 (GA4): G-MCN4RXCY6Q
 * - Microsoft Clarity: uawk2g8xee
 * 
 * How it works:
 * 1. lazy-loader.js loads analytics on first user interaction (scroll, click, etc.)
 * 2. This file checks if analytics are loaded before sending events
 * 3. Custom events: theme toggle, scroll depth, navigation clicks, form submissions
 * 4. All analytics code is defensive (checks typeof before calling)
 * 
 * To verify analytics:
 * - GA4: https://analytics.google.com → Realtime → Events
 * - Clarity: https://clarity.microsoft.com → Dashboard → Recordings
 * 
 * @version 2.1.0
 * @author Estivan Ayramia
 * @license MIT
 */let __userInteracting=!1,__userInteractingTimer=null;const __markUserInteraction=()=>{__userInteracting=!0,__userInteractingTimer&&clearTimeout(__userInteractingTimer),__userInteractingTimer=setTimeout(()=>{__userInteracting=!1},1e3)};["touchstart","touchmove","wheel","scroll"].forEach(r=>{try{window.addEventListener(r,__markUserInteraction,{passive:!0})}catch{window.addEventListener(r,__markUserInteraction)}});const __initDeferredStylesheets=()=>{try{document.querySelectorAll('link[rel="stylesheet"][media="print"][data-media]').forEach(i=>{const t=i.getAttribute("data-media")||"all",o=()=>{try{i.media=t}catch{}};try{i.addEventListener("load",o,{once:!0})}catch{i.addEventListener("load",o)}try{i.addEventListener("error",o,{once:!0})}catch{i.addEventListener("error",o)}setTimeout(()=>{try{i.sheet&&o()}catch{}},0)})}catch{}};__initDeferredStylesheets();const __initPreloadStylesheets=()=>{try{document.querySelectorAll('link[rel="preload"][as="style"][data-onload-rel]').forEach(i=>{const t=i.getAttribute("data-onload-rel")||"stylesheet",o=()=>{try{i.rel=t,i.removeAttribute("data-onload-rel")}catch{}};try{i.addEventListener("load",o,{once:!0})}catch{i.addEventListener("load",o)}try{if(typeof performance<"u"&&typeof performance.getEntriesByName=="function"){const n=i.href,e=n?performance.getEntriesByName(n):[];if(e&&e.length){const s=e[0];s&&typeof s.responseEnd=="number"&&s.responseEnd>0&&o()}}}catch{}})}catch{}};__initPreloadStylesheets();const __initCarouselAndLightbox=()=>{try{const r=document.getElementById("carouselTrack");if(!r||r.dataset&&r.dataset.carouselInit==="1")return;const i=!!(r.dataset&&r.dataset.carouselWrap==="1"),t=Array.from(document.querySelectorAll(".note-card img")),o=t.length>0,n=Array.from(document.querySelectorAll(".carousel-slide"));if(!n.length)return;const e=document.getElementById("carouselPrev"),s=document.getElementById("carouselNext"),d=document.getElementById("carouselDots"),m=document.getElementById("lightbox"),g=document.getElementById("lightbox-image"),C=document.querySelector(".lightbox-close"),I=document.querySelector(".lightbox-prev"),v=document.querySelector(".lightbox-next");if(!e||!s||!d||!m||!g||!C||!I||!v)return;const _=n.map(x=>x.querySelector("img")).filter(Boolean),f=o?t:_;if(!f.length)return;let h=0,T=0;const M=()=>o?window.innerWidth>=1024?5:window.innerWidth>=768?4:window.innerWidth>=640?3:2:window.innerWidth>=768?3:2;let a=M();const O=()=>{try{d.innerHTML=""}catch{for(;d.firstChild;)d.removeChild(d.firstChild)}},Y=()=>{try{m.classList.remove("active"),m.setAttribute("aria-hidden","true")}catch{}},q=()=>Math.ceil(n.length/a),W=()=>{try{const x=(n[0]&&n[0].offsetWidth?n[0].offsetWidth:0)+16,P=q();if(o){const N=Math.max(0,n.length-a);h=Math.max(0,Math.min(h,N)),r.style.transform=`translateX(-${h*x}px)`}else h=Math.max(0,Math.min(h,P-1)),r.style.transform=`translateX(-${h*x*a}px)`;Array.from(document.querySelectorAll(".carousel-dot")).forEach((N,R)=>{const k=o?Math.floor(h/a):h;N.classList.toggle("active",R===k)})}catch{}},F=()=>{O();const x=q();for(let P=0;P<x;P++){const N=document.createElement("button");N.className="carousel-dot"+(P===0?" active":"");try{N.setAttribute("aria-label",`Go to page ${P+1}`)}catch{}N.addEventListener("click",()=>{if(o){const R=Math.max(0,n.length-a);h=Math.max(0,Math.min(P*a,R))}else h=i?(P+x)%x:Math.max(0,Math.min(P,x-1));W()}),d.appendChild(N)}W()};e.addEventListener("click",()=>{const x=q();if(o){const P=Math.max(0,n.length-a);i?(h=h-a,h<0&&(h=P)):h=Math.max(0,h-a)}else h=i?(h-1+x)%x:Math.max(0,Math.min(h-1,x-1));W()}),s.addEventListener("click",()=>{const x=q();if(o){const P=Math.max(0,n.length-a);i?(h=h+a,h>P&&(h=0)):h=Math.min(P,h+a)}else h=i?(h+1)%x:Math.max(0,Math.min(h+1,x-1));W()});const $=x=>{const P=f[x];if(P){T=x,g.src=P.src,g.alt=P.alt||"";try{g.style.transform=P.style&&P.style.transform?P.style.transform:""}catch{}if(o){try{I.style.display=x>0?"block":"none"}catch{}try{v.style.display=x<f.length-1?"block":"none"}catch{}}}},H=x=>{$(x),m.classList.add("active"),m.setAttribute("aria-hidden","false")};o?f.forEach((x,P)=>{x.addEventListener("click",()=>H(P))}):n.forEach((x,P)=>{x.addEventListener("click",()=>H(P))}),C.addEventListener("click",Y),m.addEventListener("click",x=>{x.target===m&&Y()}),I.addEventListener("click",x=>{x&&x.stopPropagation&&x.stopPropagation(),o?T>0&&$(T-1):$((T-1+f.length)%f.length)}),v.addEventListener("click",x=>{x&&x.stopPropagation&&x.stopPropagation(),o?T<f.length-1&&$(T+1):$((T+1)%f.length)}),document.addEventListener("keydown",x=>{m.classList.contains("active")&&(x.key==="Escape"&&Y(),x.key==="ArrowLeft"&&I.click(),x.key==="ArrowRight"&&v.click())}),window.addEventListener("resize",()=>{const x=M();x!==a?(a=x,F()):W()});try{r.dataset.carouselInit="1"}catch{}F()}catch{}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",__initCarouselAndLightbox):__initCarouselAndLightbox();const __collectLogsEnabled=typeof window<"u"&&new URLSearchParams(window.location.search).has("collect-logs"),__collectedLogs=[],__saveCollected=()=>{try{localStorage.setItem("site_collect_logs",JSON.stringify(__collectedLogs.slice(-1e3)))}catch{}},__logCollect=(r,i)=>{if(__collectLogsEnabled)try{const t={t:Date.now(),msg:String(r),data:i||null,scrollY:window.scrollY||0};__collectedLogs.push(t),__saveCollected()}catch{}},__collectLogsParam=typeof window<"u"?new URLSearchParams(window.location.search).get("collect-logs"):null,__collectSnapshots=!!(__collectLogsParam&&/snapshot/i.test(__collectLogsParam)),__maybeTakeSnapshot=(r,i)=>{if(__collectSnapshots)try{const t=document.activeElement,o=e=>{if(!e||!e.getBoundingClientRect)return null;const s=e.getBoundingClientRect();return{tag:e.tagName||null,id:e.id||null,classes:e.className||null,rect:{x:Math.round(s.x),y:Math.round(s.y),w:Math.round(s.width),h:Math.round(s.height),top:Math.round(s.top),left:Math.round(s.left)},focusable:typeof e.tabIndex=="number"?e.tabIndex:null,ariaRole:e.getAttribute&&(e.getAttribute("role")||null)}},n={reason:r||null,ts:Date.now(),scrollY:window.scrollY||0,innerWidth:window.innerWidth||0,innerHeight:window.innerHeight||0,docHeight:document.documentElement.scrollHeight||document.body.scrollHeight||0,target:o(i||document.activeElement)||null,activeElement:o(t)||null};__logCollect("snapshot",n)}catch{}};if(__collectLogsEnabled){let r=null;window.addEventListener("scroll",()=>{r||(r=setTimeout(()=>{__logCollect("scroll",{y:window.scrollY,innerHeight:window.innerHeight,docHeight:document.documentElement.scrollHeight}),r=null},200))},{passive:!0});try{"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{__logCollect("controllerchange",{controller:!!navigator.serviceWorker.controller})})}catch{}try{const t=window.location.reload.bind(window.location);window.location.reload=function(){return __logCollect("location.reload called"),t()}}catch{}(()=>{const t=document.createElement("button");t.id="collect-logs-btn",t.textContent="Logs",Object.assign(t.style,{position:"fixed",left:"8px",bottom:"12px",zIndex:99999,padding:"6px 8px",fontSize:"12px",background:"rgba(33,40,66,0.85)",color:"#e1d4c2",border:"1px solid rgba(225,212,194,0.08)",borderRadius:"6px"}),t.addEventListener("click",()=>{try{const o=JSON.stringify(__collectedLogs,null,2),n=new Blob([o],{type:"application/json"}),e=URL.createObjectURL(n),s=document.createElement("a");s.href=e,s.download=`site-logs-${Date.now()}.json`,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(e)}catch{const n=window.open();if(n)try{const e=JSON.stringify(__collectedLogs,null,2),s=n.document;s.title="Site logs",s.body.style.margin="0";const d=s.createElement("pre");d.style.margin="0",d.style.padding="12px",d.textContent=e,s.body.appendChild(d)}catch{}}}),document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(t)})})();try{document.addEventListener("visibilitychange",()=>__logCollect("visibilitychange",{hidden:document.hidden})),window.addEventListener("hashchange",t=>__logCollect("hashchange",{oldURL:t.oldURL,newURL:t.newURL})),window.addEventListener("popstate",t=>__logCollect("popstate",{state:t.state})),window.addEventListener("beforeunload",t=>__logCollect("beforeunload",{})),window.addEventListener("focusin",t=>{try{__logCollect("focusin",{tag:t.target&&t.target.tagName,id:t.target&&t.target.id||null,class:t.target&&t.target.className||null})}catch{}}),(function(){const t=HTMLElement.prototype.focus;t.__wrappedByCollectLogs||(HTMLElement.prototype.focus=function(){try{__logCollect("element.focus.called",{tag:this.tagName,id:this.id||null,options:arguments[0]||null})}catch{}try{__maybeTakeSnapshot&&__maybeTakeSnapshot("focus",this)}catch{}try{return t.apply(this,arguments)}catch{try{return t.call(this)}catch{}}},HTMLElement.prototype.focus.__wrappedByCollectLogs=!0)})(),(function(){const t=Element.prototype;if(!t.__scrollIntoViewLogged){const o=t.scrollIntoView;t.scrollIntoView=function(){try{__logCollect("element.scrollIntoView",{tag:this.tagName,id:this.id||null,args:Array.from(arguments)})}catch{}try{__maybeTakeSnapshot&&__maybeTakeSnapshot("scrollIntoView",this)}catch{}return o.apply(this,arguments)},t.__scrollIntoViewLogged=!0}})();try{const t=window.scrollTo;window.scrollTo=function(){try{__logCollect("window.scrollTo",{args:Array.from(arguments)})}catch{}try{__maybeTakeSnapshot&&__maybeTakeSnapshot("window.scrollTo",null)}catch{}return t.apply(window,arguments)}}catch{}try{const t=window.scrollBy;window.scrollBy=function(){try{__logCollect("window.scrollBy",{args:Array.from(arguments)})}catch{}try{__maybeTakeSnapshot&&__maybeTakeSnapshot("window.scrollBy",null)}catch{}return t.apply(window,arguments)}}catch{}try{const t=window.fetch;window.fetch=function(o,n){try{__logCollect("fetch.start",{url:o&&o.url||o,method:n&&n.method||"GET"})}catch{}return t.apply(this,arguments).then(e=>{try{__logCollect("fetch.end",{url:e&&e.url||o,status:e.status})}catch{}return e}).catch(e=>{try{__logCollect("fetch.error",{url:o,message:e&&e.message})}catch{}throw e})}}catch{}try{let o=function(){const n=new t;let e=null;const s=n.open;n.open=function(m,g){e=g;try{__logCollect("xhr.open",{method:m,url:g})}catch{}return s.apply(n,arguments)};const d=n.send;return n.send=function(){try{__logCollect("xhr.send",{url:e})}catch{}return n.addEventListener("loadend",function(){try{__logCollect("xhr.loadend",{url:e,status:n.status})}catch{}}),d.apply(n,arguments)},n};var WrappedXHR=o;const t=window.XMLHttpRequest;o.prototype=t.prototype,window.XMLHttpRequest=o}catch{}window.addEventListener("resize",()=>__logCollect("resize",{innerWidth:window.innerWidth,innerHeight:window.innerHeight})),window.addEventListener("orientationchange",()=>__logCollect("orientationchange",{orientation:window.orientation}));try{if(navigator.serviceWorker&&navigator.serviceWorker.register){const t=navigator.serviceWorker.register.bind(navigator.serviceWorker);navigator.serviceWorker.register=function(){const o=arguments;try{__logCollect("sw.register.start",{scope:o&&o[1]&&o[1].scope||null,script:o&&o[0]})}catch{}return t.apply(navigator.serviceWorker,arguments).then(n=>{try{__logCollect("sw.register.done",{scope:n.scope})}catch{}try{n.addEventListener("updatefound",()=>__logCollect("sw.updatefound",{})),n.waiting&&__logCollect("sw.waiting",{})}catch{}return n}).catch(n=>{try{__logCollect("sw.register.error",{message:n&&n.message})}catch{}throw n})}}}catch{}try{if(typeof ScrollTrigger<"u"&&ScrollTrigger&&ScrollTrigger.refresh){const t=ScrollTrigger.refresh.bind(ScrollTrigger);ScrollTrigger.refresh=function(){try{__logCollect("ScrollTrigger.refresh",{args:Array.from(arguments)})}catch{}return t.apply(this,arguments)}}}catch{}["touchend","pointerup","mouseup"].forEach(t=>{window.addEventListener(t,o=>{try{__logCollect("gesture."+t,{x:o.changedTouches&&o.changedTouches[0]&&o.changedTouches[0].clientX||o.clientX||null,y:o.changedTouches&&o.changedTouches[0]&&o.changedTouches[0].clientY||o.clientY||null})}catch{}},{passive:!0})});try{let t=document.documentElement.scrollHeight||document.body.scrollHeight||0;new MutationObserver(()=>{try{const n=document.documentElement.scrollHeight||document.body.scrollHeight||0;if(n!==t){__logCollect("docHeight.change",{from:t,to:n});try{__maybeTakeSnapshot&&__maybeTakeSnapshot("docHeight.change",document.documentElement)}catch{}t=n}}catch{}}).observe(document.documentElement||document.body,{childList:!0,subtree:!0,attributes:!0})}catch{}try{const o=n=>{try{const e=JSON.stringify(n,(s,d)=>typeof s=="string"&&/pass(word)?|token|secret|auth|credit|cc-number|card|ssn|cvv/i.test(s)?"[REDACTED]":typeof d=="string"&&d.length>200?d.slice(0,200)+"\u2026[truncated]":d);return e.length>8192?e.slice(0,8192)+"...[truncated]":e}catch{return String(n)}};try{["log","info","warn","error","debug"].forEach(n=>{const e=console[n]&&console[n].bind(console);e&&(console[n]=function(){try{__logCollect("console."+n,{args:Array.from(arguments).map(s=>typeof s=="object"?o(s):String(s))})}catch{}try{(n==="error"||n==="warn")&&__maybeTakeSnapshot&&__maybeTakeSnapshot("console."+n,document.activeElement)}catch{}return e.apply(console,arguments)})})}catch{}window.addEventListener("error",n=>{try{__logCollect("window.error",{message:n.message,filename:n.filename,lineno:n.lineno,colno:n.colno,stack:n.error&&n.error.stack?String(n.error.stack).slice(0,1e3):null});try{__maybeTakeSnapshot&&__maybeTakeSnapshot("error",n&&n.target?n.target:document.activeElement)}catch{}}catch{}}),window.addEventListener("unhandledrejection",n=>{try{__logCollect("unhandledrejection",{reason:n.reason&&(n.reason.stack?String(n.reason.stack).slice(0,1e3):String(n.reason))})}catch{}});try{const n=localStorage.setItem.bind(localStorage);localStorage.setItem=function(e,s){try{__logCollect("localStorage.setItem",{key:String(e),size:s&&s.length||0})}catch{}return n(e,s)}}catch{}try{const n=sessionStorage.setItem.bind(sessionStorage);sessionStorage.setItem=function(e,s){try{__logCollect("sessionStorage.setItem",{key:String(e),size:s&&s.length||0})}catch{}return n(e,s)}}catch{}try{if(navigator&&navigator.sendBeacon){const n=navigator.sendBeacon.bind(navigator);navigator.sendBeacon=function(e,s){try{__logCollect("navigator.sendBeacon",{url:String(e),dataSize:s&&s.size||null})}catch{}return n(e,s)}}}catch{}try{document.addEventListener("click",n=>{try{const e=n.target&&(n.target.closest?n.target.closest("a,button,input,select,textarea,summary"):n.target);if(!e)return;const s=(e.tagName||"").toLowerCase(),d={tag:s,id:e.id||null,classes:e.className||null};s==="a"&&e.href&&(d.href=e.href.length>200?e.href.slice(0,200)+"\u2026":e.href),__logCollect("dom.click",d);try{["a","button","input","textarea","select"].includes(s)&&__maybeTakeSnapshot&&__maybeTakeSnapshot("click",e)}catch{}}catch{}},{passive:!0}),document.addEventListener("submit",n=>{try{const e=n.target;if(!e||!e.tagName||e.tagName.toLowerCase()!=="form")return;const s=Array.from(e.elements||[]).filter(d=>d.name).map(d=>({name:d.name,type:d.type||d.tagName}));__logCollect("form.submit",{action:e.action||null,method:e.method||"GET",fields:s})}catch{}},!0)}catch{}try{document.addEventListener("input",n=>{try{const e=n.target;if(!e)return;const s=e.tagName&&e.tagName.toLowerCase();if(s==="input"||s==="textarea"||s==="select"){const d={tag:s,type:e.type||null,name:e.name||null,valueLength:e.value&&e.value.length||0};__logCollect("input",d)}}catch{}},{passive:!0})}catch{}try{document.addEventListener("selectionchange",()=>{try{const n=document.getSelection&&document.getSelection();if(!n)return;const e=n.toString(),s=n.anchorNode&&n.anchorNode.parentElement&&n.anchorNode.parentElement.tagName;__logCollect("selectionchange",{length:e.length,container:s||null})}catch{}})}catch{}try{["copy","cut","paste"].forEach(n=>{document.addEventListener(n,e=>{try{__logCollect("clipboard."+n,{})}catch{}})})}catch{}try{if("PerformanceObserver"in window)try{new PerformanceObserver(e=>{e.getEntries().forEach(s=>{try{s.entryType==="longtask"?__logCollect("perf.longtask",{duration:Math.round(s.duration)}):s.entryType==="resource"&&__logCollect("perf.resource",{name:s.name,initiatorType:s.initiatorType,duration:Math.round(s.duration)})}catch{}})}).observe({entryTypes:["longtask","resource"]})}catch{}}catch{}try{const n=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(e,s,d){try{__logCollect("addEventListener",{target:this&&this.tagName?this.tagName:this&&this.constructor&&this.constructor.name||"unknown",type:e})}catch{}return n.apply(this,arguments)}}catch{}}catch{}}catch{}window.tryGuardedReload=function(t){t=t||{};const o=typeof t.MAX=="number"?t.MAX:3e4,n=typeof t.RETRY=="number"?t.RETRY:500,e=t&&typeof t.fallback=="function"?t.fallback:null,s=Date.now();(function d(){try{if(!(typeof window.__userInteracting<"u"?window.__userInteracting:!1)){try{window.location.reload()}catch{try{window.location.href=window.location.href}catch{}}return}if(Date.now()-s<o){setTimeout(d,n);return}if(e)try{e()}catch{try{window.location.reload()}catch{}}else try{window.location.reload()}catch{try{window.location.href=window.location.href}catch{}}}catch{if(e)try{e()}catch{try{window.location.reload()}catch{}}else try{window.location.reload()}catch{}}})()}}const initDarkMode=()=>{const r=document.getElementById("theme-toggle");if(!r)return;const i=window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("theme"),o=t||(i?"dark":"light");document.documentElement.setAttribute("data-theme",o),t||localStorage.setItem("theme",o),r.innerHTML=o==="dark"?'<span style="color: #e1d4c2">\u{1F506}</span>':'<span style="color: #212842">\u{1F319}</span>';const n=()=>{const e=document.documentElement.getAttribute("data-theme"),s=e==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s),r.innerHTML=s==="dark"?'<span style="color: #e1d4c2">\u{1F506}</span>':'<span style="color: #212842">\u{1F319}</span>',typeof clarity=="function"&&clarity("event","theme_toggle",{theme:s}),typeof gtag=="function"&&gtag("event","theme_toggle",{event_category:"user_preference",event_label:s}),r.setAttribute("aria-label",`Switch to ${e} mode`)};window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(!localStorage.getItem("theme_manual")){const s=e.matches?"dark":"light";document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s),r.innerHTML=s==="dark"?'<span style="color: #e1d4c2">\u{1F506}</span>':'<span style="color: #212842">\u{1F319}</span>'}}),r.addEventListener("click",()=>{n(),localStorage.setItem("theme_manual","true")})},initMobileMenu=()=>{const r=document.getElementById("mobile-menu-toggle"),i=document.getElementById("mobile-menu");if(!r||!i)return;let t=0,o=null;const n=()=>o||(o=document.createElement("div"),o.setAttribute("aria-hidden","true"),o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.right="0",o.style.bottom="0",o.style.zIndex="35",o.style.background="rgba(0,0,0,0.35)",o.addEventListener("click",()=>s()),o),e=()=>{t=window.scrollY;try{const g=n();g.parentElement||document.body.appendChild(g)}catch{}i.classList.remove("hidden"),r.setAttribute("aria-expanded","true"),document.body.style.position="fixed",document.body.style.top=`-${t}px`,document.body.style.width="100%";const m=r.querySelector("svg");m&&(m.style.transform="rotate(90deg)")},s=()=>{if(i.classList.contains("hidden"))return;i.classList.add("hidden"),r.setAttribute("aria-expanded","false"),o&&o.parentElement&&o.parentElement.removeChild(o),document.body.style.position="",document.body.style.top="",document.body.style.width="",window.scrollTo(0,t);const m=r.querySelector("svg");m&&(m.style.transform="rotate(0deg)")},d=()=>{r.getAttribute("aria-expanded")==="true"?s():e()};r.addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),d()}),document.addEventListener("click",m=>{!r.contains(m.target)&&!i.contains(m.target)&&s()}),document.addEventListener("keydown",m=>{m.key==="Escape"&&s()}),window.addEventListener("hashchange",s),window.addEventListener("popstate",s),i.addEventListener("click",m=>{(m.target.tagName==="A"||m.target.closest("a"))&&s()})},initAriaCurrent=()=>{const r=o=>{try{return o?(o=String(o).split("#")[0].split("?")[0],o.endsWith(".html")&&(o=o.slice(0,-5)),o.length>1&&o.endsWith("/")&&(o=o.slice(0,-1)),o||"/"):"/"}catch{return"/"}},i=r(window.location&&window.location.pathname);document.querySelectorAll("header a[href], #mobile-menu a[href]").forEach(o=>{try{const n=o.getAttribute("href");if(!n||/^(https?:)?\/\//i.test(n)||/^mailto:/i.test(n)||n.startsWith("#"))return;r(n)===i?o.setAttribute("aria-current","page"):o.removeAttribute("aria-current")}catch{}})},initAnimations=()=>{const r=typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(max-width: 768px)").matches,i=typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;if(document.querySelectorAll("[data-gsap]").forEach(s=>{s.classList.remove("opacity-0","translate-y-8"),s.style.opacity="1",s.style.transform="none"}),typeof gsap>"u"||typeof ScrollTrigger>"u"){console.warn("GSAP or ScrollTrigger not loaded; revealing content without animations.");return}if(i)return;gsap.registerPlugin(ScrollTrigger),document.querySelectorAll('[data-gsap="fade-up"]').forEach(s=>{const d=s.getAttribute("data-gsap-delay")||0;gsap.from(s,{opacity:0,y:20,duration:.4,delay:parseFloat(d)*.5,ease:"power2.out",scrollTrigger:{trigger:s,start:"top 92%",toggleActions:"play none none none"}})});const n=document.querySelector("section:first-of-type");n&&!r&&!n.classList.contains("no-parallax")&&gsap.to(n,{yPercent:20,ease:"none",scrollTrigger:{trigger:n,start:"top top",end:"bottom top",scrub:!0}}),document.querySelectorAll(".card-hover").forEach(s=>{s.addEventListener("mouseenter",()=>{gsap.to(s,{y:-8,duration:.3,ease:"power2.out"})}),s.addEventListener("mouseleave",()=>{gsap.to(s,{y:0,duration:.3,ease:"power2.out"})})})},loadGSAPAndInit=()=>{const r=typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(max-width: 768px)").matches,i=()=>{if(window.gsap&&window.ScrollTrigger){initAnimations();return}const t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js",t.onload=()=>{const o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js",o.onload=()=>{initAnimations()},document.body.appendChild(o)},document.body.appendChild(t)};if(r){initAnimations();const t=()=>{["scroll","touchstart","mousemove"].forEach(o=>window.removeEventListener(o,t)),i()};["scroll","touchstart","mousemove"].forEach(o=>window.addEventListener(o,t,{once:!0,passive:!0}))}else i()},initSmoothScroll=()=>{document.addEventListener("click",r=>{const i=r.target.closest("a");if(!i)return;const t=i.getAttribute("href");if(t==="#"){r.preventDefault(),r.stopPropagation();return}if(t&&t.startsWith("#")&&t.length>1){const o=document.querySelector(t);if(o){r.preventDefault();const s=o.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:s,behavior:"smooth"})}}},{passive:!1})},initFormValidation=()=>{const r=document.querySelector('form[action*="formspree.io"]');if(!r)return;const i=r.querySelectorAll("input, textarea, select"),t=r.querySelector('input[type="file"][name="file"]'),o=5*1024*1024,n=["csv","doc","docx","pdf","txt","xls","xlsx","jpg","jpeg","png","gif","svg","webp"],e=r.querySelector('input[name="link"]'),s=v=>{if(!v)return!0;let _=v.trim();/^https?:\/\//i.test(_)||(_=`https://${_}`);let f;try{f=new URL(_)}catch{return!1}return!["javascript:","data:","file:","blob:","chrome:","chrome-extension:"].includes(f.protocol)};e&&e.addEventListener("blur",()=>{e.value&&!/^https?:\/\//i.test(e.value)&&(e.value=`https://${e.value.trim()}`)});const d=(v,_)=>{v.classList.add("border-red-500");let f=v.parentElement.querySelector(".inline-error");f||(f=document.createElement("p"),f.className="inline-error text-xs text-red-600 mt-1",v.parentElement.appendChild(f)),f.textContent=_},m=v=>{v.classList.remove("border-red-500");const _=v.parentElement.querySelector(".inline-error");_&&_.remove()};i.forEach(v=>{v.addEventListener("blur",()=>{v.hasAttribute("required")&&!v.value.trim()?d(v,"This field is required"):v.type==="email"&&v.value&&!v.checkValidity()?d(v,"Please enter a valid email address"):v.type==="url"&&v.value&&!s(v.value)?d(v,"Please enter a valid URL"):v.checkValidity()?m(v):d(v,v.validationMessage||"Invalid input")}),v.addEventListener("input",()=>{v.classList.contains("border-red-500")&&v.checkValidity()&&v.value.trim()&&m(v)})});let g=r.querySelector("#form-status");g||(g=document.createElement("div"),g.id="form-status",g.className="text-sm mt-3",r.appendChild(g));const C=v=>{const _=r.querySelector('button[type="submit"]');_&&(_.disabled=v,_.classList.toggle("loading",v))},I=async()=>{C(!0),g.textContent="";try{const v=new FormData(r);if(t&&t.files&&t.files[0]){const f=t.files[0],h=(f.name.split(".").pop()||"").toLowerCase();if(!n.includes(h)){g.className="text-sm mt-3 text-red-700",g.textContent="Unsupported file type. Please upload one of: CSV, DOC, DOCX, PDF, TXT, XLS, XLSX, JPG, JPEG, PNG, GIF, SVG, WEBP.",C(!1);return}if(f.size>o){g.className="text-sm mt-3 text-red-700",g.textContent="File too large (max 5MB). Please upload a smaller file.",C(!1);return}}if(e&&e.value&&!s(e.value)){g.className="text-sm mt-3 text-red-700",g.textContent="Please enter a valid link starting with https:// or http://",C(!1);return}if((await fetch(r.action,{method:"POST",body:v,headers:{Accept:"application/json"},mode:"cors",credentials:"omit"})).ok){r.reset();const f=r.parentElement;f&&(f.innerHTML=`
                        <h2 class="text-2xl font-bold text-indigodeep mb-2">Thanks - message sent!</h2>
                        <p class="text-sm text-chocolate mb-4">Enjoy a quick game while you're here.</p>
                        <div id="mini-game-root" class="w-full bg-white border border-chocolate/10 rounded-xl p-4"></div>
                    `,initMiniGame("mini-game-root"))}else{g.className="text-sm mt-3 text-red-700",g.textContent="Sorry, something went wrong. Trying fallback...";try{r.setAttribute("target","_blank"),r.submit()}catch{g.textContent="Sorry, something went wrong. Please try again or email hello@estivanayramia.com."}}}catch{g.className="text-sm mt-3 text-red-700",g.textContent="Network error detected. Opening fallback submit...";try{r.setAttribute("target","_blank"),r.submit()}catch{g.textContent="Network error. Please check your connection or email hello@estivanayramia.com."}}finally{C(!1)}};r.addEventListener("submit",v=>{let _=!0;if(i.forEach(f=>{f.checkValidity()||(_=!1,f.classList.add("border-red-500"))}),v.preventDefault(),!_){const f=r.querySelector(".border-red-500");if(f)try{f.focus({preventScroll:!0})}catch{try{__logCollect&&__logCollect("focus-fallback",{selector:f.tagName+(f.id?"#"+f.id:"")})}catch{}f.focus()}g.className="text-sm mt-3 text-red-700",g.textContent="Please complete required fields highlighted in red.";return}I()})},initMiniGame=r=>{const i=document.getElementById(r);if(!i)return;const t="mgHighScore",o="mgLeaderboard",n=parseInt(localStorage.getItem(t)||"0",10),e=()=>{try{const k=localStorage.getItem(o);if(!k)return[];const D=JSON.parse(k);return Array.isArray(D)?D.filter(l=>typeof l.name=="string"&&typeof l.score=="number").slice(0,25):[]}catch{return[]}},s=k=>{try{localStorage.setItem(o,JSON.stringify(k.slice(0,25)))}catch{}};let d=e();i.innerHTML=`
        <div class="flex items-center justify-between mb-2">
            <div class="text-sm font-medium text-indigodeep">Score: <span id="mg-score">0</span> <span id="mg-mult" class="ml-2 text-ink/60">x1</span></div>
            <div class="text-xs text-ink/60">Best: <span id="mg-best">${n}</span></div>
        </div>
        <div class="flex items-center justify-between mb-2">
            <div class="text-xs text-ink/60">Lives: <span id="mg-lives">\u2764\u2764\u2764</span></div>
            <button id="mg-start" class="text-xs bg-indigodeep text-white px-3 py-1 rounded-full">Start</button>
        </div>
        <canvas id="mg-canvas" class="w-full rounded border border-chocolate/10" style="touch-action: none; height: 320px;"></canvas>
        <p class="text-xs text-ink/60 mt-2">Catch the orbs. Golden orbs are bonus. Tap/drag on mobile, or use \u25C0 \u25B6.</p>
    `;const m=i.querySelector("#mg-canvas"),g=i.querySelector("#mg-score"),C=i.querySelector("#mg-mult"),I=i.querySelector("#mg-best"),v=i.querySelector("#mg-lives"),_=i.querySelector("#mg-start"),f=m.getContext("2d"),h=window.devicePixelRatio||1,a={running:!1,score:0,best:n,w:0,h:0,paddle:{x:0,y:0,w:90,h:12},orbs:[],particles:[],lastSpawn:0,orbInterval:900,baseSpeed:2.2,lives:3,combo:0,comboTimer:0,shake:0,t:0},O=()=>{const k=m.getBoundingClientRect();m.width=Math.floor(k.width*h),m.height=Math.floor(320*h),a.w=m.width,a.h=m.height,a.paddle.y=a.h-30*h,a.paddle.x===0&&(a.paddle.x=a.w/2-a.paddle.w*h/2),H()},Y=k=>"\u2764\u2764\u2764".slice(0,k),q=k=>{navigator.vibrate&&navigator.vibrate(k)},W=(k,D,l="#212842",u=10)=>{for(let c=0;c<u;c++)a.particles.push({x:k,y:D,vx:(Math.random()-.5)*3*h,vy:-Math.random()*3*h,life:600,color:l,r:2*h})},F=()=>{const k=(8+Math.random()*2)*h,D=k+Math.random()*(a.w-2*k),l=Math.random()<.15,u=l?"#eab308":"#362017",c=(a.baseSpeed+Math.random()*1.5+a.score*.01)*h;a.orbs.push({x:D,y:k+2,r:k,vy:c,color:u,type:l?"gold":"normal"})},$=()=>{const k=f.createLinearGradient(0,0,a.w,a.h),D=(Math.sin(a.t*.001)+1)/2;k.addColorStop(0,`rgba(${210+20*D|0}, ${200+10*D|0}, 180, 0.6)`),k.addColorStop(1,"rgba(200, 190, 170, 0.6)"),f.fillStyle=k,f.fillRect(0,0,a.w,a.h)},H=()=>{const k=a.shake?Math.random()*a.shake-a.shake/2:0,D=a.shake?Math.random()*a.shake-a.shake/2:0;f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,a.w,a.h),f.translate(k,D),$();const l=Math.min(a.combo,6);f.shadowColor="rgba(33,40,66,0.6)",f.shadowBlur=l*2*h,f.fillStyle="#212842",f.fillRect(a.paddle.x,a.paddle.y,a.paddle.w*h,a.paddle.h*h),f.shadowBlur=0,a.particles.forEach(u=>{f.globalAlpha=Math.max(0,u.life/600),f.fillStyle=u.color,f.beginPath(),f.arc(u.x,u.y,u.r,0,Math.PI*2),f.fill(),f.globalAlpha=1}),a.orbs.forEach(u=>{f.beginPath(),f.fillStyle=u.color,f.shadowColor=u.type==="gold"?"rgba(234,179,8,0.6)":"rgba(54,32,23,0.3)",f.shadowBlur=u.type==="gold"?8*h:4*h,f.arc(u.x,u.y,u.r,0,Math.PI*2),f.fill(),f.shadowBlur=0})},x=k=>{if(!a.running)return;a.last||(a.last=k);const D=k-a.last;a.t+=D,a.last=k,a.comboTimer+=D,a.comboTimer>1600&&a.combo>0&&(a.combo=0,C.textContent="x1"),a.shake>0&&(a.shake=Math.max(0,a.shake-.5*h)),k-a.lastSpawn>a.orbInterval&&(F(),a.lastSpawn=k,a.orbInterval>420&&(a.orbInterval-=8));const l=a.paddle.w*h,u=a.paddle.h*h,c=a.paddle.x,b=a.paddle.y;a.orbs.forEach(S=>{S.y+=S.vy});for(let S=a.particles.length-1;S>=0;S--){const w=a.particles[S];w.x+=w.vx,w.y+=w.vy,w.vy+=.04*h,w.life-=D,w.life<=0&&a.particles.splice(S,1)}for(let S=a.orbs.length-1;S>=0;S--){const w=a.orbs[S];if(w.y+w.r>=b&&w.x>=c&&w.x<=c+l){const p=w.type==="gold"?5:1;a.combo=Math.min(a.combo+1,9),a.comboTimer=0;const E=1+Math.floor(a.combo/3);a.score+=p*E,g.textContent=a.score,C.textContent="x"+E,W(w.x,b,w.color,w.type==="gold"?18:10),a.shake=Math.min(6*h,a.shake+(w.type==="gold"?4:2)),q(w.type==="gold"?25:12),a.orbs.splice(S,1),a.score%10===0&&W(w.x,w.y,"#e1d4c2",24)}else if(w.y-w.r>a.h&&(a.orbs.splice(S,1),a.lives-=1,v.textContent=Y(a.lives),a.combo=0,C.textContent="x1",a.shake=10*h,q(60),a.lives<=0)){P();return}}H(),requestAnimationFrame(x)},P=()=>{a.running=!1,a.score>a.best&&(a.best=a.score,localStorage.setItem(t,String(a.best)),I.textContent=a.best),_.textContent="Restart";const k=document.createElement("div");k.className="mt-3 text-sm text-indigodeep mg-end",k.innerHTML=`
            <div class="mb-1 font-medium">Game over! Final score: ${a.score}</div>
            <p class="text-ink/80 mb-2">Hope you enjoyed this little easter egg - I'll be in touch soon.</p>
            <p class="text-ink/60">Want more surprises? Explore a few corners of the site:</p>
            <div class="mt-2 flex flex-wrap gap-2">
                <a href="overview.html" class="text-xs px-3 py-1 rounded-full border border-chocolate/20 text-indigodeep hover:bg-beige transition-colors">Overview</a>
                <a href="deep-dive.html" class="text-xs px-3 py-1 rounded-full border border-chocolate/20 text-indigodeep hover:bg-beige transition-colors">Deep Dive</a>
                <a href="projects.html" class="text-xs px-3 py-1 rounded-full border border-chocolate/20 text-indigodeep hover:bg-beige transition-colors">Projects</a>
            </div>
            ${a.score>0?`<div class='mt-4 border-t border-chocolate/10 pt-3'>
                <p class='text-ink/70 mb-2'>Submit your score to the local leaderboard (device-only) or view current rankings.</p>
                <div class='flex flex-col sm:flex-row gap-2 sm:items-center'>
                    <input id='mg-name' maxlength='16' placeholder='Username (3-16 chars)' class='flex-1 px-3 py-2 text-sm border border-chocolate/20 rounded focus:outline-none focus:ring-2 focus:ring-indigodeep'/>
                    <button id='mg-save' class='text-xs bg-indigodeep text-white px-4 py-2 rounded-full'>Save Score</button>
                    <button id='mg-view' class='text-xs bg-chocolate text-white px-4 py-2 rounded-full'>View Leaderboard</button>
                </div>
                <div id='mg-name-error' class='mt-2 text-xs text-red-600 hidden'></div>
                <div id='mg-leaderboard' class='mt-3 hidden'></div>
            </div>`:""}
        `,i.appendChild(k);const D=k.querySelector("#mg-name"),l=k.querySelector("#mg-save"),u=k.querySelector("#mg-view"),c=k.querySelector("#mg-name-error"),b=k.querySelector("#mg-leaderboard");if(!l||!u)return;const S=["fuck","shit","bitch","cunt","dick","piss","cock","asshole","retard","fag","faggot","nigger","nigga","spic","chink","whore","slut","bastard","twat","rape","cum","penis","vagina"],w=L=>L.toLowerCase().replace(/[@]/g,"a").replace(/[$]/g,"s").replace(/0/g,"o").replace(/1/g,"i").replace(/3/g,"e").replace(/4/g,"a").replace(/5/g,"s").replace(/7/g,"t"),p=L=>{const j=w(L).replace(/[_-]/g,"");return!S.some(A=>j.includes(A))},E=/^[A-Za-z0-9_-]{3,16}$/,y=()=>{if(!b)return;let L="<table class='w-full text-xs'><thead><tr class='text-indigodeep'><th class='text-left pb-1'>#</th><th class='text-left pb-1'>User</th><th class='text-right pb-1'>Score</th></tr></thead><tbody>";d.slice(0,10).forEach((j,A)=>{L+=`<tr class='border-t border-chocolate/10'><td class='py-1 pr-2'>${A+1}</td><td class='py-1 pr-2'>${j.name}</td><td class='py-1 text-right'>${j.score}</td></tr>`}),d.length===0&&(L+="<tr><td colspan='3' class='py-2 text-ink/60'>No scores yet.</td></tr>"),L+="</tbody></table>",b.innerHTML=L};u.addEventListener("click",()=>{b.classList.toggle("hidden"),b.classList.contains("hidden")?u.textContent="View Leaderboard":(y(),u.textContent="Hide Leaderboard")}),l.addEventListener("click",()=>{const L=(D.value||"").trim();if(!E.test(L)){c.textContent="Username must be 3-16 chars: letters, numbers, _ or - only.",c.classList.remove("hidden");return}if(!p(L)){c.textContent="Please choose a different name (profanity not allowed).",c.classList.remove("hidden");return}c.classList.add("hidden"),d.push({name:L,score:a.score,ts:Date.now()}),d.sort((j,A)=>A.score-j.score||j.ts-A.ts),d=d.slice(0,25),s(d),y(),b.classList.remove("hidden"),u.textContent="Hide Leaderboard",l.disabled=!0,l.textContent="Saved"})},N=()=>{a.running=!0,a.score=0,g.textContent="0",a.orbs=[],a.particles=[],a.lastSpawn=0,a.orbInterval=900,a.baseSpeed=2.2,a.lives=3,v.textContent=Y(3),a.combo=0,C.textContent="x1",a.t=0,a.shake=0,[...i.querySelectorAll(".mg-end")].forEach(k=>k.remove()),requestAnimationFrame(x)},R=k=>{const D=m.getBoundingClientRect();let l=(k-D.left)*h-a.paddle.w*h/2;l=Math.max(0,Math.min(l,a.w-a.paddle.w*h)),a.paddle.x=l};m.addEventListener("mousemove",k=>R(k.clientX)),m.addEventListener("touchstart",k=>{k.touches[0]&&R(k.touches[0].clientX)},{passive:!0}),m.addEventListener("touchmove",k=>{k.touches[0]&&R(k.touches[0].clientX)},{passive:!0}),window.addEventListener("keydown",k=>{k.key==="ArrowLeft"&&R(m.getBoundingClientRect().left+a.paddle.x/h-24),k.key==="ArrowRight"&&R(m.getBoundingClientRect().left+a.paddle.x/h+24)}),_.addEventListener("click",()=>{_.textContent="Playing...",N()}),window.addEventListener("resize",O),O(),H()},initLazyLoading=()=>{const r=document.querySelectorAll("img[data-src]");if("IntersectionObserver"in window){const i=new IntersectionObserver((t,o)=>{t.forEach(n=>{if(n.isIntersecting){const e=n.target;e.src=e.dataset.src,e.removeAttribute("data-src"),i.unobserve(e)}})});r.forEach(t=>i.observe(t))}else r.forEach(i=>{i.src=i.dataset.src,i.removeAttribute("data-src")})},initPdfPreviews=()=>{try{document.querySelectorAll(".preview-panel").forEach(r=>{try{const i=r.closest("section")||r.parentElement;if(!i)return;const t=i.querySelector('a[href$=".pdf"]');if(!t)return;const o=t.href;r.dataset.pdfLoaded="true";const n=g=>{try{r.innerHTML='<div class="rounded-xl border border-chocolate/20 bg-white/40 overflow-hidden p-8 text-center"><p class="text-sm text-chocolate/70">Inline PDF preview may be blocked by hosting or browser settings. Use the buttons below to open or download the deck.</p></div>',__logCollect&&__logCollect("pdf.preview.fallback",{url:o,reason:g})}catch{}};r.innerHTML=`<div class="py-12 bg-white/30 rounded-xl border border-chocolate/10 flex items-center justify-center min-h-[480px]">
  <div class="text-sm text-chocolate/60 flex items-center gap-2"><svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Loading preview\u2026</div>
</div>`;const e=document.createElement("iframe");e.setAttribute("aria-label","PDF preview"),e.style.cssText="width:100%;height:480px;border:0;border-radius:12px;background:#fff;opacity:0;position:absolute;top:0;left:0;",e.referrerPolicy="strict-origin-when-cross-origin",r.style.position="relative",r.style.minHeight="480px";let s=!1,d=!1;const m=g=>{if(!d)if(d=!0,g){e.style.position="relative",e.style.opacity="1",e.style.transition="opacity 0.3s ease";const C=r.querySelector("div");C&&C.remove(),__logCollect&&__logCollect("pdf.preview.loaded",{url:o})}else{try{e.remove()}catch{}n("load_failed")}};e.addEventListener("load",()=>{s=!0,setTimeout(()=>m(!0),100)}),e.addEventListener("error",()=>m(!1));try{e.src=o,r.appendChild(e),__logCollect&&__logCollect("pdf.preview.attempt",{url:o})}catch{m(!1);return}setTimeout(()=>{s||m(!0)},5e3)}catch{}})}catch{}},initScrollToTop=()=>{const r=document.getElementById("scroll-to-top");if(!r)return;const i=()=>{const n=(document.documentElement.scrollHeight-window.innerHeight)*.25;window.scrollY>n?r.classList.add("show"):r.classList.remove("show")},t=()=>{typeof clarity=="function"&&clarity("event","scroll_to_top_clicked"),typeof gtag=="function"&&gtag("event","scroll_to_top",{event_category:"navigation",event_label:"button_click"}),window.scrollTo({top:0,behavior:"smooth"})};window.addEventListener("scroll",i),r.addEventListener("click",t),i()},getCurrentLanguage=()=>document.documentElement.lang||"en",translations={achievement:{en:{unlocked:"Achievement Unlocked!",explorer:{name:"Explorer",description:"Visited all main pages"},reader:{name:"Deep Diver",description:"Read the full Deep Dive"},gamer:{name:"Game Master",description:"Played the contact form game"},chatter:{name:"Conversationalist",description:"Opened the chat"},nightOwl:{name:"Night Owl",description:"Toggled dark mode"},konami:{name:"Secret Discoverer",description:"Found the Konami code"},networker:{name:"Networker",description:"Visited social profiles"},formFiller:{name:"Messenger",description:"Submitted the contact form"}},es:{unlocked:"\xA1Logro Desbloqueado!",explorer:{name:"Explorador",description:"Visit\xF3 todas las p\xE1ginas principales"},reader:{name:"Buzo Profundo",description:"Ley\xF3 la inmersi\xF3n completa"},gamer:{name:"Maestro del Juego",description:"Jug\xF3 el juego del formulario de contacto"},chatter:{name:"Conversador",description:"Abri\xF3 el chat"},nightOwl:{name:"Noct\xE1mbulo",description:"Altern\xF3 el modo oscuro"},konami:{name:"Descubridor Secreto",description:"Encontr\xF3 el c\xF3digo Konami"},networker:{name:"Redactor",description:"Visit\xF3 perfiles sociales"},formFiller:{name:"Mensajero",description:"Envi\xF3 el formulario de contacto"}},ar:{unlocked:"\u062A\u0645 \u0625\u0644\u063A\u0627\u0621 \u0642\u0641\u0644 \u0627\u0644\u0625\u0646\u062C\u0627\u0632!",explorer:{name:"\u0627\u0644\u0645\u0633\u062A\u0643\u0634\u0641",description:"\u0632\u0627\u0631 \u062C\u0645\u064A\u0639 \u0627\u0644\u0635\u0641\u062D\u0627\u062A \u0627\u0644\u0631\u0626\u064A\u0633\u064A\u0629"},reader:{name:"\u0627\u0644\u063A\u0648\u0627\u0635 \u0627\u0644\u0639\u0645\u064A\u0642",description:"\u0642\u0631\u0623 \u0627\u0644\u063A\u0648\u0635 \u0627\u0644\u0643\u0627\u0645\u0644"},gamer:{name:"\u0633\u064A\u062F \u0627\u0644\u0644\u0639\u0628\u0629",description:"\u0644\u0639\u0628 \u0644\u0639\u0628\u0629 \u0646\u0645\u0648\u0630\u062C \u0627\u0644\u0627\u062A\u0635\u0627\u0644"},chatter:{name:"\u0627\u0644\u0645\u062D\u0627\u062F\u062B",description:"\u0641\u062A\u062D \u0627\u0644\u062F\u0631\u062F\u0634\u0629"},nightOwl:{name:"\u0628\u0648\u0645\u0629 \u0627\u0644\u0644\u064A\u0644",description:"\u0628\u062F\u0651\u0644 \u0627\u0644\u0648\u0636\u0639 \u0627\u0644\u0645\u0638\u0644\u0645"},konami:{name:"\u0627\u0644\u0645\u0643\u062A\u0634\u0641 \u0627\u0644\u0633\u0631\u064A",description:"\u0648\u062C\u062F \u0631\u0645\u0632 \u0643\u0648\u0646\u0627\u0645\u064A"},networker:{name:"\u0627\u0644\u0634\u0628\u0643\u064A",description:"\u0632\u0627\u0631 \u0627\u0644\u0645\u0644\u0641\u0627\u062A \u0627\u0644\u0634\u062E\u0635\u064A\u0629 \u0627\u0644\u0627\u062C\u062A\u0645\u0627\u0639\u064A\u0629"},formFiller:{name:"\u0627\u0644\u0631\u0633\u0648\u0644",description:"\u0623\u0631\u0633\u0644 \u0646\u0645\u0648\u0630\u062C \u0627\u0644\u0627\u062A\u0635\u0627\u0644"}}},konami:{en:{title:"\u{1F3AE} You found the secret!",message:"Congratulations! You've unlocked the Konami code.",giftText:"Click the gift for a surprise!",stats:"You're one of the {percent}% who found this!",compliments:["You're absolutely amazing! \u{1F31F}","You're a coding wizard! \u{1F9D9}\u200D\u2642\uFE0F","You're incredibly talented! \u{1F3A8}","You're a problem-solving genius! \u{1F9E0}","You're making the world better! \u{1F30D}","You're a creative powerhouse! \u26A1","You're inspiring others! \u{1F4AB}","You're a true innovator! \u{1F680}","You're exceptionally skilled! \u{1F3C6}","You're a digital artist! \u{1F3AD}","You're building something incredible! \u{1F3D7}\uFE0F","You're a technology trailblazer! \u{1F5FA}\uFE0F","You're exceptionally creative! \u{1F3A8}","You're a user experience master! \u{1F3AF}","You're a design virtuoso! \u{1F3A8}"]},es:{title:"\u{1F3AE} \xA1Encontraste el secreto!",message:"\xA1Felicitaciones! Has desbloqueado el c\xF3digo Konami.",giftText:"\xA1Haz clic en el regalo para una sorpresa!",stats:"\xA1Eres uno del {percent}% que encontr\xF3 esto!",compliments:["\xA1Eres absolutamente incre\xEDble! \u{1F31F}","\xA1Eres un mago de la programaci\xF3n! \u{1F9D9}\u200D\u2642\uFE0F","\xA1Eres incre\xEDblemente talentoso! \u{1F3A8}","\xA1Eres un genio para resolver problemas! \u{1F9E0}","\xA1Est\xE1s haciendo el mundo mejor! \u{1F30D}","\xA1Eres una potencia creativa! \u26A1","\xA1Est\xE1s inspirando a otros! \u{1F4AB}","\xA1Eres un verdadero innovador! \u{1F680}","\xA1Eres excepcionalmente h\xE1bil! \u{1F3C6}","\xA1Eres un artista digital! \u{1F3AD}","\xA1Est\xE1s construyendo algo incre\xEDble! \u{1F3D7}\uFE0F","\xA1Eres un pionero de la tecnolog\xEDa! \u{1F5FA}\uFE0F","\xA1Eres excepcionalmente creativo! \u{1F3A8}","\xA1Eres un maestro de la experiencia del usuario! \u{1F3AF}","\xA1Eres un virtuoso del dise\xF1o! \u{1F3A8}"]},ar:{title:"\u{1F3AE} \u0644\u0642\u062F \u0648\u062C\u062F\u062A \u0627\u0644\u0633\u0631!",message:"\u062A\u0647\u0627\u0646\u064A\u0646\u0627! \u0644\u0642\u062F \u0642\u0645\u062A \u0628\u0641\u062A\u062D \u0631\u0645\u0632 \u0643\u0648\u0646\u0627\u0645\u064A.",giftText:"\u0627\u0646\u0642\u0631 \u0639\u0644\u0649 \u0627\u0644\u0647\u062F\u064A\u0629 \u0644\u0644\u062D\u0635\u0648\u0644 \u0639\u0644\u0649 \u0645\u0641\u0627\u062C\u0623\u0629!",stats:"\u0623\u0646\u062A \u0648\u0627\u062D\u062F \u0645\u0646 {percent}% \u0627\u0644\u0630\u064A\u0646 \u0648\u062C\u062F\u0648\u0627 \u0647\u0630\u0627!",compliments:["\u0623\u0646\u062A \u0631\u0627\u0626\u0639 \u062A\u0645\u0627\u0645\u0627\u064B! \u{1F31F}","\u0623\u0646\u062A \u0633\u0627\u062D\u0631 \u0628\u0631\u0645\u062C\u0629! \u{1F9D9}\u200D\u2642\uFE0F","\u0623\u0646\u062A \u0645\u0648\u0647\u0648\u0628 \u0628\u0634\u0643\u0644 \u0644\u0627 \u064A\u0635\u062F\u0642! \u{1F3A8}","\u0623\u0646\u062A \u0639\u0628\u0642\u0631\u064A \u0641\u064A \u062D\u0644 \u0627\u0644\u0645\u0634\u0643\u0644\u0627\u062A! \u{1F9E0}","\u0623\u0646\u062A \u062A\u062C\u0639\u0644 \u0627\u0644\u0639\u0627\u0644\u0645 \u0623\u0641\u0636\u0644! \u{1F30D}","\u0623\u0646\u062A \u0642\u0648\u0629 \u0625\u0628\u062F\u0627\u0639\u064A\u0629! \u26A1","\u0623\u0646\u062A \u062A\u0644\u0647\u0645 \u0627\u0644\u0622\u062E\u0631\u064A\u0646! \u{1F4AB}","\u0623\u0646\u062A \u0645\u0628\u062A\u0643\u0631 \u062D\u0642\u064A\u0642\u064A! \u{1F680}","\u0623\u0646\u062A \u0645\u0627\u0647\u0631 \u0628\u0634\u0643\u0644 \u0627\u0633\u062A\u062B\u0646\u0627\u0626\u064A! \u{1F3C6}","\u0623\u0646\u062A \u0641\u0646\u0627\u0646 \u0631\u0642\u0645\u064A! \u{1F3AD}","\u0623\u0646\u062A \u062A\u0628\u0646\u064A \u0634\u064A\u0626\u0627\u064B \u0645\u0630\u0647\u0644\u0627\u064B! \u{1F3D7}\uFE0F","\u0623\u0646\u062A \u0631\u0627\u0626\u062F \u062A\u0643\u0646\u0648\u0644\u0648\u062C\u064A\u0627! \u{1F5FA}\uFE0F","\u0623\u0646\u062A \u0645\u0628\u062F\u0639 \u0628\u0634\u0643\u0644 \u0627\u0633\u062A\u062B\u0646\u0627\u0626\u064A! \u{1F3A8}","\u0623\u0646\u062A \u062E\u0628\u064A\u0631 \u0641\u064A \u062A\u062C\u0631\u0628\u0629 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645! \u{1F3AF}","\u0623\u0646\u062A \u0641\u0646\u0627\u0646 \u062A\u0635\u0645\u064A\u0645! \u{1F3A8}"]}},chat:{welcome:{en:"Hello! I am Savonie. Ask me anything about Estivan.",es:"\xA1Hola! Soy Savonie. Preg\xFAntame cualquier cosa sobre Estivan.",ar:"\u0645\u0631\u062D\u0628\u0627\u064B! \u0623\u0646\u0627 \u0633\u0627\u0641\u0648\u0646\u064A. \u0627\u0633\u0623\u0644\u0646\u064A \u0623\u064A \u0634\u064A\u0621 \u0639\u0646 \u0627\u0633\u062A\u064A\u0641\u0627\u0646."},defaultChips:{en:["What does Estivan do?","Tell me about his background","What are his skills?","How can I contact him?"],es:["\xBFQu\xE9 hace Estivan?","H\xE1blame de su experiencia","\xBFCu\xE1les son sus habilidades?","\xBFC\xF3mo puedo contactarlo?"],ar:["\u0645\u0627\u0630\u0627 \u064A\u0641\u0639\u0644 \u0627\u0633\u062A\u064A\u0641\u0627\u0646\u061F","\u0623\u062E\u0628\u0631\u0646\u064A \u0639\u0646 \u062E\u0644\u0641\u064A\u062A\u0647","\u0645\u0627 \u0647\u064A \u0645\u0647\u0627\u0631\u0627\u062A\u0647\u061F","\u0643\u064A\u0641 \u064A\u0645\u0643\u0646\u0646\u064A \u0627\u0644\u0627\u062A\u0635\u0627\u0644 \u0628\u0647\u061F"]},contextualSuggestions:{en:{skills:["What projects have you worked on?","Tell me about your experience","What are you learning currently?"],background:["What are your main skills?","Tell me about your education","What industries have you worked in?"],projects:["Can you show me your code?","What technologies did you use?","How long did it take to build?"],contact:["Are you available for freelance work?","What's your typical response time?","Do you work remotely?"],education:["What certifications do you have?","What's your favorite programming language?","How do you stay updated with technology?"],projectResponse:["Can you tell me more about that project?","What challenges did you face?","What did you learn from it?"],skillResponse:["How did you learn that?","Have you used it in projects?","What's your proficiency level?"],early:["What are your main skills?","Tell me about your background","What projects are you proud of?"]},es:{skills:["\xBFEn qu\xE9 proyectos has trabajado?","H\xE1blame de tu experiencia","\xBFQu\xE9 est\xE1s aprendiendo actualmente?"],background:["\xBFCu\xE1les son tus principales habilidades?","H\xE1blame de tu educaci\xF3n","\xBFEn qu\xE9 industrias has trabajado?"],projects:["\xBFPuedes mostrarme tu c\xF3digo?","\xBFQu\xE9 tecnolog\xEDas usaste?","\xBFCu\xE1nto tiempo tom\xF3 construirlo?"],contact:["\xBFEst\xE1s disponible para trabajo freelance?","\xBFCu\xE1l es tu tiempo t\xEDpico de respuesta?","\xBFTrabajas de forma remota?"],education:["\xBFQu\xE9 certificaciones tienes?","\xBFCu\xE1l es tu lenguaje de programaci\xF3n favorito?","\xBFC\xF3mo te mantienes actualizado con la tecnolog\xEDa?"],projectResponse:["\xBFPuedes contarme m\xE1s sobre ese proyecto?","\xBFQu\xE9 desaf\xEDos enfrentaste?","\xBFQu\xE9 aprendiste de ello?"],skillResponse:["\xBFC\xF3mo aprendiste eso?","\xBFLo has usado en proyectos?","\xBFCu\xE1l es tu nivel de competencia?"],early:["\xBFCu\xE1les son tus principales habilidades?","H\xE1blame de tu experiencia","\xBFDe qu\xE9 proyectos est\xE1s orgulloso?"]},ar:{skills:["\u0645\u0627 \u0647\u064A \u0627\u0644\u0645\u0634\u0627\u0631\u064A\u0639 \u0627\u0644\u062A\u064A \u0639\u0645\u0644\u062A \u0639\u0644\u064A\u0647\u0627\u061F","\u0623\u062E\u0628\u0631\u0646\u064A \u0639\u0646 \u062A\u062C\u0631\u0628\u062A\u0643","\u0645\u0627\u0630\u0627 \u062A\u062A\u0639\u0644\u0645 \u062D\u0627\u0644\u064A\u0627\u064B\u061F"],background:["\u0645\u0627 \u0647\u064A \u0645\u0647\u0627\u0631\u0627\u062A\u0643 \u0627\u0644\u0631\u0626\u064A\u0633\u064A\u0629\u061F","\u0623\u062E\u0628\u0631\u0646\u064A \u0639\u0646 \u062A\u0639\u0644\u064A\u0645\u0643","\u0641\u064A \u0623\u064A \u0635\u0646\u0627\u0639\u0627\u062A \u0639\u0645\u0644\u062A\u061F"],projects:["\u0647\u0644 \u064A\u0645\u0643\u0646\u0643 \u0625\u0638\u0647\u0627\u0631 \u0643\u0648\u062F\u0643\u061F","\u0645\u0627 \u0647\u064A \u0627\u0644\u062A\u0642\u0646\u064A\u0627\u062A \u0627\u0644\u062A\u064A \u0627\u0633\u062A\u062E\u062F\u0645\u062A\u0647\u0627\u061F","\u0643\u0645 \u0645\u0646 \u0627\u0644\u0648\u0642\u062A \u0627\u0633\u062A\u063A\u0631\u0642 \u0628\u0646\u0627\u0624\u0647\u061F"],contact:["\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0627\u062D \u0644\u0644\u0639\u0645\u0644 \u0627\u0644\u062D\u0631\u061F","\u0645\u0627 \u0647\u0648 \u0648\u0642\u062A \u0631\u062F\u0643 \u0627\u0644\u0645\u0639\u062A\u0627\u062F\u061F","\u0647\u0644 \u062A\u0639\u0645\u0644 \u0639\u0646 \u0628\u0639\u062F\u061F"],education:["\u0645\u0627 \u0647\u064A \u0627\u0644\u0634\u0647\u0627\u062F\u0627\u062A \u0627\u0644\u062A\u064A \u0644\u062F\u064A\u0643\u061F","\u0645\u0627 \u0647\u0648 \u0644\u063A\u0629 \u0627\u0644\u0628\u0631\u0645\u062C\u0629 \u0627\u0644\u0645\u0641\u0636\u0644\u0629 \u0644\u062F\u064A\u0643\u061F","\u0643\u064A\u0641 \u062A\u062D\u0627\u0641\u0638 \u0639\u0644\u0649 \u062A\u062D\u062F\u064A\u062B \u0646\u0641\u0633\u0643 \u0628\u0627\u0644\u062A\u0643\u0646\u0648\u0644\u0648\u062C\u064A\u0627\u061F"],projectResponse:["\u0647\u0644 \u064A\u0645\u0643\u0646\u0643 \u0625\u062E\u0628\u0627\u0631\u064A \u0627\u0644\u0645\u0632\u064A\u062F \u0639\u0646 \u0647\u0630\u0627 \u0627\u0644\u0645\u0634\u0631\u0648\u0639\u061F","\u0645\u0627 \u0647\u064A \u0627\u0644\u062A\u062D\u062F\u064A\u0627\u062A \u0627\u0644\u062A\u064A \u0648\u0627\u062C\u0647\u062A\u0647\u0627\u061F","\u0645\u0627\u0630\u0627 \u062A\u0639\u0644\u0645\u062A \u0645\u0646\u0647\u061F"],skillResponse:["\u0643\u064A\u0641 \u062A\u0639\u0644\u0645\u062A \u0630\u0644\u0643\u061F","\u0647\u0644 \u0627\u0633\u062A\u062E\u062F\u0645\u062A\u0647 \u0641\u064A \u0645\u0634\u0627\u0631\u064A\u0639\u061F","\u0645\u0627 \u0647\u0648 \u0645\u0633\u062A\u0648\u0649 \u0645\u0647\u0627\u0631\u062A\u0643\u061F"],early:["\u0645\u0627 \u0647\u064A \u0645\u0647\u0627\u0631\u0627\u062A\u0643 \u0627\u0644\u0631\u0626\u064A\u0633\u064A\u0629\u061F","\u0623\u062E\u0628\u0631\u0646\u064A \u0639\u0646 \u062E\u0644\u0641\u064A\u062A\u0643","\u0645\u0627 \u0647\u064A \u0627\u0644\u0645\u0634\u0627\u0631\u064A\u0639 \u0627\u0644\u062A\u064A \u062A\u0641\u062E\u0631 \u0628\u0647\u0627\u061F"]}}}},initAchievements=()=>{const r="portfolio_achievements",i={explorer:{id:"explorer",icon:"\u{1F5FA}\uFE0F"},reader:{id:"reader",icon:"\u{1F4D6}"},gamer:{id:"gamer",icon:"\u{1F3AE}"},chatter:{id:"chatter",icon:"\u{1F4AC}"},nightOwl:{id:"nightOwl",icon:"\u{1F319}"},konami:{id:"konami",icon:"\u{1F3AF}"},networker:{id:"networker",icon:"\u{1F517}"},formFiller:{id:"formFiller",icon:"\u2709\uFE0F"}},t=()=>{try{const g=localStorage.getItem(r);return g?JSON.parse(g):{}}catch{return{}}},o=g=>{try{localStorage.setItem(r,JSON.stringify(g))}catch{}},n=g=>{const C=t();if(C[g])return;const I=getCurrentLanguage(),v=translations.achievement[I]||translations.achievement.en,_={...i[g],...v&&v[g]?v[g]:{}};C[g]={unlockedAt:new Date().toISOString(),..._},o(C),e(_);try{const f="arcade_achievements",h=JSON.parse(localStorage.getItem(f)||"[]");Array.isArray(h)&&!h.includes(g)&&(h.push(g),localStorage.setItem(f,JSON.stringify(h))),window.ArcadeAchievements&&typeof window.ArcadeAchievements.updateUI=="function"&&window.ArcadeAchievements.updateUI()}catch{}},e=g=>{const C=getCurrentLanguage(),I=translations.achievement[C]||translations.achievement.en,_=(H=>H?typeof H=="string"?{id:H}:typeof H=="object"?H:{}:{})(g),f=_.id||_.achievementId||_.key,h=typeof f=="string"?f:"",T=h.replace(/^site_/,"");let M={icon:_.icon,name:_.name||_.title,description:_.description||_.desc};if((!M.name||!M.description||!M.icon)&&h&&window.ArcadeAchievements&&typeof window.ArcadeAchievements.getDefinitions=="function"){const H=window.ArcadeAchievements.getDefinitions(),x=H&&H[h];x&&(M={icon:M.icon||x.icon,name:M.name||x.title||x.name,description:M.description||x.description||x.desc})}(!M.name||!M.description)&&I&&T&&I[T]&&(M={icon:M.icon||i[T]&&i[T].icon,name:M.name||I[T].name,description:M.description||I[T].description});const a=M.icon||"\u{1F3C6}",O=M.name||"Achievement",Y=M.description||"",q=document.createElement("div");q.className="achievement-notification",q.innerHTML=`
            <div class="achievement-icon">${a}</div>
            <div class="achievement-content">
                <div class="achievement-title">${I&&I.unlocked?I.unlocked:"Achievement Unlocked!"}</div>
                <div class="achievement-name">${O}</div>
                <div class="achievement-desc">${Y}</div>
            </div>
            <button class="achievement-close" aria-label="Close achievement notification">\xD7</button>
        `,document.body.appendChild(q);const W=q.querySelector(".achievement-close"),F=()=>{q.classList.remove("show"),setTimeout(()=>q.remove(),300)};W.addEventListener("click",F),setTimeout(()=>q.classList.add("show"),100);const $=setTimeout(()=>{document.body.contains(q)&&F()},4e3);W.addEventListener("click",()=>clearTimeout($))},s=()=>{const g="portfolio_visited_pages";try{const C=JSON.parse(localStorage.getItem(g)||"[]"),I=window.location.pathname.split("/").pop()||"index.html";C.includes(I)||(C.push(I),localStorage.setItem(g,JSON.stringify(C))),["index.html","overview.html","deep-dive.html","about.html","projects.html","contact.html"].every(f=>C.includes(f))&&n("explorer"),I==="deep-dive.html"&&n("reader")}catch{}},d=()=>{const g=document.getElementById("theme-toggle");g&&g.addEventListener("click",()=>n("nightOwl"))},m=()=>{document.querySelectorAll('a[href*="linkedin.com"], a[href*="github.com"]').forEach(g=>{g.addEventListener("click",()=>n("networker"))})};s(),d(),m(),window.unlockAchievement=n},initKonamiCode=()=>{const r=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"];let i=0;const t=()=>{window.dispatchEvent(new Event("konami-activated")),window.unlockAchievement&&window.unlockAchievement("konami");const n=getCurrentLanguage(),e=translations.konami[n],s=document.createElement("div");s.className="konami-modal",s.innerHTML=`
            <div class="konami-content">
                <div class="konami-header">
                    <h2>${e.title}</h2>
                    <button class="konami-close" aria-label="Close">&times;</button>
                </div>
                <div class="konami-body">
                    <p class="konami-message">${e.message}</p>
                    <div class="konami-gift">
                        <div class="gift-emoji">\u{1F381}</div>
                        <p class="gift-text">${e.giftText}</p>
                        <div class="compliment-container" style="display: none;">
                            <p class="compliment-text"></p>
                        </div>
                    </div>
                    <div class="konami-stats">
                        <p>${e.stats.replace("{percent}",Math.floor(Math.random()*10)+1)}</p>
                    </div>
                </div>
            </div>
        `,document.body.appendChild(s),setTimeout(()=>s.classList.add("show"),100);const d=s.querySelector(".gift-emoji"),m=s.querySelector(".compliment-container"),g=s.querySelector(".compliment-text"),C=s.querySelector(".gift-text"),I=e.compliments;d.addEventListener("click",()=>{d.style.display="none",C.style.display="none";const _=I[Math.floor(Math.random()*I.length)];g.textContent=_,m.style.display="block",d.classList.add("gift-opened"),o(),setTimeout(()=>{m.classList.add("sparkle")},500)});const v=()=>{s.classList.remove("show"),setTimeout(()=>s.remove(),300)};s.querySelector(".konami-close").addEventListener("click",v),s.addEventListener("click",_=>{_.target===s&&v()})},o=()=>{const n=["#ff6b6b","#4ecdc4","#45b7d1","#f9ca24","#f0932b","#eb4d4b","#6c5ce7","#a29bfe","#fd79a8","#e17055"];for(let s=0;s<50;s++){const d=document.createElement("div");d.className="confetti",d.style.left=Math.random()*100+"vw",d.style.backgroundColor=n[Math.floor(Math.random()*n.length)],d.style.animationDelay=Math.random()*3+"s",d.style.animationDuration=Math.random()*3+2+"s",document.body.appendChild(d),setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},5e3)}};document.addEventListener("keydown",n=>{n.key===r[i]?(i++,i===r.length&&(i=0,t())):i=0})},initPWA=()=>{if("serviceWorker"in navigator){let i=!!navigator.serviceWorker.controller,t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{if(!i){i=!0;return}t||(t=!0)}),window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(o=>{try{const n="sw_last_update_ts",e=Date.now(),s=parseInt(sessionStorage.getItem(n)||"0",10);(!Number.isFinite(s)||e-s>360*60*1e3)&&(sessionStorage.setItem(n,String(e)),o.update().catch(()=>{}))}catch{}}).catch(o=>{})})}let r;window.addEventListener("beforeinstallprompt",i=>{i.preventDefault(),r=i})},trackEventDebug=(r,i)=>{try{window.location.search.includes("debug-analytics=1")&&console.log("[Analytics Event]",r,i||null)}catch{}},initAnalytics=()=>{const r=(e,s)=>{const d=`button_click_${s}`;trackEventDebug(d),typeof clarity=="function"&&clarity("event",d),typeof gtag=="function"&&gtag("event","button_click",{event_category:"engagement",event_label:s})};document.querySelectorAll('a[href*="contact"], button[type="submit"]').forEach(e=>{e.addEventListener("click",()=>{const s=e.textContent.trim().replace(/\s+/g,"_").toLowerCase();r(e,s)})}),document.querySelectorAll("nav a").forEach(e=>{e.addEventListener("click",()=>{const s=e.getAttribute("href")||"unknown";trackEventDebug("navigation_click",{page:s}),typeof clarity=="function"&&clarity("event","navigation_click",{page:s}),typeof gtag=="function"&&gtag("event","navigation_click",{event_category:"navigation",event_label:s})})}),document.querySelectorAll('a[href*="linkedin.com"], a[href*="github.com"]').forEach(e=>{e.addEventListener("click",()=>{const s=e.href.includes("linkedin")?"linkedin":"github";trackEventDebug("social_click",{platform:s}),typeof clarity=="function"&&clarity("event","social_click",{platform:s}),typeof gtag=="function"&&gtag("event","social_click",{event_category:"social",event_label:s})})});const i=document.querySelector('form[action*="formspree.io"]');i&&i.addEventListener("submit",()=>{trackEventDebug("form_submission"),typeof clarity=="function"&&clarity("event","form_submission"),typeof gtag=="function"&&gtag("event","form_submission",{event_category:"engagement",event_label:"contact_form"})});let t=0,o={25:!1,50:!1,75:!1,100:!1};window.addEventListener("scroll",()=>{const e=Math.round((window.scrollY+window.innerHeight)/document.documentElement.scrollHeight*100);e>t&&(t=e,t>=25&&!o[25]&&(o[25]=!0,trackEventDebug("scroll_25_percent"),typeof clarity=="function"&&clarity("event","scroll_25_percent"),typeof gtag=="function"&&gtag("event","scroll",{event_category:"engagement",event_label:"25_percent"})),t>=50&&!o[50]&&(o[50]=!0,trackEventDebug("scroll_50_percent"),typeof clarity=="function"&&clarity("event","scroll_50_percent"),typeof gtag=="function"&&gtag("event","scroll",{event_category:"engagement",event_label:"50_percent"})),t>=75&&!o[75]&&(o[75]=!0,trackEventDebug("scroll_75_percent"),typeof clarity=="function"&&clarity("event","scroll_75_percent"),typeof gtag=="function"&&gtag("event","scroll",{event_category:"engagement",event_label:"75_percent"})),t>=100&&!o[100]&&(o[100]=!0,trackEventDebug("scroll_100_percent"),typeof clarity=="function"&&clarity("event","scroll_100_percent"),typeof gtag=="function"&&gtag("event","scroll",{event_category:"engagement",event_label:"100_percent"})))}),window.addEventListener("konami-activated",()=>{trackEventDebug("konami_code_activated"),typeof clarity=="function"&&clarity("event","konami_code_activated"),typeof gtag=="function"&&gtag("event","easter_egg",{event_category:"engagement",event_label:"konami_code"})});const n=window.unlockAchievement;n&&(window.unlockAchievement=(...e)=>{const s=e.length>1?e[1]:e[0];trackEventDebug("achievement_unlocked",{achievement:s}),typeof clarity=="function"&&clarity("event","achievement_unlocked",{achievement:s}),typeof gtag=="function"&&gtag("event","achievement_unlock",{event_category:"gamification",event_label:s}),n.apply(window,e)})},initPerformanceMonitoring=()=>{if("PerformanceObserver"in window)try{new PerformanceObserver(i=>{const t=i.getEntries(),o=t[t.length-1];typeof clarity=="function"&&clarity("set","lcp",Math.round(o.renderTime||o.loadTime));const n=o.renderTime||o.loadTime;n>2500&&console.warn("Poor LCP detected:",n,"ms")}).observe({type:"largest-contentful-paint",buffered:!0})}catch{}if("web-vital"in window){try{new PerformanceObserver(i=>{i.getEntries().forEach(o=>{const n=o.processingStart-o.startTime;typeof clarity=="function"&&clarity("set","fid",Math.round(n))})}).observe({type:"first-input",buffered:!0})}catch{}try{let r=0;new PerformanceObserver(t=>{for(const o of t.getEntries())o.hadRecentInput||(r+=o.value);typeof clarity=="function"&&clarity("set","cls",r.toFixed(4))}).observe({type:"layout-shift",buffered:!0})}catch{}}},initPhase2=()=>{document.body.addEventListener("click",i=>{const t=i.target.closest('a[href^="mailto:"]');if(!t)return;i.preventDefault();const o=t.href.replace("mailto:","").split("?")[0];navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(o).then(()=>{if(t.innerText||t.textContent){const n=t.innerText||t.textContent;t.innerText="Copied! \u2705",setTimeout(()=>{t.innerText=n},2e3)}}).catch(()=>{window.location.href=t.href}):window.location.href=t.href});try{const i=document.getElementById("copyright-year");i&&(i.textContent=String(new Date().getFullYear()))}catch{}try{const i=document.querySelector("footer p.text-xs");if(i){const t=new Date().getFullYear();i.innerHTML=i.innerHTML.replace(/&copy;\s*\d{4}/,`&copy; ${t}`)}}catch{}const r=document.querySelector('form[action*="formspree"]');r&&r.addEventListener("submit",i=>{const t=r.querySelector('input[name="website_url"]');if(t&&t.value)return i.preventDefault(),!1})},__isEnglishChromePage=()=>{try{const r=document.documentElement&&document.documentElement.lang?document.documentElement.lang.toLowerCase():"en",i=window.location&&window.location.pathname?window.location.pathname:"/";return i.startsWith("/es/")||i.startsWith("/ar/")?!1:r==="en"}catch{return!1}},__ensureStandardEnglishChrome=()=>{if(__isEnglishChromePage()){try{if(!!!document.querySelector("header #brand-logo, header #mobile-menu-toggle")){const i=document.createElement("header");i.className="fixed top-0 left-0 right-0 z-40 bg-beige/95 backdrop-blur-sm border-b border-chocolate/10",i.innerHTML=`
        <nav class="max-w-7xl mx-auto px-6 lg:px-12 py-6 flex items-center justify-between gap-2">
            <a href="/index.html" id="brand-logo" class="text-lg sm:text-xl font-semibold text-indigodeep hover:text-chocolate transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded inline-flex items-center shrink min-w-0" aria-label="Go to Portfolio home page">
                <img src="/assets/img/logo-ea.webp" alt="Estivan Ayramia logo" class="h-8 w-8 mr-2 object-contain shrink-0" width="300" height="264" fetchpriority="high">
                <span translate="no" class="notranslate truncate">Estivan Ayramia</span>
            </a>
            
            <!-- Main Navigation -->
            <ul class="hidden md:flex items-center space-x-8">
                <li><a href="/index.html" class="text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded" data-nav-key="home">Home</a></li>
                <li><a href="/projects.html" class="text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded" data-nav-key="projects">Projects</a></li>
                <li><a href="/overview.html" class="text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded" data-nav-key="overview">Overview</a></li>
                <li><a href="/deep-dive.html" class="text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded" data-nav-key="deep-dive">Deep Dive</a></li>
                <li><a href="/about.html" class="text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded" data-nav-key="about">About</a></li>
                <li><a href="/contact.html" class="text-sm font-medium text-beige bg-indigodeep border border-white/20 px-5 py-2 rounded-full hover:bg-chocolate transition-colors dark:bg-indigodeep dark:text-beige dark:hover:bg-white dark:hover:text-indigodeep dark:border-white/20 focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige" data-nav-key="contact">Contact</a></li>
            </ul>
            
            <!-- Language Switcher -->
            <div id="lang-switcher" class="flex items-center space-x-3 shrink-0" style="z-index: 20;">
                <a href="#" class="text-xs font-semibold text-indigodeep underline focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded" data-lang-key="en">EN</a>
                <a href="/es/index.html" class="text-xs text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded">ES</a>
                <a href="/ar/index.html" class="text-xs text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded">AR</a>
            </div>
            
            <!-- Dark Mode Toggle -->
            <button type="button" id="theme-toggle" class="text-base font-medium text-beige bg-indigodeep border border-white/20 px-5 py-2 rounded-full hover:bg-chocolate transition-colors dark:bg-indigodeep dark:text-beige dark:hover:bg-white dark:hover:text-indigodeep dark:border-white/20 focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige" aria-label="Switch to light mode"><span style="color: #e1d4c2">\u{1F506}</span></button>
            
            <!-- Mobile Menu Toggle -->
            <button type="button" id="mobile-menu-toggle" class="md:hidden text-chocolate focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded p-2" aria-label="Toggle mobile menu" aria-expanded="false">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </nav>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden border-t border-chocolate/10 bg-beige">
            <ul class="px-6 py-4 space-y-3">
                <li><a href="/index.html" class="block text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded py-2" data-nav-key="home">Home</a></li>
                <li><a href="/projects.html" class="block text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded py-2" data-nav-key="projects">Projects</a></li>
                <li><a href="/overview.html" class="block text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded py-2" data-nav-key="overview">Overview</a></li>
                <li><a href="/deep-dive.html" class="block text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded py-2" data-nav-key="deep-dive">Deep Dive</a></li>
                <li><a href="/about.html" class="block text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded py-2" data-nav-key="about">About</a></li>
                <li><a href="/contact.html" class="block text-sm font-medium text-beige bg-indigodeep border border-white/20 px-5 py-2 rounded-full hover:bg-chocolate transition-colors text-center dark:bg-indigodeep dark:text-beige dark:hover:bg-white dark:hover:text-indigodeep dark:border-white/20 focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige" data-nav-key="contact">Contact</a></li>
            </ul>
        </div>
            `,document.body&&document.body.insertBefore(i,document.body.firstChild),document.querySelector("main.pt-24")||document.body&&document.body.classList&&document.body.classList.add("pt-24");try{const o=i.querySelector('[data-lang-key="en"]');if(o){const n=window.location.pathname||"/";o.href=n==="/"?"/index.html":n}}catch{}}}catch{}try{if(!!!document.querySelector("footer.bg-indigodeep.text-beige.py-12")){const i=document.createElement("footer");i.className="bg-indigodeep text-beige py-12",i.innerHTML=`
        <div class="max-w-7xl mx-auto px-6 lg:px-12">
            <div class="grid md:grid-cols-3 gap-12 mb-12">
                <div class="space-y-4">
                    <a href="/" class="flex items-center space-x-3 mb-4 hover:opacity-80 transition-opacity">
                        <img src="/assets/img/logo-ea.webp" alt="Estivan Ayramia logo" class="h-12 w-12 object-contain" width="300" height="264">
                        <h3 class="text-xl font-semibold text-white">Estivan Ayramia</h3>
                    </a>
                    <p class="text-sm text-beige/80 leading-relaxed">Chaldean from El Cajon. General Business graduate from SDSU. Building systems, working with people, and turning chaos into clean execution.</p>
                </div>
                <div class="space-y-4">
                    <h3 class="text-sm font-semibold text-white uppercase tracking-wider">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="/overview.html" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">Overview</a></li>
                        <li><a href="/deep-dive.html" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">Deep Dive</a></li>
                        <li><a href="/projects/" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">Projects</a></li>
                        <li><a href="/about.html" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">About</a></li>
                    </ul>
                </div>
                <div class="space-y-4">
                    <h3 class="text-sm font-semibold text-white uppercase tracking-wider">Connect</h3>
                    <ul class="space-y-2">
                        <li><a href="https://www.linkedin.com/in/estivanayramia" target="_blank" rel="noopener noreferrer" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">LinkedIn \u2197</a></li>
                        <li><a href="https://github.com/estivanayramia/" target="_blank" rel="noopener noreferrer" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">GitHub \u2197</a></li>
                        <li><a href="/contact.html" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">Contact</a></li>
                        <li><a href="/assets/docs/Estivan-Ayramia-Resume.pdf" download="" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">Resume (PDF)</a></li>
                        <li><a href="/privacy.html" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-beige/20 pt-8 text-center">
                <p class="text-sm text-beige/80">\xA9 <span id="copyright-year">2025</span> Estivan Ayramia. All rights reserved.</p>
            </div>
        </div>
            `,document.body&&document.body.appendChild(i)}}catch{}}},__arcadeStorageKey="site_played_games_v1",__safeJsonParse=(r,i)=>{try{return JSON.parse(r)}catch{return i}},__getPlayedGames=()=>{try{const r=localStorage.getItem(__arcadeStorageKey),i=__safeJsonParse(r,{});return i&&typeof i=="object"?i:{}}catch{return{}}},__setPlayedGames=r=>{try{localStorage.setItem(__arcadeStorageKey,JSON.stringify(r||{}))}catch{}},__normalizePath=r=>{try{return(r||"/").replace(/\/+$/,"")||"/"}catch{return"/"}},__getCurrentGameId=()=>{try{const r=document.body&&document.body.getAttribute("data-arcade-achievements-filter");if(r&&/^mini_/.test(r))return r.replace(/^mini_/,"");if(r&&/^arcade_/.test(r))return r.replace(/^arcade_/,"");const i=__normalizePath(window.location.pathname||"/"),t=i.match(/^\/hobbies-games\/(.+)$/);if(t&&t[1])return t[1].replace(/\.html$/i,"");const o=i.split("/").pop()||"";return o.endsWith(".html")?o.replace(/\.html$/i,""):null}catch{return null}},__markGamePlayed=r=>{if(r)try{const i=__getPlayedGames();i[r]={lastPlayedAt:Date.now()},__setPlayedGames(i)}catch{}},__hashString=r=>{let i=2166136261;for(let t=0;t<r.length;t++)i^=r.charCodeAt(t),i=Math.imul(i,16777619);return i>>>0},__mulberry32=r=>{let i=r>>>0;return function(){i+=1831565813;let t=Math.imul(i^i>>>15,1|i);return t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}},__shuffleInPlace=(r,i)=>{for(let t=r.length-1;t>0;t--){const o=Math.floor(i()*(t+1));[r[t],r[o]]=[r[o],r[t]]}return r},__GAME_CATALOG=[{id:"snake",href:"/snake.html",emoji:"\u{1F40D}",title:"Snake",subtitle:"Classic growth game"},{id:"breaker",href:"/breaker.html",emoji:"\u{1F9F1}",title:"Block Breaker",subtitle:"Smash the bricks"},{id:"2048",href:"/2048.html",emoji:"\u{1F9E9}",title:"2048",subtitle:"Merge the numbers"},{id:"invaders",href:"/invaders.html",emoji:"\u{1F47E}",title:"Space Invaders",subtitle:"Defend the earth"},{id:"racer",href:"/hobbies-games/racer.html",emoji:"\u{1F3CE}\uFE0F",title:"Racer",subtitle:"Fast reflex racing"},{id:"oh-flip",href:"/hobbies-games/oh-flip.html",emoji:"\u{1F938}",title:"Oh Flip",subtitle:"Timing + tricks"},{id:"onoff",href:"/hobbies-games/onoff.html",emoji:"\u26A1",title:"ON/OFF",subtitle:"Switch-based puzzle"},{id:"1024-moves",href:"/hobbies-games/1024-moves.html",emoji:"\u{1F9E0}",title:"1024 Moves",subtitle:"Move-limited strategy"},{id:"back-attacker",href:"/hobbies-games/back-attacker.html",emoji:"\u{1F6E1}\uFE0F",title:"Back Attacker",subtitle:"Survive the attacks"},{id:"nano-wirebot",href:"/hobbies-games/nano-wirebot.html",emoji:"\u{1F916}",title:"Nano Wirebot",subtitle:"Precision platforming"},{id:"off-the-line",href:"/hobbies-games/off-the-line.html",emoji:"\u{1F9F7}",title:"Off The Line",subtitle:"Don\u2019t cross the line"},{id:"pizza-undelivery",href:"/hobbies-games/pizza-undelivery.html",emoji:"\u{1F355}",title:"Pizza Undelivery",subtitle:"Fast food chaos"},{id:"the-matr13k",href:"/hobbies-games/the-matr13k.html",emoji:"\u{1F9EC}",title:"The Matr13k",subtitle:"Pattern puzzle"},{id:"triangle-back-to-home",href:"/hobbies-games/triangle-back-to-home.html",emoji:"\u{1F53A}",title:"Triangle: Back to Home",subtitle:"Geometry adventure"},{id:"xx142-b2exe",href:"/hobbies-games/xx142-b2exe.html",emoji:"\u{1F9EA}",title:"XX142-B2EXE",subtitle:"Experimental arcade"}],__renderSuggestionGrid=(r,i)=>{if(!r)return;const t=i&&i.count?i.count:6,o=i&&i.currentId?i.currentId:null,n=__getPlayedGames(),e=Date.now(),s=__GAME_CATALOG.filter(T=>T&&T.id&&T.href&&T.id!==o),d=s.filter(T=>!n[T.id]),m=s.filter(T=>!!n[T.id]),g=Math.floor(e/864e5),C=parseInt(sessionStorage.getItem("site_suggest_nonce")||"0",10)||0;sessionStorage.setItem("site_suggest_nonce",String(C+1));const I=g*1e3+C+__hashString(String(window.location.pathname||"/")),v=__mulberry32(I);__shuffleInPlace(d,v),m.sort((T,M)=>{const a=n[T.id]&&n[T.id].lastPlayedAt?n[T.id].lastPlayedAt:0,O=n[M.id]&&n[M.id].lastPlayedAt?n[M.id].lastPlayedAt:0;return a-O}),__shuffleInPlace(m,v);const _=[];for(const T of d){if(_.length>=t)break;_.push(T)}for(const T of m){if(_.length>=t)break;_.push(T)}const f="flex flex-col items-center p-4 bg-white/5 rounded-xl hover:bg-white/10 transition-all group border border-white/5 hover:border-white/20",h="text-4xl mb-3 group-hover:scale-110 transition-transform";r.innerHTML=_.map(T=>`
        <a href="${T.href}" class="${f}" data-game-id="${T.id}">
            <div class="${h}">${T.emoji||"\u{1F3AE}"}</div>
            <div class="font-bold text-sm">${T.title||T.id}</div>
            <div class="text-xs opacity-60 mt-1">${T.subtitle||""}</div>
        </a>
    `).join("")},__initDynamicGameSuggestions=()=>{try{const r=__getCurrentGameId();r&&__markGamePlayed(r);const i=new Set;document.querySelectorAll('a[class*="bg-white/5"][class*="rounded-xl"][class*="hover:bg-white/10"]').forEach(t=>{const o=t.closest(".grid");o&&i.add(o)}),i.forEach(t=>{const o=t.querySelectorAll("a");!o||o.length<4||__renderSuggestionGrid(t,{count:6,currentId:r})})}catch{}},init=()=>{console.log("%c Designed by Estivan Ayramia ","background: #212842; color: #e1d4c2; padding: 4px; border-radius: 4px;"),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{__ensureStandardEnglishChrome(),initDarkMode(),initAriaCurrent(),initMobileMenu(),__initDynamicGameSuggestions(),loadGSAPAndInit(),initSmoothScroll(),initFormValidation(),initLazyLoading(),initScrollToTop(),initPdfPreviews(),initAchievements(),initKonamiCode(),initPWA(),initAnalytics(),initPerformanceMonitoring(),initPhase2()}):(__ensureStandardEnglishChrome(),initDarkMode(),initAriaCurrent(),initMobileMenu(),__initDynamicGameSuggestions(),loadGSAPAndInit(),initSmoothScroll(),initFormValidation(),initLazyLoading(),initScrollToTop(),initPdfPreviews(),initAchievements(),initKonamiCode(),initPWA(),initAnalytics(),initPerformanceMonitoring(),initPhase2())};init(),document.addEventListener("DOMContentLoaded",()=>{const r="https://portfolio-chat.eayramia.workers.dev/chat",i="/assets/docs/Estivan-Ayramia-Resume.pdf",t="https://www.linkedin.com/in/estivanayramia",n={logistics:{title:"Logistics System",summary:"A systems-focused project centered on execution, coordination, and operational clarity.",img:"/assets/img/project-logistics.jpg",link:"/projects/logistics"},conflict:{title:"Conflict Playbook",summary:"A practical framework for navigating conflict with structure, empathy, and outcomes.",img:"/assets/img/project-conflict.jpg",link:"/deep-dive#conflict"},discipline:{title:"Discipline Routine",summary:"A repeatable routine and mindset system for sustainable discipline and follow-through.",img:"/assets/img/project-discipline.jpg",link:"/projects/discipline"},website:{title:"Portfolio Website",summary:"The site you are on, built for speed, clarity, and a clean browsing experience.",img:"/assets/img/og-image.png",link:"/"}},e={widget:document.getElementById("chat-widget"),window:document.getElementById("chat-window"),header:document.getElementById("chat-header"),messages:document.getElementById("chat-messages"),input:document.getElementById("chat-input"),sendBtn:document.getElementById("send-btn"),toggleBtn:document.getElementById("chat-toggle"),closeBtn:document.getElementById("close-chat"),bubble:document.getElementById("welcome-bubble"),chipsContainer:document.getElementById("chat-chips"),suggestionsBtn:document.getElementById("suggestions-btn"),suggestionsContainer:document.querySelector('[data-chat-suggestions="container"]'),suggestionsToggle:document.querySelector('[data-chat-suggestions-toggle="button"]'),suggestionsClose:null};(function(){try{if(window.CSS&&CSS.supports&&CSS.supports("animation-timeline","scroll()"))return}catch{}const u=document.querySelector(".scroll-progress");if(!u)return;let c=!1;function b(){const w=document.documentElement,p=window.scrollY||w.scrollTop||0,E=Math.max((w.scrollHeight||document.body.scrollHeight||0)-window.innerHeight,0),y=E>0?Math.min(1,Math.max(0,p/E)):0;u.style.setProperty("--scroll-scale",y),c=!1}const S=function(){c||(c=!0,requestAnimationFrame(b))};window.addEventListener("scroll",S,{passive:!0}),window.addEventListener("resize",S,{passive:!0}),requestAnimationFrame(b)})();const s=document.documentElement.lang||"en";s==="ar"&&e.widget?(e.widget.style.left="1rem",e.widget.style.right="auto",e.bubble&&(e.bubble.style.left="1rem",e.bubble.style.right="auto")):e.widget&&(e.widget.style.right="1rem",e.widget.style.left="auto",e.bubble&&(e.bubble.style.right="1rem",e.bubble.style.left="auto"));let d=[],m=!1,g=null,C=!1;const I=`savonie_history:v1:${s||"en"}`,v=50;function _(){try{const l=[],u=window.location.pathname||"/";l.push(`path: ${u}`),l.push(`title: ${document.title||""}`);const c=Array.from(document.querySelectorAll("h1, h2")).map(S=>(S.textContent||"").trim()).filter(Boolean).slice(0,10);c.length&&(l.push("headings:"),c.forEach(S=>l.push(`- ${S}`)));const b=l.join(`
`);return b.length>3500?b.slice(0,3500):b}catch{return`${window.location.pathname||"/"} | ${document.title||""}`}}try{const l=sessionStorage.getItem(I);l&&(d=JSON.parse(l),d.forEach(u=>{if(u&&u.kind==="card"){k(u.cardId);return}if(!u||u.kind!=="text")return;const c=document.createElement("div"),b="bg-[#212842] text-white rounded-tr-none self-end ml-auto",S="bg-white text-[#362017] rounded-tl-none border border-[#362017]/5 self-start";c.className=`p-3 rounded-lg shadow-sm max-w-[85%] mb-3 text-sm leading-relaxed ${u.sender==="user"?b:S}`,u.sender==="bot"?c.replaceChildren($(u.text)):c.textContent=u.text,e.messages?.appendChild(c)}),setTimeout(()=>{e.messages&&(e.messages.scrollTop=e.messages.scrollHeight)},100))}catch{}if(d.length===0){const l=document.documentElement.lang||"en",u=translations.chat.welcome[l]||"Hello! I am Savonie. Ask me anything about Estivan.";R(u,"bot",!1)}if(e.chipsContainer){const l=document.documentElement.lang||"en",u=translations.chat.defaultChips[l]||translations.chat.defaultChips.en;H(u)}C=!0;const f=parseInt(sessionStorage.getItem("savonie_bubble_count")||"0");f<2&&setTimeout(()=>{e.window?.classList.contains("hidden")&&d.length===0&&(e.bubble?.classList.remove("opacity-0","translate-y-4"),e.bubble?.classList.add("opacity-100","translate-y-0"),sessionStorage.setItem("savonie_bubble_count",(f+1).toString()))},2500),e.toggleBtn?.addEventListener("click",x),e.closeBtn?.addEventListener("click",x),e.sendBtn?.addEventListener("click",N),e.input?.addEventListener("keydown",l=>{l.key!=="Enter"||l.target&&l.target.tagName==="TEXTAREA"&&l.shiftKey||(l.preventDefault(),N())});function h(l){if(!e.suggestionsContainer){console.log("[Savonie DEBUG] setSuggestionsVisible called but no suggestions container");return}l?(e.suggestionsContainer.classList.remove("savonie-suggestions-hidden"),e.suggestionsContainer.removeAttribute("hidden"),e.suggestionsContainer.style.display="flex"):(e.suggestionsContainer.classList.add("savonie-suggestions-hidden"),e.suggestionsContainer.setAttribute("hidden","true"),e.suggestionsContainer.style.display="none"),console.log("[Savonie DEBUG] setSuggestionsVisible ->",l,"classes:",e.suggestionsContainer.className)}function T(){if(!e.suggestionsContainer){console.log("[Savonie DEBUG] No suggestions container found on this page");return}e.suggestionsToggle?e.suggestionsToggle.addEventListener("click",()=>{const u=e.suggestionsContainer.classList.contains("savonie-suggestions-hidden")||e.suggestionsContainer.hasAttribute("hidden")||e.suggestionsContainer.style.display==="none";console.log("[Savonie DEBUG] Lightbulb clicked, nextVisible =",u),h(u)}):console.log("[Savonie DEBUG] No suggestions toggle (lightbulb) found"),console.log("[Savonie DEBUG] attachSuggestionHandlers complete")}T(),e.chipsContainer&&e.chipsContainer.querySelectorAll(".chip-btn").forEach(l=>{l.addEventListener("click",()=>{e.input&&(e.input.value=l.textContent,N())})});const M=document.getElementById("mic-btn");let a=null,O=!1;if(M&&("webkitSpeechRecognition"in window||"SpeechRecognition"in window)){const l=window.SpeechRecognition||window.webkitSpeechRecognition;a=new l,a.continuous=!1,a.interimResults=!1,a.lang=document.documentElement.lang||"en-US",a.onstart=()=>{O=!0,M.classList.add("listening"),M.setAttribute("aria-label","Listening...")},a.onend=()=>{O=!1,M.classList.remove("listening"),M.setAttribute("aria-label","Voice input")},a.onresult=u=>{const c=u.results[0][0].transcript;if(e.input&&c){e.input.value=c;try{e.input.focus({preventScroll:!0})}catch{e.input.focus()}}},a.onerror=u=>{console.warn("Speech recognition error:",u.error),O=!1,M.classList.remove("listening")},M.addEventListener("click",()=>{O?a.stop():a.start()})}else M&&(M.style.display="none");function Y(l){const u=[],c=[...l].reverse().find(p=>p.sender==="user")?.text?.toLowerCase()||"",b=[...l].reverse().find(p=>p.sender==="bot")?.text?.toLowerCase()||"",S=q(c),w=translations.chat.contextualSuggestions;return c.includes("skill")||c.includes("technology")||c.includes("expertise")||c.includes("habilidad")||c.includes("tecnolog\xEDa")||c.includes("experiencia")||c.includes("\u0645\u0647\u0627\u0631\u0629")||c.includes("\u062A\u0643\u0646\u0648\u0644\u0648\u062C\u064A\u0627")||c.includes("\u062E\u0628\u0631\u0629")?u.push(...w[S]?.skills||["What projects have you worked on?","Tell me about your experience","What are you learning currently?"]):c.includes("background")||c.includes("experience")||c.includes("career")||c.includes("fondo")||c.includes("experiencia")||c.includes("carrera")||c.includes("\u062E\u0644\u0641\u064A\u0629")||c.includes("\u062E\u0628\u0631\u0629")||c.includes("\u0645\u0633\u064A\u0631\u0629")?u.push(...w[S]?.background||["What are your main skills?","Tell me about your education","What industries have you worked in?"]):c.includes("project")||c.includes("work")||c.includes("portfolio")||c.includes("proyecto")||c.includes("trabajo")||c.includes("portafolio")||c.includes("\u0645\u0634\u0631\u0648\u0639")||c.includes("\u0639\u0645\u0644")||c.includes("\u0645\u062D\u0641\u0638\u0629")?u.push(...w[S]?.projects||["Can you show me your code?","What technologies did you use?","How long did it take to build?"]):c.includes("contact")||c.includes("reach")||c.includes("email")||c.includes("contacto")||c.includes("alcanzar")||c.includes("correo")||c.includes("\u0627\u062A\u0635\u0627\u0644")||c.includes("\u0627\u0644\u0648\u0635\u0648\u0644")||c.includes("\u0628\u0631\u064A\u062F")?u.push(...w[S]?.contact||["Are you available for freelance work?","What's your typical response time?","Do you work remotely?"]):c.includes("education")||c.includes("study")||c.includes("learn")||c.includes("educaci\xF3n")||c.includes("estudio")||c.includes("aprender")||c.includes("\u062A\u0639\u0644\u064A\u0645")||c.includes("\u062F\u0631\u0627\u0633\u0629")||c.includes("\u062A\u0639\u0644\u0645")?u.push(...w[S]?.education||["What certifications do you have?","What's your favorite programming language?","How do you stay updated with technology?"]):b.includes("project")||b.includes("work")||b.includes("proyecto")||b.includes("trabajo")||b.includes("\u0645\u0634\u0631\u0648\u0639")||b.includes("\u0639\u0645\u0644")?u.push(...w[S]?.projectResponse||["Can you tell me more about that project?","What challenges did you face?","What did you learn from it?"]):b.includes("skill")||b.includes("technology")||b.includes("habilidad")||b.includes("tecnolog\xEDa")||b.includes("\u0645\u0647\u0627\u0631\u0629")||b.includes("\u062A\u0643\u0646\u0648\u0644\u0648\u062C\u064A\u0627")?u.push(...w[S]?.skillResponse||["How did you learn that?","Have you used it in projects?","What's your proficiency level?"]):l.length<4&&u.push(...w[S]?.early||["What are your main skills?","Tell me about your background","What projects are you proud of?"]),u.slice(0,3)}function q(l){return l?/[\u0600-\u06FF]/.test(l)?"ar":/\b(qué|como|dónde|cuándo|por qué|está|son|tiene|trabajo|habilidades?|experiencia|proyecto|contacto)\b/i.test(l)?"es":"en":"en"}function W(l){const u=document.createDocumentFragment();if(!l)return u;const c=p=>{try{const E=String(p).trim();if(E.startsWith("/"))return E;const y=new URL(E);return y.protocol!=="http:"&&y.protocol!=="https:"?null:y.toString()}catch{return null}},b=(p,E)=>{const y=document.createElement("a");y.href=p;const L=p.startsWith("/");return y.target=L?"_self":"_blank",L||(y.rel="noopener noreferrer"),y.className="text-[#212842] underline hover:text-[#362017] font-medium",y.textContent=E,y},S=(p,E)=>{const y=/\[([^\]]+)\]\(([^)\s]+)\)|\bhttps?:\/\/[^\s<]+/g,L=String(E);let j=0,A;for(;(A=y.exec(L))!==null;){if(A.index>j&&p.appendChild(document.createTextNode(L.slice(j,A.index))),A[1]&&A[2]){const B=c(A[2]);B?p.appendChild(b(B,A[1])):p.appendChild(document.createTextNode(A[0]))}else{const B=c(A[0]);B?p.appendChild(b(B,A[0])):p.appendChild(document.createTextNode(A[0]))}j=y.lastIndex}j<L.length&&p.appendChild(document.createTextNode(L.slice(j)))},w=String(l).split(/\n/);for(let p=0;p<w.length;p++)S(u,w[p]),p<w.length-1&&u.appendChild(document.createElement("br"));return u}function F(l){const u=document.createElement("template");u.innerHTML=String(l||"");const c=new Set(["P","BR","STRONG","EM","CODE","PRE","UL","OL","LI","A","BLOCKQUOTE"]),b=w=>{if(!w)return null;const p=String(w).trim();if(p.startsWith("/"))return p;try{const E=new URL(p);return E.protocol==="http:"||E.protocol==="https:"?E.toString():null}catch{return null}},S=w=>{const p=Array.from(w.childNodes);for(const E of p)if(E.nodeType===Node.ELEMENT_NODE){const y=E,L=y.tagName;if(!c.has(L)){const A=document.createTextNode(y.textContent||"");y.replaceWith(A);continue}const j=Array.from(y.attributes);for(const A of j)y.removeAttribute(A.name);if(L==="A"){const A=b(y.getAttribute("href"));if(!A){const U=document.createTextNode(y.textContent||"");y.replaceWith(U);continue}y.setAttribute("href",A),A.startsWith("/")?y.setAttribute("target","_self"):(y.setAttribute("target","_blank"),y.setAttribute("rel","noopener noreferrer")),y.className="text-[#212842] underline hover:text-[#362017] font-medium"}S(y)}};return S(u.content),u.content}function $(l){const u=String(l||""),c=typeof window<"u"&&window.marked&&typeof window.marked.parse=="function"?window.marked:null;if(!c)return W(u);const b=u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");try{const S=c.parse(b);return F(S)}catch{return W(u)}}window.__savonieXssSelfTest=function(){const u=["<img src=x onerror=alert(1)>","[bad](javascript:alert(1))","[ok](https://example.com)","https://example.com/test?x=<script>alert(1)<\/script>",`Line 1
Line 2 with https://example.com`].map(c=>{const b=document.createElement("div");return b.appendChild(W(c)),b.innerHTML});return console.log("[Savonie] XSS self-test rendered HTML:",u),u};function H(l){if(!e.chipsContainer)return;if(e.chipsContainer.innerHTML="",!l||l.length===0){h(!1);return}const u=["Projects","View Projects","Projects & Case Studies","View projects"],c=["Resume","Download Resume","View Resume","Get resume"],b=["Contact","Email","Email Estivan","LinkedIn","Contact Estivan"],S=["LinkedIn","Open LinkedIn"];l.forEach(p=>{const E=document.createElement("button");E.className="chip-btn text-xs bg-white border border-[#212842]/20 text-[#212842] px-3 py-1 rounded-full hover:bg-[#212842] hover:text-white transition-colors",E.textContent=p,E.addEventListener("click",()=>{if(u.includes(p)){window.location.href="/projects.html";return}if(c.includes(p)){try{window.open(i,"_blank","noopener")}catch{}return}if(b.includes(p)){window.location.href="/contact.html";return}if(S.includes(p)){try{window.open(t,"_blank","noopener")}catch{}return}if(p==="Continue reading..."){N("Continue",g);return}e.input&&(e.input.value=p,N())}),e.chipsContainer.appendChild(E)});const w=document.createElement("button");w.className="chip-close-btn text-xs text-[#362017]/60 hover:text-[#362017] px-2 py-1 ml-2 transition-colors",w.setAttribute("data-chat-suggestions-close","button"),w.innerHTML="\xD7",w.title="Hide suggestions",w.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation(),console.log("[Savonie DEBUG] Suggestions close X clicked, hiding suggestions"),h(!1)}),e.chipsContainer.appendChild(w),e.suggestionsClose=w,h(!0)}function x(){const l=e.window?.classList.contains("hidden"),u=document.documentElement.dir==="rtl";if(l?(e.window?.classList.remove("hidden"),e.window?.classList.add("flex"),typeof clarity=="function"&&clarity("event","chat_open"),typeof gtag=="function"&&gtag("event","chat_open",{event_category:"Chatbot"})):(e.window?.classList.remove("flex"),e.window?.classList.add("hidden"),typeof clarity=="function"&&clarity("event","chat_close"),typeof gtag=="function"&&gtag("event","chat_close",{event_category:"Chatbot"})),!e.window?.classList.contains("hidden")){if(l){const c=e.widget?.getBoundingClientRect();if(c){let p=c.left/16,E=c.top/16-31.25-1;p+20>window.innerWidth/16&&(p=window.innerWidth/16-20-1),p<1&&(p=1),E<1&&(E=1),e.window.style.position="fixed",e.window.style.left=`${p}rem`,e.window.style.top=`${E}rem`,e.window.style.right="auto",e.window.style.zIndex="10000"}else e.window.style.position="",e.window.style.left="",e.window.style.top="",e.window.style.right="",e.window.style.zIndex=""}e.bubble&&(e.bubble.style.display="none"),setTimeout(()=>{try{e.input?.focus({preventScroll:!0})}catch{e.input?.focus&&e.input.focus()}e.messages&&(e.messages.scrollTop=e.messages.scrollHeight)},100)}}async function P(){if(navigator.onLine)return!0;try{const l=new AbortController,u=setTimeout(()=>l.abort(),3e3),c=await fetch("/favicon.ico",{method:"HEAD",cache:"no-cache",signal:l.signal});return clearTimeout(u),c.ok}catch{return!1}}async function N(l=null,u=null){if(!e.input)return;const c=typeof l=="string"?l:e.input.value.trim();if(!c||m)return;if(m=!0,typeof gtag=="function"&&gtag("event","chat_question",{event_category:"Chatbot",event_label:"User Asked Question"}),typeof clarity=="function"&&clarity("event","chat_question"),!await P()){R(c,"user"),l||(e.input.value=""),R("You appear to be offline. Please check your connection and try again.","bot"),m=!1;return}R(c,"user"),l||(e.input.value="");const S=R("Thinking...","bot",!0),w=3e4,p=2;let E=null,y=null;for(let L=0;L<=p;L++){const j=new AbortController,A=setTimeout(()=>j.abort(),w);try{const B=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:c,pageContent:_(),language:s,previousContext:u||null}),signal:j.signal});if(clearTimeout(A),!B.ok)if(B.status>=500){if(E={type:"server",status:B.status},L<p){await new Promise(U=>setTimeout(U,1e3*(L+1)));continue}}else if(B.status===429){E={type:"rate_limit"};break}else{E={type:"client",status:B.status};break}y=await B.json(),E=null;break}catch(B){if(clearTimeout(A),B.name==="AbortError"){if(E={type:"timeout"},L<p)continue}else if(E={type:"network",message:B.message},L<p){await new Promise(U=>setTimeout(U,1e3*(L+1)));continue}}}if(E){D(S);let L;switch(E.type){case"timeout":L="The request took too long. The AI service might be busy. Please try again in a moment.";break;case"rate_limit":L="Too many requests. Please wait a moment before sending another message.";break;case"server":L="The AI service is temporarily unavailable. Please try again in a few seconds.";break;case"network":L="Connection lost. Please check your internet connection and try again.";break;default:L="Something went wrong. Please try again."}R(L,"bot"),m=!1;return}if(D(S),y&&y.errorType){let L="Something went wrong. Please try again.";y.errorType==="RateLimit"?L="Too many requests. Please wait a moment before trying again.":y.errorType==="BadRequest"?L="Please rephrase your question and try again.":y.errorType==="UpstreamError"&&(L="Service hiccup, please try again in a moment."),R(L,"bot"),m=!1;return}if(y.reply&&(y.reply=y.reply.replace(/\n?\s*\{\s*"(reply|chips|action|card|errorType)"[\s\S]*$/,"").trim(),R(y.reply,"bot")),y.truncated&&(y.continuation_hint||y.reply)?(g=y.continuation_hint||y.reply.slice(-800),y.chips||(y.chips=[]),y.chips=y.chips.filter(L=>L!=="Continue reading..."),y.chips.unshift("Continue reading...")):g=null,y.chips&&Array.isArray(y.chips)&&e.chipsContainer&&H(y.chips),y.action){if(y.action==="download_resume")try{window.open(i,"_blank","noopener")}catch{const j=document.createElement("a");j.href=i,j.target="_blank",j.rel="noopener noreferrer",j.download="Estivan-Ayramia-Resume.pdf",j.style.display="none",document.body.appendChild(j),j.click(),document.body.removeChild(j)}else if(y.action==="email_link")window.location.href="mailto:hello@estivanayramia.com";else if(y.action==="open_linkedin")try{window.open(t,"_blank","noopener")}catch{}}if(y.card&&k(y.card),!y.chips&&d.length>0){const L=Y(d);L.length>0&&e.chipsContainer&&H(L)}m=!1}function R(l,u,c=!1){if(!e.messages)return;const b=document.createElement("div");b.id=c?"loading-msg":"";const S="bg-[#212842] text-white rounded-tr-none self-end ml-auto",w="bg-white text-[#362017] rounded-tl-none border border-[#362017]/5 self-start";if(b.className=`p-3 rounded-lg shadow-sm max-w-[70%] mb-3 text-sm leading-relaxed ${u==="user"?S:w}`,e.messages.appendChild(b),u==="bot"&&!c){let p=0;b.textContent="";const E=setInterval(()=>{p<l.length?(b.textContent+=l[p],p++,e.messages.scrollTop=e.messages.scrollHeight):(clearInterval(E),b.replaceChildren($(l)),e.messages.scrollTop=e.messages.scrollHeight)},12)}else u==="bot"?b.replaceChildren($(l)):b.textContent=l;return!c&&C&&(d.push({kind:"text",text:l,sender:u}),d.length>v&&(d=d.slice(d.length-v)),sessionStorage.setItem(I,JSON.stringify(d))),e.messages.scrollTop=e.messages.scrollHeight,b.id}function k(l){if(!e.messages||!n[l])return;const u=n[l],c=document.createElement("div");c.className="bg-white rounded-lg shadow-md overflow-hidden border border-[#362017]/10 mb-3 max-w-[85%] self-start";const b=document.createElement("div");b.className="p-3";const S=document.createElement("h4");S.className="font-semibold text-[#212842] mb-1",S.textContent=u.title;const w=document.createElement("p");w.className="text-xs text-[#362017]/80 mb-3 leading-relaxed",w.textContent=u.summary||"";const p=document.createElement("a");if(p.href=u.link,p.className="inline-block bg-[#212842] text-white px-4 py-2 rounded-lg text-sm hover:bg-[#362017] transition-colors",p.textContent="View",b.appendChild(S),u.summary&&b.appendChild(w),b.appendChild(p),u.img){const E=document.createElement("img");E.src=u.img,E.alt=u.title,E.className="w-full h-32 object-cover",E.addEventListener("error",()=>{try{E.remove()}catch{}}),c.appendChild(E)}c.appendChild(b),e.messages.appendChild(c),e.messages.scrollTop=e.messages.scrollHeight,C&&(d.push({kind:"card",cardId:l}),d.length>v&&(d=d.slice(d.length-v)),sessionStorage.setItem(I,JSON.stringify(d)))}function D(l){const u=document.getElementById(l);u&&u.remove()}if(e.header&&e.window){let l=!1,u,c,b,S;const w=document.documentElement.dir==="rtl";e.header.style.cursor="move",e.header.addEventListener("mousedown",p=>{if(p.target.closest("#close-chat"))return;l=!0,u=p.clientX,c=p.clientY;const E=e.window.getBoundingClientRect();if(b=E.left,S=E.top,e.header.style.cursor="grabbing",document.body.style.userSelect="none",e.window.style.position!=="fixed"){if(e.window.style.position="fixed",w){const y=window.innerWidth-E.right;e.window.style.right=`${y}px`,e.window.style.left="auto"}else e.window.style.left=`${b}px`;e.window.style.top=`${S}px`,e.window.style.zIndex="10000"}}),document.addEventListener("mousemove",p=>{if(!l)return;p.preventDefault();const E=p.clientX-u,y=p.clientY-c,L=e.window.offsetWidth,j=e.window.offsetHeight,A=10;if(w){let U=window.innerWidth-b-L-E;U=Math.max(A,Math.min(U,window.innerWidth-L-A)),e.window.style.right=`${U}px`,e.window.style.left="auto"}else{let U=b+E;U=Math.max(A,Math.min(U,window.innerWidth-L-A)),e.window.style.left=`${U}px`,e.window.style.right="auto"}let B=S+y;B=Math.max(A,Math.min(B,window.innerHeight-j-A)),e.window.style.top=`${B}px`}),document.addEventListener("mouseup",()=>{l&&(l=!1,e.header.style.cursor="move",document.body.style.userSelect="")})}document.addEventListener("keydown",l=>{l.key==="Escape"&&!e.window?.classList.contains("hidden")&&x(),(l.ctrlKey||l.metaKey)&&l.key==="k"&&(l.preventDefault(),x())})}),document.addEventListener("DOMContentLoaded",()=>{const r=()=>{const t=document.createElement("div");t.className="rounded-xl border border-chocolate/20 bg-white/40 overflow-hidden p-8 text-center";const o=document.createElement("p");return o.className="text-sm text-chocolate/70",o.textContent="Inline PDF preview may be blocked by hosting or browser settings. Use the buttons below to open or download the deck.",t.appendChild(o),t},i=(t,o)=>{if(!t||!o||t.dataset.pdfLoaded)return;t.innerHTML="";const n=document.createElement("div");n.className="py-12 text-sm text-chocolate/60",n.textContent="Attempting to load inline preview\u2026",t.appendChild(n);const e=document.createElement("iframe");e.src=o,e.title="PDF preview",e.style.width="100%",e.style.height="480px",e.style.border="0",e.loading="lazy";let s=!1;const d=setTimeout(()=>{s=!0,console.log("PDF load timeout - assuming success");try{n.remove()}catch{}t.contains(e)||t.appendChild(e),t.dataset.pdfLoaded="true"},5e3),m=()=>{clearTimeout(d);try{e.remove()}catch{}t.innerHTML="",t.appendChild(r()),t.dataset.pdfLoaded="false"};e.addEventListener("load",()=>{clearTimeout(d);try{try{n.remove()}catch{}t.contains(e)||t.appendChild(e),t.dataset.pdfLoaded="true"}catch{m()}}),e.addEventListener("error",m),t.appendChild(e)};document.querySelectorAll(".preview-toggle").forEach(t=>{const o=t.closest("section"),n=o&&o.querySelector(".preview-panel");let e=null;o&&(e=o.querySelector('a[href$=".pdf"]')||o.querySelector('a[href*=".pdf?"]'));const s=e?e.getAttribute("href"):null;n&&s&&i(n,s),t.addEventListener("click",()=>{if(!n)return;n.classList.toggle("hidden");const d=!n.classList.contains("hidden");t.textContent=d?"Hide preview":"Show preview",typeof clarity=="function"&&clarity("event",d?"pdf_preview_show":"pdf_preview_hide"),typeof gtag=="function"&&gtag("event",d?"pdf_preview_show":"pdf_preview_hide",{event_category:"PDF"}),d&&!n.dataset.pdfLoaded&&s&&i(n,s)})})});
