console.log("[Savonie DEBUG] site.js loaded");
/**
 * ============================================================================
 * PORTFOLIO SITE - MAIN JAVASCRIPT
 * ============================================================================
 * 
 * Purpose: Core functionality for the portfolio website including:
 * - Mobile-optimized navigation and scroll handling
 * - Dark/light theme management with system preference detection
 * - GSAP animations with ScrollTrigger
 * - Progressive PDF preview loading with graceful fallbacks
 * - Savonie AI chatbot integration
 * - Client-side diagnostics (opt-in with ?collect-logs=1)
 * - PWA support with service worker
 * - Achievement system
 * - Custom analytics event tracking (theme changes, scroll depth, interactions)
 * 
 * Architecture Overview:
 * 1. Core Utilities (user interaction tracking, guarded reload)
 * 2. Instrumentation Module (diagnostic logging, gated by URL param)
 * 3. Feature Modules (theme, animations, PDFs, chat, etc.)
 * 4. Analytics Integration (custom events sent to GA4 & Clarity)
 * 5. Initialization & Startup
 * 
 * Analytics Integration:
 * ----------------------
 * Analytics initialization is handled by lazy-loader.js (loaded via defer).
 * This file sends CUSTOM EVENTS to the analytics services after they're loaded.
 * 
 * Services used:
 * - Google Analytics 4 (GA4): G-MCN4RXCY6Q
 * - Microsoft Clarity: uawk2g8xee
 * 
 * How it works:
 * 1. lazy-loader.js loads analytics on first user interaction (scroll, click, etc.)
 * 2. This file checks if analytics are loaded before sending events
 * 3. Custom events: theme toggle, scroll depth, navigation clicks, form submissions
 * 4. All analytics code is defensive (checks typeof before calling)
 * 
 * To verify analytics:
 * - GA4: https://analytics.google.com â†’ Realtime â†’ Events
 * - Clarity: https://clarity.microsoft.com â†’ Dashboard â†’ Recordings
 * 
 * @version 2.1.0
 * @author Estivan Ayramia
 * @license MIT
 */
let __userInteracting=!1,__userInteractingTimer=null;const __markUserInteraction=()=>{__userInteracting=!0,__userInteractingTimer&&clearTimeout(__userInteractingTimer),__userInteractingTimer=setTimeout(()=>{__userInteracting=!1},1e3)};["touchstart","touchmove","wheel","scroll"].forEach(e=>{try{window.addEventListener(e,__markUserInteraction,{passive:!0})}catch(t){window.addEventListener(e,__markUserInteraction)}});const __initDeferredStylesheets=()=>{try{document.querySelectorAll('link[rel="stylesheet"][media="print"][data-media]').forEach(e=>{const t=e.getAttribute("data-media")||"all",n=()=>{try{e.media=t}catch(e){}};try{e.addEventListener("load",n,{once:!0})}catch(t){e.addEventListener("load",n)}try{e.addEventListener("error",n,{once:!0})}catch(t){e.addEventListener("error",n)}setTimeout(()=>{try{e.sheet&&n()}catch(e){}},0)})}catch(e){}};__initDeferredStylesheets();const __initPreloadStylesheets=()=>{try{document.querySelectorAll('link[rel="preload"][as="style"][data-onload-rel]').forEach(e=>{const t=e.getAttribute("data-onload-rel")||"stylesheet",n=()=>{try{e.rel=t,e.removeAttribute("data-onload-rel")}catch(e){}};try{e.addEventListener("load",n,{once:!0})}catch(t){e.addEventListener("load",n)}try{if("undefined"!=typeof performance&&"function"==typeof performance.getEntriesByName){const t=e.href,o=t?performance.getEntriesByName(t):[];if(o&&o.length){const e=o[0];e&&"number"==typeof e.responseEnd&&e.responseEnd>0&&n()}}}catch(e){}})}catch(e){}};__initPreloadStylesheets();const __initCarouselAndLightbox=()=>{try{const e=document.getElementById("carouselTrack");if(!e)return;if(e.dataset&&"1"===e.dataset.carouselInit)return;const t=!(!e.dataset||"1"!==e.dataset.carouselWrap),n=Array.from(document.querySelectorAll(".note-card img")),o=n.length>0,i=Array.from(document.querySelectorAll(".carousel-slide"));if(!i.length)return;const r=document.getElementById("carouselPrev"),a=document.getElementById("carouselNext"),s=document.getElementById("carouselDots"),c=document.getElementById("lightbox"),l=document.getElementById("lightbox-image"),d=document.querySelector(".lightbox-close"),u=document.querySelector(".lightbox-prev"),g=document.querySelector(".lightbox-next");if(!(r&&a&&s&&c&&l&&d&&u&&g))return;const m=i.map(e=>e.querySelector("img")).filter(Boolean),h=o?n:m;if(!h.length)return;let p=0,f=0;const y=()=>o?window.innerWidth>=1024?5:window.innerWidth>=768?4:window.innerWidth>=640?3:2:window.innerWidth>=768?3:2;let b=y();const v=()=>{try{s.innerHTML=""}catch(e){for(;s.firstChild;)s.removeChild(s.firstChild)}},w=()=>{try{c.classList.remove("active"),c.setAttribute("aria-hidden","true")}catch(e){}},x=()=>Math.ceil(i.length/b),k=()=>{try{const t=(i[0]&&i[0].offsetWidth?i[0].offsetWidth:0)+16,n=x();if(o){const n=Math.max(0,i.length-b);p=Math.max(0,Math.min(p,n)),e.style.transform=`translateX(-${p*t}px)`}else p=Math.max(0,Math.min(p,n-1)),e.style.transform=`translateX(-${p*t*b}px)`;Array.from(document.querySelectorAll(".carousel-dot")).forEach((e,t)=>{const n=o?Math.floor(p/b):p;e.classList.toggle("active",t===n)})}catch(e){}},_=()=>{v();const e=x();for(let n=0;n<e;n++){const r=document.createElement("button");r.className="carousel-dot"+(0===n?" active":"");try{r.setAttribute("aria-label",`Go to page ${n+1}`)}catch(e){}r.addEventListener("click",()=>{if(o){const e=Math.max(0,i.length-b);p=Math.max(0,Math.min(n*b,e))}else p=t?(n+e)%e:Math.max(0,Math.min(n,e-1));k()}),s.appendChild(r)}k()};r.addEventListener("click",()=>{const e=x();if(o){const e=Math.max(0,i.length-b);t?(p-=b,p<0&&(p=e)):p=Math.max(0,p-b)}else p=t?(p-1+e)%e:Math.max(0,Math.min(p-1,e-1));k()}),a.addEventListener("click",()=>{const e=x();if(o){const e=Math.max(0,i.length-b);t?(p+=b,p>e&&(p=0)):p=Math.min(e,p+b)}else p=t?(p+1)%e:Math.max(0,Math.min(p+1,e-1));k()});const E=e=>{const t=h[e];if(t){f=e,l.src=t.src,l.alt=t.alt||"";try{l.style.transform=t.style&&t.style.transform?t.style.transform:""}catch(e){}if(o){try{u.style.display=e>0?"block":"none"}catch(e){}try{g.style.display=e<h.length-1?"block":"none"}catch(e){}}}},S=e=>{E(e),c.classList.add("active"),c.setAttribute("aria-hidden","false")};o?h.forEach((e,t)=>{e.addEventListener("click",()=>S(t))}):i.forEach((e,t)=>{e.addEventListener("click",()=>S(t))}),d.addEventListener("click",w),c.addEventListener("click",e=>{e.target===c&&w()}),u.addEventListener("click",e=>{e&&e.stopPropagation&&e.stopPropagation(),o?f>0&&E(f-1):E((f-1+h.length)%h.length)}),g.addEventListener("click",e=>{e&&e.stopPropagation&&e.stopPropagation(),o?f<h.length-1&&E(f+1):E((f+1)%h.length)}),document.addEventListener("keydown",e=>{c.classList.contains("active")&&("Escape"===e.key&&w(),"ArrowLeft"===e.key&&u.click(),"ArrowRight"===e.key&&g.click())}),window.addEventListener("resize",()=>{const e=y();e!==b?(b=e,_()):k()});try{e.dataset.carouselInit="1"}catch(e){}_()}catch(e){}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",__initCarouselAndLightbox):__initCarouselAndLightbox();const __collectLogsEnabled="undefined"!=typeof window&&new URLSearchParams(window.location.search).has("collect-logs"),__collectedLogs=[],__saveCollected=()=>{try{localStorage.setItem("site_collect_logs",JSON.stringify(__collectedLogs.slice(-1e3)))}catch(e){}},__logCollect=(e,t)=>{if(__collectLogsEnabled)try{const n={t:Date.now(),msg:String(e),data:t||null,scrollY:window.scrollY||0};__collectedLogs.push(n),__saveCollected()}catch(e){}},__collectLogsParam="undefined"!=typeof window?new URLSearchParams(window.location.search).get("collect-logs"):null,__collectSnapshots=!(!__collectLogsParam||!/snapshot/i.test(__collectLogsParam)),__maybeTakeSnapshot=(e,t)=>{if(__collectSnapshots)try{const n=document.activeElement,o=e=>{if(!e||!e.getBoundingClientRect)return null;const t=e.getBoundingClientRect();return{tag:e.tagName||null,id:e.id||null,classes:e.className||null,rect:{x:Math.round(t.x),y:Math.round(t.y),w:Math.round(t.width),h:Math.round(t.height),top:Math.round(t.top),left:Math.round(t.left)},focusable:"number"==typeof e.tabIndex?e.tabIndex:null,ariaRole:e.getAttribute&&(e.getAttribute("role")||null)}},i={reason:e||null,ts:Date.now(),scrollY:window.scrollY||0,innerWidth:window.innerWidth||0,innerHeight:window.innerHeight||0,docHeight:document.documentElement.scrollHeight||document.body.scrollHeight||0,target:o(t||document.activeElement)||null,activeElement:o(n)||null};__logCollect("snapshot",i)}catch(e){}};if(__collectLogsEnabled){let e=null;window.addEventListener("scroll",()=>{e||(e=setTimeout(()=>{__logCollect("scroll",{y:window.scrollY,innerHeight:window.innerHeight,docHeight:document.documentElement.scrollHeight}),e=null},200))},{passive:!0});try{"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{__logCollect("controllerchange",{controller:!!navigator.serviceWorker.controller})})}catch(t){}try{const n=window.location.reload.bind(window.location);window.location.reload=function(){return __logCollect("location.reload called"),n()}}catch(o){}(()=>{const e=document.createElement("button");e.id="collect-logs-btn",e.textContent="Logs",Object.assign(e.style,{position:"fixed",left:"8px",bottom:"12px",zIndex:99999,padding:"6px 8px",fontSize:"12px",background:"rgba(33,40,66,0.85)",color:"#e1d4c2",border:"1px solid rgba(225,212,194,0.08)",borderRadius:"6px"}),e.addEventListener("click",()=>{try{const e=JSON.stringify(__collectedLogs,null,2),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=`site-logs-${Date.now()}.json`,document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(n)}catch(e){const t=window.open();if(t)try{const e=JSON.stringify(__collectedLogs,null,2),n=t.document;n.title="Site logs",n.body.style.margin="0";const o=n.createElement("pre");o.style.margin="0",o.style.padding="12px",o.textContent=e,n.body.appendChild(o)}catch(e){}}}),document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(e)})})();try{document.addEventListener("visibilitychange",()=>__logCollect("visibilitychange",{hidden:document.hidden})),window.addEventListener("hashchange",e=>__logCollect("hashchange",{oldURL:e.oldURL,newURL:e.newURL})),window.addEventListener("popstate",e=>__logCollect("popstate",{state:e.state})),window.addEventListener("beforeunload",e=>__logCollect("beforeunload",{})),window.addEventListener("focusin",e=>{try{__logCollect("focusin",{tag:e.target&&e.target.tagName,id:e.target&&e.target.id||null,class:e.target&&e.target.className||null})}catch(e){}}),function(){const e=HTMLElement.prototype.focus;e.__wrappedByCollectLogs||(HTMLElement.prototype.focus=function(){try{__logCollect("element.focus.called",{tag:this.tagName,id:this.id||null,options:arguments[0]||null})}catch(e){}try{__maybeTakeSnapshot&&__maybeTakeSnapshot("focus",this)}catch(e){}try{return e.apply(this,arguments)}catch(t){try{return e.call(this)}catch(e){}}},HTMLElement.prototype.focus.__wrappedByCollectLogs=!0)}(),function(){const e=Element.prototype;if(!e.__scrollIntoViewLogged){const t=e.scrollIntoView;e.scrollIntoView=function(){try{__logCollect("element.scrollIntoView",{tag:this.tagName,id:this.id||null,args:Array.from(arguments)})}catch(e){}try{__maybeTakeSnapshot&&__maybeTakeSnapshot("scrollIntoView",this)}catch(e){}return t.apply(this,arguments)},e.__scrollIntoViewLogged=!0}}();try{const i=window.scrollTo;window.scrollTo=function(){try{__logCollect("window.scrollTo",{args:Array.from(arguments)})}catch(e){}try{__maybeTakeSnapshot&&__maybeTakeSnapshot("window.scrollTo",null)}catch(e){}return i.apply(window,arguments)}}catch(r){}try{const a=window.scrollBy;window.scrollBy=function(){try{__logCollect("window.scrollBy",{args:Array.from(arguments)})}catch(e){}try{__maybeTakeSnapshot&&__maybeTakeSnapshot("window.scrollBy",null)}catch(e){}return a.apply(window,arguments)}}catch(s){}try{const c=window.fetch;window.fetch=function(e,t){try{__logCollect("fetch.start",{url:e&&e.url||e,method:t&&t.method||"GET"})}catch(e){}return c.apply(this,arguments).then(t=>{try{__logCollect("fetch.end",{url:t&&t.url||e,status:t.status})}catch(e){}return t}).catch(t=>{try{__logCollect("fetch.error",{url:e,message:t&&t.message})}catch(e){}throw t})}}catch(l){}try{const d=window.XMLHttpRequest;function WrappedXHR(){const e=new d;let t=null;const n=e.open;e.open=function(o,i){t=i;try{__logCollect("xhr.open",{method:o,url:i})}catch(e){}return n.apply(e,arguments)};const o=e.send;return e.send=function(){try{__logCollect("xhr.send",{url:t})}catch(e){}return e.addEventListener("loadend",function(){try{__logCollect("xhr.loadend",{url:t,status:e.status})}catch(e){}}),o.apply(e,arguments)},e}WrappedXHR.prototype=d.prototype,window.XMLHttpRequest=WrappedXHR}catch(u){}window.addEventListener("resize",()=>__logCollect("resize",{innerWidth:window.innerWidth,innerHeight:window.innerHeight})),window.addEventListener("orientationchange",()=>__logCollect("orientationchange",{orientation:window.orientation}));try{if(navigator.serviceWorker&&navigator.serviceWorker.register){const g=navigator.serviceWorker.register.bind(navigator.serviceWorker);navigator.serviceWorker.register=function(){const e=arguments;try{__logCollect("sw.register.start",{scope:e&&e[1]&&e[1].scope||null,script:e&&e[0]})}catch(e){}return g.apply(navigator.serviceWorker,arguments).then(e=>{try{__logCollect("sw.register.done",{scope:e.scope})}catch(e){}try{e.addEventListener("updatefound",()=>__logCollect("sw.updatefound",{})),e.waiting&&__logCollect("sw.waiting",{})}catch(e){}return e}).catch(e=>{try{__logCollect("sw.register.error",{message:e&&e.message})}catch(e){}throw e})}}}catch(m){}try{if("undefined"!=typeof ScrollTrigger&&ScrollTrigger&&ScrollTrigger.refresh){const h=ScrollTrigger.refresh.bind(ScrollTrigger);ScrollTrigger.refresh=function(){try{__logCollect("ScrollTrigger.refresh",{args:Array.from(arguments)})}catch(e){}return h.apply(this,arguments)}}}catch(p){}["touchend","pointerup","mouseup"].forEach(e=>{window.addEventListener(e,t=>{try{__logCollect("gesture."+e,{x:t.changedTouches&&t.changedTouches[0]&&t.changedTouches[0].clientX||t.clientX||null,y:t.changedTouches&&t.changedTouches[0]&&t.changedTouches[0].clientY||t.clientY||null})}catch(e){}},{passive:!0})});try{let f=document.documentElement.scrollHeight||document.body.scrollHeight||0;new MutationObserver(()=>{try{const e=document.documentElement.scrollHeight||document.body.scrollHeight||0;if(e!==f){__logCollect("docHeight.change",{from:f,to:e});try{__maybeTakeSnapshot&&__maybeTakeSnapshot("docHeight.change",document.documentElement)}catch(e){}f=e}}catch(e){}}).observe(document.documentElement||document.body,{childList:!0,subtree:!0,attributes:!0})}catch(y){}try{const b=8192,v=e=>{try{const t=JSON.stringify(e,(e,t)=>"string"==typeof e&&/pass(word)?|token|secret|auth|credit|cc-number|card|ssn|cvv/i.test(e)?"[REDACTED]":"string"==typeof t&&t.length>200?t.slice(0,200)+"â€¦[truncated]":t);return t.length>b?t.slice(0,b)+"...[truncated]":t}catch(t){return String(e)}};try{["log","info","warn","error","debug"].forEach(e=>{const t=console[e]&&console[e].bind(console);t&&(console[e]=function(){try{__logCollect("console."+e,{args:Array.from(arguments).map(e=>"object"==typeof e?v(e):String(e))})}catch(e){}try{"error"!==e&&"warn"!==e||__maybeTakeSnapshot&&__maybeTakeSnapshot("console."+e,document.activeElement)}catch(e){}return t.apply(console,arguments)})})}catch(w){}window.addEventListener("error",e=>{try{__logCollect("window.error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error&&e.error.stack?String(e.error.stack).slice(0,1e3):null});try{__maybeTakeSnapshot&&__maybeTakeSnapshot("error",e&&e.target?e.target:document.activeElement)}catch(e){}}catch(e){}}),window.addEventListener("unhandledrejection",e=>{try{__logCollect("unhandledrejection",{reason:e.reason&&(e.reason.stack?String(e.reason.stack).slice(0,1e3):String(e.reason))})}catch(e){}});try{const x=localStorage.setItem.bind(localStorage);localStorage.setItem=function(e,t){try{__logCollect("localStorage.setItem",{key:String(e),size:t&&t.length||0})}catch(e){}return x(e,t)}}catch(k){}try{const _=sessionStorage.setItem.bind(sessionStorage);sessionStorage.setItem=function(e,t){try{__logCollect("sessionStorage.setItem",{key:String(e),size:t&&t.length||0})}catch(e){}return _(e,t)}}catch(E){}try{if(navigator&&navigator.sendBeacon){const S=navigator.sendBeacon.bind(navigator);navigator.sendBeacon=function(e,t){try{__logCollect("navigator.sendBeacon",{url:String(e),dataSize:t&&t.size||null})}catch(e){}return S(e,t)}}}catch(C){}try{document.addEventListener("click",e=>{try{const t=e.target&&(e.target.closest?e.target.closest("a,button,input,select,textarea,summary"):e.target);if(!t)return;const n=(t.tagName||"").toLowerCase(),o={tag:n,id:t.id||null,classes:t.className||null};"a"===n&&t.href&&(o.href=t.href.length>200?t.href.slice(0,200)+"â€¦":t.href),__logCollect("dom.click",o);try{["a","button","input","textarea","select"].includes(n)&&__maybeTakeSnapshot&&__maybeTakeSnapshot("click",t)}catch(e){}}catch(e){}},{passive:!0}),document.addEventListener("submit",e=>{try{const t=e.target;if(!t||!t.tagName||"form"!==t.tagName.toLowerCase())return;const n=Array.from(t.elements||[]).filter(e=>e.name).map(e=>({name:e.name,type:e.type||e.tagName}));__logCollect("form.submit",{action:t.action||null,method:t.method||"GET",fields:n})}catch(e){}},!0)}catch(L){}try{document.addEventListener("input",e=>{try{const t=e.target;if(!t)return;const n=t.tagName&&t.tagName.toLowerCase();if("input"===n||"textarea"===n||"select"===n){const e={tag:n,type:t.type||null,name:t.name||null,valueLength:t.value&&t.value.length||0};__logCollect("input",e)}}catch(e){}},{passive:!0})}catch(T){}try{document.addEventListener("selectionchange",()=>{try{const e=document.getSelection&&document.getSelection();if(!e)return;const t=e.toString(),n=e.anchorNode&&e.anchorNode.parentElement&&e.anchorNode.parentElement.tagName;__logCollect("selectionchange",{length:t.length,container:n||null})}catch(e){}})}catch(A){}try{["copy","cut","paste"].forEach(e=>{document.addEventListener(e,t=>{try{__logCollect("clipboard."+e,{})}catch(e){}})})}catch(M){}try{if("PerformanceObserver"in window)try{new PerformanceObserver(e=>{e.getEntries().forEach(e=>{try{"longtask"===e.entryType?__logCollect("perf.longtask",{duration:Math.round(e.duration)}):"resource"===e.entryType&&__logCollect("perf.resource",{name:e.name,initiatorType:e.initiatorType,duration:Math.round(e.duration)})}catch(e){}})}).observe({entryTypes:["longtask","resource"]})}catch(I){}}catch(P){}try{const D=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(e,t,n){try{__logCollect("addEventListener",{target:this&&this.tagName?this.tagName:this&&this.constructor&&this.constructor.name||"unknown",type:e})}catch(e){}return D.apply(this,arguments)}}catch(j){}}catch(N){}}catch(q){}window.tryGuardedReload=function(e){const t="number"==typeof(e=e||{}).MAX?e.MAX:3e4,n="number"==typeof e.RETRY?e.RETRY:500,o=e&&"function"==typeof e.fallback?e.fallback:null,i=Date.now();!function e(){try{if(!(void 0!==window.__userInteracting&&window.__userInteracting)){try{window.location.reload()}catch(e){try{window.location.href=window.location.href}catch(e){}}return}if(Date.now()-i<t)return void setTimeout(e,n);if(o)try{o()}catch(e){try{window.location.reload()}catch(e){}}else try{window.location.reload()}catch(e){try{window.location.href=window.location.href}catch(e){}}}catch(e){if(o)try{o()}catch(e){try{window.location.reload()}catch(e){}}else try{window.location.reload()}catch(e){}}}()}}const initDarkMode=()=>{const e=document.getElementById("theme-toggle");if(!e)return;const t=window.matchMedia("(prefers-color-scheme: dark)").matches,n=localStorage.getItem("theme"),o=n||(t?"dark":"light");document.documentElement.setAttribute("data-theme",o),n||localStorage.setItem("theme",o),e.innerHTML="dark"===o?'<span style="color: #e1d4c2">ğŸ”†</span>':'<span style="color: #212842">ğŸŒ™</span>';window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{if(!localStorage.getItem("theme_manual")){const n=t.matches?"dark":"light";document.documentElement.setAttribute("data-theme",n),localStorage.setItem("theme",n),e.innerHTML="dark"===n?'<span style="color: #e1d4c2">ğŸ”†</span>':'<span style="color: #212842">ğŸŒ™</span>'}}),e.addEventListener("click",()=>{(()=>{const t=document.documentElement.getAttribute("data-theme"),n="light"===t?"dark":"light";document.documentElement.setAttribute("data-theme",n),localStorage.setItem("theme",n),e.innerHTML="dark"===n?'<span style="color: #e1d4c2">ğŸ”†</span>':'<span style="color: #212842">ğŸŒ™</span>',"function"==typeof clarity&&clarity("event","theme_toggle",{theme:n}),"function"==typeof gtag&&gtag("event","theme_toggle",{event_category:"user_preference",event_label:n}),e.setAttribute("aria-label",`Switch to ${t} mode`)})(),localStorage.setItem("theme_manual","true")})},initMobileMenu=()=>{const e=document.getElementById("mobile-menu-toggle"),t=document.getElementById("mobile-menu");if(!e||!t)return;let n=0,o=null;const i=()=>{n=window.scrollY;try{const e=o||(o=document.createElement("div"),o.setAttribute("aria-hidden","true"),o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.right="0",o.style.bottom="0",o.style.zIndex="35",o.style.background="rgba(0,0,0,0.35)",o.addEventListener("click",()=>r()),o);e.parentElement||document.body.appendChild(e)}catch(e){}t.classList.remove("hidden"),e.setAttribute("aria-expanded","true"),document.body.style.position="fixed",document.body.style.top=`-${n}px`,document.body.style.width="100%";const i=e.querySelector("svg");i&&(i.style.transform="rotate(90deg)")},r=()=>{if(t.classList.contains("hidden"))return;t.classList.add("hidden"),e.setAttribute("aria-expanded","false"),o&&o.parentElement&&o.parentElement.removeChild(o),document.body.style.position="",document.body.style.top="",document.body.style.width="",window.scrollTo(0,n);const i=e.querySelector("svg");i&&(i.style.transform="rotate(0deg)")};e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),"true"===e.getAttribute("aria-expanded")?r():i()}),document.addEventListener("click",n=>{e.contains(n.target)||t.contains(n.target)||r()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&r()}),window.addEventListener("hashchange",r),window.addEventListener("popstate",r),t.addEventListener("click",e=>{("A"===e.target.tagName||e.target.closest("a"))&&r()})},initAriaCurrent=()=>{const e=e=>{try{return e?((e=String(e).split("#")[0].split("?")[0]).endsWith(".html")&&(e=e.slice(0,-5)),e.length>1&&e.endsWith("/")&&(e=e.slice(0,-1)),e||"/"):"/"}catch(e){return"/"}},t=e(window.location&&window.location.pathname);document.querySelectorAll("header a[href], #mobile-menu a[href]").forEach(n=>{try{const o=n.getAttribute("href");if(!o)return;if(/^(https?:)?\/\//i.test(o)||/^mailto:/i.test(o)||o.startsWith("#"))return;e(o)===t?n.setAttribute("aria-current","page"):n.removeAttribute("aria-current")}catch(e){}})},initAnimations=()=>{const e="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(max-width: 768px)").matches,t="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;if(document.querySelectorAll("[data-gsap]").forEach(e=>{e.classList.remove("opacity-0","translate-y-8"),e.style.opacity="1",e.style.transform="none"}),"undefined"==typeof gsap||"undefined"==typeof ScrollTrigger)return void console.warn("GSAP or ScrollTrigger not loaded; revealing content without animations.");if(t)return;gsap.registerPlugin(ScrollTrigger);document.querySelectorAll('[data-gsap="fade-up"]').forEach(e=>{const t=e.getAttribute("data-gsap-delay")||0;gsap.from(e,{opacity:0,y:20,duration:.4,delay:.5*parseFloat(t),ease:"power2.out",scrollTrigger:{trigger:e,start:"top 92%",toggleActions:"play none none none"}})});const n=document.querySelector("section:first-of-type");!n||e||n.classList.contains("no-parallax")||gsap.to(n,{yPercent:20,ease:"none",scrollTrigger:{trigger:n,start:"top top",end:"bottom top",scrub:!0}});document.querySelectorAll(".card-hover").forEach(e=>{e.addEventListener("mouseenter",()=>{gsap.to(e,{y:-8,duration:.3,ease:"power2.out"})}),e.addEventListener("mouseleave",()=>{gsap.to(e,{y:0,duration:.3,ease:"power2.out"})})})},loadGSAPAndInit=()=>{const e="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(max-width: 768px)").matches,t=()=>{if(window.gsap&&window.ScrollTrigger)return void initAnimations();const e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js",e.onload=()=>{const e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js",e.onload=()=>{initAnimations()},document.body.appendChild(e)},document.body.appendChild(e)};if(e){initAnimations();const e=()=>{["scroll","touchstart","mousemove"].forEach(t=>window.removeEventListener(t,e)),t()};["scroll","touchstart","mousemove"].forEach(t=>window.addEventListener(t,e,{once:!0,passive:!0}))}else t()},initSmoothScroll=()=>{document.addEventListener("click",e=>{const t=e.target.closest("a");if(!t)return;const n=t.getAttribute("href");if("#"===n)return e.preventDefault(),void e.stopPropagation();if(n&&n.startsWith("#")&&n.length>1){const t=document.querySelector(n);if(t){e.preventDefault();const n=100,o=t.getBoundingClientRect().top+window.pageYOffset-n;window.scrollTo({top:o,behavior:"smooth"})}}},{passive:!1})},initFormValidation=()=>{const e=document.querySelector('form[action*="formspree.io"]');if(!e)return;const t=e.querySelectorAll("input, textarea, select"),n=e.querySelector('input[type="file"][name="file"]'),o=["csv","doc","docx","pdf","txt","xls","xlsx","jpg","jpeg","png","gif","svg","webp"],i=e.querySelector('input[name="link"]'),r=e=>{if(!e)return!0;let t,n=e.trim();/^https?:\/\//i.test(n)||(n=`https://${n}`);try{t=new URL(n)}catch(e){return!1}return!["javascript:","data:","file:","blob:","chrome:","chrome-extension:"].includes(t.protocol)};i&&i.addEventListener("blur",()=>{i.value&&!/^https?:\/\//i.test(i.value)&&(i.value=`https://${i.value.trim()}`)});const a=(e,t)=>{e.classList.add("border-red-500");let n=e.parentElement.querySelector(".inline-error");n||(n=document.createElement("p"),n.className="inline-error text-xs text-red-600 mt-1",e.parentElement.appendChild(n)),n.textContent=t},s=e=>{e.classList.remove("border-red-500");const t=e.parentElement.querySelector(".inline-error");t&&t.remove()};t.forEach(e=>{e.addEventListener("blur",()=>{e.hasAttribute("required")&&!e.value.trim()?a(e,"This field is required"):"email"===e.type&&e.value&&!e.checkValidity()?a(e,"Please enter a valid email address"):"url"===e.type&&e.value&&!r(e.value)?a(e,"Please enter a valid URL"):e.checkValidity()?s(e):a(e,e.validationMessage||"Invalid input")}),e.addEventListener("input",()=>{e.classList.contains("border-red-500")&&e.checkValidity()&&e.value.trim()&&s(e)})});let c=e.querySelector("#form-status");c||(c=document.createElement("div"),c.id="form-status",c.className="text-sm mt-3",e.appendChild(c));const l=t=>{const n=e.querySelector('button[type="submit"]');n&&(n.disabled=t,n.classList.toggle("loading",t))};e.addEventListener("submit",a=>{let s=!0;if(t.forEach(e=>{e.checkValidity()||(s=!1,e.classList.add("border-red-500"))}),a.preventDefault(),!s){const t=e.querySelector(".border-red-500");if(t)try{t.focus({preventScroll:!0})}catch(a){try{__logCollect&&__logCollect("focus-fallback",{selector:t.tagName+(t.id?"#"+t.id:"")})}catch(e){}t.focus()}return c.className="text-sm mt-3 text-red-700",void(c.textContent="Please complete required fields highlighted in red.")}(async()=>{l(!0),c.textContent="";try{const t=new FormData(e);if(n&&n.files&&n.files[0]){const e=n.files[0],t=(e.name.split(".").pop()||"").toLowerCase();if(!o.includes(t))return c.className="text-sm mt-3 text-red-700",c.textContent="Unsupported file type. Please upload one of: CSV, DOC, DOCX, PDF, TXT, XLS, XLSX, JPG, JPEG, PNG, GIF, SVG, WEBP.",void l(!1);if(e.size>5242880)return c.className="text-sm mt-3 text-red-700",c.textContent="File too large (max 5MB). Please upload a smaller file.",void l(!1)}if(i&&i.value&&!r(i.value))return c.className="text-sm mt-3 text-red-700",c.textContent="Please enter a valid link starting with https:// or http://",void l(!1);if((await fetch(e.action,{method:"POST",body:t,headers:{Accept:"application/json"},mode:"cors",credentials:"omit"})).ok){e.reset();const t=e.parentElement;t&&(t.innerHTML='\n                        <h2 class="text-2xl font-bold text-indigodeep mb-2">Thanks - message sent!</h2>\n                        <p class="text-sm text-chocolate mb-4">Enjoy a quick game while you\'re here.</p>\n                        <div id="mini-game-root" class="w-full bg-white border border-chocolate/10 rounded-xl p-4"></div>\n                    ',initMiniGame("mini-game-root"))}else{c.className="text-sm mt-3 text-red-700",c.textContent="Sorry, something went wrong. Trying fallback...";try{e.setAttribute("target","_blank"),e.submit()}catch(e){c.textContent="Sorry, something went wrong. Please try again or email hello@estivanayramia.com."}}}catch(t){c.className="text-sm mt-3 text-red-700",c.textContent="Network error detected. Opening fallback submit...";try{e.setAttribute("target","_blank"),e.submit()}catch(e){c.textContent="Network error. Please check your connection or email hello@estivanayramia.com."}}finally{l(!1)}})()})},initMiniGame=e=>{const t=document.getElementById(e);if(!t)return;const n="mgHighScore",o="mgLeaderboard",i=parseInt(localStorage.getItem(n)||"0",10);let r=(()=>{try{const e=localStorage.getItem(o);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(e=>"string"==typeof e.name&&"number"==typeof e.score).slice(0,25):[]}catch(e){return[]}})();t.innerHTML=`\n        <div class="flex items-center justify-between mb-2">\n            <div class="text-sm font-medium text-indigodeep">Score: <span id="mg-score">0</span> <span id="mg-mult" class="ml-2 text-ink/60">x1</span></div>\n            <div class="text-xs text-ink/60">Best: <span id="mg-best">${i}</span></div>\n        </div>\n        <div class="flex items-center justify-between mb-2">\n            <div class="text-xs text-ink/60">Lives: <span id="mg-lives">â¤â¤â¤</span></div>\n            <button id="mg-start" class="text-xs bg-indigodeep text-white px-3 py-1 rounded-full">Start</button>\n        </div>\n        <canvas id="mg-canvas" class="w-full rounded border border-chocolate/10" style="touch-action: none; height: 320px;"></canvas>\n        <p class="text-xs text-ink/60 mt-2">Catch the orbs. Golden orbs are bonus. Tap/drag on mobile, or use â—€ â–¶.</p>\n    `;const a=t.querySelector("#mg-canvas"),s=t.querySelector("#mg-score"),c=t.querySelector("#mg-mult"),l=t.querySelector("#mg-best"),d=t.querySelector("#mg-lives"),u=t.querySelector("#mg-start"),g=a.getContext("2d"),m=window.devicePixelRatio||1,h={running:!1,score:0,best:i,w:0,h:0,paddle:{x:0,y:0,w:90,h:12},orbs:[],particles:[],lastSpawn:0,orbInterval:900,baseSpeed:2.2,lives:3,combo:0,comboTimer:0,shake:0,t:0},p=()=>{const e=a.getBoundingClientRect();a.width=Math.floor(e.width*m),a.height=Math.floor(320*m),h.w=a.width,h.h=a.height,h.paddle.y=h.h-30*m,0===h.paddle.x&&(h.paddle.x=h.w/2-h.paddle.w*m/2),v()},f=e=>"â¤â¤â¤".slice(0,e),y=e=>{navigator.vibrate&&navigator.vibrate(e)},b=(e,t,n="#212842",o=10)=>{for(let i=0;i<o;i++)h.particles.push({x:e,y:t,vx:3*(Math.random()-.5)*m,vy:3*-Math.random()*m,life:600,color:n,r:2*m})},v=()=>{const e=h.shake?Math.random()*h.shake-h.shake/2:0,t=h.shake?Math.random()*h.shake-h.shake/2:0;g.setTransform(1,0,0,1,0,0),g.clearRect(0,0,h.w,h.h),g.translate(e,t),(()=>{const e=g.createLinearGradient(0,0,h.w,h.h),t=(Math.sin(.001*h.t)+1)/2;e.addColorStop(0,`rgba(${210+20*t|0}, ${200+10*t|0}, 180, 0.6)`),e.addColorStop(1,"rgba(200, 190, 170, 0.6)"),g.fillStyle=e,g.fillRect(0,0,h.w,h.h)})();const n=Math.min(h.combo,6);g.shadowColor="rgba(33,40,66,0.6)",g.shadowBlur=2*n*m,g.fillStyle="#212842",g.fillRect(h.paddle.x,h.paddle.y,h.paddle.w*m,h.paddle.h*m),g.shadowBlur=0,h.particles.forEach(e=>{g.globalAlpha=Math.max(0,e.life/600),g.fillStyle=e.color,g.beginPath(),g.arc(e.x,e.y,e.r,0,2*Math.PI),g.fill(),g.globalAlpha=1}),h.orbs.forEach(e=>{g.beginPath(),g.fillStyle=e.color,g.shadowColor="gold"===e.type?"rgba(234,179,8,0.6)":"rgba(54,32,23,0.3)",g.shadowBlur="gold"===e.type?8*m:4*m,g.arc(e.x,e.y,e.r,0,2*Math.PI),g.fill(),g.shadowBlur=0})},w=e=>{if(!h.running)return;h.last||(h.last=e);const t=e-h.last;h.t+=t,h.last=e,h.comboTimer+=t,h.comboTimer>1600&&h.combo>0&&(h.combo=0,c.textContent="x1"),h.shake>0&&(h.shake=Math.max(0,h.shake-.5*m)),e-h.lastSpawn>h.orbInterval&&((()=>{const e=(8+2*Math.random())*m,t=e+Math.random()*(h.w-2*e),n=Math.random()<.15,o=n?"#eab308":"#362017",i=(h.baseSpeed+1.5*Math.random()+.01*h.score)*m;h.orbs.push({x:t,y:e+2,r:e,vy:i,color:o,type:n?"gold":"normal"})})(),h.lastSpawn=e,h.orbInterval>420&&(h.orbInterval-=8));const n=h.paddle.w*m,o=(h.paddle.h,h.paddle.x),i=h.paddle.y;h.orbs.forEach(e=>{e.y+=e.vy});for(let e=h.particles.length-1;e>=0;e--){const n=h.particles[e];n.x+=n.vx,n.y+=n.vy,n.vy+=.04*m,n.life-=t,n.life<=0&&h.particles.splice(e,1)}for(let e=h.orbs.length-1;e>=0;e--){const t=h.orbs[e];if(t.y+t.r>=i&&t.x>=o&&t.x<=o+n){const n="gold"===t.type?5:1;h.combo=Math.min(h.combo+1,9),h.comboTimer=0;const o=1+Math.floor(h.combo/3);h.score+=n*o,s.textContent=h.score,c.textContent="x"+o,b(t.x,i,t.color,"gold"===t.type?18:10),h.shake=Math.min(6*m,h.shake+("gold"===t.type?4:2)),y("gold"===t.type?25:12),h.orbs.splice(e,1),h.score%10==0&&b(t.x,t.y,"#e1d4c2",24)}else if(t.y-t.r>h.h&&(h.orbs.splice(e,1),h.lives-=1,d.textContent=f(h.lives),h.combo=0,c.textContent="x1",h.shake=10*m,y(60),h.lives<=0))return void x()}v(),requestAnimationFrame(w)},x=()=>{h.running=!1,h.score>h.best&&(h.best=h.score,localStorage.setItem(n,String(h.best)),l.textContent=h.best),u.textContent="Restart";const e=document.createElement("div");e.className="mt-3 text-sm text-indigodeep mg-end",e.innerHTML=`\n            <div class="mb-1 font-medium">Game over! Final score: ${h.score}</div>\n            <p class="text-ink/80 mb-2">Hope you enjoyed this little easter egg - I'll be in touch soon.</p>\n            <p class="text-ink/60">Want more surprises? Explore a few corners of the site:</p>\n            <div class="mt-2 flex flex-wrap gap-2">\n                <a href="overview.html" class="text-xs px-3 py-1 rounded-full border border-chocolate/20 text-indigodeep hover:bg-beige transition-colors">Overview</a>\n                <a href="deep-dive.html" class="text-xs px-3 py-1 rounded-full border border-chocolate/20 text-indigodeep hover:bg-beige transition-colors">Deep Dive</a>\n                <a href="projects.html" class="text-xs px-3 py-1 rounded-full border border-chocolate/20 text-indigodeep hover:bg-beige transition-colors">Projects</a>\n            </div>\n            ${h.score>0?"<div class='mt-4 border-t border-chocolate/10 pt-3'>\n                <p class='text-ink/70 mb-2'>Submit your score to the local leaderboard (device-only) or view current rankings.</p>\n                <div class='flex flex-col sm:flex-row gap-2 sm:items-center'>\n                    <input id='mg-name' maxlength='16' placeholder='Username (3-16 chars)' class='flex-1 px-3 py-2 text-sm border border-chocolate/20 rounded focus:outline-none focus:ring-2 focus:ring-indigodeep'/>\n                    <button id='mg-save' class='text-xs bg-indigodeep text-white px-4 py-2 rounded-full'>Save Score</button>\n                    <button id='mg-view' class='text-xs bg-chocolate text-white px-4 py-2 rounded-full'>View Leaderboard</button>\n                </div>\n                <div id='mg-name-error' class='mt-2 text-xs text-red-600 hidden'></div>\n                <div id='mg-leaderboard' class='mt-3 hidden'></div>\n            </div>":""}\n        `,t.appendChild(e);const i=e.querySelector("#mg-name"),a=e.querySelector("#mg-save"),s=e.querySelector("#mg-view"),c=e.querySelector("#mg-name-error"),d=e.querySelector("#mg-leaderboard");if(!a||!s)return;const g=["fuck","shit","bitch","cunt","dick","piss","cock","asshole","retard","fag","faggot","nigger","nigga","spic","chink","whore","slut","bastard","twat","rape","cum","penis","vagina"],m=/^[A-Za-z0-9_-]{3,16}$/,p=()=>{if(!d)return;let e="<table class='w-full text-xs'><thead><tr class='text-indigodeep'><th class='text-left pb-1'>#</th><th class='text-left pb-1'>User</th><th class='text-right pb-1'>Score</th></tr></thead><tbody>";r.slice(0,10).forEach((t,n)=>{e+=`<tr class='border-t border-chocolate/10'><td class='py-1 pr-2'>${n+1}</td><td class='py-1 pr-2'>${t.name}</td><td class='py-1 text-right'>${t.score}</td></tr>`}),0===r.length&&(e+="<tr><td colspan='3' class='py-2 text-ink/60'>No scores yet.</td></tr>"),e+="</tbody></table>",d.innerHTML=e};s.addEventListener("click",()=>{d.classList.toggle("hidden"),d.classList.contains("hidden")?s.textContent="View Leaderboard":(p(),s.textContent="Hide Leaderboard")}),a.addEventListener("click",()=>{const e=(i.value||"").trim();return m.test(e)?(e=>{const t=(e=>e.toLowerCase().replace(/[@]/g,"a").replace(/[$]/g,"s").replace(/0/g,"o").replace(/1/g,"i").replace(/3/g,"e").replace(/4/g,"a").replace(/5/g,"s").replace(/7/g,"t"))(e).replace(/[_-]/g,"");return!g.some(e=>t.includes(e))})(e)?(c.classList.add("hidden"),r.push({name:e,score:h.score,ts:Date.now()}),r.sort((e,t)=>t.score-e.score||e.ts-t.ts),r=r.slice(0,25),(e=>{try{localStorage.setItem(o,JSON.stringify(e.slice(0,25)))}catch(e){}})(r),p(),d.classList.remove("hidden"),s.textContent="Hide Leaderboard",a.disabled=!0,void(a.textContent="Saved")):(c.textContent="Please choose a different name (profanity not allowed).",void c.classList.remove("hidden")):(c.textContent="Username must be 3-16 chars: letters, numbers, _ or - only.",void c.classList.remove("hidden"))})},k=e=>{let t=(e-a.getBoundingClientRect().left)*m-h.paddle.w*m/2;t=Math.max(0,Math.min(t,h.w-h.paddle.w*m)),h.paddle.x=t};a.addEventListener("mousemove",e=>k(e.clientX)),a.addEventListener("touchstart",e=>{e.touches[0]&&k(e.touches[0].clientX)},{passive:!0}),a.addEventListener("touchmove",e=>{e.touches[0]&&k(e.touches[0].clientX)},{passive:!0}),window.addEventListener("keydown",e=>{"ArrowLeft"===e.key&&k(a.getBoundingClientRect().left+h.paddle.x/m-24),"ArrowRight"===e.key&&k(a.getBoundingClientRect().left+h.paddle.x/m+24)}),u.addEventListener("click",()=>{u.textContent="Playing...",h.running=!0,h.score=0,s.textContent="0",h.orbs=[],h.particles=[],h.lastSpawn=0,h.orbInterval=900,h.baseSpeed=2.2,h.lives=3,d.textContent=f(3),h.combo=0,c.textContent="x1",h.t=0,h.shake=0,[...t.querySelectorAll(".mg-end")].forEach(e=>e.remove()),requestAnimationFrame(w)}),window.addEventListener("resize",p),p(),v()},initLazyLoading=()=>{const e=document.querySelectorAll("img[data-src]");if("IntersectionObserver"in window){const t=new IntersectionObserver((e,n)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,n.removeAttribute("data-src"),t.unobserve(n)}})});e.forEach(e=>t.observe(e))}else e.forEach(e=>{e.src=e.dataset.src,e.removeAttribute("data-src")})},initPdfPreviews=()=>{try{document.querySelectorAll(".preview-panel").forEach(e=>{try{const t=e.closest("section")||e.parentElement;if(!t)return;const n=t.querySelector('a[href$=".pdf"]');if(!n)return;const o=n.href;e.dataset.pdfLoaded="true";const i=t=>{try{e.innerHTML='<div class="rounded-xl border border-chocolate/20 bg-white/40 overflow-hidden p-8 text-center"><p class="text-sm text-chocolate/70">Inline PDF preview may be blocked by hosting or browser settings. Use the buttons below to open or download the deck.</p></div>',__logCollect&&__logCollect("pdf.preview.fallback",{url:o,reason:t})}catch(e){}};e.innerHTML='<div class="py-12 bg-white/30 rounded-xl border border-chocolate/10 flex items-center justify-center min-h-[480px]">\n  <div class="text-sm text-chocolate/60 flex items-center gap-2"><svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Loading previewâ€¦</div>\n</div>';const r=document.createElement("iframe");r.setAttribute("aria-label","PDF preview"),r.style.cssText="width:100%;height:480px;border:0;border-radius:12px;background:#fff;opacity:0;position:absolute;top:0;left:0;",r.referrerPolicy="strict-origin-when-cross-origin",e.style.position="relative",e.style.minHeight="480px";let a=!1,s=!1;const c=t=>{if(!s)if(s=!0,t){r.style.position="relative",r.style.opacity="1",r.style.transition="opacity 0.3s ease";const t=e.querySelector("div");t&&t.remove(),__logCollect&&__logCollect("pdf.preview.loaded",{url:o})}else{try{r.remove()}catch(e){}i("load_failed")}};r.addEventListener("load",()=>{a=!0,setTimeout(()=>c(!0),100)}),r.addEventListener("error",()=>c(!1));try{r.src=o,e.appendChild(r),__logCollect&&__logCollect("pdf.preview.attempt",{url:o})}catch(e){return void c(!1)}setTimeout(()=>{a||c(!0)},5e3)}catch(e){}})}catch(e){}},initScrollToTop=()=>{const e=document.getElementById("scroll-to-top");if(!e)return;const t=e.querySelector(".scroll-progress-circle"),n=t?parseFloat(t.getAttribute("r")||"22"):0,o=n>0?2*n*Math.PI:0;t&&o>0&&(t.style.strokeDasharray=`${o}`,t.style.strokeDashoffset=`${o}`);const i=()=>{const n=document.documentElement.scrollHeight-window.innerHeight,i=.25*n,r=window.scrollY;if(r>i?e.classList.add("show"):e.classList.remove("show"),t&&o>0&&n>0){const e=o-r/n*o;t.style.strokeDashoffset=e}};window.addEventListener("scroll",i),e.addEventListener("click",()=>{"function"==typeof clarity&&clarity("event","scroll_to_top_clicked"),"function"==typeof gtag&&gtag("event","scroll_to_top",{event_category:"navigation",event_label:"button_click"}),window.scrollTo({top:0,behavior:"smooth"})}),i()},getCurrentLanguage=()=>document.documentElement.lang||"en",translations={achievement:{en:{unlocked:"Achievement Unlocked!",explorer:{name:"Explorer",description:"Visited all main pages"},reader:{name:"Deep Diver",description:"Read the full Deep Dive"},gamer:{name:"Game Master",description:"Played the contact form game"},chatter:{name:"Conversationalist",description:"Opened the chat"},nightOwl:{name:"Night Owl",description:"Toggled dark mode"},konami:{name:"Secret Discoverer",description:"Found the Konami code"},networker:{name:"Networker",description:"Visited social profiles"},formFiller:{name:"Messenger",description:"Submitted the contact form"}},es:{unlocked:"Â¡Logro Desbloqueado!",explorer:{name:"Explorador",description:"VisitÃ³ todas las pÃ¡ginas principales"},reader:{name:"Buzo Profundo",description:"LeyÃ³ la inmersiÃ³n completa"},gamer:{name:"Maestro del Juego",description:"JugÃ³ el juego del formulario de contacto"},chatter:{name:"Conversador",description:"AbriÃ³ el chat"},nightOwl:{name:"NoctÃ¡mbulo",description:"AlternÃ³ el modo oscuro"},konami:{name:"Descubridor Secreto",description:"EncontrÃ³ el cÃ³digo Konami"},networker:{name:"Redactor",description:"VisitÃ³ perfiles sociales"},formFiller:{name:"Mensajero",description:"EnviÃ³ el formulario de contacto"}},ar:{unlocked:"ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ù‚ÙÙ„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²!",explorer:{name:"Ø§Ù„Ù…Ø³ØªÙƒØ´Ù",description:"Ø²Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"},reader:{name:"Ø§Ù„ØºÙˆØ§Øµ Ø§Ù„Ø¹Ù…ÙŠÙ‚",description:"Ù‚Ø±Ø£ Ø§Ù„ØºÙˆØµ Ø§Ù„ÙƒØ§Ù…Ù„"},gamer:{name:"Ø³ÙŠØ¯ Ø§Ù„Ù„Ø¹Ø¨Ø©",description:"Ù„Ø¹Ø¨ Ù„Ø¹Ø¨Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§ØªØµØ§Ù„"},chatter:{name:"Ø§Ù„Ù…Ø­Ø§Ø¯Ø«",description:"ÙØªØ­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©"},nightOwl:{name:"Ø¨ÙˆÙ…Ø© Ø§Ù„Ù„ÙŠÙ„",description:"Ø¨Ø¯Ù‘Ù„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…"},konami:{name:"Ø§Ù„Ù…ÙƒØªØ´Ù Ø§Ù„Ø³Ø±ÙŠ",description:"ÙˆØ¬Ø¯ Ø±Ù…Ø² ÙƒÙˆÙ†Ø§Ù…ÙŠ"},networker:{name:"Ø§Ù„Ø´Ø¨ÙƒÙŠ",description:"Ø²Ø§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©"},formFiller:{name:"Ø§Ù„Ø±Ø³ÙˆÙ„",description:"Ø£Ø±Ø³Ù„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§ØªØµØ§Ù„"}}},konami:{en:{title:"ğŸ® You found the secret!",message:"Congratulations! You've unlocked the Konami code.",giftText:"Click the gift for a surprise!",stats:"You're one of the {percent}% who found this!",compliments:["You're absolutely amazing! ğŸŒŸ","You're a coding wizard! ğŸ§™â€â™‚ï¸","You're incredibly talented! ğŸ¨","You're a problem-solving genius! ğŸ§ ","You're making the world better! ğŸŒ","You're a creative powerhouse! âš¡","You're inspiring others! ğŸ’«","You're a true innovator! ğŸš€","You're exceptionally skilled! ğŸ†","You're a digital artist! ğŸ­","You're building something incredible! ğŸ—ï¸","You're a technology trailblazer! ğŸ—ºï¸","You're exceptionally creative! ğŸ¨","You're a user experience master! ğŸ¯","You're a design virtuoso! ğŸ¨"]},es:{title:"ğŸ® Â¡Encontraste el secreto!",message:"Â¡Felicitaciones! Has desbloqueado el cÃ³digo Konami.",giftText:"Â¡Haz clic en el regalo para una sorpresa!",stats:"Â¡Eres uno del {percent}% que encontrÃ³ esto!",compliments:["Â¡Eres absolutamente increÃ­ble! ğŸŒŸ","Â¡Eres un mago de la programaciÃ³n! ğŸ§™â€â™‚ï¸","Â¡Eres increÃ­blemente talentoso! ğŸ¨","Â¡Eres un genio para resolver problemas! ğŸ§ ","Â¡EstÃ¡s haciendo el mundo mejor! ğŸŒ","Â¡Eres una potencia creativa! âš¡","Â¡EstÃ¡s inspirando a otros! ğŸ’«","Â¡Eres un verdadero innovador! ğŸš€","Â¡Eres excepcionalmente hÃ¡bil! ğŸ†","Â¡Eres un artista digital! ğŸ­","Â¡EstÃ¡s construyendo algo increÃ­ble! ğŸ—ï¸","Â¡Eres un pionero de la tecnologÃ­a! ğŸ—ºï¸","Â¡Eres excepcionalmente creativo! ğŸ¨","Â¡Eres un maestro de la experiencia del usuario! ğŸ¯","Â¡Eres un virtuoso del diseÃ±o! ğŸ¨"]},ar:{title:"ğŸ® Ù„Ù‚Ø¯ ÙˆØ¬Ø¯Øª Ø§Ù„Ø³Ø±!",message:"ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ÙØªØ­ Ø±Ù…Ø² ÙƒÙˆÙ†Ø§Ù…ÙŠ.",giftText:"Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯ÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙØ§Ø¬Ø£Ø©!",stats:"Ø£Ù†Øª ÙˆØ§Ø­Ø¯ Ù…Ù† {percent}% Ø§Ù„Ø°ÙŠÙ† ÙˆØ¬Ø¯ÙˆØ§ Ù‡Ø°Ø§!",compliments:["Ø£Ù†Øª Ø±Ø§Ø¦Ø¹ ØªÙ…Ø§Ù…Ø§Ù‹! ğŸŒŸ","Ø£Ù†Øª Ø³Ø§Ø­Ø± Ø¨Ø±Ù…Ø¬Ø©! ğŸ§™â€â™‚ï¸","Ø£Ù†Øª Ù…ÙˆÙ‡ÙˆØ¨ Ø¨Ø´ÙƒÙ„ Ù„Ø§ ÙŠØµØ¯Ù‚! ğŸ¨","Ø£Ù†Øª Ø¹Ø¨Ù‚Ø±ÙŠ ÙÙŠ Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª! ğŸ§ ","Ø£Ù†Øª ØªØ¬Ø¹Ù„ Ø§Ù„Ø¹Ø§Ù„Ù… Ø£ÙØ¶Ù„! ğŸŒ","Ø£Ù†Øª Ù‚ÙˆØ© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©! âš¡","Ø£Ù†Øª ØªÙ„Ù‡Ù… Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†! ğŸ’«","Ø£Ù†Øª Ù…Ø¨ØªÙƒØ± Ø­Ù‚ÙŠÙ‚ÙŠ! ğŸš€","Ø£Ù†Øª Ù…Ø§Ù‡Ø± Ø¨Ø´ÙƒÙ„ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ! ğŸ†","Ø£Ù†Øª ÙÙ†Ø§Ù† Ø±Ù‚Ù…ÙŠ! ğŸ­","Ø£Ù†Øª ØªØ¨Ù†ÙŠ Ø´ÙŠØ¦Ø§Ù‹ Ù…Ø°Ù‡Ù„Ø§Ù‹! ğŸ—ï¸","Ø£Ù†Øª Ø±Ø§Ø¦Ø¯ ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§! ğŸ—ºï¸","Ø£Ù†Øª Ù…Ø¨Ø¯Ø¹ Ø¨Ø´ÙƒÙ„ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ! ğŸ¨","Ø£Ù†Øª Ø®Ø¨ÙŠØ± ÙÙŠ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…! ğŸ¯","Ø£Ù†Øª ÙÙ†Ø§Ù† ØªØµÙ…ÙŠÙ…! ğŸ¨"]}},chat:{welcome:{en:"Hello! I am Savonie. Ask me anything about Estivan.",es:"Â¡Hola! Soy Savonie. PregÃºntame cualquier cosa sobre Estivan.",ar:"Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ø³Ø§ÙÙˆÙ†ÙŠ. Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø´ÙŠØ¡ Ø¹Ù† Ø§Ø³ØªÙŠÙØ§Ù†."},defaultChips:{en:["What does Estivan do?","Tell me about his background","What are his skills?","How can I contact him?"],es:["Â¿QuÃ© hace Estivan?","HÃ¡blame de su experiencia","Â¿CuÃ¡les son sus habilidades?","Â¿CÃ³mo puedo contactarlo?"],ar:["Ù…Ø§Ø°Ø§ ÙŠÙØ¹Ù„ Ø§Ø³ØªÙŠÙØ§Ù†ØŸ","Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¹Ù† Ø®Ù„ÙÙŠØªÙ‡","Ù…Ø§ Ù‡ÙŠ Ù…Ù‡Ø§Ø±Ø§ØªÙ‡ØŸ","ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‡ØŸ"]},contextualSuggestions:{en:{skills:["What projects have you worked on?","Tell me about your experience","What are you learning currently?"],background:["What are your main skills?","Tell me about your education","What industries have you worked in?"],projects:["Can you show me your code?","What technologies did you use?","How long did it take to build?"],contact:["Are you available for freelance work?","What's your typical response time?","Do you work remotely?"],education:["What certifications do you have?","What's your favorite programming language?","How do you stay updated with technology?"],projectResponse:["Can you tell me more about that project?","What challenges did you face?","What did you learn from it?"],skillResponse:["How did you learn that?","Have you used it in projects?","What's your proficiency level?"],early:["What are your main skills?","Tell me about your background","What projects are you proud of?"]},es:{skills:["Â¿En quÃ© proyectos has trabajado?","HÃ¡blame de tu experiencia","Â¿QuÃ© estÃ¡s aprendiendo actualmente?"],background:["Â¿CuÃ¡les son tus principales habilidades?","HÃ¡blame de tu educaciÃ³n","Â¿En quÃ© industrias has trabajado?"],projects:["Â¿Puedes mostrarme tu cÃ³digo?","Â¿QuÃ© tecnologÃ­as usaste?","Â¿CuÃ¡nto tiempo tomÃ³ construirlo?"],contact:["Â¿EstÃ¡s disponible para trabajo freelance?","Â¿CuÃ¡l es tu tiempo tÃ­pico de respuesta?","Â¿Trabajas de forma remota?"],education:["Â¿QuÃ© certificaciones tienes?","Â¿CuÃ¡l es tu lenguaje de programaciÃ³n favorito?","Â¿CÃ³mo te mantienes actualizado con la tecnologÃ­a?"],projectResponse:["Â¿Puedes contarme mÃ¡s sobre ese proyecto?","Â¿QuÃ© desafÃ­os enfrentaste?","Â¿QuÃ© aprendiste de ello?"],skillResponse:["Â¿CÃ³mo aprendiste eso?","Â¿Lo has usado en proyectos?","Â¿CuÃ¡l es tu nivel de competencia?"],early:["Â¿CuÃ¡les son tus principales habilidades?","HÃ¡blame de tu experiencia","Â¿De quÃ© proyectos estÃ¡s orgulloso?"]},ar:{skills:["Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ØªÙŠ Ø¹Ù…Ù„Øª Ø¹Ù„ÙŠÙ‡Ø§ØŸ","Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¹Ù† ØªØ¬Ø±Ø¨ØªÙƒ","Ù…Ø§Ø°Ø§ ØªØªØ¹Ù„Ù… Ø­Ø§Ù„ÙŠØ§Ù‹ØŸ"],background:["Ù…Ø§ Ù‡ÙŠ Ù…Ù‡Ø§Ø±Ø§ØªÙƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŸ","Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¹Ù† ØªØ¹Ù„ÙŠÙ…Ùƒ","ÙÙŠ Ø£ÙŠ ØµÙ†Ø§Ø¹Ø§Øª Ø¹Ù…Ù„ØªØŸ"],projects:["Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙˆØ¯ÙƒØŸ","Ù…Ø§ Ù‡ÙŠ Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„ØªÙŠ Ø§Ø³ØªØ®Ø¯Ù…ØªÙ‡Ø§ØŸ","ÙƒÙ… Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ø³ØªØºØ±Ù‚ Ø¨Ù†Ø§Ø¤Ù‡ØŸ"],contact:["Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ§Ø­ Ù„Ù„Ø¹Ù…Ù„ Ø§Ù„Ø­Ø±ØŸ","Ù…Ø§ Ù‡Ùˆ ÙˆÙ‚Øª Ø±Ø¯Ùƒ Ø§Ù„Ù…Ø¹ØªØ§Ø¯ØŸ","Ù‡Ù„ ØªØ¹Ù…Ù„ Ø¹Ù† Ø¨Ø¹Ø¯ØŸ"],education:["Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØªÙŠ Ù„Ø¯ÙŠÙƒØŸ","Ù…Ø§ Ù‡Ùˆ Ù„ØºØ© Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù„Ø¯ÙŠÙƒØŸ","ÙƒÙŠÙ ØªØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ ØªØ­Ø¯ÙŠØ« Ù†ÙØ³Ùƒ Ø¨Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ØŸ"],projectResponse:["Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø®Ø¨Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ","Ù…Ø§ Ù‡ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„ØªÙŠ ÙˆØ§Ø¬Ù‡ØªÙ‡Ø§ØŸ","Ù…Ø§Ø°Ø§ ØªØ¹Ù„Ù…Øª Ù…Ù†Ù‡ØŸ"],skillResponse:["ÙƒÙŠÙ ØªØ¹Ù„Ù…Øª Ø°Ù„ÙƒØŸ","Ù‡Ù„ Ø§Ø³ØªØ®Ø¯Ù…ØªÙ‡ ÙÙŠ Ù…Ø´Ø§Ø±ÙŠØ¹ØŸ","Ù…Ø§ Ù‡Ùˆ Ù…Ø³ØªÙˆÙ‰ Ù…Ù‡Ø§Ø±ØªÙƒØŸ"],early:["Ù…Ø§ Ù‡ÙŠ Ù…Ù‡Ø§Ø±Ø§ØªÙƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŸ","Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¹Ù† Ø®Ù„ÙÙŠØªÙƒ","Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ØªÙŠ ØªÙØ®Ø± Ø¨Ù‡Ø§ØŸ"]}}}},initAchievements=()=>{const e="portfolio_achievements",t={explorer:{id:"explorer",icon:"ğŸ—ºï¸"},reader:{id:"reader",icon:"ğŸ“–"},gamer:{id:"gamer",icon:"ğŸ®"},chatter:{id:"chatter",icon:"ğŸ’¬"},nightOwl:{id:"nightOwl",icon:"ğŸŒ™"},konami:{id:"konami",icon:"ğŸ¯"},networker:{id:"networker",icon:"ğŸ”—"},formFiller:{id:"formFiller",icon:"âœ‰ï¸"}},n=n=>{const i=(()=>{try{const t=localStorage.getItem(e);return t?JSON.parse(t):{}}catch{return{}}})();if(i[n])return;const r=getCurrentLanguage(),a=translations.achievement[r]||translations.achievement.en,s={...t[n],...a&&a[n]?a[n]:{}};i[n]={unlockedAt:(new Date).toISOString(),...s},(t=>{try{localStorage.setItem(e,JSON.stringify(t))}catch{}})(i),o(s);try{const e="arcade_achievements",t=JSON.parse(localStorage.getItem(e)||"[]");Array.isArray(t)&&!t.includes(n)&&(t.push(n),localStorage.setItem(e,JSON.stringify(t))),window.ArcadeAchievements&&"function"==typeof window.ArcadeAchievements.updateUI&&window.ArcadeAchievements.updateUI()}catch{}},o=e=>{const n=getCurrentLanguage(),o=translations.achievement[n]||translations.achievement.en,i=(e=>e?"string"==typeof e?{id:e}:"object"==typeof e?e:{}:{})(e),r=i.id||i.achievementId||i.key,a="string"==typeof r?r:"",s=a.replace(/^site_/,"");let c={icon:i.icon,name:i.name||i.title,description:i.description||i.desc};if((!c.name||!c.description||!c.icon)&&a&&window.ArcadeAchievements&&"function"==typeof window.ArcadeAchievements.getDefinitions){const e=window.ArcadeAchievements.getDefinitions(),t=e&&e[a];t&&(c={icon:c.icon||t.icon,name:c.name||t.title||t.name,description:c.description||t.description||t.desc})}c.name&&c.description||!o||!s||!o[s]||(c={icon:c.icon||t[s]&&t[s].icon,name:c.name||o[s].name,description:c.description||o[s].description});const l=c.icon||"ğŸ†",d=c.name||"Achievement",u=c.description||"",g=document.createElement("div");g.className="achievement-notification",g.innerHTML=`\n            <div class="achievement-icon">${l}</div>\n            <div class="achievement-content">\n                <div class="achievement-title">${o&&o.unlocked?o.unlocked:"Achievement Unlocked!"}</div>\n                <div class="achievement-name">${d}</div>\n                <div class="achievement-desc">${u}</div>\n            </div>\n            <button class="achievement-close" aria-label="Close achievement notification">Ã—</button>\n        `,document.body.appendChild(g);const m=g.querySelector(".achievement-close"),h=()=>{g.classList.remove("show"),setTimeout(()=>g.remove(),300)};m.addEventListener("click",h),setTimeout(()=>g.classList.add("show"),100);const p=setTimeout(()=>{document.body.contains(g)&&h()},4e3);m.addEventListener("click",()=>clearTimeout(p))};(()=>{const e="portfolio_visited_pages";try{const t=JSON.parse(localStorage.getItem(e)||"[]"),o=window.location.pathname.split("/").pop()||"index.html";t.includes(o)||(t.push(o),localStorage.setItem(e,JSON.stringify(t)));["index.html","overview.html","deep-dive.html","about.html","projects.html","contact.html"].every(e=>t.includes(e))&&n("explorer"),"deep-dive.html"===o&&n("reader")}catch{}})(),(()=>{const e=document.getElementById("theme-toggle");e&&e.addEventListener("click",()=>n("nightOwl"))})(),document.querySelectorAll('a[href*="linkedin.com"], a[href*="github.com"]').forEach(e=>{e.addEventListener("click",()=>n("networker"))}),window.unlockAchievement=n},initKonamiCode=()=>{const e=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"];let t=0;const n=()=>{const e=["#ff6b6b","#4ecdc4","#45b7d1","#f9ca24","#f0932b","#eb4d4b","#6c5ce7","#a29bfe","#fd79a8","#e17055"];for(let t=0;t<50;t++){const t=document.createElement("div");t.className="confetti",t.style.left=100*Math.random()+"vw",t.style.backgroundColor=e[Math.floor(Math.random()*e.length)],t.style.animationDelay=3*Math.random()+"s",t.style.animationDuration=3*Math.random()+2+"s",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},5e3)}};document.addEventListener("keydown",o=>{o.key===e[t]?(t++,t===e.length&&(t=0,(()=>{window.dispatchEvent(new Event("konami-activated")),window.unlockAchievement&&window.unlockAchievement("konami");const e=getCurrentLanguage(),t=translations.konami[e],o=document.createElement("div");o.className="konami-modal",o.innerHTML=`\n            <div class="konami-content">\n                <div class="konami-header">\n                    <h2>${t.title}</h2>\n                    <button class="konami-close" aria-label="Close">&times;</button>\n                </div>\n                <div class="konami-body">\n                    <p class="konami-message">${t.message}</p>\n                    <div class="konami-gift">\n                        <div class="gift-emoji">ğŸ</div>\n                        <p class="gift-text">${t.giftText}</p>\n                        <div class="compliment-container" style="display: none;">\n                            <p class="compliment-text"></p>\n                        </div>\n                    </div>\n                    <div class="konami-stats">\n                        <p>${t.stats.replace("{percent}",Math.floor(10*Math.random())+1)}</p>\n                    </div>\n                </div>\n            </div>\n        `,document.body.appendChild(o),setTimeout(()=>o.classList.add("show"),100);const i=o.querySelector(".gift-emoji"),r=o.querySelector(".compliment-container"),a=o.querySelector(".compliment-text"),s=o.querySelector(".gift-text"),c=t.compliments;i.addEventListener("click",()=>{i.style.display="none",s.style.display="none";const e=c[Math.floor(Math.random()*c.length)];a.textContent=e,r.style.display="block",i.classList.add("gift-opened"),n(),setTimeout(()=>{r.classList.add("sparkle")},500)});const l=()=>{o.classList.remove("show"),setTimeout(()=>o.remove(),300)};o.querySelector(".konami-close").addEventListener("click",l),o.addEventListener("click",e=>{e.target===o&&l()})})())):t=0})},initPWA=()=>{if("serviceWorker"in navigator){let e=!!navigator.serviceWorker.controller,t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{e?t||(t=!0):e=!0}),window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{try{const t="sw_last_update_ts",n=Date.now(),o=parseInt(sessionStorage.getItem(t)||"0",10);(!Number.isFinite(o)||n-o>216e5)&&(sessionStorage.setItem(t,String(n)),e.update().catch(()=>{}))}catch(e){}}).catch(e=>{})})}let e;window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),e=t})},trackEventDebug=(e,t)=>{try{window.location.search.includes("debug-analytics=1")&&console.log("[Analytics Event]",e,t||null)}catch(e){}},initAnalytics=()=>{document.querySelectorAll('a[href*="contact"], button[type="submit"]').forEach(e=>{e.addEventListener("click",()=>{((e,t)=>{const n=`button_click_${t}`;trackEventDebug(n),"function"==typeof clarity&&clarity("event",n),"function"==typeof gtag&&gtag("event","button_click",{event_category:"engagement",event_label:t})})(0,e.textContent.trim().replace(/\s+/g,"_").toLowerCase())})}),document.querySelectorAll("nav a").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("href")||"unknown";trackEventDebug("navigation_click",{page:t}),"function"==typeof clarity&&clarity("event","navigation_click",{page:t}),"function"==typeof gtag&&gtag("event","navigation_click",{event_category:"navigation",event_label:t})})}),document.querySelectorAll('a[href*="linkedin.com"], a[href*="github.com"]').forEach(e=>{e.addEventListener("click",()=>{const t=e.href.includes("linkedin")?"linkedin":"github";trackEventDebug("social_click",{platform:t}),"function"==typeof clarity&&clarity("event","social_click",{platform:t}),"function"==typeof gtag&&gtag("event","social_click",{event_category:"social",event_label:t})})});const e=document.querySelector('form[action*="formspree.io"]');e&&e.addEventListener("submit",()=>{trackEventDebug("form_submission"),"function"==typeof clarity&&clarity("event","form_submission"),"function"==typeof gtag&&gtag("event","form_submission",{event_category:"engagement",event_label:"contact_form"})});let t=0,n={25:!1,50:!1,75:!1,100:!1};window.addEventListener("scroll",()=>{const e=Math.round((window.scrollY+window.innerHeight)/document.documentElement.scrollHeight*100);e>t&&(t=e,t>=25&&!n[25]&&(n[25]=!0,trackEventDebug("scroll_25_percent"),"function"==typeof clarity&&clarity("event","scroll_25_percent"),"function"==typeof gtag&&gtag("event","scroll",{event_category:"engagement",event_label:"25_percent"})),t>=50&&!n[50]&&(n[50]=!0,trackEventDebug("scroll_50_percent"),"function"==typeof clarity&&clarity("event","scroll_50_percent"),"function"==typeof gtag&&gtag("event","scroll",{event_category:"engagement",event_label:"50_percent"})),t>=75&&!n[75]&&(n[75]=!0,trackEventDebug("scroll_75_percent"),"function"==typeof clarity&&clarity("event","scroll_75_percent"),"function"==typeof gtag&&gtag("event","scroll",{event_category:"engagement",event_label:"75_percent"})),t>=100&&!n[100]&&(n[100]=!0,trackEventDebug("scroll_100_percent"),"function"==typeof clarity&&clarity("event","scroll_100_percent"),"function"==typeof gtag&&gtag("event","scroll",{event_category:"engagement",event_label:"100_percent"})))}),window.addEventListener("konami-activated",()=>{trackEventDebug("konami_code_activated"),"function"==typeof clarity&&clarity("event","konami_code_activated"),"function"==typeof gtag&&gtag("event","easter_egg",{event_category:"engagement",event_label:"konami_code"})});const o=window.unlockAchievement;o&&(window.unlockAchievement=(...e)=>{const t=e.length>1?e[1]:e[0];trackEventDebug("achievement_unlocked",{achievement:t}),"function"==typeof clarity&&clarity("event","achievement_unlocked",{achievement:t}),"function"==typeof gtag&&gtag("event","achievement_unlock",{event_category:"gamification",event_label:t}),o.apply(window,e)})},initPerformanceMonitoring=()=>{if("PerformanceObserver"in window)try{new PerformanceObserver(e=>{const t=e.getEntries(),n=t[t.length-1];"function"==typeof clarity&&clarity("set","lcp",Math.round(n.renderTime||n.loadTime));const o=n.renderTime||n.loadTime;o>2500&&console.warn("Poor LCP detected:",o,"ms")}).observe({type:"largest-contentful-paint",buffered:!0})}catch(e){}if("web-vital"in window){try{new PerformanceObserver(e=>{e.getEntries().forEach(e=>{const t=e.processingStart-e.startTime;"function"==typeof clarity&&clarity("set","fid",Math.round(t))})}).observe({type:"first-input",buffered:!0})}catch(e){}try{let e=0;new PerformanceObserver(t=>{for(const n of t.getEntries())n.hadRecentInput||(e+=n.value);"function"==typeof clarity&&clarity("set","cls",e.toFixed(4))}).observe({type:"layout-shift",buffered:!0})}catch(e){}}},initPhase2=()=>{document.body.addEventListener("click",e=>{const t=e.target.closest('a[href^="mailto:"]');if(!t)return;e.preventDefault();const n=t.href.replace("mailto:","").split("?")[0];navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(n).then(()=>{if(t.innerText||t.textContent){const e=t.innerText||t.textContent;t.innerText="Copied! âœ…",setTimeout(()=>{t.innerText=e},2e3)}}).catch(()=>{window.location.href=t.href}):window.location.href=t.href});try{const e=document.getElementById("copyright-year");e&&(e.textContent=String((new Date).getFullYear()))}catch(e){}try{const e=document.querySelector("footer p.text-xs");if(e){const t=(new Date).getFullYear();e.innerHTML=e.innerHTML.replace(/&copy;\s*\d{4}/,`&copy; ${t}`)}}catch(e){}const e=document.querySelector('form[action*="formspree"]');e&&e.addEventListener("submit",t=>{const n=e.querySelector('input[name="website_url"]');if(n&&n.value)return t.preventDefault(),!1})},__isEnglishChromePage=()=>{try{const e=document.documentElement&&document.documentElement.lang?document.documentElement.lang.toLowerCase():"en",t=window.location&&window.location.pathname?window.location.pathname:"/";return!t.startsWith("/es/")&&!t.startsWith("/ar/")&&"en"===e}catch(e){return!1}},__ensureStandardEnglishChrome=()=>{if(__isEnglishChromePage()){try{if(!!!document.querySelector("header #brand-logo, header #mobile-menu-toggle")){const e=document.createElement("header");e.className="fixed top-0 left-0 right-0 z-40 bg-beige/95 backdrop-blur-sm border-b border-chocolate/10",e.innerHTML='\n        <nav class="max-w-7xl mx-auto px-6 lg:px-12 py-6 flex items-center justify-between gap-2">\n            <a href="/index.html" id="brand-logo" class="text-lg sm:text-xl font-semibold text-indigodeep hover:text-chocolate transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded inline-flex items-center shrink min-w-0" aria-label="Go to Portfolio home page">\n                <img src="/assets/img/logo-ea.webp" alt="Estivan Ayramia logo" class="h-8 w-8 mr-2 object-contain shrink-0" width="300" height="264" fetchpriority="high">\n                <span translate="no" class="notranslate truncate">Estivan Ayramia</span>\n            </a>\n            \n            \x3c!-- Main Navigation --\x3e\n            <ul class="hidden md:flex items-center space-x-8">\n                <li><a href="/index.html" class="text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded" data-nav-key="home">Home</a></li>\n                <li><a href="/projects.html" class="text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded" data-nav-key="projects">Projects</a></li>\n                <li><a href="/overview.html" class="text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded" data-nav-key="overview">Overview</a></li>\n                <li><a href="/deep-dive.html" class="text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded" data-nav-key="deep-dive">Deep Dive</a></li>\n                <li><a href="/about.html" class="text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded" data-nav-key="about">About</a></li>\n                <li><a href="/contact.html" class="text-sm font-medium text-beige bg-indigodeep border border-white/20 px-5 py-2 rounded-full hover:bg-chocolate transition-colors dark:bg-indigodeep dark:text-beige dark:hover:bg-white dark:hover:text-indigodeep dark:border-white/20 focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige" data-nav-key="contact">Contact</a></li>\n            </ul>\n            \n            \x3c!-- Language Switcher --\x3e\n            <div id="lang-switcher" class="flex items-center space-x-3 shrink-0" style="z-index: 20;">\n                <a href="#" class="text-xs font-semibold text-indigodeep underline focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded" data-lang-key="en">EN</a>\n                <a href="/es/index.html" class="text-xs text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded">ES</a>\n                <a href="/ar/index.html" class="text-xs text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded">AR</a>\n            </div>\n            \n            \x3c!-- Dark Mode Toggle --\x3e\n            <button type="button" id="theme-toggle" class="text-base font-medium text-beige bg-indigodeep border border-white/20 px-5 py-2 rounded-full hover:bg-chocolate transition-colors dark:bg-indigodeep dark:text-beige dark:hover:bg-white dark:hover:text-indigodeep dark:border-white/20 focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige" aria-label="Switch to light mode"><span style="color: #e1d4c2">ğŸ”†</span></button>\n            \n            \x3c!-- Mobile Menu Toggle --\x3e\n            <button type="button" id="mobile-menu-toggle" class="md:hidden text-chocolate focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded p-2" aria-label="Toggle mobile menu" aria-expanded="false">\n                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>\n                </svg>\n            </button>\n        </nav>\n        \n        \x3c!-- Mobile Menu --\x3e\n        <div id="mobile-menu" class="hidden md:hidden border-t border-chocolate/10 bg-beige">\n            <ul class="px-6 py-4 space-y-3">\n                <li><a href="/index.html" class="block text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded py-2" data-nav-key="home">Home</a></li>\n                <li><a href="/projects.html" class="block text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded py-2" data-nav-key="projects">Projects</a></li>\n                <li><a href="/overview.html" class="block text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded py-2" data-nav-key="overview">Overview</a></li>\n                <li><a href="/deep-dive.html" class="block text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded py-2" data-nav-key="deep-dive">Deep Dive</a></li>\n                <li><a href="/about.html" class="block text-sm text-chocolate hover:text-indigodeep transition-colors focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige rounded py-2" data-nav-key="about">About</a></li>\n                <li><a href="/contact.html" class="block text-sm font-medium text-beige bg-indigodeep border border-white/20 px-5 py-2 rounded-full hover:bg-chocolate transition-colors text-center dark:bg-indigodeep dark:text-beige dark:hover:bg-white dark:hover:text-indigodeep dark:border-white/20 focus:outline-none focus:ring-2 focus:ring-indigodeep focus:ring-offset-2 focus:ring-offset-beige" data-nav-key="contact">Contact</a></li>\n            </ul>\n        </div>\n            ',document.body&&document.body.insertBefore(e,document.body.firstChild);!!document.querySelector("main.pt-24")||document.body&&document.body.classList&&document.body.classList.add("pt-24");try{const t=e.querySelector('[data-lang-key="en"]');if(t){const e=window.location.pathname||"/";t.href="/"===e?"/index.html":e}}catch(e){}}}catch(e){}try{if(!!!document.querySelector("footer.bg-indigodeep.text-beige.py-12")){const e=document.createElement("footer");e.className="bg-indigodeep text-beige py-12",e.innerHTML='\n        <div class="max-w-7xl mx-auto px-6 lg:px-12">\n            <div class="grid md:grid-cols-3 gap-12 mb-12">\n                <div class="space-y-4">\n                    <a href="/" class="flex items-center space-x-3 mb-4 hover:opacity-80 transition-opacity">\n                        <img src="/assets/img/logo-ea.webp" alt="Estivan Ayramia logo" class="h-12 w-12 object-contain" width="300" height="264">\n                        <h3 class="text-xl font-semibold text-white">Estivan Ayramia</h3>\n                    </a>\n                    <p class="text-sm text-beige/80 leading-relaxed">Chaldean from El Cajon. General Business graduate from SDSU. Building systems, working with people, and turning chaos into clean execution.</p>\n                </div>\n                <div class="space-y-4">\n                    <h3 class="text-sm font-semibold text-white uppercase tracking-wider">Quick Links</h3>\n                    <ul class="space-y-2">\n                        <li><a href="/overview.html" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">Overview</a></li>\n                        <li><a href="/deep-dive.html" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">Deep Dive</a></li>\n                        <li><a href="/projects/" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">Projects</a></li>\n                        <li><a href="/about.html" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">About</a></li>\n                    </ul>\n                </div>\n                <div class="space-y-4">\n                    <h3 class="text-sm font-semibold text-white uppercase tracking-wider">Connect</h3>\n                    <ul class="space-y-2">\n                        <li><a href="https://www.linkedin.com/in/estivanayramia" target="_blank" rel="noopener noreferrer" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">LinkedIn â†—</a></li>\n                        <li><a href="https://github.com/estivanayramia/" target="_blank" rel="noopener noreferrer" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">GitHub â†—</a></li>\n                        <li><a href="/contact.html" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">Contact</a></li>\n                        <li><a href="/assets/docs/Estivan-Ayramia-Resume.pdf" download="" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">Resume (PDF)</a></li>\n                        <li><a href="/privacy.html" class="text-sm text-beige/80 hover:text-white inline-block transition-all hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigodeep rounded">Privacy Policy</a></li>\n                    </ul>\n                </div>\n            </div>\n            <div class="border-t border-beige/20 pt-8 text-center">\n                <p class="text-sm text-beige/80">Â© <span id="copyright-year">2025</span> Estivan Ayramia. All rights reserved.</p>\n            </div>\n        </div>\n            ',document.body&&document.body.appendChild(e)}}catch(e){}}},__arcadeStorageKey="site_played_games_v1",__safeJsonParse=(e,t)=>{try{return JSON.parse(e)}catch(e){return t}},__getPlayedGames=()=>{try{const e=localStorage.getItem(__arcadeStorageKey),t=__safeJsonParse(e,{});return t&&"object"==typeof t?t:{}}catch(e){return{}}},__setPlayedGames=e=>{try{localStorage.setItem(__arcadeStorageKey,JSON.stringify(e||{}))}catch(e){}},__normalizePath=e=>{try{return(e||"/").replace(/\/+$/,"")||"/"}catch(e){return"/"}},__getCurrentGameId=()=>{try{const e=document.body&&document.body.getAttribute("data-arcade-achievements-filter");if(e&&/^mini_/.test(e))return e.replace(/^mini_/,"");if(e&&/^arcade_/.test(e))return e.replace(/^arcade_/,"");const t=__normalizePath(window.location.pathname||"/"),n=t.match(/^\/hobbies-games\/(.+)$/);if(n&&n[1])return n[1].replace(/\.html$/i,"");const o=t.split("/").pop()||"";return o.endsWith(".html")?o.replace(/\.html$/i,""):null}catch(e){return null}},__markGamePlayed=e=>{if(e)try{const t=__getPlayedGames();t[e]={lastPlayedAt:Date.now()},__setPlayedGames(t)}catch(e){}},__hashString=e=>{let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);return t>>>0},__mulberry32=e=>{let t=e>>>0;return function(){t+=1831565813;let e=Math.imul(t^t>>>15,1|t);return e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}},__shuffleInPlace=(e,t)=>{for(let n=e.length-1;n>0;n--){const o=Math.floor(t()*(n+1));[e[n],e[o]]=[e[o],e[n]]}return e},__GAME_CATALOG=[{id:"snake",href:"/snake.html",emoji:"ğŸ",title:"Snake",subtitle:"Classic growth game"},{id:"breaker",href:"/breaker.html",emoji:"ğŸ§±",title:"Block Breaker",subtitle:"Smash the bricks"},{id:"2048",href:"/2048.html",emoji:"ğŸ§©",title:"2048",subtitle:"Merge the numbers"},{id:"invaders",href:"/invaders.html",emoji:"ğŸ‘¾",title:"Space Invaders",subtitle:"Defend the earth"},{id:"racer",href:"/hobbies-games/racer.html",emoji:"ğŸï¸",title:"Racer",subtitle:"Fast reflex racing"},{id:"oh-flip",href:"/hobbies-games/oh-flip.html",emoji:"ğŸ¤¸",title:"Oh Flip",subtitle:"Timing + tricks"},{id:"onoff",href:"/hobbies-games/onoff.html",emoji:"âš¡",title:"ON/OFF",subtitle:"Switch-based puzzle"},{id:"1024-moves",href:"/hobbies-games/1024-moves.html",emoji:"ğŸ§ ",title:"1024 Moves",subtitle:"Move-limited strategy"},{id:"back-attacker",href:"/hobbies-games/back-attacker.html",emoji:"ğŸ›¡ï¸",title:"Back Attacker",subtitle:"Survive the attacks"},{id:"nano-wirebot",href:"/hobbies-games/nano-wirebot.html",emoji:"ğŸ¤–",title:"Nano Wirebot",subtitle:"Precision platforming"},{id:"off-the-line",href:"/hobbies-games/off-the-line.html",emoji:"ğŸ§·",title:"Off The Line",subtitle:"Donâ€™t cross the line"},{id:"pizza-undelivery",href:"/hobbies-games/pizza-undelivery.html",emoji:"ğŸ•",title:"Pizza Undelivery",subtitle:"Fast food chaos"},{id:"the-matr13k",href:"/hobbies-games/the-matr13k.html",emoji:"ğŸ§¬",title:"The Matr13k",subtitle:"Pattern puzzle"},{id:"triangle-back-to-home",href:"/hobbies-games/triangle-back-to-home.html",emoji:"ğŸ”º",title:"Triangle: Back to Home",subtitle:"Geometry adventure"},{id:"xx142-b2exe",href:"/hobbies-games/xx142-b2exe.html",emoji:"ğŸ§ª",title:"XX142-B2EXE",subtitle:"Experimental arcade"}],__renderSuggestionGrid=(e,t)=>{if(!e)return;const n=t&&t.count?t.count:6,o=t&&t.currentId?t.currentId:null,i=__getPlayedGames(),r=Date.now(),a=__GAME_CATALOG.filter(e=>e&&e.id&&e.href&&e.id!==o),s=a.filter(e=>!i[e.id]),c=a.filter(e=>!!i[e.id]),l=Math.floor(r/864e5),d=parseInt(sessionStorage.getItem("site_suggest_nonce")||"0",10)||0;sessionStorage.setItem("site_suggest_nonce",String(d+1));const u=1e3*l+d+__hashString(String(window.location.pathname||"/")),g=__mulberry32(u);__shuffleInPlace(s,g),c.sort((e,t)=>(i[e.id]&&i[e.id].lastPlayedAt?i[e.id].lastPlayedAt:0)-(i[t.id]&&i[t.id].lastPlayedAt?i[t.id].lastPlayedAt:0)),__shuffleInPlace(c,g);const m=[];for(const e of s){if(m.length>=n)break;m.push(e)}for(const e of c){if(m.length>=n)break;m.push(e)}e.innerHTML=m.map(e=>`\n        <a href="${e.href}" class="flex flex-col items-center p-4 bg-white/5 rounded-xl hover:bg-white/10 transition-all group border border-white/5 hover:border-white/20" data-game-id="${e.id}">\n            <div class="text-4xl mb-3 group-hover:scale-110 transition-transform">${e.emoji||"ğŸ®"}</div>\n            <div class="font-bold text-sm">${e.title||e.id}</div>\n            <div class="text-xs opacity-60 mt-1">${e.subtitle||""}</div>\n        </a>\n    `).join("")},__initDynamicGameSuggestions=()=>{try{const e=__getCurrentGameId();e&&__markGamePlayed(e);const t=new Set;document.querySelectorAll('a[class*="bg-white/5"][class*="rounded-xl"][class*="hover:bg-white/10"]').forEach(e=>{const n=e.closest(".grid");n&&t.add(n)}),t.forEach(t=>{const n=t.querySelectorAll("a");!n||n.length<4||__renderSuggestionGrid(t,{count:6,currentId:e})})}catch(e){}},init=()=>{console.log("%c Designed by Estivan Ayramia ","background: #212842; color: #e1d4c2; padding: 4px; border-radius: 4px;"),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{__ensureStandardEnglishChrome(),initDarkMode(),initAriaCurrent(),initMobileMenu(),__initDynamicGameSuggestions(),loadGSAPAndInit(),initSmoothScroll(),initFormValidation(),initLazyLoading(),initScrollToTop(),initPdfPreviews(),initAchievements(),initKonamiCode(),initPWA(),initAnalytics(),initPerformanceMonitoring(),initPhase2()}):(__ensureStandardEnglishChrome(),initDarkMode(),initAriaCurrent(),initMobileMenu(),__initDynamicGameSuggestions(),loadGSAPAndInit(),initSmoothScroll(),initFormValidation(),initLazyLoading(),initScrollToTop(),initPdfPreviews(),initAchievements(),initKonamiCode(),initPWA(),initAnalytics(),initPerformanceMonitoring(),initPhase2())};init(),document.addEventListener("DOMContentLoaded",()=>{const e="/assets/docs/Estivan-Ayramia-Resume.pdf",t="https://www.linkedin.com/in/estivanayramia",n={logistics:{title:"Logistics System",summary:"A systems-focused project centered on execution, coordination, and operational clarity.",img:"/assets/img/project-logistics.jpg",link:"/projects/logistics"},conflict:{title:"Conflict Playbook",summary:"A practical framework for navigating conflict with structure, empathy, and outcomes.",img:"/assets/img/project-conflict.jpg",link:"/deep-dive#conflict"},discipline:{title:"Discipline Routine",summary:"A repeatable routine and mindset system for sustainable discipline and follow-through.",img:"/assets/img/project-discipline.jpg",link:"/projects/discipline"},website:{title:"Portfolio Website",summary:"The site you are on, built for speed, clarity, and a clean browsing experience.",img:"/assets/img/og-image.png",link:"/"}},o={widget:document.getElementById("chat-widget"),window:document.getElementById("chat-window"),header:document.getElementById("chat-header"),messages:document.getElementById("chat-messages"),input:document.getElementById("chat-input"),sendBtn:document.getElementById("send-btn"),toggleBtn:document.getElementById("chat-toggle"),closeBtn:document.getElementById("close-chat"),bubble:document.getElementById("welcome-bubble"),chipsContainer:document.getElementById("chat-chips"),suggestionsBtn:document.getElementById("suggestions-btn"),suggestionsContainer:document.querySelector('[data-chat-suggestions="container"]'),suggestionsToggle:document.querySelector('[data-chat-suggestions-toggle="button"]'),suggestionsClose:null};!function(){try{if(window.CSS&&CSS.supports&&CSS.supports("animation-timeline","scroll()"))return}catch(e){}const e=document.querySelector(".scroll-progress");if(!e)return;let t=!1;function n(){const n=document.documentElement,o=window.scrollY||n.scrollTop||0,i=Math.max((n.scrollHeight||document.body.scrollHeight||0)-window.innerHeight,0),r=i>0?Math.min(1,Math.max(0,o/i)):0;e.style.setProperty("--scroll-scale",r),t=!1}const o=function(){t||(t=!0,requestAnimationFrame(n))};window.addEventListener("scroll",o,{passive:!0}),window.addEventListener("resize",o,{passive:!0}),requestAnimationFrame(n)}();const i=document.documentElement.lang||"en";"ar"===i&&o.widget?(o.widget.style.left="1rem",o.widget.style.right="auto",o.bubble&&(o.bubble.style.left="1rem",o.bubble.style.right="auto")):o.widget&&(o.widget.style.right="1rem",o.widget.style.left="auto",o.bubble&&(o.bubble.style.right="1rem",o.bubble.style.left="auto"));let r=[],a=!1,s=null,c=!1;const l=`savonie_history:v1:${i||"en"}`;function d(){try{const e=[],t=window.location.pathname||"/";e.push(`path: ${t}`),e.push(`title: ${document.title||""}`);const n=Array.from(document.querySelectorAll("h1, h2")).map(e=>(e.textContent||"").trim()).filter(Boolean).slice(0,10);n.length&&(e.push("headings:"),n.forEach(t=>e.push(`- ${t}`)));const o=e.join("\n");return o.length>3500?o.slice(0,3500):o}catch(e){return`${window.location.pathname||"/"} | ${document.title||""}`}}try{const e=sessionStorage.getItem(l);e&&(r=JSON.parse(e),r.forEach(e=>{if(e&&"card"===e.kind)return void k(e.cardId);if(!e||"text"!==e.kind)return;const t=document.createElement("div");t.className="p-3 rounded-lg shadow-sm max-w-[85%] mb-3 text-sm leading-relaxed "+("user"===e.sender?"bg-[#212842] text-white rounded-tr-none self-end ml-auto":"bg-white text-[#362017] rounded-tl-none border border-[#362017]/5 self-start"),"bot"===e.sender?t.replaceChildren(y(e.text)):t.textContent=e.text,o.messages?.appendChild(t)}),setTimeout(()=>{o.messages&&(o.messages.scrollTop=o.messages.scrollHeight)},100))}catch(e){}if(0===r.length){const e=document.documentElement.lang||"en";x(translations.chat.welcome[e]||"Hello! I am Savonie. Ask me anything about Estivan.","bot",!1)}if(o.chipsContainer){const e=document.documentElement.lang||"en";b(translations.chat.defaultChips[e]||translations.chat.defaultChips.en)}c=!0;const u=parseInt(sessionStorage.getItem("savonie_bubble_count")||"0");function g(e){o.suggestionsContainer?(e?(o.suggestionsContainer.classList.remove("savonie-suggestions-hidden"),o.suggestionsContainer.removeAttribute("hidden"),o.suggestionsContainer.style.display="flex"):(o.suggestionsContainer.classList.add("savonie-suggestions-hidden"),o.suggestionsContainer.setAttribute("hidden","true"),o.suggestionsContainer.style.display="none"),console.log("[Savonie DEBUG] setSuggestionsVisible ->",e,"classes:",o.suggestionsContainer.className)):console.log("[Savonie DEBUG] setSuggestionsVisible called but no suggestions container")}u<2&&setTimeout(()=>{o.window?.classList.contains("hidden")&&0===r.length&&(o.bubble?.classList.remove("opacity-0","translate-y-4"),o.bubble?.classList.add("opacity-100","translate-y-0"),sessionStorage.setItem("savonie_bubble_count",(u+1).toString()))},2500),o.toggleBtn?.addEventListener("click",v),o.closeBtn?.addEventListener("click",v),o.sendBtn?.addEventListener("click",w),o.input?.addEventListener("keydown",e=>{if("Enter"!==e.key)return;e.target&&"TEXTAREA"===e.target.tagName&&e.shiftKey||(e.preventDefault(),w())}),o.suggestionsContainer?(o.suggestionsToggle?o.suggestionsToggle.addEventListener("click",()=>{const e=o.suggestionsContainer.classList.contains("savonie-suggestions-hidden")||o.suggestionsContainer.hasAttribute("hidden")||"none"===o.suggestionsContainer.style.display;console.log("[Savonie DEBUG] Lightbulb clicked, nextVisible =",e),g(e)}):console.log("[Savonie DEBUG] No suggestions toggle (lightbulb) found"),console.log("[Savonie DEBUG] attachSuggestionHandlers complete")):console.log("[Savonie DEBUG] No suggestions container found on this page"),o.chipsContainer&&o.chipsContainer.querySelectorAll(".chip-btn").forEach(e=>{e.addEventListener("click",()=>{o.input&&(o.input.value=e.textContent,w())})});const m=document.getElementById("mic-btn");let h=null,p=!1;if(m&&("webkitSpeechRecognition"in window||"SpeechRecognition"in window)){const e=window.SpeechRecognition||window.webkitSpeechRecognition;h=new e,h.continuous=!1,h.interimResults=!1,h.lang=document.documentElement.lang||"en-US",h.onstart=()=>{p=!0,m.classList.add("listening"),m.setAttribute("aria-label","Listening...")},h.onend=()=>{p=!1,m.classList.remove("listening"),m.setAttribute("aria-label","Voice input")},h.onresult=e=>{const t=e.results[0][0].transcript;if(o.input&&t){o.input.value=t;try{o.input.focus({preventScroll:!0})}catch(e){o.input.focus()}}},h.onerror=e=>{console.warn("Speech recognition error:",e.error),p=!1,m.classList.remove("listening")},m.addEventListener("click",()=>{p?h.stop():h.start()})}else m&&(m.style.display="none");function f(e){const t=document.createDocumentFragment();if(!e)return t;const n=e=>{try{const t=String(e).trim();if(t.startsWith("/"))return t;const n=new URL(t);return"http:"!==n.protocol&&"https:"!==n.protocol?null:n.toString()}catch(e){return null}},o=(e,t)=>{const n=document.createElement("a");n.href=e;const o=e.startsWith("/");return n.target=o?"_self":"_blank",o||(n.rel="noopener noreferrer"),n.className="text-[#212842] underline hover:text-[#362017] font-medium",n.textContent=t,n},i=(e,t)=>{const i=/\[([^\]]+)\]\(([^)\s]+)\)|\bhttps?:\/\/[^\s<]+/g,r=String(t);let a,s=0;for(;null!==(a=i.exec(r));){if(a.index>s&&e.appendChild(document.createTextNode(r.slice(s,a.index))),a[1]&&a[2]){const t=n(a[2]);t?e.appendChild(o(t,a[1])):e.appendChild(document.createTextNode(a[0]))}else{const t=n(a[0]);t?e.appendChild(o(t,a[0])):e.appendChild(document.createTextNode(a[0]))}s=i.lastIndex}s<r.length&&e.appendChild(document.createTextNode(r.slice(s)))},r=String(e).split(/\n/);for(let e=0;e<r.length;e++)i(t,r[e]),e<r.length-1&&t.appendChild(document.createElement("br"));return t}function y(e){const t=String(e||""),n="undefined"!=typeof window&&window.marked&&"function"==typeof window.marked.parse?window.marked:null;if(!n)return f(t);const o=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");try{return function(e){const t=document.createElement("template");t.innerHTML=String(e||"");const n=new Set(["P","BR","STRONG","EM","CODE","PRE","UL","OL","LI","A","BLOCKQUOTE"]),o=e=>{if(!e)return null;const t=String(e).trim();if(t.startsWith("/"))return t;try{const e=new URL(t);return"http:"===e.protocol||"https:"===e.protocol?e.toString():null}catch(e){return null}},i=e=>{const t=Array.from(e.childNodes);for(const e of t)if(e.nodeType===Node.ELEMENT_NODE){const t=e,r=t.tagName,a="A"===r?t.getAttribute("href"):null;if(!n.has(r)){const e=document.createTextNode(t.textContent||"");t.replaceWith(e);continue}const s=Array.from(t.attributes);for(const e of s)t.removeAttribute(e.name);if("A"===r){const e=o(a);if(!e){const e=document.createTextNode(t.textContent||"");t.replaceWith(e);continue}t.setAttribute("href",e),e.startsWith("/")?t.setAttribute("target","_self"):(t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer")),t.className="text-[#212842] underline hover:text-[#362017] font-medium"}i(t)}};return i(t.content),t.content}(n.parse(o))}catch(e){return f(t)}}function b(n){if(!o.chipsContainer)return;if(o.chipsContainer.innerHTML="",!n||0===n.length)return void g(!1);const i=["Projects","View Projects","Projects & Case Studies","View projects"],r=["Resume","Download Resume","View Resume","Get resume"],a=["Contact","Email","Email Estivan","Contact Estivan"],c=["LinkedIn","Open LinkedIn"];n.forEach(n=>{const l=document.createElement("button");l.className="chip-btn text-xs bg-white border border-[#212842]/20 text-[#212842] px-3 py-1 rounded-full hover:bg-[#212842] hover:text-white transition-colors",l.textContent=n,l.addEventListener("click",()=>{if(i.includes(n))window.location.href="/projects.html";else if(r.includes(n))try{window.open(e,"_blank","noopener")}catch(e){}else if(a.includes(n))window.location.href="/contact.html";else if(c.includes(n))try{window.open(t,"_blank","noopener")}catch(e){}else"Continue reading..."!==n?o.input&&(o.input.value=n,w()):w("Continue",s)}),o.chipsContainer.appendChild(l)});const l=document.createElement("button");l.className="chip-close-btn text-xs text-[#362017]/60 hover:text-[#362017] px-2 py-1 ml-2 transition-colors",l.setAttribute("data-chat-suggestions-close","button"),l.innerHTML="Ã—",l.title="Hide suggestions",l.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),console.log("[Savonie DEBUG] Suggestions close X clicked, hiding suggestions"),g(!1)}),o.chipsContainer.appendChild(l),o.suggestionsClose=l,g(!0)}function v(){const e=o.window?.classList.contains("hidden");document.documentElement.dir;if(e?(o.window?.classList.remove("hidden"),o.window?.classList.add("flex"),"function"==typeof clarity&&clarity("event","chat_open"),"function"==typeof gtag&&gtag("event","chat_open",{event_category:"Chatbot"})):(o.window?.classList.remove("flex"),o.window?.classList.add("hidden"),"function"==typeof clarity&&clarity("event","chat_close"),"function"==typeof gtag&&gtag("event","chat_close",{event_category:"Chatbot"})),!o.window?.classList.contains("hidden")){if(e){const e=o.widget?.getBoundingClientRect();if(e){const t=20,n=31.25,i=1;let r=e.left/16,a=e.top/16-n-i;r+t>window.innerWidth/16&&(r=window.innerWidth/16-t-i),r<i&&(r=i),a<i&&(a=i),o.window.style.position="fixed",o.window.style.left=`${r}rem`,o.window.style.top=`${a}rem`,o.window.style.right="auto",o.window.style.zIndex="10000"}else o.window.style.position="",o.window.style.left="",o.window.style.top="",o.window.style.right="",o.window.style.zIndex=""}o.bubble&&(o.bubble.style.display="none"),setTimeout(()=>{try{o.input?.focus({preventScroll:!0})}catch(e){o.input?.focus&&o.input.focus()}o.messages&&(o.messages.scrollTop=o.messages.scrollHeight)},100)}}async function w(n=null,c=null){if(!o.input)return;const l="string"==typeof n?n:o.input.value.trim();if(!l||a)return;a=!0,"function"==typeof gtag&&gtag("event","chat_question",{event_category:"Chatbot",event_label:"User Asked Question"}),"function"==typeof clarity&&clarity("event","chat_question");if(!await async function(){if(navigator.onLine)return!0;try{const e=new AbortController,t=setTimeout(()=>e.abort(),3e3),n=await fetch("/favicon.ico",{method:"HEAD",cache:"no-cache",signal:e.signal});return clearTimeout(t),n.ok}catch(e){return!1}}())return x(l,"user"),n||(o.input.value=""),x("You appear to be offline. Please check your connection and try again.","bot"),void(a=!1);x(l,"user"),n||(o.input.value="");const u=x("Thinking...","bot",!0);let g=null,m=null;for(let e=0;e<=2;e++){const t=new AbortController,n=setTimeout(()=>t.abort(),3e4);try{const o=await fetch("https://portfolio-chat.eayramia.workers.dev/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:l,pageContent:d(),language:i,previousContext:c||null}),signal:t.signal});if(clearTimeout(n),console.log("[Chat Debug] Fetch completed. Status:",o.status,"OK:",o.ok),!o.ok){try{const e=await o.json();if(e&&e.errorType){m=e,g=null;break}}catch(e){}if(!(o.status>=500||503===o.status||504===o.status)){if(429===o.status){g={type:"rate_limit"};break}g={type:"client",status:o.status};break}if(g={type:"server",status:o.status},e<2){await new Promise(t=>setTimeout(t,1e3*(e+1)));continue}}m=await o.json(),console.log("[Chat Debug] Response parsed successfully:",m),g=null;break}catch(t){if(clearTimeout(n),"AbortError"===t.name){if(g={type:"timeout"},e<2)continue}else if(g={type:"network",message:t.message},e<2){await new Promise(t=>setTimeout(t,1e3*(e+1)));continue}}}if(g){let e;switch(_(u),g.type){case"timeout":e="The request took too long. The AI service might be busy. Please try again in a moment.";break;case"rate_limit":e="Too many requests. Please wait a moment before sending another message.";break;case"server":e="The AI service is temporarily unavailable. Please try again in a few seconds.";break;case"network":e="Connection lost. Please check your internet connection and try again.";break;default:e="Something went wrong. Please try again."}return x(e,"bot"),void(a=!1)}if(_(u),console.log("[Chat Debug] Processing response. Data structure:",{hasData:!!m,hasErrorType:!(!m||!m.errorType),hasReply:!(!m||!m.reply)}),m&&m.errorType){let e="Something went wrong. Please try again.",t=!1,n=0;if("RateLimit"===m.errorType?e="Too many requests. Please wait a moment before trying again.":"BadRequest"===m.errorType?e="Please rephrase your question and try again.":"UpstreamError"===m.errorType?e="The AI service is temporarily unavailable. Please try again in a moment.":"UpstreamBusy"===m.errorType?(e="The AI service is experiencing high demand. Retrying automatically in 30 seconds...",t=!0,n=3e4):"AuthError"===m.errorType?e="The AI service is having configuration issues. Please try again later or explore projects directly.":"Timeout"===m.errorType?e="The request timed out. Please try again with a shorter question.":"OfflineMode"===m.errorType&&(e=null),e&&x(e,"bot"),"OfflineMode"!==m.errorType)return m.chips&&Array.isArray(m.chips)&&o.chipsContainer&&b(m.chips),t&&setTimeout(()=>{w(l,c)},n),void(a=!1)}if(console.log("[Chat Debug] About to check reply. data.reply exists:",!!m.reply,"Value:",m.reply?m.reply.substring(0,100)+"...":"undefined"),m.reply&&(m.reply=m.reply.replace(/\n?\s*\{\s*"(reply|chips|action|card|errorType)"[\s\S]*$/,"").trim(),x(m.reply,"bot")),m.truncated&&(m.continuation_hint||m.reply)?(s=m.continuation_hint||m.reply.slice(-800),m.chips||(m.chips=[]),m.chips=m.chips.filter(e=>"Continue reading..."!==e),m.chips.unshift("Continue reading...")):s=null,m.chips&&Array.isArray(m.chips)&&o.chipsContainer&&b(m.chips),m.action)if("download_resume"===m.action)try{window.open(e,"_blank","noopener")}catch(t){const n=document.createElement("a");n.href=e,n.target="_blank",n.rel="noopener noreferrer",n.download="Estivan-Ayramia-Resume.pdf",n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}else if("email_link"===m.action)window.location.href="mailto:hello@estivanayramia.com";else if("open_linkedin"===m.action)try{window.open(t,"_blank","noopener")}catch(e){}if(m.card&&k(m.card),!m.chips&&r.length>0){const e=function(e){const t=[],n=[...e].reverse().find(e=>"user"===e.sender)?.text?.toLowerCase()||"",o=[...e].reverse().find(e=>"bot"===e.sender)?.text?.toLowerCase()||"",i=function(e){return e?/[\u0600-\u06FF]/.test(e)?"ar":/\b(quÃ©|como|dÃ³nde|cuÃ¡ndo|por quÃ©|estÃ¡|son|tiene|trabajo|habilidades?|experiencia|proyecto|contacto)\b/i.test(e)?"es":"en":"en"}(n),r=translations.chat.contextualSuggestions;return n.includes("skill")||n.includes("technology")||n.includes("expertise")||n.includes("habilidad")||n.includes("tecnologÃ­a")||n.includes("experiencia")||n.includes("Ù…Ù‡Ø§Ø±Ø©")||n.includes("ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§")||n.includes("Ø®Ø¨Ø±Ø©")?t.push(...r[i]?.skills||["What projects have you worked on?","Tell me about your experience","What are you learning currently?"]):n.includes("background")||n.includes("experience")||n.includes("career")||n.includes("fondo")||n.includes("experiencia")||n.includes("carrera")||n.includes("Ø®Ù„ÙÙŠØ©")||n.includes("Ø®Ø¨Ø±Ø©")||n.includes("Ù…Ø³ÙŠØ±Ø©")?t.push(...r[i]?.background||["What are your main skills?","Tell me about your education","What industries have you worked in?"]):n.includes("project")||n.includes("work")||n.includes("portfolio")||n.includes("proyecto")||n.includes("trabajo")||n.includes("portafolio")||n.includes("Ù…Ø´Ø±ÙˆØ¹")||n.includes("Ø¹Ù…Ù„")||n.includes("Ù…Ø­ÙØ¸Ø©")?t.push(...r[i]?.projects||["Can you show me your code?","What technologies did you use?","How long did it take to build?"]):n.includes("contact")||n.includes("reach")||n.includes("email")||n.includes("contacto")||n.includes("alcanzar")||n.includes("correo")||n.includes("Ø§ØªØµØ§Ù„")||n.includes("Ø§Ù„ÙˆØµÙˆÙ„")||n.includes("Ø¨Ø±ÙŠØ¯")?t.push(...r[i]?.contact||["Are you available for freelance work?","What's your typical response time?","Do you work remotely?"]):n.includes("education")||n.includes("study")||n.includes("learn")||n.includes("educaciÃ³n")||n.includes("estudio")||n.includes("aprender")||n.includes("ØªØ¹Ù„ÙŠÙ…")||n.includes("Ø¯Ø±Ø§Ø³Ø©")||n.includes("ØªØ¹Ù„Ù…")?t.push(...r[i]?.education||["What certifications do you have?","What's your favorite programming language?","How do you stay updated with technology?"]):o.includes("project")||o.includes("work")||o.includes("proyecto")||o.includes("trabajo")||o.includes("Ù…Ø´Ø±ÙˆØ¹")||o.includes("Ø¹Ù…Ù„")?t.push(...r[i]?.projectResponse||["Can you tell me more about that project?","What challenges did you face?","What did you learn from it?"]):o.includes("skill")||o.includes("technology")||o.includes("habilidad")||o.includes("tecnologÃ­a")||o.includes("Ù…Ù‡Ø§Ø±Ø©")||o.includes("ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§")?t.push(...r[i]?.skillResponse||["How did you learn that?","Have you used it in projects?","What's your proficiency level?"]):e.length<4&&t.push(...r[i]?.early||["What are your main skills?","Tell me about your background","What projects are you proud of?"]),t.slice(0,3)}(r);e.length>0&&o.chipsContainer&&b(e)}a=!1}function x(e,t,n=!1){if(!o.messages)return;const i=document.createElement("div");i.id=n?"loading-msg":"";if(i.className="p-3 rounded-lg shadow-sm max-w-[70%] mb-3 text-sm leading-relaxed "+("user"===t?"bg-[#212842] text-white rounded-tr-none self-end ml-auto":"bg-white text-[#362017] rounded-tl-none border border-[#362017]/5 self-start"),o.messages.appendChild(i),"bot"!==t||n)"bot"===t?i.replaceChildren(y(e)):i.textContent=e;else{let t=0;i.textContent="";const n=setInterval(()=>{t<e.length?(i.textContent+=e[t],t++,o.messages.scrollTop=o.messages.scrollHeight):(clearInterval(n),i.replaceChildren(y(e)),o.messages.scrollTop=o.messages.scrollHeight)},12)}return!n&&c&&(r.push({kind:"text",text:e,sender:t}),r.length>50&&(r=r.slice(r.length-50)),sessionStorage.setItem(l,JSON.stringify(r))),o.messages.scrollTop=o.messages.scrollHeight,i.id}function k(e){if(!o.messages||!n[e])return;const t=n[e],i=document.createElement("div");i.className="bg-white rounded-lg shadow-md overflow-hidden border border-[#362017]/10 mb-3 max-w-[85%] self-start";const a=document.createElement("div");a.className="p-3";const s=document.createElement("h4");s.className="font-semibold text-[#212842] mb-1",s.textContent=t.title;const d=document.createElement("p");d.className="text-xs text-[#362017]/80 mb-3 leading-relaxed",d.textContent=t.summary||"";const u=document.createElement("a");if(u.href=t.link,u.className="inline-block bg-[#212842] text-white px-4 py-2 rounded-lg text-sm hover:bg-[#362017] transition-colors",u.textContent="View",a.appendChild(s),t.summary&&a.appendChild(d),a.appendChild(u),t.img){const e=document.createElement("img");e.src=t.img,e.alt=t.title,e.className="w-full h-32 object-cover",e.addEventListener("error",()=>{try{e.remove()}catch(e){}}),i.appendChild(e)}i.appendChild(a),o.messages.appendChild(i),o.messages.scrollTop=o.messages.scrollHeight,c&&(r.push({kind:"card",cardId:e}),r.length>50&&(r=r.slice(r.length-50)),sessionStorage.setItem(l,JSON.stringify(r)))}function _(e){const t=document.getElementById(e);t&&t.remove()}if(window.__savonieXssSelfTest=function(){const e=["<img src=x onerror=alert(1)>","[bad](javascript:alert(1))","[ok](https://example.com)","https://example.com/test?x=<script>alert(1)<\/script>","Line 1\nLine 2 with https://example.com"].map(e=>{const t=document.createElement("div");return t.appendChild(f(e)),t.innerHTML});return console.log("[Savonie] XSS self-test rendered HTML:",e),e},o.header&&o.window){let e,t,n,i,r=!1;const a="rtl"===document.documentElement.dir;o.header.style.cursor="move",o.header.addEventListener("mousedown",s=>{if(s.target.closest("#close-chat"))return;r=!0,e=s.clientX,t=s.clientY;const c=o.window.getBoundingClientRect();if(n=c.left,i=c.top,o.header.style.cursor="grabbing",document.body.style.userSelect="none","fixed"!==o.window.style.position){if(o.window.style.position="fixed",a){const e=window.innerWidth-c.right;o.window.style.right=`${e}px`,o.window.style.left="auto"}else o.window.style.left=`${n}px`;o.window.style.top=`${i}px`,o.window.style.zIndex="10000"}}),document.addEventListener("mousemove",s=>{if(!r)return;s.preventDefault();const c=s.clientX-e,l=s.clientY-t,d=o.window.offsetWidth,u=o.window.offsetHeight,g=10;if(a){let e=window.innerWidth-n-d-c;e=Math.max(g,Math.min(e,window.innerWidth-d-g)),o.window.style.right=`${e}px`,o.window.style.left="auto"}else{let e=n+c;e=Math.max(g,Math.min(e,window.innerWidth-d-g)),o.window.style.left=`${e}px`,o.window.style.right="auto"}let m=i+l;m=Math.max(g,Math.min(m,window.innerHeight-u-g)),o.window.style.top=`${m}px`}),document.addEventListener("mouseup",()=>{r&&(r=!1,o.header.style.cursor="move",document.body.style.userSelect="")})}document.addEventListener("keydown",e=>{"Escape"!==e.key||o.window?.classList.contains("hidden")||v(),(e.ctrlKey||e.metaKey)&&"k"===e.key&&(e.preventDefault(),v())})}),document.addEventListener("DOMContentLoaded",()=>{const e=(e,t)=>{if(!e||!t)return;if(e.dataset.pdfLoaded)return;e.innerHTML="";const n=document.createElement("div");n.className="py-12 text-sm text-chocolate/60",n.textContent="Attempting to load inline previewâ€¦",e.appendChild(n);const o=document.createElement("iframe");o.src=t,o.title="PDF preview",o.style.width="100%",o.style.height="480px",o.style.border="0",o.loading="lazy";let i=!1;const r=setTimeout(()=>{i=!0,console.log("PDF load timeout - assuming success");try{n.remove()}catch(e){}e.contains(o)||e.appendChild(o),e.dataset.pdfLoaded="true"},5e3),a=()=>{clearTimeout(r);try{o.remove()}catch(e){}e.innerHTML="",e.appendChild((()=>{const e=document.createElement("div");e.className="rounded-xl border border-chocolate/20 bg-white/40 overflow-hidden p-8 text-center";const t=document.createElement("p");return t.className="text-sm text-chocolate/70",t.textContent="Inline PDF preview may be blocked by hosting or browser settings. Use the buttons below to open or download the deck.",e.appendChild(t),e})()),e.dataset.pdfLoaded="false"};o.addEventListener("load",()=>{clearTimeout(r);try{try{n.remove()}catch(e){}e.contains(o)||e.appendChild(o),e.dataset.pdfLoaded="true"}catch(e){a()}}),o.addEventListener("error",a),e.appendChild(o)};document.querySelectorAll(".preview-toggle").forEach(t=>{const n=t.closest("section"),o=n&&n.querySelector(".preview-panel");let i=null;n&&(i=n.querySelector('a[href$=".pdf"]')||n.querySelector('a[href*=".pdf?"]'));const r=i?i.getAttribute("href"):null;o&&r&&e(o,r),t.addEventListener("click",()=>{if(!o)return;o.classList.toggle("hidden");const n=!o.classList.contains("hidden");t.textContent=n?"Hide preview":"Show preview","function"==typeof clarity&&clarity("event",n?"pdf_preview_show":"pdf_preview_hide"),"function"==typeof gtag&&gtag("event",n?"pdf_preview_show":"pdf_preview_hide",{event_category:"PDF"}),n&&!o.dataset.pdfLoaded&&r&&e(o,r)})})});