function x(d,t,e){let s=Number(d),r=Number(t),i=Number(e);return Number.isFinite(s)?Math.max(r,Math.min(i,s)):r}function y(d,t){let e=null;return function(...r){e&&clearTimeout(e),e=setTimeout(()=>{e=null,d.apply(this,r)},Math.max(0,Number(t)||0))}}function m(d){try{return window.matchMedia?window.matchMedia(String(d)):{matches:!1}}catch(t){return{matches:!1}}}function f(){return m("(prefers-reduced-motion: reduce)").matches}var u={visibleCards:5,perspective:1600,rotationSpeed:320,settleEase:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",dragThreshold:10},g=class{constructor(t,e={}){this.element=t,this.options={...u,...e},this.viewport=t.querySelector(".coverflow-viewport"),this.track=t.querySelector(".coverflow-track"),this.originalCards=Array.from(t.querySelectorAll(".coverflow-card")),this.prevBtn=t.querySelector(".coverflow-btn--prev"),this.nextBtn=t.querySelector(".coverflow-btn--next"),this.statusEl=t.querySelector('[role="status"]'),this.setSize=this.originalCards.length,this.totalCards=this.setSize*3,this.currentIndex=this.setSize,this.virtualIndex=this.currentIndex,this.cards=[],this.isDragging=!1,this.dragStartX=0,this.dragCurrentX=0,this.dragStartIndex=this.currentIndex,this.pointerId=null,this.rafId=null,this.cardWidth=320,this.stepSize=280,this.onResize=y(()=>{this.measure(),this.render(0)},150),this.init()}init(){!this.viewport||!this.track||this.setSize===0||(this.element.hasAttribute("tabindex")||(this.element.tabIndex=0),this.buildTrack(),this.measure(),this.bindEvents(),this.virtualIndex=this.currentIndex,this.render(0),this.element.classList.add("coverflow-ready"))}buildTrack(){if(this.track){this.track.innerHTML="";for(let t=0;t<3;t++)for(let e=0;e<this.originalCards.length;e++){let r=this.originalCards[e].cloneNode(!0),i=t*this.originalCards.length+e;r.dataset.index=String(i),this.track.appendChild(r)}this.cards=Array.from(this.track.querySelectorAll(".coverflow-card"))}}bindEvents(){this.viewport&&(this.prevBtn&&this.prevBtn.addEventListener("click",()=>this.prev()),this.nextBtn&&this.nextBtn.addEventListener("click",()=>this.next()),this.element.addEventListener("keydown",t=>this.handleKeyboard(t)),this.viewport.addEventListener("pointerdown",t=>this.handleDragStart(t)),this.viewport.addEventListener("pointermove",t=>this.handleDragMove(t)),this.viewport.addEventListener("pointerup",t=>this.handleDragEnd(t)),this.viewport.addEventListener("pointercancel",t=>this.handleDragEnd(t)),this.viewport.addEventListener("click",t=>this.handleClick(t)),window.addEventListener("resize",this.onResize))}measure(){if(!this.track)return;let t=this.track.querySelector(".coverflow-card");if(!t)return;let e=t.getBoundingClientRect();e&&Number.isFinite(e.width)&&e.width>0&&(this.cardWidth=e.width,this.stepSize=Math.max(220,Math.min(420,e.width*.72))),this.viewport&&(this.viewport.style.perspective=`${Math.max(600,Number(this.options.perspective)||u.perspective)}px`)}handleKeyboard(t){if(t.key==="ArrowLeft"){t.preventDefault(),this.prev();return}if(t.key==="ArrowRight"){t.preventDefault(),this.next();return}if(t.key==="Home"){t.preventDefault(),this.goTo(this.setSize,!0);return}t.key==="End"&&(t.preventDefault(),this.goTo(this.setSize+this.setSize-1,!0))}handleDragStart(t){if(this.viewport&&!(t.pointerType==="mouse"&&t.button!==0)){this.pointerId=t.pointerId,this.isDragging=!0,this.dragStartX=t.clientX,this.dragCurrentX=t.clientX,this.dragStartIndex=this.currentIndex,this.virtualIndex=this.currentIndex;try{this.viewport.setPointerCapture(t.pointerId)}catch(e){}this.viewport.style.cursor="grabbing",this.render(0)}}handleDragMove(t){this.isDragging&&(this.pointerId!==null&&t.pointerId!==this.pointerId||(this.dragCurrentX=t.clientX,this.scheduleDragRender()))}scheduleDragRender(){this.rafId===null&&(this.rafId=window.requestAnimationFrame(()=>{if(this.rafId=null,!this.isDragging)return;let e=(this.dragCurrentX-this.dragStartX)/this.stepSize;this.virtualIndex=this.dragStartIndex-e,this.render(0,{dragging:!0})}))}handleDragEnd(t){if(!this.isDragging||this.pointerId!==null&&t.pointerId!==this.pointerId)return;this.isDragging=!1,this.pointerId=null,this.viewport&&(this.viewport.style.cursor="");let e=this.dragCurrentX-this.dragStartX,s=Math.max(Number(this.options.dragThreshold)||0,this.stepSize*.12);if(Math.abs(e)<=s){this.goTo(this.dragStartIndex,!0);return}let r=Math.round(e/this.stepSize);this.goTo(this.dragStartIndex-r,!0)}handleClick(t){let e=t.target instanceof HTMLElement?t.target:null;if(!e)return;let s=e.closest(".coverflow-card");if(!s)return;let r=Number(s.dataset.index);if(!Number.isFinite(r))return;let i=this.getActiveIndex(),o=r===i,a=e.closest("a");if(!o){a&&t.preventDefault(),this.goTo(r,!0);return}}calculatePosition(t){let e=t===0?0:t>0?1:-1,s=Math.abs(t),r={rotateY:0,translateZ:110,scale:1.15,opacity:1,blur:0,brightness:1.1},i={rotateY:70,translateZ:-150,scale:.82,opacity:.55,blur:1.2,brightness:.78},o={rotateY:80,translateZ:-300,scale:.65,opacity:.32,blur:2,brightness:.75},a=(n,p,h)=>n+(p-n)*h;if(s<=1){let n=s;return{rotateY:e*a(r.rotateY,i.rotateY,n),translateZ:a(r.translateZ,i.translateZ,n),scale:a(r.scale,i.scale,n),opacity:a(r.opacity,i.opacity,n),blur:a(r.blur,i.blur,n),brightness:a(r.brightness,i.brightness,n),zIndex:Math.round(100-s*45)}}if(s<=2){let n=s-1;return{rotateY:e*a(i.rotateY,o.rotateY,n),translateZ:a(i.translateZ,o.translateZ,n),scale:a(i.scale,o.scale,n),opacity:a(i.opacity,o.opacity,n),blur:a(i.blur,o.blur,n),brightness:a(i.brightness,o.brightness,n),zIndex:Math.round(55-s*20)}}return{opacity:0,zIndex:0,blur:4,brightness:.65,scale:.6,translateZ:-350,rotateY:e*85}}render(t=0,e={}){var p;if(!this.track)return;let r=f()||e.dragging?0:Math.max(0,Number(t)||0),i=x(this.virtualIndex,0,Math.max(0,this.totalCards-1)),o=Math.round(i),a=Math.max(1,Math.floor((Number(this.options.visibleCards)||u.visibleCards)/2)),n=String(this.options.settleEase||u.settleEase);for(let h=0;h<this.cards.length;h++){let c=this.cards[h],b=h-i;if(!(Math.abs(b)<=a+.75)){c.style.opacity="0",c.style.transform="translate3d(0,0,0) scale(0.6)",c.style.filter="blur(4px) brightness(0.65)",c.style.zIndex="0",c.style.pointerEvents="none",c.setAttribute("aria-hidden","true"),this.setFocusable(c,!1);continue}let l=this.calculatePosition(b),S=`translate3d(${b*this.stepSize}px, 0, 0) rotateY(${l.rotateY||0}deg) translateZ(${l.translateZ||0}px) scale(${l.scale||1})`;c.style.transform=S,c.style.opacity=String((p=l.opacity)!=null?p:1),c.style.filter=`blur(${l.blur||0}px) brightness(${l.brightness||1})`,c.style.zIndex=String(l.zIndex||0),c.style.pointerEvents="auto",c.style.transition=r>0?`transform ${r}ms ${n}, opacity ${r}ms ${n}, filter ${r}ms ${n}`:"none";let v=h===o;c.classList.toggle("coverflow-card--active",v),c.setAttribute("aria-hidden",v?"false":"true"),this.setFocusable(c,v),c.style.willChange=e.dragging||r>0?"transform, opacity, filter":"auto"}this.announce(o)}getActiveIndex(){return Math.round(this.virtualIndex)}setFocusable(t,e){t.querySelectorAll("a[href],button:not([disabled]),input:not([disabled]),select:not([disabled]),textarea:not([disabled]),[tabindex]").forEach(r=>{let i=r;if(e)i.dataset.coverflowTabindex?(i.setAttribute("tabindex",i.dataset.coverflowTabindex),delete i.dataset.coverflowTabindex):i.getAttribute("tabindex")==="-1"&&i.removeAttribute("tabindex");else{let o=i.getAttribute("tabindex");o!==null&&(i.dataset.coverflowTabindex=o),i.setAttribute("tabindex","-1")}})}announce(t){var i,o,a,n;if(!this.statusEl||!this.cards.length)return;let e=this.cards[t],s=((o=(i=e==null?void 0:e.querySelector("h3"))==null?void 0:i.textContent)==null?void 0:o.trim())||((n=(a=e==null?void 0:e.querySelector("h2"))==null?void 0:a.textContent)==null?void 0:n.trim())||"",r=((t-this.setSize)%this.setSize+this.setSize)%this.setSize;this.statusEl.textContent=`Project ${r+1} of ${this.setSize}: ${s}`}goTo(t,e=!0){let s=f(),r=this.wrapIndex(Math.round(t));this.currentIndex=r,this.virtualIndex=r,this.render(s?0:e?this.options.rotationSpeed:0),!(s||!e)&&(window.clearTimeout(this._normalizeTimer),this._normalizeTimer=window.setTimeout(()=>{this.normalizeToMiddle()},Math.max(0,Number(this.options.rotationSpeed)||u.rotationSpeed)+20))}normalizeToMiddle(){let t=this.wrapIndex(this.currentIndex);t!==this.currentIndex&&(this.currentIndex=t,this.virtualIndex=t,this.render(0))}wrapIndex(t){let e=this.setSize,s=this.totalCards;if(e===0)return 0;let r=t;return r<e/2&&(r+=e),r>=s-e/2&&(r-=e),x(r,0,s-1)}next(){this.goTo(this.currentIndex+1,!0)}prev(){this.goTo(this.currentIndex-1,!0)}destroy(){window.removeEventListener("resize",this.onResize),this.element.classList.remove("coverflow-ready"),this.viewport&&(this.viewport.style.cursor="",this.viewport.replaceWith(this.viewport.cloneNode(!0))),this.cards=[]}};function w(){document.querySelectorAll("[data-coverflow-luxury]").forEach(t=>{try{let e=t;if(f()&&m("(max-width: 480px)").matches)return;new g(e)}catch(e){console.error("Coverflow init failed:",e)}})}typeof document!="undefined"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",w):w());export{g as default};
