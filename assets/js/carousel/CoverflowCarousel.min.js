function m(c,t,e){let s=Number(c),i=Number(t),r=Number(e);return Number.isFinite(s)?Math.max(i,Math.min(r,s)):i}function w(c,t){let e=null;return function(...i){e&&clearTimeout(e),e=setTimeout(()=>{e=null,c.apply(this,i)},Math.max(0,Number(t)||0))}}function y(c){try{return window.matchMedia?window.matchMedia(String(c)):{matches:!1}}catch(t){return{matches:!1}}}function p(){return y("(prefers-reduced-motion: reduce)").matches}function S(c=10){try{"vibrate"in navigator&&typeof navigator.vibrate=="function"&&navigator.vibrate(Math.max(0,Number(c)||0))}catch(t){}}var f={visibleCards:5,perspective:1600,rotationSpeed:320,settleEase:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",dragThreshold:10},v=class{constructor(t,e={}){this.element=t,this.options={...f,...e},this.viewport=t.querySelector(".coverflow-viewport"),this.track=t.querySelector(".coverflow-track"),this.originalCards=Array.from(t.querySelectorAll(".coverflow-card")),this.prevBtn=t.querySelector(".coverflow-btn--prev"),this.nextBtn=t.querySelector(".coverflow-btn--next"),this.statusEl=t.querySelector('[role="status"]'),this.setSize=this.originalCards.length,this.totalCards=this.setSize*3,this.currentIndex=this.setSize,this.virtualIndex=this.currentIndex,this.cards=[],this.isDragging=!1,this.dragStartX=0,this.dragCurrentX=0,this.dragStartIndex=this.currentIndex,this.pointerId=null,this.rafId=null,this.cardWidth=320,this.cardHeight=500,this.stepSize=280,this.onResize=w(()=>{this.measure(),this.render(0)},150),this.init()}init(){!this.viewport||!this.track||this.setSize===0||(this.element.hasAttribute("tabindex")||(this.element.tabIndex=0),this.buildTrack(),this.measure(),this.bindEvents(),this.element.classList.add("coverflow-ready"),this.virtualIndex=this.currentIndex,this.render(0),this.runEntranceAnimation())}buildTrack(){if(this.track){this.track.innerHTML="";for(let t=0;t<3;t++)for(let e=0;e<this.originalCards.length;e++){let i=this.originalCards[e].cloneNode(!0),r=t*this.originalCards.length+e;i.dataset.index=String(r),this.track.appendChild(i)}this.cards=Array.from(this.track.querySelectorAll(".coverflow-card"))}}bindEvents(){this.viewport&&(this.prevBtn&&this.prevBtn.addEventListener("click",()=>this.prev()),this.nextBtn&&this.nextBtn.addEventListener("click",()=>this.next()),this.element.addEventListener("keydown",t=>this.handleKeyboard(t)),this.viewport.addEventListener("pointerdown",t=>this.handleDragStart(t)),this.viewport.addEventListener("pointermove",t=>this.handleDragMove(t)),this.viewport.addEventListener("pointerup",t=>this.handleDragEnd(t)),this.viewport.addEventListener("pointercancel",t=>this.handleDragEnd(t)),this.viewport.addEventListener("click",t=>this.handleClick(t)),window.addEventListener("resize",this.onResize))}measure(){if(!this.track)return;let t=this.track.querySelector(".coverflow-card");if(!t)return;let e=t.getBoundingClientRect();if(e&&Number.isFinite(e.width)&&e.width>0){this.cardWidth=e.width,Number.isFinite(e.height)&&e.height>0&&(this.cardHeight=e.height);let i=((this.viewport&&this.viewport.getBoundingClientRect?this.viewport.getBoundingClientRect().width:0)||window.innerWidth||1024)<768?e.width*.8:e.width*.65;this.stepSize=Math.max(200,Math.min(450,i)),this.element.style.setProperty("--coverflow-card-w",`${Math.round(this.cardWidth)}px`),this.element.style.setProperty("--coverflow-card-h",`${Math.round(this.cardHeight)}px`)}this.viewport&&(this.viewport.style.perspective=`${Math.max(600,Number(this.options.perspective)||f.perspective)}px`)}handleKeyboard(t){if(t.key==="ArrowLeft"){t.preventDefault(),this.prev();return}if(t.key==="ArrowRight"){t.preventDefault(),this.next();return}if(t.key==="Home"){t.preventDefault(),this.goTo(this.setSize,!0);return}t.key==="End"&&(t.preventDefault(),this.goTo(this.setSize+this.setSize-1,!0))}handleDragStart(t){if(this.viewport&&!(t.pointerType==="mouse"&&t.button!==0)){this.pointerId=t.pointerId,this.isDragging=!0,this.dragStartX=t.clientX,this.dragCurrentX=t.clientX,this.dragStartIndex=this.currentIndex,this.virtualIndex=this.currentIndex;try{this.viewport.setPointerCapture(t.pointerId)}catch(e){}this.viewport.style.cursor="grabbing",this.viewport.style.filter="brightness(0.95)",S(10),this.render(0)}}handleDragMove(t){this.isDragging&&(this.pointerId!==null&&t.pointerId!==this.pointerId||(this.dragCurrentX=t.clientX,this.scheduleDragRender()))}scheduleDragRender(){this.rafId===null&&(this.rafId=window.requestAnimationFrame(()=>{if(this.rafId=null,!this.isDragging)return;let e=(this.dragCurrentX-this.dragStartX)/this.stepSize;this.virtualIndex=this.dragStartIndex-e,this.render(0,{dragging:!0})}))}handleDragEnd(t){if(!this.isDragging||this.pointerId!==null&&t.pointerId!==this.pointerId)return;this.isDragging=!1,this.pointerId=null,this.viewport&&(this.viewport.style.cursor="",this.viewport.style.filter="");let e=this.dragCurrentX-this.dragStartX,s=Math.max(Number(this.options.dragThreshold)||0,this.stepSize*.12);if(Math.abs(e)<=s){this.goTo(this.dragStartIndex,!0);return}let i=Math.round(e/this.stepSize);this.goTo(this.dragStartIndex-i,!0)}handleClick(t){let e=t.target instanceof HTMLElement?t.target:null;if(!e)return;let s=e.closest(".coverflow-card");if(!s)return;let i=Number(s.dataset.index);if(!Number.isFinite(i))return;let r=this.getActiveIndex(),o=i===r,n=e.closest("a");if(!o){n&&t.preventDefault(),this.goTo(i,!0);return}}calculatePosition(t){let e=t===0?0:t>0?1:-1,s=Math.abs(t),i={rotateY:0,translateZ:110,scale:1.15,opacity:1,blur:0,brightness:1.1},r={rotateY:70,translateZ:-150,scale:.82,opacity:.55,blur:1.2,brightness:.78},o={rotateY:80,translateZ:-300,scale:.65,opacity:.32,blur:2,brightness:.75},n=(a,u,g)=>a+(u-a)*g;if(s<=1){let a=s;return{rotateY:e*n(i.rotateY,r.rotateY,a),translateZ:n(i.translateZ,r.translateZ,a),scale:n(i.scale,r.scale,a),opacity:n(i.opacity,r.opacity,a),blur:n(i.blur,r.blur,a),brightness:n(i.brightness,r.brightness,a),zIndex:Math.round(100-s*45)}}if(s<=2){let a=s-1;return{rotateY:e*n(r.rotateY,o.rotateY,a),translateZ:n(r.translateZ,o.translateZ,a),scale:n(r.scale,o.scale,a),opacity:n(r.opacity,o.opacity,a),blur:n(r.blur,o.blur,a),brightness:n(r.brightness,o.brightness,a),zIndex:Math.round(55-s*20)}}return{opacity:0,zIndex:0,blur:4,brightness:.65,scale:.6,translateZ:-350,rotateY:e*85}}render(t=0,e={}){var g;if(!this.track)return;let s=p(),i=!!e.entrance,r=s||e.dragging?0:Math.max(0,Number(t)||0),o=m(this.virtualIndex,0,Math.max(0,this.totalCards-1)),n=Math.round(o),a=Math.max(1,Math.floor((Number(this.options.visibleCards)||f.visibleCards)/2)),u=i?"cubic-bezier(0.34, 1.56, 0.64, 1)":String(this.options.settleEase||f.settleEase);for(let l=0;l<this.cards.length;l++){let h=this.cards[l],b=l-o;if(!(Math.abs(b)<=a+.75)){h.style.opacity="0",h.style.transform="translate3d(0,0,0) scale(0.6)",h.style.filter="blur(4px) brightness(0.65)",h.style.zIndex="0",h.style.pointerEvents="none",h.setAttribute("aria-hidden","true"),this.setFocusable(h,!1);continue}let d=this.calculatePosition(b),M=`translate3d(${b*this.stepSize}px, 0, 0) rotateY(${d.rotateY||0}deg) translateZ(${d.translateZ||0}px) scale(${d.scale||1})`;h.style.transform=M,h.style.opacity=String((g=d.opacity)!=null?g:1),h.style.filter=`blur(${d.blur||0}px) brightness(${d.brightness||1})`,h.style.zIndex=String(d.zIndex||0),h.style.pointerEvents="auto",h.style.transitionDelay=i?`${Math.min(240,Math.round(Math.abs(l-n)*60))}ms`:"0ms",h.style.transition=r>0?`transform ${r}ms ${u}, opacity ${r}ms ${u}, filter ${r}ms ${u}`:"none";let x=l===n;h.classList.toggle("coverflow-card--active",x),h.setAttribute("aria-hidden",x?"false":"true"),this.setFocusable(h,x),h.style.willChange=e.dragging||r>0?"transform, opacity, filter":"auto"}this.announce(n)}getActiveIndex(){return Math.round(this.virtualIndex)}setFocusable(t,e){t.querySelectorAll("a[href],button:not([disabled]),input:not([disabled]),select:not([disabled]),textarea:not([disabled]),[tabindex]").forEach(i=>{let r=i;if(e)r.dataset.coverflowTabindex?(r.setAttribute("tabindex",r.dataset.coverflowTabindex),delete r.dataset.coverflowTabindex):r.getAttribute("tabindex")==="-1"&&r.removeAttribute("tabindex");else{let o=r.getAttribute("tabindex");o!==null&&(r.dataset.coverflowTabindex=o),r.setAttribute("tabindex","-1")}})}announce(t){var r,o,n,a;if(!this.statusEl||!this.cards.length)return;let e=this.cards[t],s=((o=(r=e==null?void 0:e.querySelector("h3"))==null?void 0:r.textContent)==null?void 0:o.trim())||((a=(n=e==null?void 0:e.querySelector("h2"))==null?void 0:n.textContent)==null?void 0:a.trim())||"",i=((t-this.setSize)%this.setSize+this.setSize)%this.setSize;this.statusEl.textContent=`Project ${i+1} of ${this.setSize}: ${s}`}goTo(t,e=!0){let s=p(),i=this.wrapIndex(Math.round(t));this.currentIndex=i,this.virtualIndex=i,this.render(s?0:e?this.options.rotationSpeed:0),!(s||!e)&&(window.clearTimeout(this._normalizeTimer),this._normalizeTimer=window.setTimeout(()=>{this.normalizeToMiddle()},Math.max(0,Number(this.options.rotationSpeed)||f.rotationSpeed)+20))}normalizeToMiddle(){let t=this.wrapIndex(this.currentIndex);t!==this.currentIndex&&(this.currentIndex=t,this.virtualIndex=t,this.render(0))}wrapIndex(t){let e=this.setSize,s=this.totalCards;if(e===0)return 0;let i=t,r=Math.min(3,Math.max(1,e));return i<r&&(i+=e),i>=s-r&&(i-=e),m(i,0,s-1)}next(){this.goTo(this.currentIndex+1,!0)}prev(){this.goTo(this.currentIndex-1,!0)}destroy(){window.removeEventListener("resize",this.onResize),this.element.classList.remove("coverflow-ready"),this.viewport&&(this.viewport.style.cursor="",this.viewport.replaceWith(this.viewport.cloneNode(!0))),this.cards=[]}runEntranceAnimation(){if(p()||!this.cards.length)return;let t=this.currentIndex;for(let e=0;e<this.cards.length;e++){let s=this.cards[e],i=e-t,r=this.calculatePosition(i),o=i*this.stepSize;s.style.transition="none",s.style.transitionDelay="0ms",s.style.opacity="0",s.style.transform=`translate3d(${o}px, 40px, -220px) rotateY(${r.rotateY||0}deg) translateZ(${(r.translateZ||0)-120}px) scale(${Math.max(.92,(r.scale||1)-.06)})`}window.setTimeout(()=>{this.render(600,{entrance:!0}),window.setTimeout(()=>{for(let e of this.cards)e.style.transitionDelay="0ms"},900)},100)}};function I(){document.querySelectorAll("[data-coverflow-luxury]").forEach(t=>{try{let e=t;if(p()&&y("(max-width: 480px)").matches)return;new v(e)}catch(e){console.error("Coverflow init failed:",e)}})}typeof document!="undefined"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I):I());export{v as default};
