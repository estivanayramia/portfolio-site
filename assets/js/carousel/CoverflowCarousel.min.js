(()=>{function g(h,t,e){let s=Number(h),i=Number(t),r=Number(e);return Number.isFinite(s)?Math.max(i,Math.min(r,s)):i}function y(h,t){let e=null;return function(...i){e&&clearTimeout(e),e=setTimeout(()=>{e=null,h.apply(this,i)},Math.max(0,Number(t)||0))}}function m(h){try{return window.matchMedia?window.matchMedia(String(h)):{matches:!1}}catch{return{matches:!1}}}function f(){return m("(prefers-reduced-motion: reduce)").matches}function w(h=10){try{"vibrate"in navigator&&typeof navigator.vibrate=="function"&&navigator.vibrate(Math.max(0,Number(h)||0))}catch{}}var u={visibleCards:5,perspective:1600,rotationSpeed:320,settleEase:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",dragThreshold:10},b=class{constructor(t,e={}){this.element=t,this.options={...u,...e},this.viewport=t.querySelector(".coverflow-viewport"),this.track=t.querySelector(".coverflow-track"),this.originalCards=Array.from(t.querySelectorAll(".coverflow-card")),this.prevBtn=t.querySelector(".coverflow-btn--prev"),this.nextBtn=t.querySelector(".coverflow-btn--next"),this.statusEl=t.querySelector('[role="status"]'),this.setSize=this.originalCards.length,this.totalCards=this.setSize*3,this.currentIndex=this.setSize,this.virtualIndex=this.currentIndex,this.cards=[],this.isDragging=!1,this.dragStartX=0,this.dragCurrentX=0,this.dragStartIndex=this.currentIndex,this.pointerId=null,this.rafId=null,this.cardWidth=320,this.cardHeight=500,this.stepSize=280,this.onResize=y(()=>{this.measure(),this.render(0)},150),this.init()}init(){!this.viewport||!this.track||this.setSize===0||(this.element.hasAttribute("tabindex")||(this.element.tabIndex=0),this.buildTrack(),this.measure(),this.bindEvents(),this.element.classList.add("coverflow-ready"),this.virtualIndex=this.currentIndex,this.render(0),this.runEntranceAnimation())}buildTrack(){if(this.track){this.track.innerHTML="";for(let t=0;t<3;t++)for(let e=0;e<this.originalCards.length;e++){let i=this.originalCards[e].cloneNode(!0),r=t*this.originalCards.length+e;i.dataset.index=String(r),this.track.appendChild(i)}this.cards=Array.from(this.track.querySelectorAll(".coverflow-card"))}}bindEvents(){this.viewport&&(this.prevBtn&&this.prevBtn.addEventListener("click",()=>this.prev()),this.nextBtn&&this.nextBtn.addEventListener("click",()=>this.next()),this.element.addEventListener("keydown",t=>this.handleKeyboard(t)),this.viewport.addEventListener("pointerdown",t=>this.handleDragStart(t)),this.viewport.addEventListener("pointermove",t=>this.handleDragMove(t)),this.viewport.addEventListener("pointerup",t=>this.handleDragEnd(t)),this.viewport.addEventListener("pointercancel",t=>this.handleDragEnd(t)),this.viewport.addEventListener("click",t=>this.handleClick(t)),window.addEventListener("resize",this.onResize))}measure(){if(!this.track)return;let t=this.track.querySelector(".coverflow-card");if(!t)return;let e=t.getBoundingClientRect();if(e&&Number.isFinite(e.width)&&e.width>0){this.cardWidth=e.width,Number.isFinite(e.height)&&e.height>0&&(this.cardHeight=e.height);let s=(this.viewport&&this.viewport.getBoundingClientRect?this.viewport.getBoundingClientRect().width:0)||window.innerWidth||1024,i=Math.max(1,Math.floor((Number(this.options.visibleCards)||u.visibleCards)/2)),a=(s/2-this.cardWidth/2-16)/i,o=s<768?e.width*.8:e.width*.55,n=g(o,90,450);this.stepSize=Number.isFinite(a)&&a>0?Math.min(n,a):n,this.element.style.setProperty("--coverflow-card-w",`${Math.round(this.cardWidth)}px`),this.element.style.setProperty("--coverflow-card-h",`${Math.round(this.cardHeight)}px`)}this.viewport&&(this.viewport.style.perspective=`${Math.max(600,Number(this.options.perspective)||u.perspective)}px`)}handleKeyboard(t){if(t.key==="ArrowLeft"){t.preventDefault(),this.prev();return}if(t.key==="ArrowRight"){t.preventDefault(),this.next();return}if(t.key==="Home"){t.preventDefault(),this.goTo(this.setSize,!0);return}t.key==="End"&&(t.preventDefault(),this.goTo(this.setSize+this.setSize-1,!0))}handleDragStart(t){if(this.viewport&&!(t.pointerType==="mouse"&&t.button!==0)){this.pointerId=t.pointerId,this.isDragging=!0,this.dragStartX=t.clientX,this.dragCurrentX=t.clientX,this.dragStartIndex=this.currentIndex,this.virtualIndex=this.currentIndex;try{this.viewport.setPointerCapture(t.pointerId)}catch{}this.viewport.style.cursor="grabbing",this.viewport.style.filter="brightness(0.95)",w(10),this.render(0)}}handleDragMove(t){this.isDragging&&(this.pointerId!==null&&t.pointerId!==this.pointerId||(this.dragCurrentX=t.clientX,this.scheduleDragRender()))}scheduleDragRender(){this.rafId===null&&(this.rafId=window.requestAnimationFrame(()=>{if(this.rafId=null,!this.isDragging)return;let e=(this.dragCurrentX-this.dragStartX)/200;this.virtualIndex=this.dragStartIndex-e,this.render(0,{dragging:!0})}))}handleDragEnd(t){if(!this.isDragging||this.pointerId!==null&&t.pointerId!==this.pointerId)return;this.isDragging=!1,this.pointerId=null,this.viewport&&(this.viewport.style.cursor="",this.viewport.style.filter="");let e=this.dragCurrentX-this.dragStartX,s=Math.max(Number(this.options.dragThreshold)||0,200*.12);if(Math.abs(e)<=s){this.goTo(this.dragStartIndex,!0);return}let i=Math.round(e/200);this.goTo(this.dragStartIndex-i,!0)}handleClick(t){let e=t.target instanceof HTMLElement?t.target:null;if(!e)return;let s=e.closest(".coverflow-card");if(!s)return;let i=Number(s.dataset.index);if(!Number.isFinite(i))return;let r=this.getActiveIndex(),a=i===r,o=e.closest("a");if(!a){o&&t.preventDefault(),this.goTo(i,!0);return}}calculatePosition(t){let e=t===0?0:t>0?1:-1,s=Math.abs(t),i={rotateY:0,translateZ:110,scale:1.15,opacity:1,blur:0,brightness:1.1},r={rotateY:70,translateZ:-150,scale:.82,opacity:.55,blur:1.2,brightness:.78},a={rotateY:80,translateZ:-300,scale:.65,opacity:.32,blur:2,brightness:.75},o=(n,p,d)=>n+(p-n)*d;if(s<=1){let n=s;return{rotateY:e*o(i.rotateY,r.rotateY,n),translateZ:o(i.translateZ,r.translateZ,n),scale:o(i.scale,r.scale,n),opacity:o(i.opacity,r.opacity,n),blur:o(i.blur,r.blur,n),brightness:o(i.brightness,r.brightness,n),zIndex:Math.round(100-s*45)}}if(s<=2){let n=s-1;return{rotateY:e*o(r.rotateY,a.rotateY,n),translateZ:o(r.translateZ,a.translateZ,n),scale:o(r.scale,a.scale,n),opacity:o(r.opacity,a.opacity,n),blur:o(r.blur,a.blur,n),brightness:o(r.brightness,a.brightness,n),zIndex:Math.round(55-s*20)}}return{opacity:0,zIndex:0,blur:4,brightness:.65,scale:.6,translateZ:-350,rotateY:e*85}}render(t=0,e={}){if(!this.track)return;let s=f(),i=!!e.entrance,r=s||e.dragging?0:Math.max(0,Number(t)||0),a=g(this.virtualIndex,0,Math.max(0,this.totalCards-1)),o=Math.round(a),n=Math.max(1,Math.floor((Number(this.options.visibleCards)||u.visibleCards)/2)),p=i?"cubic-bezier(0.34, 1.56, 0.64, 1)":String(this.options.settleEase||u.settleEase);for(let d=0;d<this.cards.length;d++){let c=this.cards[d],v=d-a;if(!(Math.abs(v)<=n+.75)){c.style.opacity="0",c.style.transform="translate3d(0,0,0) scale(0.6)",c.style.filter="blur(4px) brightness(0.65)",c.style.zIndex="0",c.style.pointerEvents="none",c.setAttribute("aria-hidden","true"),this.setFocusable(c,!1);continue}let l=this.calculatePosition(v),I=`translateX(${v*200}px) rotateY(${l.rotateY||0}deg) translateZ(${l.translateZ||0}px) scale(${l.scale||1})`;c.style.transform=I,c.style.opacity=String(l.opacity??1),c.style.filter=`blur(${l.blur||0}px) brightness(${l.brightness||1})`,c.style.zIndex=String(l.zIndex||0),c.style.pointerEvents="auto",c.style.transitionDelay=i?`${Math.min(240,Math.round(Math.abs(d-o)*60))}ms`:"0ms",c.style.transition=r>0?`transform ${r}ms ${p}, opacity ${r}ms ${p}, filter ${r}ms ${p}`:"none";let x=d===o;c.classList.toggle("coverflow-card--active",x),c.setAttribute("aria-hidden",x?"false":"true"),this.setFocusable(c,x),c.style.willChange=e.dragging||r>0?"transform, opacity, filter":"auto"}this.announce(o)}getActiveIndex(){return Math.round(this.virtualIndex)}setFocusable(t,e){t.querySelectorAll("a[href],button:not([disabled]),input:not([disabled]),select:not([disabled]),textarea:not([disabled]),[tabindex]").forEach(i=>{let r=i;if(e)r.dataset.coverflowTabindex?(r.setAttribute("tabindex",r.dataset.coverflowTabindex),delete r.dataset.coverflowTabindex):r.getAttribute("tabindex")==="-1"&&r.removeAttribute("tabindex");else{let a=r.getAttribute("tabindex");a!==null&&(r.dataset.coverflowTabindex=a),r.setAttribute("tabindex","-1")}})}announce(t){if(!this.statusEl||!this.cards.length)return;let e=this.cards[t],s=e?.querySelector("h3")?.textContent?.trim()||e?.querySelector("h2")?.textContent?.trim()||"",i=((t-this.setSize)%this.setSize+this.setSize)%this.setSize;this.statusEl.textContent=`Project ${i+1} of ${this.setSize}: ${s}`}goTo(t,e=!0){let s=f(),i=this.wrapIndex(Math.round(t));this.currentIndex=i,this.virtualIndex=i,this.render(s?0:e?this.options.rotationSpeed:0),!(s||!e)&&(window.clearTimeout(this._normalizeTimer),this._normalizeTimer=window.setTimeout(()=>{this.normalizeToMiddle()},Math.max(0,Number(this.options.rotationSpeed)||u.rotationSpeed)+20))}normalizeToMiddle(){let t=this.wrapIndex(this.currentIndex);t!==this.currentIndex&&(this.currentIndex=t,this.virtualIndex=t,this.render(0))}wrapIndex(t){let e=this.setSize,s=this.totalCards;if(e===0)return 0;let i=t,r=Math.min(3,Math.max(1,e));return i<r&&(i+=e),i>=s-r&&(i-=e),g(i,0,s-1)}next(){this.goTo(this.currentIndex+1,!0)}prev(){this.goTo(this.currentIndex-1,!0)}destroy(){window.removeEventListener("resize",this.onResize),this.element.classList.remove("coverflow-ready"),this.viewport&&(this.viewport.style.cursor="",this.viewport.replaceWith(this.viewport.cloneNode(!0))),this.cards=[]}runEntranceAnimation(){if(f()||!this.cards.length)return;let t=this.currentIndex;for(let e=0;e<this.cards.length;e++){let s=this.cards[e],i=e-t,r=this.calculatePosition(i),a=i*200;s.style.transition="none",s.style.transitionDelay="0ms",s.style.opacity="0",s.style.transform=`translateX(${a}px) translateY(40px) rotateY(${r.rotateY||0}deg) translateZ(${(r.translateZ||0)-120}px) scale(${Math.max(.92,(r.scale||1)-.06)})`}window.setTimeout(()=>{this.render(600,{entrance:!0}),window.setTimeout(()=>{for(let e of this.cards)e.style.transitionDelay="0ms"},900)},100)}};function S(){document.querySelectorAll("[data-coverflow-luxury]").forEach(t=>{try{let e=t;if(f()&&m("(max-width: 480px)").matches)return;new b(e)}catch(e){console.error("Coverflow init failed:",e)}})}typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S):S());})();
